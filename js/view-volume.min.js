var widgetData={ytLoaded:!1,ytCall:null,ytCode:null,timer:null,extract:null,sTime:null,eTime:null,playing:!1,widget:null,xscriptOn:!1,tcArray:null,tcIndex:-1};
function PViewFrame(E){function y(c){c!==p&&(p=c,jQuery(u()+" div.lgnd-container div.lgnd-handle button.lgnd-update").prop("disabled",!c))}function u(){return"#view-frame-"+E}function P(c){c=jQuery(u()+" div.view-controls select.view-viz-select option:selected").val();PState.set(PSTATE_BUILD);I(c,!0);PState.set(PSTATE_READY)}function Q(c){l.flags()&V_FLAG_LGND&&jQuery(u()+" div.lgnd-container").toggle("slide",{direction:"left"});c.preventDefault()}function F(c){function e(a){return a.replace(/^[ \f\t\v\u200b]+|[ \f\t\v\u200b]+$/g,
"")}function f(a){var b=new Number,d=parseTC.exec(a);if(null!==d)b=1E3*(3600*parseInt(d[1])+60*parseInt(d[2])+parseFloat(d[3])),b=1==d[4].length?b+100*parseInt(d[4]):b+10*parseInt(d[4]);else throw Error("Error in transcript file: Cannot parse "+a+" as timecode.");return b}function h(a,b){var d=new String(a),d=e(d).split(/\r\n|\r|\n/g),v=[];if(d){var g,c=0;_.each(d,function(a){a=e(a);0<a.length&&("["===a.charAt(0)?(0<c&&v.push(g),g=""):(0<g.length&&(g+="<br/>"),g+=a),c++)})}_.each(v,function(a,d){b.find('div.timecode[data-tcindex="'+
d+'"]').next().after('<div class="xscript">'+a+"</div>")})}function m(a){widgetData.tcArray=[];widgetData.tcIndex=-1;var b=widgetData.tcArray;a=new String(a);if(a=e(a).split(/\r\n|\r|\n/g)){var d=jQuery("#xscript-tbl"),v=0,g,c=0,A=0,k="";_.each(a,function(a){a=e(a);1<a.length&&("["===a.charAt(0)&&"0"<=a.charAt(1)&&"9">=a.charAt(1)?(g=f(a),0<k.length&&(A&&b.push({s:c,e:g}),d.append('<div class="row"><div class="timecode" data-timecode="'+c+'" data-tcindex="'+v++ +'">'+A+'</div><div class="xscript">'+
k+"</div></div>"),k=""),A=a,c=g):(0<k.length&&(k+="<br/>"),k+=a))});0<k.length&&(b.push({s:c,e:324E5}),d.append('<div class="row"><div class="timecode" data-timecode="'+c+'" data-tcindex="'+v+'">'+A+'</div><div class="xscript">'+k+"</div></div>"));"undefined"!==typeof J&&null!=J&&jQuery.ajax({type:"POST",url:prspdata.ajax_url,data:{action:"prsp_get_transcript",transcript:J,excerpt:widgetData.extract},success:function(a,b,v){h(JSON.parse(a),d)},error:function(a,b,d){alert(d)}})}}function C(a){var b,
d=widgetData.tcIndex;_.find(widgetData.tcArray,function(v,g){if((b=v.s<=a&&a<v.e)&&g!=d){var c=jQuery("#xscript-tbl");if(document.getElementById("sync-xscript").checked){var f=c.find('[data-tcindex="'+g+'"]').offset().top-c.offset().top,f=c.scrollTop()+f;c.animate({scrollTop:f},300)}-1!=d&&c.find('[data-tcindex="'+d+'"]').removeClass("current");c.find('[data-tcindex="'+g+'"]').addClass("current");widgetData.tcIndex=g}return b})}function q(){widgetData.widget=new YT.Player("yt-widget",{width:B-40,
height:Math.floor(9*(B-40)/16),videoId:widgetData.ytCode,events:{onError:function(a){console.log("YouTube Error: "+a.data)},onStateChange:function(a){var d;switch(a.data){case 1:widgetData.playing=!0;null==widgetData.timer&&(widgetData.timer=setInterval(function(){d=1E3*widgetData.widget.getCurrentTime();widgetData.playing&&widgetData.xscriptOn&&C(d)},300));break;case 0:case 2:widgetData.playing=!1;window.clearInterval(widgetData.timer);widgetData.timer=null;break;case 3:case 5:widgetData.playing=
!1}},onReady:function(){widgetData.extract&&widgetData.widget.cueVideoById({videoId:widgetData.ytCode,startSeconds:widgetData.sTime/1E3,endSeconds:widgetData.eTime/1E3})}}})}function r(){widgetData.playing=!0}function k(){widgetData.playing=!1}function n(){widgetData.playing&&widgetData.xscriptOn&&C(1E3*widgetData.widget.currentTime)}function u(){switch(A){case 3:null!=widgetData.widget&&(widgetData.widget.removeEventListener("ended",k),widgetData.widget.removeEventListener("pause",k),widgetData.widget.removeEventListener("playing",
r),widgetData.widget.removeEventListener("timeupdate",n));case 1:null!=widgetData.widget&&widgetData.playing&&widgetData.widget.pause();widgetData.playing=!1;widgetData.widget=null;break;case 2:widgetData.ytCall=null,null!=widgetData.widget&&widgetData.playing&&widgetData.widget.stopVideo(),widgetData.widget=null,widgetData.playing=!1,null!=widgetData.timer&&(window.clearInterval(widgetData.timer),widgetData.timer=null)}}function x(){function a(){widgetData.sTime=widgetData.eTime=null;var b;(b=prspdata.e.i.t.tcAtts[e])&&
(b=p.a[b])&&""!==b&&(widgetData.extract=b,b=b.split("-"),widgetData.sTime=f(b[0]),widgetData.eTime=f(b[1]))}var d=w[z];p=PData.rByN(d);var b=" "+p.l+" ("+(z+1)+"/"+w.length+") ",c=jQuery("#inspect-name");c.text(b);c.prop("title",p.id);var e=PData.n2T(d);v.empty();g=null;A=0;widgetData.extract=null;widgetData.xscriptOn=!1;widgetData.playing=!1;if(prspdata.e.i.modal.scOn||"boolean"===typeof prspdata.e.i.modal.aOn&&prspdata.e.i.modal.aOn)if(g=prspdata.e.i.sc.atts[e])if(b=p.a[g])if(a(),b.match(/soundcloud\.com/)){var h=
!0;A=1;v.append('<iframe id="sc-widget" class="player" width="100%" height="110" src="http://w.soundcloud.com/player/?url='+b+'"></iframe>');var l=SC.Widget(document.getElementById("sc-widget"));widgetData.widget=l;l.bind(SC.Widget.Events.READY,function(){l.play();l.bind(SC.Widget.Events.PLAY,function(){widgetData.playing=!0});l.bind(SC.Widget.Events.PAUSE,function(){widgetData.playing=!1});l.bind(SC.Widget.Events.PLAY_PROGRESS,function(a){h&&(l.pause(),h=!1,widgetData.playing=!1);widgetData.extract&&
(a.currentPosition<widgetData.sTime?l.seekTo(widgetData.sTime):a.currentPosition>widgetData.eTime&&(l.pause(),widgetData.playing=!1));widgetData.playing&&widgetData.xscriptOn&&C(a.currentPosition)});l.bind(SC.Widget.Events.FINISH,function(){widgetData.playing=!1})})}else A=3,widgetData.extract&&(c=widgetData.extract.split("-"),b+="#t="+c[0]+","+c[1]),v.append('<audio id="na-widget" controls src="'+b+'"></audio>'),widgetData.widget=document.getElementById("na-widget"),widgetData.widget.addEventListener("ended",
k),widgetData.widget.addEventListener("pause",k),widgetData.widget.addEventListener("playing",r),widgetData.widget.addEventListener("timeupdate",n);0===A&&prspdata.e.i.modal.ytOn&&(g=prspdata.e.i.yt.atts[e])&&(b=p.a[g])&&(a(),widgetData.ytCode=b,v.append('<div id="yt-widget"></div>'),widgetData.ytCall=q,widgetData.ytLoaded?q():(widgetData.ytLoaded=!0,b=document.createElement("script"),b.src="https://www.youtube.com/iframe_api",c=document.getElementsByTagName("script")[0],c.parentNode.insertBefore(b,
c)),A=2);prspdata.e.i.modal.tOn&&(b=prspdata.e.i.t.t1Atts[e])&&""!==b&&"disable"!==b&&(b=p.a[b],"string"===typeof b&&""!==b&&(0<A&&v.append("<div>"+document.getElementById("dltext-sync-xscript").innerHTML+"</div>"),v.find("#xscript-tbl").remove(),v.append('<div id="xscript-tbl"></div>'),widgetData.xscriptOn=!0,jQuery("#xscript-tbl").click(function(a){if(A&&jQuery(a.target).hasClass("timecode"))switch(a=jQuery(a.target).data("timecode"),A){case 1:widgetData.playing||(widgetData.playing=!0,widgetData.widget.play());
widgetData.widget.seekTo(a);break;case 2:widgetData.playing||(widgetData.playing=!0,widgetData.widget.playVideo());widgetData.widget.seekTo(a/1E3);break;case 3:widgetData.playing||(widgetData.playing=!0,widgetData.widget.play()),widgetData.widget.currentTime=a/1E3}}),J=null,(c=prspdata.e.i.t.t2Atts[e])&&""!==c&&"disable"!==c&&(J=p.a[c]),jQuery.ajax({type:"POST",url:prspdata.ajax_url,data:{action:"prsp_get_transcript",transcript:b,excerpt:widgetData.extract},success:function(a,b,d){m(JSON.parse(a))},
error:function(a,b,d){alert(d)}})));prspdata.e.i.modal.atts[e].forEach(function(a){var b=PData.rAV(d,a,!1);if(b){a=PData.aByID(a);var g;"_"==a.def.l.charAt(0)?g="<div>"+b+"</div>":(g='<div><span class="att-label">'+a.def.l+":</span> ","I"==a.def.t&&(g+="<br/>"),g+=b+"</div>");v.append(g)}})}function a(a){a=z+a;-1==a?a=w.length-1:a==w.length&&(a=0);a!=z&&(z=a,u(),x())}function b(b){a(-1)}function d(b){a(1)}var v=jQuery("#inspect-content"),g=null,A=0,J,B=450,K=400,w=null;l&&(w=l.getSel());if(null!=
w&&0!=w.length){var y,p,z=0;prspdata.e.i.modal.scOn&&(B=550);prspdata.e.i.modal.ytOn&&(B=Math.max(B,475),K=500);prspdata.e.i.modal.tOn&&(K+=100,prspdata.e.i.modal.t2On?(B=Math.max(750,Math.floor(.8*jQuery(document).width())),B=Math.min(900,B)):B=Math.max(B,550));"number"===typeof prspdata.e.i.modal.w&&(B=prspdata.e.i.modal.w);"number"===typeof prspdata.e.i.modal.h&&(K=prspdata.e.i.modal.h);D(!1);x();jQuery("#btn-inspect-left").click(b);jQuery("#btn-inspect-right").click(d);y=jQuery("#dialog-inspector").dialog({width:B,
height:K,modal:!0,buttons:[{text:dlText.seerec,click:function(){window.open(prspdata.site_url+"?p="+p.wp,"_blank")}},{text:dlText.close,click:function(){y.dialog("close")}}]});y.on("dialogclose",function(a,b){u();jQuery("#btn-inspect-left").off("click");jQuery("#btn-inspect-right").off("click");D(!0);y.off("dialogclose")});c.preventDefault()}}function D(c){var e=jQuery(u()+" div.view-controls");c?(e.find(".osel").button("enable"),e.find(".osel").addClass("pulse"),e.find(".xsel").button("enable")):
(e.find(".osel").button("disable"),e.find(".osel").removeClass("pulse"),e.find(".xsel").button("disable"))}function L(c){jQuery("body").trigger("prospect",{s:PSTATE_HILITE,v:E,t:l.tUsed});c.preventDefault()}function R(c){PState.set(PSTATE_UPDATE);l&&l.clearSel();D(!1);PState.set(PSTATE_READY);c.preventDefault()}function M(c){l&&l.doOptions();c.preventDefault()}function G(c){var e=jQuery("#dialog-vnotes").dialog({width:300,height:300,modal:!0,buttons:[{text:dlText.ok,click:function(){e.dialog("close")}}]});
c.preventDefault()}function N(c,e){jQuery(u()+' div.lgnd-container div.lgnd-scroll div.lgnd-template[data-index="'+c+'"] div.lgnd-group input.lgnd-entry-check').prop("checked",e);y(!0)}function O(c){var e=jQuery(c.target).closest("div.lgnd-template").data("index"),f=c.target.className;switch(f){case "lgnd-update":l&&x&&(PState.set(PSTATE_BUILD),D(!1),l.render(x),y(!1),PState.set(PSTATE_READY));break;case "lgnd-entry-check":f=jQuery(c.target).closest("div.lgnd-entry");c=jQuery(c.target).is(":checked");
f.hasClass("lgnd-sh")?N(e,c):f.hasClass("lgnd-locate")?(f.data("id"),y(!0)):f.hasClass("lgnd-value")&&(f.data("index"),y(!0));break;case "lgnd-viz":case "lgnd-value-title":f=jQuery(c.target).closest("div.lgnd-entry");f.hasClass("lgnd-locate")?(c=f.data("id"),jQuery(u()+' div.lgnd-container div.lgnd-scroll div.lgnd-template[data-index="'+e+'"] div.lgnd-locate input.lgnd-entry-check').prop("checked",!1),jQuery(u()+' div.lgnd-container div.lgnd-scroll div.lgnd-template[data-index="'+e+'"] div.lgnd-locate[data-id="'+
c+'"] input.lgnd-entry-check').prop("checked",!0),y(!0)):f.hasClass("lgnd-value")&&(c=f.data("index"),jQuery(u()+' div.lgnd-container div.lgnd-scroll div.lgnd-template[data-index="'+e+'"] div.lgnd-group input.lgnd-entry-check').prop("checked",!1),jQuery(u()+' div.lgnd-container div.lgnd-scroll div.lgnd-template[data-index="'+e+'"] div.lgnd-group div.lgnd-value[data-index="'+c+'"] input.lgnd-entry-check').prop("checked",!0),y(!0));break;case "lgnd-template":case "lgnd-select":case "":break;default:f.match(/lgnd-sh/i)&&
(f=jQuery(c.target).find("input.lgnd-entry-check"),c=!f.is(":checked"),f.prop("checked",c),N(e,c))}}function T(c){var e=jQuery(c.target).closest("div.lgnd-template").data("index");c=jQuery(c.target).val();H(e,c);y(!0)}function H(c,e){var f,h=jQuery(u()+' div.lgnd-container div.lgnd-scroll div.lgnd-template[data-index="'+c+'"] div.lgnd-group');h.empty();z[c]=e;var l=PData.aByID(e);"undefined"!==typeof l.r.u&&(f='<div class="lgnd-value lgnd-entry" data-index="-1"><input type="checkbox" checked="checked" class="lgnd-entry-check"/><div class="lgnd-viz" style="background-color: '+
l.r.u.v+'"> </div> <span class="lgnd-value-title">'+dlText.undef+"</span></div>",h.append(f));l.l.forEach(function(c,e){f='<div class="lgnd-value lgnd-entry" data-index="'+e+'"><input type="checkbox" checked="checked" class="lgnd-entry-check"/><div class="lgnd-viz" style="background-color: '+c.v+'"> </div> <span class="lgnd-value-title">'+c.l+"</span></div>";h.append(f);c.z&&0<c.z.length&&c.z.forEach(function(c,k){f='<div class="lgnd-value lgnd-entry" data-index="'+e+","+k+'"><input type="checkbox" checked="checked" class="lgnd-entry-check"/>';
f=c.v&&""!==c.v?f+('<div class="lgnd-viz" style="background-color: '+c.v+'"></div>'):f+'<div class="lgnd-viz lgnd-viz-empty"></div>';f+=' <span class="lgnd-value-title">&raquo; '+c.l+"</span></div>";h.append(f)})});jQuery(u()+' div.lgnd-container div.lgnd-scroll div.lgnd-template[data-index="'+c+'"] div.lgnd-sh input').prop("checked",!0)}function I(c,e){var f=PData.vByN(c);l&&(l.teardown(),l=null);var h=jQuery(u());h.find("div.viz-content div.viz-result").empty();var t;switch(f.vf){case "M":t=new VizMap(m,
f.c);break;case "C":t=new VizCards(m,f.c);break;case "P":t=new VizPinboard(m,f.c);break;case "T":t=new VizTime(m,f.c);break;case "D":t=new VizDirectory(m,f.c);break;case "t":t=new VizTextStream(m,f.c);break;case "S":t=new VizStackChart(m,f.c);break;case "N":t=new VizNetWheel(m,f.c);break;case "F":t=new VizFlow(m,f.c);break;case "B":t=new VizBrowser(m,f.c);break;case "m":t=new VizMBMap(m,f.c)}w=c;var p=t.flags();p&V_FLAG_HSCRL?(h.find("div.viz-content").addClass("h-scroll"),h.find("div.viz-result").addClass("viz-fit-w"),
h.find("div.viz-result").removeClass("viz-max-w")):(h.find("div.viz-content").removeClass("h-scroll"),h.find("div.viz-result").removeClass("viz-fit-w"),h.find("div.viz-result").addClass("viz-max-w"));p&V_FLAG_VSCRL?(h.find("div.viz-content").addClass("v-scroll"),h.find("div.viz-result").addClass("viz-fit-h"),h.find("div.viz-result").removeClass("viz-max-h")):(h.find("div.viz-content").removeClass("v-scroll"),h.find("div.viz-result").removeClass("viz-fit-h"),h.find("div.viz-result").addClass("viz-max-h"));
z=[];if(p&V_FLAG_LGND){h.find(".hslgnd").button("enable");var q=h.find("div.lgnd-container div.lgnd-scroll");q.empty();if(p&V_FLAG_SLGND){var r=t.getFeatureAtts(),k=PData.aByID(r);q.append('<div class="lgnd-template" data-index="0"><div class="lgnd-title">'+k.def.l+'</div><div class="lgnd-entry lgnd-sh"><input type="checkbox" checked="checked" class="lgnd-entry-check"/><i>'+dlText.sha+'</i></div><div class="lgnd-group"></div></div>');z.push(r);H(0,r)}else{var n=!1;prspdata.e.g.ts.forEach(function(c,
f){var a=PData.tByID(c),b=t.getLocAtts(f);if(b&&0<b.length||!(p&V_FLAG_LOC)){var d=t.getFeatureAtts(f);if(0<d.length){n&&q.append("<hr/>");var v=jQuery('<div class="lgnd-template" data-index="'+f+'"><div class="lgnd-title">'+a.l+"</div></div>");b&&b.forEach(function(a,b){var d=PData.aByID(a);v.append('<div class="lgnd-entry lgnd-locate" data-id="'+a+'"><input type="checkbox" checked="checked" class="lgnd-entry-check"/><span class="lgnd-value-title">'+d.def.l+"</span></div>")});var g='<select class="lgnd-select">';
d.forEach(function(a,b){var d=PData.aByID(a);g+='<option value="'+a+'">'+d.def.l+"</option>"});g+="</select>";a=jQuery(g);a.change(T);jQuery(v).append(a);jQuery(v).append('<div class="lgnd-entry lgnd-sh"><input type="checkbox" checked="checked" class="lgnd-entry-check"/><i>'+dlText.sha+'</i></div><div class="lgnd-group"></div>');q.append(v);d=d[0];z.push(d);H(f,d);n=!0}}})}h.find("div.lgnd-container").show()}else h.find("button.hslgnd").button("disable"),h.find("div.lgnd-container").hide();y(!1);
p&V_FLAG_SEL?(h.find(".hilite").button("enable"),jQuery("#save-prspctv-h"+E).prop("disabled",!1).prop("checked",!1)):(h.find(".hilite").button("disable"),jQuery("#save-prspctv-h"+E).prop("disabled",!0).prop("checked",!1));p&V_FLAG_OPT?h.find(".vopts").button("enable"):h.find(".vopts").button("disable");(r=t.hint())||"string"===typeof f.n&&""!==f.n?(h.find(".vnote").button("enable"),r=r?"string"===typeof f.n&&""!==f.n?r+(".<br/>"+f.n):r+".":f.n,jQuery("#vnotes-txt").empty().append(r)):h.find(".vnote").button("disable");
t.setup();D(!1);x&&e&&t.render(x);l=t}var m={},w=0,l=null,z=[],p=null,x=null;m.getFrameID=u;m.getIndex=function(){return E};m.setViz=function(c,e){c!=w&&(jQuery(u()+" div.view-controls select.view-viz-select").val(c),I(c,e))};m.initDOM=function(c){var e=document.getElementById("dltext-view-controls").innerHTML;jQuery("#viz-frame").append('<div id="view-frame-'+E+'">'+e+"</div>");var e=jQuery(u()),f=prspdata.bClrs.vf;f&&0<f.length&&e.find("div.view-controls").css("background-color",f);e.find("div.lgnd-container").draggable({handle:e.find("div.lgnd-handle"),
containment:"parent"});var h=e.find("div.view-controls select.view-viz-select");prspdata.e.vf.forEach(function(c,f){h.append('<option value="'+f+'">'+c.l+"</option>")});h.val(c);h.change(P);e.find("div.view-controls button:first").button({icons:{primary:"ui-icon-bookmark"},text:!1}).click(Q).next().button({icons:{primary:"ui-icon-wrench"},text:!1}).click(M).next().button({icons:{primary:"ui-icon-info"},text:!1}).click(G).next().button({icons:{primary:"ui-icon-star"},text:!1}).click(L).next().button({icons:{primary:"ui-icon-cancel"},
text:!1}).click(R).next().button({icons:{primary:"ui-icon-search"},text:!1}).click(F).next();e.find("div.lgnd-container").click(O);I(c,!1)};m.getSelLocAtts=function(c){var e=[];jQuery(u()+' div.lgnd-container div.lgnd-scroll div.lgnd-template[data-index="'+c+'"] div.lgnd-locate input:checked').each(function(){var c=jQuery(this).parent().data("id");e.push(c)});return e};m.getSelFeatAtts=function(c){var e=[],f,h;jQuery(u()+' div.lgnd-container div.lgnd-scroll div.lgnd-template[data-index="'+c+'"] div.lgnd-group div.lgnd-value input:checked').each(function(){f=
jQuery(this).parent().data("index");"number"==typeof f?e.push(f):-1!=(h=f.indexOf(","))?e.push([parseInt(f.substring(0,h),10),parseInt(f.substring(h+1),10)]):e.push(parseInt(f,10))});return e};m.getSelLegend=function(c){return z[c]};m.getLgndSels=function(){return z.slice(0)};m.setLgndSels=function(c){c.forEach(function(c,f){c&&(jQuery(u()+' div.lgnd-container div.lgnd-scroll div.lgnd-template[data-index="'+f+'"] select.lgnd-select').val(c),H(f,c))})};m.getState=function(){return l?l.getState():null};
m.setState=function(c){l&&l.setState(c)};m.showStream=function(c){x=c;l&&l.render(c);y(!1)};m.setStream=function(c){x=c};m.selBtns=function(c){D(c)};m.clearSel=function(){l&&l.clearSel();D(!1)};m.setSel=function(c){return l&&l.flags()&V_FLAG_SEL?(l.setSel(c),D(0<c.length),!0):!1};m.resize=function(){l&&l.resize()};m.title=function(){return PData.vByN(w).l};m.flushLgnd=function(){jQuery(u()).find("div.lgnd-container").css("left","10px")};m.getBMData=function(){return l?{t:l.tUsed,r:l.rMap}:null};return m}
jQuery(document).ready(function(E){function y(a){window.location.href=prspdata.e.g.hurl;a.preventDefault()}function u(a,b,d,c){jQuery("#filter-list li").removeClass("selected");var g,f,e,h;jQuery("#filter-list li").each(function(b){g=jQuery(this);f=g.data("id");"_remove"==f?a?g.show():g.hide():d?(e=PData.aByID(f),h=!1,e.t.forEach(function(a,b){h=h||a&&d[b]}),h?g.show():g.hide()):g.show()});var k,l={height:300,width:350,modal:!0,buttons:[{text:dlText.add,click:function(){var a=jQuery("#filter-list li.selected");
1===a.length&&c(a.data("id"));k.dialog("close")}},{text:dlText.cancel,click:function(){k.dialog("close")}}]};b&&(l.appendTo="#dialog-2");k=jQuery("#dialog-choose-att").dialog(l)}function P(a){var b=l[a],d=w[1],c=0,g,f=0,e;PState.set(PSTATE_PROCESS);if(0===a){r=[];k=null;n=[];jQuery("#text-frame a").removeClass("sel");null==q&&D();b.evalPrep();e=q.t[0];a:for(;c<q.l;){for(;0==e.n||e.i+e.n==c;){if(++f===PData.eTNum())break a;e=q.t[f];c=e.i}a=q.s[c++];g=PData.rByN(a);b.eval(g)&&(r.push(g.id),n.push(a))}b.evalDone(q.l);
r.sort();r.forEach(function(a){jQuery('#text-frame a[data-id="'+a+'"]').addClass("sel")});PState.set(PSTATE_UPDATE);switch(x){case "v0":case "v1":0<n.length?d.setSel(n):d.clearSel();break;case "v2":L(),d.showStream(k)}}else{var h=d.getBMData(),m=[];if(null!=p){b.evalPrep();e=p.t[0];a:for(;c<p.l;){for(;!h.t[f]||0==e.n||e.i+e.n==c;){if(++f===PData.eTNum())break a;e=p.t[f];c=e.i}a=p.s[c++];h.r[a>>4]&1<<(a&15)&&(g=PData.rByN(a),b.eval(g)&&m.push(a))}b.evalDone(p.l)}PState.set(PSTATE_UPDATE);0<m.length?
d.setSel(m):d.clearSel()}PState.set(PSTATE_READY)}function Q(a,b){var d;d=jQuery("#dialog-hilite-"+a).dialog({height:275,width:Math.min(jQuery(window).width()-20,675),modal:!0,appendTo:"#dialog-1",buttons:[{text:dlText.chsatt,click:function(){u(!1,!0,b,function(b){var d;if("_remove"==b)d=new PFilterRemove(a),b={t:[!0,!0,!0,!0]};else switch(b=PData.aByID(b),b.def.t){case "V":d=new PFilterVocab(a,b);break;case "T":d=new PFilterText(a,b);break;case "g":d=new PFilterTags(a,b);break;case "N":d=new PFilterNum(a,
b);break;case "D":d=new PFilterDates(a,b)}jQuery("#dialog-hilite-"+a+" span.filter-id").html(b.def.l);jQuery("#hilite-"+a).empty();d.setup();l[a]=d})}},{text:dlText.ok,click:function(){d.dialog("close");null!==l[a]&&P(a)}},{text:dlText.cancel,click:function(){d.dialog("close")}}]})}function F(){var a=w[1];if(a)switch(x){case "v0":a.showStream(p);null==n&&R();0<n.length?a.setSel(n):a.clearSel();break;case "v1":null==q&&D();a.showStream(q);null==n&&R();0<n.length?a.setSel(n):a.clearSel();break;case "v2":a.clearSel(),
null==k&&L(),a.showStream(k)}}function D(){q={s:[],t:[],l:0};var a,b,d,c;b=0;for(d=PData.eTNum();b<d;b++)q.t.push({i:0,n:0});C.forEach(function(g){a=PData.nByID(g);if(null!=a){0===q.s.length?q.s.push(a):(b=_.sortedIndex(q.s,a),q.s.splice(b,0,a));c=PData.n2T(a);for(q.t[c++].n+=1;c<d;)q.t[c++].i+=1;q.l+=1}})}function L(){k={s:[],t:[],l:0};var a,b,d,c;b=0;for(d=PData.eTNum();b<d;b++)k.t.push({i:0,n:0});r.forEach(function(g){a=PData.nByID(g);if(null!=a){0===k.s.length?k.s.push(a):(b=_.sortedIndex(k.s,
a),k.s.splice(b,0,a));c=PData.n2T(a);for(k.t[c++].n+=1;c<d;)k.t[c++].i+=1;k.l+=1}})}function R(){n=[];var a,b;r.forEach(function(d){a=PData.nByID(d);0===n.length?n.push(a):(b=_.sortedIndex(n,a),n.splice(b,0,a))})}function M(){var a,b,d,c=jQuery("#text-frame");c.empty();h.forEach(function(g,f){a=e[f];if(g.c)for(c.append(jQuery(a.e).clone()),d=jQuery(a.e).next();0!=d.length;)switch(d.prop("tagName").toUpperCase()){case "H1":case "H2":d=[];break;default:c.append(d.clone()),d=d.next()}g.s.forEach(function(g,
f){if(g)for(b=a.s[f],c.append(jQuery(b).clone()),d=jQuery(b).next();0!=d.length;)switch(d.prop("tagName").toUpperCase()){case "H1":case "H2":d=[];break;default:c.append(d.clone()),d=d.next()}})});C=[];q=null;r=[];n=k=null;jQuery("#text-frame").find("a").each(function(a){if(a=jQuery(this).data("id"))if(0==C.length)C.push(a);else{var b=_.sortedIndex(C,a);C[b]!==a&&C.splice(b,0,a)}})}function G(a,b,d){if(a)for(var c=0;c<h.length;c++){a=h[c];a.c=!1;for(var g=0;g<a.s.length;g++)a.s[g]=!1}a=h[b];-1==d?
a.c=!0:a.s[d]=!0;N();M();F()}function N(){var a,b;a=jQuery("#toc-frame");h.forEach(function(d,c){b=a.find('ul.toc-wrapper > li.toc-chap[data-c="'+c+'"]');b.toggleClass("sel",d.c);d.s.forEach(function(a,d){b.find('li[data-s="'+d+'"]').toggleClass("sel",a)})})}function O(){var a,b;a=jQuery("#toc-frame");f.forEach(function(d,c){b=a.find('ul.toc-wrapper > li.toc-chap[data-c="'+c+'"]');b.find(".readlist-c").prop("checked",d.c);d.s.forEach(function(a,d){b.find('li[data-s="'+d+'"] > .readlist').prop("checked",
a)})})}function T(a){jQuery(this).closest("li.toc-chap").find("ul.toc-secs").toggle();a.preventDefault()}function H(a){var b=a.target.dataset.c;if("undefined"!=typeof b){t=!0;var d=h[b];d.c=!d.c;b=jQuery('#toc-frame > ul.toc-wrapper > li.toc-chap[data-c="'+b+'"]');d.c?b.addClass("sel"):b.removeClass("sel");a.preventDefault()}}function I(a){var b=a.target.dataset.s;if("undefined"!=typeof b){t=!0;var d=jQuery(a.target).closest("li.toc-chap"),c=d.data("c"),c=h[c],c=c.s[b]=!c.s[b],b=d.find('ul.toc-secs > li[data-s="'+
b+'"]');c?b.addClass("sel"):b.removeClass("sel");a.preventDefault()}}function m(a){var b=a.target.checked,d;"readlist-c"===a.target.className?(a=jQuery(a.target).closest("li.toc-chap").data("c"),f[a].c=b):"readlist"===a.target.className&&(d=jQuery(a.target).closest("li").data("s"),a=jQuery(a.target).closest("li.toc-chap").data("c"),f[a].s[d]=b)}var w=[null,null],l=[null,null],z,p,x="v0",c=!1,e=[],f=[],h=[],t=!1,C=[],q,r=[],k,n;jQuery("body").addClass("waiting");(function(a,b){var d=prspdata.bClrs[a];
d&&0<d.length&&jQuery(b).css("background-color",d)})("cb","#command-bar");PState.init();PMapHub.init(prspdata.m);(function(){function a(a,c){b=document.getElementById(a).innerHTML;dlText[c]=b.trim()}var b;a("dltext-removehideall","rha");a("dltext-showhideall","sha");a("dltext-ok","ok");a("dltext-cancel","cancel");a("dltext-choose-att","chsatt");a("dltext-seerec","seerec");a("dltext-close","close");a("dltext-add","add");a("dltext-manage","manage");a("dltext-delete","del");a("dltext-edit","edit");a("dltext-markers",
"markers");a("dltext-hint-marker","markersize");a("dltext-hint-text","textsize");a("dltext-xaxis","xaxis");a("dltext-yaxis","yaxis");a("dltext-undefined","undef");a("dltext-orderedby","orderedby");a("dltext-grpblks","grpblks");a("dltext-reset","reset");a("dltext-nofilter","nofilter");a("dltext-dofilters","dofilters");a("dltext-filtered","filtered");b=document.getElementById("dltext-month-names").innerHTML;months=b.trim().split("|");(b=document.getElementById("dltext-d3-local"))&&(b=b.innerHTML)&&
1<b.length&&(localD3=d3.locale(JSON.parse(b)).timeFormat.multi([["%H:%M",function(a){return a.getMinutes()}],["%H:%M",function(a){return a.getHours()}],["%a %d",function(a){return a.getDay()&&1!=a.getDate()}],["%b %d",function(a){return 1!=a.getDate()}],["%B",function(a){return a.getMonth()}],["%Y",function(){return!0}]]))})();(function(){var a=_.template(document.getElementById("dltext-filter-template").innerHTML),b=[];prspdata.t.forEach(function(d,c){b.push(a({ti:c,tl:d.def.l}))});apTmStr=b.join("&nbsp;")})();
(function(){var a;prspdata.t.forEach(function(b,d){var c="";b.def.a.forEach(function(b){a=PData.aByID(b);switch(a.def.t){case "T":case "V":case "N":case "D":c+='<option value="'+b+'">'+a.def.l+"</option>"}});jQuery("#dialog-sortby").append("<b>"+b.def.l+"</b>: <select data-ti="+d+">"+c+"</select><br/>")})})();"/"!=prspdata.site_url.charAt(prspdata.site_url.length-1)&&(prspdata.site_url+="/");""!=prspdata.e.g.l&&jQuery("#title").text(prspdata.e.g.l);try{var S=window.localStorage;S.setItem("__storage_test__",
"__storage_test__");S.removeItem("__storage_test__");var U=S.getItem(prspdata.e.id);0<U.length&&JSON.parse(U)}catch(a){}jQuery("#btn-about").button({icons:{primary:"ui-icon-power"},text:!1}).click(function(a){var b;jQuery("#dialog-about img").removeClass("zoomin");b=jQuery("#dialog-about").dialog({height:390,width:350,modal:!0,buttons:[{text:dlText.ok,click:function(){b.dialog("close")}}]});jQuery("#dialog-about img").addClass("zoomin");a.preventDefault()});jQuery("#btn-show-prspctv").button({icons:{primary:"ui-icon-image"},
text:!1});jQuery("#btn-save-prspctv").button({icons:{primary:"ui-icon-pencil"},text:!1});jQuery("#btn-annote").button({icons:{primary:"ui-icon-comment"},text:!1});jQuery("#hstoc").button({icons:{primary:"ui-icon-bookmark"},text:!1}).click(function(a){(c=!c)?(t=!1,jQuery("#toc-controls").show(),jQuery("#toc-frame").show(),jQuery("#text-controls").hide(),jQuery("#text-frame").hide()):(t&&(M(),F()),jQuery("#toc-controls").hide(),jQuery("#toc-frame").hide(),jQuery("#text-controls").show(),jQuery("#text-frame").show());
a.preventDefault()});jQuery("#tochcall").click(function(a){a=a.target.checked;for(var b=0;b<f.length;b++){var d=f[b];d.c=a;for(var c=0;c<d.s.length;c++)d.s[c]=a}O()});jQuery("#tochsall").click(function(a){t=!0;var b=a.target.checked;h.forEach(function(a,c){var g=jQuery('#toc-frame > ul.toc-wrapper > li.toc-chap[data-c="'+c+'"]');a.c=b;for(i=0;i<a.s.length;i++)a.s[i]=b;b?(g.addClass("sel"),g.find("ul.toc-secs > li").addClass("sel")):(g.removeClass("sel"),g.find("ul.toc-secs > li").removeClass("sel"))})});
jQuery("#tocfind").button({icons:{primary:"ui-icon-star"},text:!1}).click(function(a){var b;b=jQuery("#dialog-find-toc").dialog({height:150,width:250,modal:!0,buttons:[{text:dlText.ok,click:function(){var a=jQuery("#find-toc-txt").val(),c,g;e.forEach(function(b,e){c=!1;if(-1!==b.e.innerHTML.indexOf(a))c=!0;else for(g=jQuery(b.e).next();0!=g.length;)switch(g.prop("tagName").toUpperCase()){case "H1":case "H2":g=[];break;default:-1!==jQuery(g).contents().text().indexOf(a)?(c=!0,g=[]):g=g.next()}f[e].c=
c;b.s.forEach(function(b,h){c=!1;if(-1!==b.innerHTML.indexOf(a))c=!0;else for(g=jQuery(b).next();0!=g.length;)switch(g.prop("tagName").toUpperCase()){case "H1":case "H2":g=[];break;default:-1!==jQuery(g).contents().text().indexOf(a)?(c=!0,g=[]):g=g.next()}f[e].s[h]=c})});O();b.dialog("close")}},{text:dlText.cancel,click:function(){b.dialog("close")}}]});a.preventDefault()});jQuery("#textprev").button({icons:{primary:"ui-icon-arrow-1-w"},text:!1}).click(function(a){a.preventDefault();var b=a=null,
c,e,g;e=0;a:for(;e<h.length;e++){c=h[e];if(c.c){a=e-1;break}for(g=0;g<c.s.length;g++)if(c.s[g]){a=e;b=g-1;break a}}if(null!=a)for(;-1<a;){c=f[a];for(null==b&&(b=c.s.length-1);-1<b;b--)if(c.s[b]){G(!0,a,b);return}b=null;if(c.c){G(!0,a,-1);break}a--}});jQuery("#textnext").button({icons:{primary:"ui-icon-arrow-1-e"},text:!1}).click(function(a){a.preventDefault();var b=a=null,c,e,g,k=!1;e=h.length-1;a:for(;0<=e;e--){c=h[e];for(g=c.s.length-1;0<=g;g--)if(c.s[g]){b=g+1;g==c.s.length-1?(a=e+1,b=0,k=!0):
a=e;break a}if(c.c){a=e;b=0;break}}if(null!=a)for(;a<f.length;){c=f[a];if(k&&c.c){G(!0,a,-1);break}for(;b<c.s.length;b++)if(c.s[b]){G(!0,a,b);return}b=0;a++;k=!0}});jQuery("#texthilite").button({icons:{primary:"ui-icon-star"},text:!1}).click(function(a){Q(0,null);a.preventDefault()});jQuery("#textxsel").button({icons:{primary:"ui-icon-cancel"},text:!1}).click(function(a){var b=w[1];jQuery("#text-frame a").removeClass("sel");r=[];n=[];k=null;if(null!=b)switch(x){case "v0":case "v1":b.clearSel();break;
case "v2":L(),b.showStream(k)}a.preventDefault()});jQuery("#text-frame").click(function(a){var b,c,f,g,e,h=w[1];c=a.target;if("A"===c.nodeName&&(f=c.dataset.id,b=PData.nByID(f),null!=b)){c=_.sortedIndex(r,f);if(r[c]===f){r.splice(c,1);if("v2"===x){n=null;c=_.sortedIndex(k.s,b);k.s.splice(c,1);e=0;for(b=PData.eTNum();e<b;e++)if(g=k.t[e],0<g.n&&c>=g.i&&c<g.i+g.n){--g.n;e++;break}for(--k.l;e<b;e++)--k.t[e].i}else k=null,c=_.sortedIndex(n,b),n.splice(c,1);jQuery('#text-frame a[data-id="'+f+'"]').removeClass("sel")}else{0===
r.length?r.push(f):r.splice(c,0,f);if("v2"===x)for(n=null,0===k.s.length?k.s.push(b):(c=_.sortedIndex(k.s,b),k.s.splice(c,0,b)),e=PData.n2T(b),k.t[e++].n+=1,b=PData.eTNum(),k.l+=1;e<b;e++)k.t[e].i+=1;else k=null,0==n.length?n.push(b):(c=_.sortedIndex(n,b),n.splice(c,0,b));jQuery('#text-frame a[data-id="'+f+'"]').addClass("sel")}switch(x){case "v0":case "v1":h.setSel(n);break;case "v2":h.clearSel(),h.showStream(k)}}a.preventDefault()});jQuery("input[type=radio][name=vizmode]").change(function(){x=
this.value;F()});0<prspdata.e.g.hbtn.length&&0<prspdata.e.g.hurl.length?(jQuery("#home-title").text(prspdata.e.g.hbtn),jQuery("#btn-home").button({icons:{primary:"ui-icon-home"},text:!1}).click(y)):jQuery("#btn-home").remove();jQuery("#filter-list").click(function(a){"I"==a.target.nodeName?(jQuery("#filter-list li").removeClass("selected"),jQuery(a.target).parent().addClass("selected")):"LI"==a.target.nodeName&&(jQuery("#filter-list li").removeClass("selected"),jQuery(a.target).addClass("selected"))});
jQuery("#dialog-about .logo").attr("src",prspdata.assets+"prospectlogo.jpg");jQuery("#btn-inspect-left").button({icons:{primary:"ui-icon-arrowthick-1-w"},text:!1});jQuery("#btn-inspect-right").button({icons:{primary:"ui-icon-arrowthick-1-e"},text:!1});(function(){jQuery("#filter-list").append('<li class="remove" data-id="_remove"><i>'+dlText.rha+"</i></li>");prspdata.a.forEach(function(a){switch(a.def.t){case "V":case "T":case "g":case "N":case "D":jQuery("#filter-list").append('<li data-id="'+a.id+
'">'+a.def.l+"</li>")}})})();w[1]=PViewFrame(1);w[1].initDOM(0);(function(a){var b=jQuery("#annote");b.text(a);0<a.length?(jQuery("#btn-annote").button("enable"),b.show()):(jQuery("#btn-annote").button("disable"),b.hide())})("");jQuery(window).resize(function(){w[1]&&w[1].resize()});(function(){for(var a=jQuery("#prsp-volume").children(":first"),b=null;0!=a.length;){switch(a.prop("tagName").toUpperCase()){case "H1":null!=b&&e.push(b);b={e:a.get(0),s:[]};break;case "H2":null!=b&&b.s.push(a.get(0))}a=
a.next()}null!=b&&e.push(b);e.forEach(function(a){var b={c:!0,s:[]},c={c:!1,s:[]};a.s.forEach(function(a){b.s.push(!0);c.s.push(!1)});f.push(b);h.push(c)});h[0].c=!0})();(function(){document.getElementById("prsp-volume");var a,b=jQuery("#toc-frame > ul.toc-wrapper");b.empty();e.forEach(function(c,e){a='<li class="toc-chap" data-c='+e+'><input type="checkbox" class="readlist-c"/> <button class="toccollapse">Collapse</button> ';a+=c.e.innerHTML;a+='<ul class="toc-secs">';c.s.forEach(function(b,c){a+=
"<li data-s="+c+'><input type="checkbox" class="readlist"/>'+b.innerHTML+"</li>"});a+="</ul></li>";b.append(a)});jQuery("#toc-frame > ul.toc-wrapper > li.toc-chap").click(H);jQuery("#toc-frame > ul.toc-wrapper > li.toc-chap > ul.toc-secs li").click(I);jQuery("#toc-frame > ul.toc-wrapper > li.toc-chap input[type=checkbox]").click(m);jQuery("#toc-frame .toccollapse").button({icons:{primary:"ui-icon-plus"},text:!1}).click(T)})();O();N();M();jQuery("body").on("prospect",function(a,b){switch(b.s){case PSTATE_PROCESS:PState.set(PSTATE_PROCESS);
PState.set(PSTATE_PROCESS);null==z&&(z=PData.sNew(!0));p=z;PState.set(PSTATE_BUILD);F();for(var c=0;2>c;c++)null!==l[c]&&P(c);PState.set(PSTATE_READY);jQuery("body").removeClass("waiting");break;case PSTATE_HILITE:Q(b.v,b.t)}});PState.set(PSTATE_LOAD);PData.init()});function onYouTubeIframeAPIReady(){widgetData.ytCall&&widgetData.ytCall()};