Array.prototype.findIndex||(Array.prototype.findIndex=function(a,c){if(null==this)throw new TypeError("Array.prototype.find called on null or undefined");if("function"!==typeof a)throw new TypeError("predicate must be a function");for(var d=Object(this),f=d.length>>>0,l,m=0;m<f;m++)if(l=d[m],a.call(c,l,m,d))return m;return-1});
var EVENT_INSTANT=1,EVENT_F_START=2,EVENT_F_END=4,PSTATE_INIT=0,PSTATE_LOAD=1,PSTATE_PROCESS=2,PSTATE_BUILD=3,PSTATE_UPDATE=4,PSTATE_READY=5,D3FG_BAR_WIDTH=25,D3FG_MARGINS={top:4,right:7,bottom:22,left:30},D3SC_MARGINS={top:30,right:5,bottom:5,left:40},V_FLAG_LGND=1,V_FLAG_SEL=2,V_FLAG_LOC=4,V_FLAG_SLGND=8,V_FLAG_SET=16,V_FLAG_VSCRL=32,V_FLAG_HSCRL=64,parseTC=/(\d\d)\:(\d\d)\:(\d\d)\.(\d\d?)/,mnthDays=[31,28,31,30,31,30,31,31,30,31,30,31],TODAY=new Date,localD3,months,dlText={},xhbtURL,widgetData=
{ytLoaded:!1,ytCall:null,ytCode:null,timer:null,extract:null,sTime:null,eTime:null,playing:!1,widget:null,xscriptOn:!1,tcArray:null,tcIndex:-1},PState=function(){var a=PSTATE_INIT,c;return{init:function(){c=document.getElementById("dltext-pstates").innerHTML.trim().split("|")},set:function(d){if(d!=a){var f=jQuery("#pstate");a==PSTATE_READY?f.addClass("attn"):d==PSTATE_READY&&f.removeClass("attn");f.text(c[d-1]);a=d}}}}();
function PVizModel(a,c){this.vFrame=a;this.frameID=a.getFrameID()+" div.viz-content div.viz-result";this.settings=c;this.recSel=[]}PVizModel.prototype.flags=function(){return 0};PVizModel.prototype.isSel=function(a){return-1!=_.indexOf(this.recSel,a,!0)};PVizModel.prototype.getSel=function(){return this.recSel};
PVizModel.prototype.toggleSel=function(a){var c=this.recSel.length,d=_.sortedIndex(this.recSel,a);if(this.recSel[d]==a)return this.recSel.splice(d,1),0<c&&0==this.recSel.length&&this.vFrame.selBtns(!1),!1;this.recSel.splice(d,0,a);0==c&&0<this.recSel.length&&this.vFrame.selBtns(!0);return!0};PVizModel.prototype.clearSel=function(){this.recSel=[]};PVizModel.prototype.getLocAtts=function(a){return[]};PVizModel.prototype.getFeatureAtts=function(a){return[]};PVizModel.prototype.teardown=function(){};
PVizModel.prototype.resize=function(){};PVizModel.prototype.optionsModal=function(){};PVizModel.prototype.getState=function(){return{}};PVizModel.prototype.setState=function(a){};var VizMap=function(a,c){PVizModel.call(this,a,c)};VizMap.prototype=Object.create(PVizModel.prototype);VizMap.prototype.constructor=VizMap;VizMap.prototype.flags=function(){return V_FLAG_LGND|V_FLAG_SEL|V_FLAG_LOC};VizMap.prototype.getLocAtts=function(a){return null!=a?this.settings.cAtts[a]:this.settings.cAtts};
VizMap.prototype.getFeatureAtts=function(a){return null!=a?this.settings.lgnds[a]:this.settings.lgnds};
VizMap.prototype.setup=function(){var a=this,c=parseFloat(this.settings.clat),d=parseFloat(this.settings.clon),f;f="string"==typeof this.settings.zoom?parseInt(this.settings.zoom):this.settings.zoom;var l=this.vFrame.getIndex();jQuery(this.frameID).append('<div id="l-map-'+l+'" class="max-size"></div>');this.lMap=L.map("l-map-"+l,{zoomControl:!1}).setView([c,d],f);var m=L.control.layers();m.addTo(this.lMap);this.baseMap=PMapHub.createMapLayer(this.settings.base,1,this.lMap,m);var p;this.mapLayers=
[];_.each(this.settings.lyrs,function(c){p=c.o||1;c=PMapHub.createMapLayer(c.lid,p,a.lMap,m);a.mapLayers.push(c)});var l=this.vFrame.getIndex(),q=_.template(document.getElementById("dltext-v-map").innerHTML);jQuery("#view-frame-"+l+" div.view-control-bar").append(q({vi:l}));jQuery("#map-zoom-"+l).button({text:!1,icons:{primary:"ui-icon-plus"}}).click(function(){a.lMap.zoomIn()});jQuery("#map-unzoom-"+l).button({text:!1,icons:{primary:"ui-icon-minus"}}).click(function(){a.lMap.zoomOut()});jQuery("#map-reset-"+
l).button({text:!1,icons:{primary:"ui-icon-arrowrefresh-1-w"}}).click(function(){a.lMap.setView([c,d],f)});this.markerLayer=l=L.featureGroup();l.options=l.options||{};l.options.layerName="Markers";l.addTo(this.lMap);this.lineLayer=l=L.featureGroup();l.addTo(this.lMap);l=PData.getNumETmplts();this.tLCnt=new Uint16Array(l)};
VizMap.prototype.render=function(a){function c(e){if(e.target&&e.target.options){var a=e.target.options._aid,c=d.toggleSel(a);e=PData.aIndex2Tmplt(a);1<d.tLCnt[e]?f.eachLayer(function(e){e.options._aid==a&&(c?e.setStyle({color:"#ff0000"}):e.setStyle({color:"#000"}))}):c?this.setStyle({color:"#ff0000"}):this.setStyle({color:"#000"})}}var d=this,f=this.markerLayer;1<this.recSel.length&&(this.recSel=[]);f.clearLayers();var l=this.lineLayer;l.clearLayers();var m=PData.getNumETmplts(),p=0,q,v=0,A,e,k,
t,r,g,n,h,x,z,C,y,w,u,F,E,B,I;F=this.settings.min;"string"==typeof F&&(F=parseInt(F));v=this.settings.max;"string"==typeof v&&(v=parseInt(v));E=v-F;for(p=0;p<m;p++)this.tLCnt[p]=0;for(var G,p=0;p<m;p++)if("disable"!=this.settings.pAtts[p]){G=[];break}p=0;v=-1;a:for(;p<a.l;){if(null==g){do{if(++v==m)break a;A=a.t[v]}while(0==A.n||A.i+A.n==p);g=this.vFrame.getSelLocAtts(v);if(0==g.length){g=null;continue}n=d.vFrame.getSelFeatAtts(v);if(0==n.length){g=null;continue}d.tLCnt[v]=g.length;t=d.vFrame.getSelLegend(v);
r=PData.getAttID(t);h=d.settings.pAtts[v];e=d.settings.lClrs[v];if(w=d.settings.sAtts[v])u=PData.getAttID(w),"number"==typeof u.r.min&&"number"==typeof u.r.max?(B=u.r.min,I=u.r.max-B):w=null}q=a.s[p];k=PData.getRecByIndex(q);var D;G&&(D={id:k.id,c:[],p:k.a[h],l:e});g.forEach(function(e){if(x=k.a[e])if(z=k.a[t],"undefined"!=typeof z&&(z=PData.getAttLgndVal(z,r,n))){y=d.isSel(q);if("number"==typeof x[0])w?(u=k.a[w],u="undefined"!=typeof u?Math.floor((u-B)*E/I)+F:F):u=F,C=L.circleMarker(x,{_aid:q,weight:1,
radius:u,fillColor:z,color:y?"#ff0000":"#000",opacity:1,fillOpacity:1}),D&&D.c.push(x);else if(C=2==x.length?L.polyline(x,{_aid:q,weight:1,fillColor:z,color:y?"#ff0000":"#000",opacity:1,fillOpacity:1}):L.polygon(x,{_aid:q,weight:1,fillColor:z,color:y?"#ff0000":"#000",opacity:1,fillOpacity:1}),D){var a=[0,0];x.forEach(function(e){a[0]+=e[0];a[1]+=e[1]});a[0]/=x.length;a[1]/=x.length;D.c.push(a)}C.on("click",c);f.addLayer(C)}});D&&0<D.c.length&&G.push(D);++p==A.i+A.n&&(g=null)}if(G){G.sort(function(e,
a){return PData.strcmp(a.id,e.id)});var H=[];G.forEach(function(e){e.p&&e.p.forEach(function(a){p=_.sortedIndex(G,{id:a},"id");var c=G[p];c.id==a&&e.c.forEach(function(a){c.c.forEach(function(c){a[0]==c[0]&&a[1]==c[1]||H.push({p:[a,c],c:e.l})})})})});H.forEach(function(e){l.addLayer(L.polyline(e.p,{color:e.c,weight:2}))})}};VizMap.prototype.teardown=function(){var a=this.vFrame.getIndex();jQuery("#view-frame-"+a+" div.view-control-bar div.iconbar").remove()};VizMap.prototype.resize=function(){this.lMap.invalidateSize(!1)};
VizMap.prototype.clearSel=function(){0<this.recSel.length&&(this.recSel=[],this.markerLayer&&this.markerLayer.eachLayer(function(a){a.setStyle({color:"#000"})}))};VizMap.prototype.setSel=function(a){var c=this;this.recSel=a;this.markerLayer&&this.markerLayer.eachLayer(function(a){c.isSel(a.options._aid)?a.setStyle({color:"#ff0000"}):a.setStyle({color:"#000"})})};VizMap.prototype.getState=function(){return{c:this.lMap.getCenter(),z:this.lMap.getZoom(),l:this.vFrame.getLgndSels()}};
VizMap.prototype.setState=function(a){this.lMap.setView(a.c,a.z);this.vFrame.setLgndSels(a.l)};var VizCards=function(a,c){PVizModel.call(this,a,c)};VizCards.prototype=Object.create(PVizModel.prototype);VizCards.prototype.constructor=VizCards;VizCards.prototype.flags=function(){return V_FLAG_LGND|V_FLAG_SEL|V_FLAG_VSCRL};VizCards.prototype.getFeatureAtts=function(a){return null!=a?this.settings.lgnds[a]:this.settings.lgnds};
VizCards.prototype.setup=function(){var a=this;jQuery(this.frameID).on("click.vf",function(c){if("DIV"==c.target.nodeName&&(c=jQuery(c.target).closest("div.card"),1==c.size())){var d=c.data("ai");null!=d&&(a.toggleSel(d)?c.addClass("obj-sel"):c.removeClass("obj-sel"))}})};
VizCards.prototype.render=function(a){var c=PData.getNumETmplts(),d=0,f,l=-1,m,p,q=!0,v,A,e,k,t,r,g,n,h,x,z,C,y=jQuery(this.frameID);y.empty();1<this.recSel.length&&(this.recSel=[]);for(var w,u="w"+this.settings.w+" h"+this.settings.h;d<a.l;){if(q){do{if(++l==c)return;p=a.t[l]}while(0==p.n||p.i+p.n==d);m=PData.getETmpltIndex(l);f=PData.getTmpltID(m);m=this.vFrame.getSelFeatAtts(l);if(0==m.length){q=!0;continue}y.append('<div class="template-label">'+f.l+'</div><div class="cards" data-ti="'+l+'"></div>');
w=jQuery('div.cards[data-ti="'+l+'"]');v=this.vFrame.getSelLegend(l);A=PData.getAttID(v);e=this.settings.iAtts[l];n=this.settings.cnt[l];q=!1}f=a.s[d];k=PData.getRecByIndex(f);h=k.a[v];"undefined"!=typeof h&&(t=PData.getAttLgndRecs(h,A,m,!1))&&(r=this.isSel(f)?" obj-sel":"",z=this.settings.lOn?'<div class="card-title">'+k.l+"</div>":"",g=!1,x="",n&&0<n.length&&(C=t.b?' style="color:black"':"",n.forEach(function(e){if(h=k.a[e])if(h=PData.procAttTxt(e,h))g=!0,x+=h+"<br/>"})),x=(h=k.a[e])?g?'<div class="card-body"><img src="'+
h+'"/><div class="card-cnt"'+C+">"+x+"</div></div>":'<div class="card-body"><img class="full" src="'+h+'"/></div>':'<div class="card-body"><div class="card-cnt"'+C+">"+x+"</div>",w.append('<div class="card '+u+r+'" style="background-color:'+t.v+'" data-ai="'+f+'">'+z+x+"</div>"));++d==p.i+p.n&&(q=!0)}};VizCards.prototype.teardown=function(){jQuery(this.frameID).off("click.vf")};
VizCards.prototype.setSel=function(a){var c=this,d,f;this.recSel=a;jQuery(this.frameID).find("div.card").each(function(){f=jQuery(this);d=f.data("ai");null!=d&&(c.isSel(d)?f.addClass("obj-sel"):f.removeClass("obj-sel"))})};VizCards.prototype.clearSel=function(){0<this.recSel.length&&(this.recSel=[],jQuery(this.frameID).find("div.card").removeClass("obj-sel"))};VizCards.prototype.getState=function(){return{l:this.vFrame.getLgndSels()}};VizCards.prototype.setState=function(a){this.vFrame.setLgndSels(a.l)};
var VizPinboard=function(a,c){PVizModel.call(this,a,c)};VizPinboard.prototype=Object.create(PVizModel.prototype);VizPinboard.prototype.constructor=VizPinboard;VizPinboard.prototype.flags=function(){return V_FLAG_LGND|V_FLAG_SEL|V_FLAG_LOC};VizPinboard.prototype.getLocAtts=function(a){return null!=a?[this.settings.cAtts[a]]:[this.settings.cAtts]};VizPinboard.prototype.getFeatureAtts=function(a){return null!=a?this.settings.lgnds[a]:this.settings.lgnds};
VizPinboard.prototype.setup=function(){var a=this.settings;PData.getNumETmplts();this.xScale=d3.scale.linear().domain([0,a.iw-1]).rangeRound([0,a.dw-1]);this.yScale=d3.scale.linear().domain([0,a.ih-1]).range([0,a.dh-1]);this.xAxis=d3.svg.axis().scale(this.xScale).orient("top");this.yAxis=d3.svg.axis().scale(this.yScale).orient("left");var c=d3.select(this.frameID).append("svg").attr("width",a.dw+30+3).attr("height",a.dh+30+2),d=c.append("defs");d.append("marker").attr("id","arrowhead").attr("refX",
9).attr("refY",2).attr("markerWidth",6).attr("markerHeight",4).attr("orient","auto").append("path").attr("d","M 0,0 V 4 L6,2 Z");d=d.append("g").attr("id","pin");d.append("path").attr("d","M36.439,12.646c0-6.919-5.608-12.527-12.528-12.527S11.384,5.727,11.384,12.646c0,9.913,12.527,24.582,12.527,24.582 S36.439,22.508,36.439,12.646z M17.733,11.898c0-3.413,2.767-6.179,6.179-6.179s6.179,2.766,6.179,6.179 c0,3.413-2.767,6.179-6.179,6.179S17.733,15.311,17.733,11.898z");d.append("circle").attr("cx","23.911").attr("cy",
"11.898").attr("r","3.038");d.append("path").attr("d","M30.994,32.87c-1.021,1.476-1.979,2.761-2.777,3.793c7.916,0.476,13.104,2.185,15.034,3.456 c-2.261,1.491-8.979,3.587-19.338,3.587c-10.358,0-17.077-2.097-19.338-3.587c1.93-1.271,7.114-2.979,15.022-3.455 c-0.8-1.032-1.759-2.316-2.781-3.792C7.075,33.831,0,36.713,0,40.118c0,4.19,10.707,7.588,23.913,7.588 c13.207,0,23.912-3.396,23.912-7.588C47.827,36.711,40.744,33.828,30.994,32.87z");this.chart=c.append("g").attr("transform","translate(30,30)");this.chart.append("g").attr("class",
"x axis").call(this.xAxis);this.chart.append("g").attr("class","y axis").call(this.yAxis);this.chart.append("image").attr("xlink:href",a.img).attr("x",0).attr("y",0).attr("height",a.dh).attr("width",a.dw);this.chart.on("click",function(){});this.gRecs=this.chart.append("g").attr("id","recs")};
VizPinboard.prototype.render=function(a){var c=this;this.gRecs.selectAll("svg.recobj").remove();1<this.recSel.length&&(this.recSel=[]);var d=PData.getNumETmplts(),f,l,m=0,p,q,v,A,e,k,t,r,g,n;for(f=0;f<d;f++)if("disable"!=this.settings.pAtts[f]){n=[];break}f=0;m=-1;a:for(;f<a.l;){if(null==e){do{if(++m==d)break a;p=a.t[m]}while(0==p.n||p.i+p.n==f);e=this.vFrame.getSelLocAtts(m);if(0==e.length){e=null;continue}e=e[0];k=c.vFrame.getSelFeatAtts(m);if(0==k.length){e=null;continue}v=c.vFrame.getSelLegend(m);
A=PData.getAttID(v);t=c.settings.pAtts[m]}l=a.s[f];q=PData.getRecByIndex(l);var h;n&&(h={id:q.id,c:null,p:q.a[t]});if(r=q.a[e])g=q.a[v],"undefined"!=typeof g&&(g=PData.getAttLgndVal(g,A,k))&&"number"==typeof r[0]&&(nodes.push({ai:l,id:q.id,v:g,x:r[0]+-12,y:r[1]+-20,w:24,h:24}),h&&(h.c=r));h&&0<h.c.length&&n.push(h);++f==p.i+p.n&&(e=null)}this.gRecs.selectAll("svg.recobj").data(nodes).enter().append("svg").attr("class",function(e){return c.isSel(e.ai)?"recobj obj-sel":"recobj"}).attr("x",function(e){return c.xScale(e.x)}).attr("y",
function(e){return c.yScale(e.y)}).attr("width",function(e){return c.xScale(e.w)}).attr("height",function(e){return c.yScale(e.h)}).attr("viewBox","0 0 48 48").attr("data-ai",function(e){return e.ai}).on("click",function(e,a){var k=c.toggleSel(e.ai);d3.select(this).classed("obj-sel",k)}).append("use").attr("xlink:href","#pin").attr("fill",function(e){return e.v})};VizPinboard.prototype.clearSel=function(){0<this.recSel.length&&(this.recSel=[],this.gRecs.selectAll("svg.recobj").classed("obj-sel",!1))};
VizPinboard.prototype.setSel=function(a){var c=this;this.recSel=a;this.gRecs.selectAll("svg.recobj").classed("obj-sel",function(a){return c.isSel(a.ai)})};
VizPinboard.prototype.optionsModal=function(){var a=jQuery("#dialog-opacities div.layer-list");a.empty();var c=jQuery('<div data-i="-1"><input type="checkbox" checked="checked"> Base Image <input type=range class="op-slider" min=0 max=100 value=90 step=5></div>');c.find(".op-slider").on("change",function(){jQuery(this).parent().data("i")});a.append(c);var d=jQuery("#dialog-map-opacities").dialog({height:300,width:320,modal:!0,buttons:[{text:dlText.ok,click:function(){d.dialog("close")}},{text:dlText.cancel,
click:function(){d.dialog("close")}}]})};VizPinboard.prototype.getState=function(){return{l:this.vFrame.getLgndSels()}};VizPinboard.prototype.setState=function(a){this.vFrame.setLgndSels(a.l)};var VizTime=function(a,c){PVizModel.call(this,a,c)};VizTime.prototype=Object.create(PVizModel.prototype);VizTime.prototype.constructor=VizTime;VizTime.prototype.flags=function(){return V_FLAG_LGND|V_FLAG_SEL|V_FLAG_LOC|V_FLAG_VSCRL};
VizTime.prototype.getFeatureAtts=function(a){return null!=a?this.settings.lgnds[a]:this.settings.lgnds};VizTime.prototype.getLocAtts=function(a){return null!=a?[this.settings.dAtts[a]]:[this.settings.dAtts]};VizTime.prototype.getWidths=function(){var a=[],c=jQuery(this.frameID).width();a.push(c);c-=4;a.push(c);this.threshold=c/(6.25*this.settings.xLbl);return a};
VizTime.prototype.setup=function(){function a(a){var c={id:a,l:0,t:0,h:0,w:m[1],svgID:"#tl-b-"+q+"-"+a,tHt:0,iHt:0,xScale:d3.time.scale(),yScale:function(e){return e*c.tHt},parts:[],g:null,labels:null,labelSVGs:null,redraw:function(){}};a?(c.tHt=f.settings.bHt,c.iHt=c.tHt-2):(c.tHt=3,c.iHt=2);if(1==a){var e=f.minDate,k=f.maxDate;0<f.settings.zFrom.length&&(e=PData.parseDate(f.settings.zFrom,1,1));0<f.settings.zTo.length&&(k=PData.parseDate(f.settings.zTo,12,31));c.xScale.domain([e,k]);f.zMinDate=
e;f.zMaxDate=k}else c.xScale.domain([f.minDate,f.maxDate]);c.xScale.range([0,c.w]);c.g=f.chart.append("g").attr("id",c.svgID.substring(1)).attr("class","tl-band").attr("width",c.w);f.bands[a]=c;f.cmpnts.push(c)}function c(a){var c=f.bands[a],e=d3.svg.axis().scale(c.xScale).orient("bottom").tickSize(6,0);localD3&&e.tickFormat(localD3);var k=c.g.append("g").attr("id","axis-"+q+"-"+a).attr("class","axis").style("font-size","10px");a={redraw:function(){k.call(e)}};c.parts.push(a);f.cmpnts.push(a)}function d(a){var c=
f.bands[a],e;e=1==a?32:16;c.labels=[{name:"s-"+q+"-"+a,x:function(){return 0},left:function(){return 0},anchor:"start",tDelta:2,whichDate:function(e,a){return e}},{name:"e-"+q+"-"+a,x:function(){return c.l+c.w},left:function(){return c.l+c.w-f.settings.xLbl},anchor:"end",tDelta:-3,whichDate:function(e,a){return a}}];var k=d3.select(c.svgID).selectAll(".bLblCntr").data(c.labels).enter().append("g").attr("class","bLblCntr");k.append("rect").attr("class","bLbl").attr("id",function(e){return"rect-"+e.name}).attr("x",
function(e){return e.left()}).attr("width",f.settings.xLbl).attr("height",e);var t=k.append("text").attr("class","bMinMaxLbl").attr("id",function(e){return"txt-"+e.name}).attr("x",function(e){return e.x()+e.tDelta}).attr("y",12).attr("text-anchor",function(e){return e.anchor}),d={redraw:function(){var e=c.xScale.domain(),a=e[0],k=e[1];t.text(function(e){return e.whichDate(a,k).getUTCFullYear()})}};c.parts.push(d);f.cmpnts.push(d);if(1==a){var g=k.append("text").attr("class","bMinMaxLbl").attr("id",
function(e){return"m-txt-"+e.name}).attr("x",function(e){return e.x()+e.tDelta}).attr("y",e-4).attr("text-anchor",function(e){return e.anchor});a={redraw:function(){var e=c.xScale.domain(),a=e[0],k=e[1];g.text(function(e){return k.getUTCFullYear()-a.getUTCFullYear()>f.threshold?"":months[e.whichDate(a,k).getMonth()]})}};c.parts.push(a);f.cmpnts.push(a)}c.labelSVGs=k}var f=this;"number"!=typeof this.settings.xLbl&&(this.settings.xLbl=parseInt(this.settings.xLbl));this.brushSVG=this.brush=null;var l=
this.settings;"string"===typeof l.bHt&&(l.bHt=parseInt(l.bHt,10));(function(){var a,c,e,k,t,d;l.dAtts.forEach(function(g){null!=g&&"disable"!=g&&(g=PData.getAttID(g))&&(null==a||g.r.min.y<a?(a=g.r.min.y,"undefined"!=typeof g.r.min.m?(c=g.r.min.m,e="undefined"!=typeof g.r.min.d?g.r.min.d:1):e=c=1):g.r.min.y==a&&"undefined"!=typeof g.r.min.m&&(g.r.min.m<c?(c=g.r.min.m,e="undefined"!=typeof g.r.min.d?g.r.min.d:1):g.r.min.m==c&&"undefined"!=typeof g.r.min.d&&g.r.min.d<e&&(e=g.r.min.d)),null==k?"undefined"==
typeof g.r.max.y?(k=TODAY.getUTCFullYear(),t=TODAY.getMonth()+1,d=TODAY.getDate()):(k=g.r.max.y,"undefined"!=typeof g.r.max.m?(t=g.r.max.m,d="undefined"!=typeof g.r.max.d?g.r.max.d:mnthDays[t-1]):(t=12,d=31)):g.r.max.y>k?(k=g.r.max.y,"undefined"!=typeof g.r.max.m?(t=g.r.max.m,d="undefined"!=typeof g.r.max.d?g.r.max.d:mnthDays[t-1]):(t=12,d=31)):g.r.max.y==k&&"undefined"!=typeof g.r.max.m&&(g.r.max.m>t?(t=g.r.max.m,d="undefined"!=typeof g.r.max.d?g.r.max.d:mnthDays[t-1]):g.r.max.m==t&&"undefined"!=
typeof g.r.max.d&&g.r.max.d>d&&(d=g.r.max.d)))});f.minDate=0<l.from.length?PData.parseDate(l.from,1,1):PData.date3Nums(a,c,e);f.maxDate=0<l.to.length?PData.parseDate(l.to,12,31):PData.date3Nums(k,t,d);f.instGap=.015*(f.maxDate-f.minDate)})();var m=f.getWidths(),p=d3.select(this.frameID).append("svg").attr("class","tl-vf").attr("width",m[1]);(function(){var a=[];l.lgnds.forEach(function(e){e.forEach(function(e){a.push(e)})});var a=_.uniq(a),c=[];a.forEach(function(e){(e=PData.getAttID(e))&&e.l.forEach(function(e){c.push(e.v)})});
c=_.uniq(c);c.sort();var e=p.append("defs"),k,t;c.forEach(function(a){t=a.substr(1);k=e.append("linearGradient").attr("id",t+"-fs");k.append("stop").attr("offset","0%").attr("stop-color","white");k.append("stop").attr("offset","5%").attr("stop-color",a);k.append("stop").attr("offset","100%").attr("stop-color",a);k=e.append("linearGradient").attr("id",t+"-fe");k.append("stop").attr("offset","0%").attr("stop-color",a);k.append("stop").attr("offset","95%").attr("stop-color",a);k.append("stop").attr("offset",
"100%").attr("stop-color","white");k=e.append("linearGradient").attr("id",t+"-fb");k.append("stop").attr("offset","0%").attr("stop-color","white");k.append("stop").attr("offset","5%").attr("stop-color",a);k.append("stop").attr("offset","95%").attr("stop-color",a);k.append("stop").attr("offset","100%").attr("stop-color","white")});e.append("filter").attr("id","xortext").append("feComposite").attr("operator","xor")})();var q=this.vFrame.getIndex();p.append("clipPath").attr("id","tl-clip-"+q).append("rect").attr("width",
m[1]);f.chart=p.append("g").attr("class","chart").attr("clip-path","url(#tl-clip-"+q+")");f.instRad=l.bHt/2-1;f.bands=Array(2);f.cmpnts=[];a(0);a(1);c(0);c(1);d(0);d(1);(function(){var a=f.bands[0];f.brush=d3.svg.brush().x(a.xScale.range([0,a.w])).extent([f.zMinDate,f.zMaxDate]).on("brush",function(){var a=f.brush.extent(),e;"move"===d3.event.mode?(e=d3.time.day.round(a[0]),a=d3.time.day.offset(e,Math.round((a[1]-a[0])/864E5)),e=[e,a]):(e=a.map(d3.time.day.round),e[0]>=e[1]&&(e[0]=d3.time.day.floor(a[0]),
e[1]=d3.time.day.ceil(d3.time.day.offset(e[0],Math.round(f.instGap/864E5)))));f.brush.extent(e);f.brushHandler.redraw();zoom=f.bands[1];zoom.xScale.domain(e);zoom.redraw()})})()};
VizTime.prototype.render=function(a){function c(a,c){var e=a.s-c.s;if(0>e)return 1;if(0<e)return-1;e=c.e-a.e;return 0>e?1:0<e?-1:0}function d(a){function c(e){e=m.toggleSel(e.ai);d3.select(this).classed("obj-sel",e)}var e,k,t,d,g=m.bands[a];a?(e=m.bands[0],g.t=e.t+e.h+37,e=k=t=m.instRad,d=2*m.instRad+3):(g.t=0,e=k=t=1);g.h=q*g.tHt+2;g.g.attr("transform","translate(0,"+g.t+")").attr("height",g.h);var n,h;a&&(n=.75*g.iHt+"px",h=.8*g.iHt);var f;f=d3.select(g.svgID).selectAll(".lgBd").remove();f=d3.select(g.svgID).selectAll(".lgBd").data(m.lgBds).enter().append("svg").attr("class",
"lgBd").attr("y",function(e){return g.yScale(e.t)}).attr("height",function(e){return g.yScale(e.h)});f.append("rect").attr("width","100%").attr("height","100%").attr("fill",function(e){return e.d.v});1==a&&f.append("text").attr("class","lgBdLbl").attr("x",2).attr("y",h).attr("fill",function(e){return e.d.b?"#000000":"#FFFFFF"}).style("font-size",n).text(function(e){return e.d.l});var z;d3.select(g.svgID).selectAll(".event").remove();z=d3.select(g.svgID).selectAll(".event").data(m.events).enter().append("svg").attr("class",
function(e){return 1==a&&m.isSel(e.ai)?e.f&EVENT_INSTANT?"event instant obj-sel":"event range obj-sel":e.f&EVENT_INSTANT?"event instant":"event range"}).attr("y",function(e){return g.yScale(e.t)}).attr("height",g.iHt);if(1==a)z.on("click",c);var C=d3.select(g.svgID).selectAll(".range");C.append("rect").attr("width","100%").attr("height","100%").attr("fill",function(e){return 1==a&&e.f&(EVENT_F_START|EVENT_F_END)?(e.f&(EVENT_F_START|EVENT_F_END))==(EVENT_F_START|EVENT_F_END)?"url("+e.c.v+"-fb)":(e.f&
EVENT_F_START)===EVENT_F_START?"url("+e.c.v+"-fs)":"url("+e.c.v+"-fe)":e.c.v});1==a&&C.append("text").attr("class","rangeLbl").attr("x",4).attr("y",h).attr("fill",function(e){return e.c.b?"#000000":"#FFFFFF"}).style("font-size",n).text(function(e){return e.l});C=d3.select(g.svgID).selectAll(".instant");C.append("circle").attr("cx",e).attr("cy",k).attr("r",t).attr("fill",function(e){return e.c.v});1==a&&C.append("text").attr("class","instantLbl").attr("x",d).attr("y",h).style("font-size",n).style("filter",
"url(#xortext)").text(function(e){return e.l});g.redraw=function(){f.attr("x",function(e){return g.xScale(e.s)}).attr("width",function(e){return g.xScale(e.e)-g.xScale(e.s)});z.attr("x",function(e){return g.xScale(e.s)}).attr("width",function(e){return g.xScale(e.e)-g.xScale(e.s)});g.parts.forEach(function(e){e.redraw()})}}function f(a){a=m.bands[a];d3.select(a.svgID).selectAll(".axis").attr("transform","translate(0,"+a.h+")")}function l(a){a=m.bands[a];d3.select(a.svgID).selectAll(".bLblCntr").attr("transform",
"translate(0,"+(a.h+1).toString()+")")}var m=this,p=m.vFrame.getIndex();1<this.recSel.length&&(this.recSel=[]);m.events=[];m.lgBds=[];var q=0;(function(){for(var d=PData.getNumETmplts(),f=0,e,k,t,r,g,n,h,l;f<d;){for(e=a.t[f];0==e.n;){if(++f==d)return;e=a.t[f]}t=m.vFrame.getSelLocAtts(f);if(0!=t.length&&(t=m.vFrame.getSelFeatAtts(f),0!=t.length)){l=m.vFrame.getSelLegend(f);h=PData.getAttID(l);r=m.settings.dAtts[f];for(var z,C,y,w,u,p,E,B,I=[],G=e.i;G<e.i+e.n;G++)k=a.s[G],B=PData.getRecByIndex(k),g=
B.a[l],"undefined"!=typeof g&&(g=PData.getAttLgndRecs(g,h,t,!1))&&(n=B.a[r])&&(p=n.min.f?EVENT_F_START:0,z=n.min.y,"undefined"==typeof n.min.m?y=C=1:(C=n.min.m,y="undefined"==typeof n.min.d?1:n.min.d),w=PData.date3Nums(z,C,y),"undefined"==typeof n.max?(p|=EVENT_INSTANT,u=w.getTime()+m.instGap):"open"==n.max?u=TODAY:(n.max.f&&(p|=EVENT_F_END),z=n.max.y,"undefined"==typeof n.max.m?(C=12,y=31):(C=n.max.m,y="undefined"==typeof n.max.d?mnthDays[C-1]:n.max.d),u=PData.date3Nums(z,C,y)),I.push({s:w,e:u,ai:k,
f:p,c:g,l:B.l,t:0}));I.sort(c);var D=[],H;I.forEach(function(e){for(H=0;H<D.length&&!(e.e<D[H]);H++);e.t=H+q+1;D[H]=e.s});e=PData.getAttID(r);e.l.forEach(function(e){E=e.d;z=E.min.y;"undefined"==typeof E.min.m?y=C=1:(C=E.min.m,y="undefined"==typeof E.min.d?1:E.min.d);w=PData.date3Nums(z,C,y);"undefined"==typeof E.max.y?u=TODAY:(z=E.max.y,"undefined"==typeof E.max.m?(C=12,y=31):(C=E.max.m,y="undefined"==typeof E.max.d?mnthDays[C-1]:E.max.d),u=PData.date3Nums(z,C,y));m.lgBds.push({s:w,e:u,t:q,h:D.length+
1,d:e})});q+=D.length+1;m.events=m.events.concat(I)}f++}})();m.getWidths();d(0);d(1);(function(){var a=function(){function e(e,a){this._height=a;this.g=e;this.mask=this.g.attr("class","brush").call(m.brush);this.mask.selectAll("rect").attr("y",0).attr("height",a);this.left=this.mask.append("polygon").attr("class","dragger");this.right=this.mask.append("polygon").attr("class","dragger");this._bottom=this._top=this._x=null}e.prototype.style=function(e,a){this.left.style(e,a);this.right.style(e,a);return this};
e.prototype.x=function(e){if(null==e)return this._x;this._x=e;return this};e.prototype.height=function(e){if(null==e)return this._height;this._height=e;this.mask.selectAll("rect").attr("height",e);return this};e.prototype.redraw=function(){var e,a;a=m.brush.extent();this._x.range();e=a[0];a=a[1];e=this._x(e);a=this._x(a);this.left.attr("points",""+e+","+this._height+" "+(e+5)+","+(this._height+5)+" "+(e+5)+","+(this._height+9)+" "+(e-5)+","+(this._height+9)+" "+(e-5)+","+(this._height+5)+" "+e+","+
this._height);this.right.attr("points",""+a+","+this._height+" "+(a+5)+","+(this._height+5)+" "+(a+5)+","+(this._height+9)+" "+(a-5)+","+(this._height+9)+" "+(a-5)+","+(this._height+5)+" "+a+","+this._height);return this};return e}(),c=m.bands[0];null!=m.brushSVG&&m.brushSVG.remove();m.brushSVG=c.g.append("svg");m.brushHandler=(new a(m.brushSVG,c.h-1)).x(c.xScale).redraw()})();(function(){var a=m.bands[1],a=a.t+a.h+45;d3.select(m.frameID+" svg.tl-vf").attr("height",a);d3.select("#tl-clip-"+p+" rect").attr("height",
a)})();f(0);f(1);l(0);l(1);m.cmpnts.forEach(function(a){a.redraw()})};
VizTime.prototype.resize=function(){var a=this.getWidths(),c=d3.select(this.frameID+" svg.tl-vf");c.attr("width",a[1]);c.select("#tl-clip-"+this.vFrame.getIndex()+" rect").attr("width",a[1]);for(var d=0;2>d;d++){b=this.bands[d];b.w=a[1];c.select(b.svgID).attr("width",a[1]);b.xScale.range([0,a[1]]);var f=b.labels[1],l=f.x()+f.tDelta;b.labelSVGs.select("#rect-"+f.name).attr("x",f.left());b.labelSVGs.select("#txt-"+f.name).attr("x",l);if(0==d){if(this.brush){if(this.brushSVG){var m=this.brush.extent();
this.brushSVG.call(this.brush.extent(m))}this.brushHandler&&this.brushHandler.redraw()}b.labelSVGs.select("#m-txt-"+f.name).attr("x",l)}}this.cmpnts.forEach(function(a){a.redraw()})};VizTime.prototype.teardown=function(){};VizTime.prototype.setSel=function(a){var c=this;c.recSel=a;d3.select(this.bands[1].svgID).selectAll(".event").attr("class",function(a){return c.isSel(a.ai)?a.f&EVENT_INSTANT?"event instant obj-sel":"event range obj-sel":a.f&EVENT_INSTANT?"event instant":"event range"})};
VizTime.prototype.clearSel=function(){function a(a){return a.f&EVENT_INSTANT?"event instant":"event range"}0<this.recSel.length&&(this.recSel=[],d3.select(this.bands[1].svgID).selectAll(".event").attr("class",a))};
VizTime.prototype.getState=function(){var a=this.brush.extent(),c=a[0],a=a[1],d=c.getUTCMonth()+1,c=c.getUTCFullYear().toString()+"-"+d.toString()+"-"+c.getDate().toString(),d=a.getUTCMonth()+1,a=a.getUTCFullYear().toString()+"-"+d.toString()+"-"+a.getDate().toString();return{d0:c,d1:a,l:this.vFrame.getLgndSels()}};VizTime.prototype.setState=function(a){var c=PData.parseDate(a.d0,1,1),d=PData.parseDate(a.d1,12,31);this.bands[1].xScale.domain([c,d]);this.brush.extent([c,d]);this.vFrame.setLgndSels(a.l)};
var VizDirectory=function(a,c){PVizModel.call(this,a,c)};VizDirectory.prototype=Object.create(PVizModel.prototype);VizDirectory.prototype.constructor=VizDirectory;VizDirectory.prototype.flags=function(){return V_FLAG_SEL|V_FLAG_VSCRL};VizDirectory.prototype.setup=function(){var a=this;jQuery(this.frameID).on("click.vf",function(c){if("TD"==c.target.nodeName){c=jQuery(c.target).closest("tr");var d=c.data("ai");null!=d&&(a.toggleSel(d)?c.addClass("obj-sel"):c.removeClass("obj-sel"))}})};
VizDirectory.prototype.render=function(a){var c=PData.getNumETmplts(),d=0,f,l=0,m,p;p=null;var q,v,A,e,k=jQuery(this.frameID);k.empty();1<this.recSel.length&&(this.recSel=[]);for(m=a.t[0];d<a.l;){for(;0==m.n||m.i+m.n==d;){if(++l==c)return;m=a.t[l];p=null}null==p&&(f=PData.getETmpltIndex(l),p=PData.getTmpltID(f),k.append('<div class="template-label">'+p.l+'</div><table cellspacing="0" class="viz-directory" data-id='+f+"></table>"),p=k.find('table[data-id="'+f+'"]'),q=this.settings.cnt[l],e="<thead><tr>",
q.forEach(function(a){a=PData.getAttID(a);e+="<th>"+a.def.l+"</th>"}),p.append(e+"<tr></thead><tbody></tbody>"),p=p.find("tbody"));f=a.s[d];A=PData.getRecByIndex(f);e='<tr data-id="'+A.id+'" data-ai='+f;this.isSel(f)&&(e+=' class="obj-sel" ');e+=">";q.forEach(function(a){v=A.a[a];"undefined"!=typeof v?e=(v=PData.procAttTxt(a,v))?e+("<td>"+v+"</td>"):e+"<td></td>":e+="<td></td>"});p.append(e+"</tr>");d++}};VizDirectory.prototype.teardown=function(){jQuery(this.frameID).off("click.vf")};
VizDirectory.prototype.setSel=function(a){var c=this,d,f;this.recSel=a;jQuery(this.frameID).find("tr").each(function(){f=jQuery(this);d=f.data("ai");null!=d&&(c.isSel(d)?f.addClass("obj-sel"):f.removeClass("obj-sel"))})};VizDirectory.prototype.clearSel=function(){0<this.recSel.length&&(this.recSel=[],jQuery(this.frameID).find("tr").removeClass("obj-sel"))};var VizTextStream=function(a,c){PVizModel.call(this,a,c)};VizTextStream.prototype=Object.create(PVizModel.prototype);
VizTextStream.prototype.constructor=VizTextStream;VizTextStream.prototype.flags=function(){return V_FLAG_LGND|V_FLAG_SEL|V_FLAG_LOC|V_FLAG_VSCRL};VizTextStream.prototype.getLocAtts=function(a){return null!=a?[this.settings.order[a]]:_.map(this.settings.order,function(a){return[a]})};VizTextStream.prototype.getFeatureAtts=function(a){return null!=a?this.settings.lgnds[a]:this.settings.lgnds};
VizTextStream.prototype.setup=function(){var a=this;jQuery(this.frameID).on("click.vf",function(c){if("DIV"==c.target.nodeName){c=jQuery(c.target);var d=c.data("ai");"undefined"!=typeof d&&0<=d&&(a.toggleSel(d)?c.addClass("obj-sel"):c.removeClass("obj-sel"))}})};
VizTextStream.prototype.render=function(a){var c=this,d=PData.getNumETmplts(),f=0,l,m,p,q,v,A,e,k,t,r,g,n,h,x,z,C,y,w,u=jQuery(this.frameID);u.empty();1<this.recSel.length&&(this.recSel=[]);y=this.settings.max-this.settings.min;for(m=a.t[0];f<d;){for(;0==m.n;){if(++f==d)return;m=a.t[f]}r=c.vFrame.getSelLocAtts(f);if(0!=r.length&&(r=c.vFrame.getSelFeatAtts(f),0!=r.length)){g=c.vFrame.getSelLegend(f);n=PData.getAttID(g);u.append('<div class="viz-textstream" data-ti='+f+"></div>");p=u.find("div.viz-textstream[data-ti="+
f+"]");l=PData.getETmpltIndex(f);l=PData.getTmpltID(l);p.append('<div class="template-label">'+l.l+"</div>");t=c.settings.cnt[f];if(z=c.settings.sAtts[f])x=PData.getAttID(z),"number"==typeof x.r.min&&"number"==typeof x.r.max?C=x.r.max-x.r.min:z=null;t&&(l=PData.getAttID(c.settings.order[f]),l=PData.orderTBy(l,a,f),l.forEach(function(a){q=PData.getRecByIndex(a.i);v=q.a[g];"undefined"!=typeof v&&(h=PData.getAttLgndRecs(v,n,r,!1))&&((A=q.a[t])&&(A=PData.procAttTxt(t,A)),A&&(z?(e=q.a[z],e="undefined"!=
typeof e?Math.floor((e-x.r.min)*y/C)+c.settings.min:c.settings.min):e=c.settings.min,k=c.isSel(a.i)?" obj-sel":"",w=h.b?";background-color:black":"",p.append('<div class="recitem'+k+'" data-ai='+a.i+' style="color:'+h.v+w+";font-size:"+e+'px">'+A+"</div>")))}))}f++}};VizTextStream.prototype.teardown=function(){jQuery(this.frameID).off("click.vf")};
VizTextStream.prototype.setSel=function(a){var c=this;this.vFrame.getIndex();var d,f;this.recSel=a;jQuery(this.frameID).find("div.recitem").each(function(){f=jQuery(this);d=f.data("ai");null!=d&&(c.isSel(d)?f.addClass("obj-sel"):f.removeClass("obj-sel"))})};VizTextStream.prototype.clearSel=function(){0<this.recSel.length&&(this.recSel=[],jQuery(this.frameID).find("div.recitem").removeClass("obj-sel"))};VizTextStream.prototype.getState=function(){return{l:this.vFrame.getLgndSels()}};
VizTextStream.prototype.setState=function(a){this.vFrame.setLgndSels(a.l)};var VizStackChart=function(a,c){PVizModel.call(this,a,c);this.bSel=[]};VizStackChart.prototype=Object.create(PVizModel.prototype);VizStackChart.prototype.constructor=VizStackChart;VizStackChart.prototype.flags=function(){return V_FLAG_LGND|V_FLAG_SLGND|V_FLAG_VSCRL|V_FLAG_HSCRL};VizStackChart.prototype.getFeatureAtts=function(a){return this.settings.sAtt};
VizStackChart.prototype.setup2=function(){var a=this.settings.h,c=this.cats.length*(this.settings.bw+10);this.xScale=d3.scale.linear().domain([0,this.cats.length]).rangeRound([0,c]);this.yScale=d3.scale.linear().range([0,a-1]);this.rScale=d3.scale.ordinal().rangeRoundBands([0,c]);this.rScale.domain(this.cats.map(function(a){return a.l}));this.xAxis=d3.svg.axis().scale(this.rScale).orient("top");this.yAxis=d3.svg.axis().scale(this.yScale).orient("left").ticks(10);this.svg=d3.select(this.frameID).append("svg").attr("width",
c+D3SC_MARGINS.left+D3SC_MARGINS.right).attr("height",a+D3SC_MARGINS.top+D3SC_MARGINS.bottom);this.svg.append("g").attr("class","chart").attr("transform","translate("+D3SC_MARGINS.left+","+D3SC_MARGINS.top+")");this.svg.append("g").attr("class","x axis").attr("transform","translate("+D3SC_MARGINS.left+","+D3SC_MARGINS.top+")").call(this.xAxis);this.svg.append("g").attr("class","y axis").attr("transform","translate("+D3SC_MARGINS.left+","+D3SC_MARGINS.top+")")};
VizStackChart.prototype.setup=function(){var a=PData.getAttID(this.settings.oAtt);"T"==a.def.t&&this.settings.tlit?this.cats=null:(this.cats=this.settings.gr?PData.getRCats(a,!0):PData.getLCats(a,null),this.setup2())};
VizStackChart.prototype.render=function(a){var c=this;this.bSel=[];var d=this.settings.oAtt,f=this.settings.sAtt;this.svg.selectAll(".block").remove();null==this.cats?(this.cats=[],PData.fillCats(this.cats,d,f,a,!0),this.setup2()):PData.fillCats(this.cats,d,f,a,!1);this.blocks=[];a=PData.getAttID(f);for(var d=0,f=c.vFrame.getSelFeatAtts(0),f=PData.getLCats(a,f),l=0;l<this.cats.length;l++){if(0<l)for(var m=0;m<f.length;m++)f[m].i=[];PData.sortCats(c.cats[l].i,a,f);var p=0;f.forEach(function(a){0<a.i.length&&
(c.blocks.push({x:l,c:a.c,y:p,h:a.i.length,a:a.i}),p+=a.i.length)});d=Math.max(d,p)}this.yScale.domain([0,d]);this.svg.select(".y.axis").call(c.yAxis);a=this.settings.bw;this.svg.selectAll(".block").data(c.blocks).enter().append("rect").attr("class","block").attr("x",function(a){return D3SC_MARGINS.left+5+c.xScale(a.x)}).attr("y",function(a){return c.yScale(a.y)+D3SC_MARGINS.top}).attr("fill",function(a){return a.c}).attr("height",function(a){return Math.max(1,c.yScale(a.h)-1)}).attr("width",a).on("click",
function(a,d){var f=c.bSel.length,e=_.sortedIndex(c.bSel,d);c.bSel[e]==d?(d3.select(this).classed("obj-sel",!1),c.bSel.splice(e,1),0<f&&0==c.bSel.length&&c.vFrame.selBtns(!1)):(d3.select(this).classed("obj-sel",!0),c.bSel.splice(e,0,d),0==f&&0<c.bSel.length&&c.vFrame.selBtns(!0))})};VizStackChart.prototype.setSel=function(a){};VizStackChart.prototype.clearSel=function(){0<this.bSel.length&&(this.bSel=[],this.svg.selectAll(".block").classed("obj-sel",!1))};
VizStackChart.prototype.getSel=function(){var a=this,c=[];this.bSel.forEach(function(d){c=_.union(c,a.blocks[d].a)});return c};VizStackChart.prototype.getState=function(){return{l:this.vFrame.getLgndSels()}};VizStackChart.prototype.setState=function(a){this.vFrame.setLgndSels(a.l)};var VizNetWheel=function(a,c){PVizModel.call(this,a,c);this.bSel=[]};VizNetWheel.prototype=Object.create(PVizModel.prototype);VizNetWheel.prototype.constructor=VizNetWheel;
VizNetWheel.prototype.flags=function(){return V_FLAG_LGND|V_FLAG_SEL|V_FLAG_VSCRL|V_FLAG_HSCRL};VizNetWheel.prototype.getFeatureAtts=function(a){return null!=a?this.settings.lgnds[a]:this.settings.lgnds};
VizNetWheel.prototype.setup=function(){function a(){360<c.spin?c.spin-=360:0>c.spin&&(c.spin+=360);c.center.attr("transform","translate("+c.cr+","+c.cr+")rotate("+c.spin+")")}var c=this;this.spin=0;var d=this.vFrame.getIndex(),f=_.template(document.getElementById("dltext-v-nwheel").innerHTML);jQuery("#view-frame-"+d+" div.view-control-bar").append(f({vi:d}));jQuery("#nw-prev-"+d).button({text:!1,icons:{primary:" ui-icon-arrowreturnthick-1-s"}}).click(function(){jQuery("#nw-size-"+d+" :radio:checked").attr("id")==
"nw-size-1-"+d?c.spin+=c.inc:c.spin+=90;a()});jQuery("#nw-for-"+d).button({text:!1,icons:{primary:" ui-icon-arrowreturnthick-1-n"}}).click(function(){jQuery("#nw-size-"+d+" :radio:checked").attr("id")=="nw-size-1-"+d?c.spin-=c.inc:c.spin-=90;a()});jQuery("#nw-size-"+d).buttonset();this.svg=d3.select(this.frameID).append("svg");this.center=this.svg.append("g")};
VizNetWheel.prototype.render=function(a){var c=this,d=[],f,l,m;this.svg.selectAll(".node").remove();this.svg.selectAll(".link").remove();this.inc=360/(a.l+a.t.length);l=Math.max((14*a.l+20)/(2*Math.PI),30);var p=this.settings.lw;"string"==typeof p&&(p=parseInt(p));this.cr=p+12+l;p=2*this.cr;this.svg.attr("width",p).attr("height",p);this.center.attr("transform","translate("+this.cr+","+this.cr+")");1<this.recSel.length&&(this.recSel=[]);var q={children:[]};(function(){var d,f=0,e=0,k,t,r,g=[],n=null,
h,m;d=a.t[0];m=c.vFrame.getSelLegend(0);h=PData.getAttID(m);n=c.vFrame.getSelFeatAtts(0);a:for(;e<a.l;){for(;0==d.n||d.i+d.n==e||0==n.length;){0<g.length&&(q.children.push({ti:f,children:g}),g=[]);if(++f==PData.getNumETmplts())break a;g=[];d=a.t[f];m=c.vFrame.getSelLegend(f);h=PData.getAttID(m);n=c.vFrame.getSelFeatAtts(f)}r=a.s[e];k=PData.getRecByIndex(r);t=k.a[m];"undefined"!=typeof t&&(fData=PData.getAttLgndRecs(t,h,n,!1))&&g.push({r:k,ai:r,c:fData.v,children:[]});e++}0<g.length&&q.children.push({ti:f,
children:g})})();l=d3.layout.cluster().size([360,l]).sort(null).nodes(q);m=this.center.append("g").selectAll(".node").data(l.filter(function(a){return!a.children})).enter().append("g").attr("class","node").attr("transform",function(a){return"rotate("+(a.x-90)+")translate("+(a.y+8)+",0)"});m.append("circle").attr("r","5").style("fill",function(a){return a.c}).on("click",function(a){a=c.toggleSel(a.ai);d3.select(this).classed("obj-sel",a)});m.append("text").attr("dy",".31em").attr("dx",function(a){return 180>
a.x?"10":"-10"}).attr("transform",function(a){return 180>a.x?"":"rotate(180)"}).style("text-anchor",function(a){return 180>a.x?"start":"end"}).attr("fill","white").text(function(a){return a.r.l}).on("click",function(a){PState.set(PSTATE_UPDATE);m.each(function(a){a.linked=!1});f.each(function(c){if(c.s===a){c.t.linked=!0;for(var e=0;e<d.length;e++){var k=d[e];if(k.source===a&&k.target===c.t){d3.select(this).attr("stroke",k.c).classed("thick",!0);break}}}else if(c.t===a)for(c.s.linked=!0,e=0;e<d.length;e++){if(k=
d[e],k.target===a&&k.source===c.s){d3.select(this).attr("stroke",k.c).classed("thick",!0);break}}else d3.select(this).attr("stroke","white").classed("thick",!1)});m.select("text").attr("fill",function(a){return a.linked?"black":"white"});d3.select(this).attr("fill","red");PState.set(PSTATE_READY)});l=d3.layout.bundle();p=d3.svg.line.radial().interpolate("bundle").tension(.85).radius(function(a){return a.y}).angle(function(a){return a.x/180*Math.PI});q.children.forEach(function(a){var f=c.settings.pAtts[a.ti],
e;a.children.forEach(function(a){f.forEach(function(c){e=a.r.a[c.pid];"undefined"!=typeof e&&e.forEach(function(e){var g=!1,f,h=0;a:for(;h<q.children.length;h++)for(var m=q.children[h],z=0;z<m.children.length;z++)if(f=m.children[z],f.r.id==e){g=!0;break a}g&&d.push({source:a,target:f,c:c.clr})})})})});f=this.center.append("g").selectAll(".link").data(l(d)).enter().append("path").each(function(a){a.s=a[0];a.t=a[a.length-1]}).attr("class","link").attr("d",p).attr("stroke","white")};
VizNetWheel.prototype.teardown=function(){var a=this.vFrame.getIndex();jQuery("#view-frame-"+a+" div.view-control-bar div.iconbar").remove()};VizNetWheel.prototype.setSel=function(a){var c=this;c.recSel=a;this.svg.selectAll(".node circle").attr("class",function(a){return c.isSel(a.ai)?"obj-sel":""})};VizNetWheel.prototype.clearSel=function(){0<this.recSel.length&&(this.recSel=[],this.svg.selectAll(".node circle").attr("class",""))};VizNetWheel.prototype.getState=function(){return{l:this.vFrame.getLgndSels()}};
VizNetWheel.prototype.setState=function(a){this.vFrame.setLgndSels(a.l)};function PFilterModel(a,c,d){this.id=a;this.att=c;this.dirty=!0;this.req=d}PFilterModel.prototype.isDirty=function(a){null!=a&&(!this.dirty&&a&&0<this.id&&jQuery("#btn-recompute").addClass("pulse"),this.dirty=a);return this.dirty};PFilterModel.prototype.isReq=function(a,c){a&&(this.req!=c&&this.isDirty(!0),this.req=c);return this.dirty};PFilterModel.prototype.title=function(){return this.att.def.l};
PFilterModel.prototype.insertPt=function(){return jQuery('div.filter-instance[data-id="'+this.id+'"] div.filter-body')};PFilterModel.prototype.teardown=function(){};var PFilterText=function(a,c,d){PFilterModel.call(this,a,c,d)};PFilterText.prototype=Object.create(PFilterModel.prototype);PFilterText.prototype.constructor=PFilterText;PFilterText.prototype.evalPrep=function(){this.findStr=this.insertPt().find("input.filter-text").val()};
PFilterText.prototype.eval=function(a){var c=this.findStr;if(null==c||""==c)return!0;a=a.a[this.att.id];return"undefined"==typeof a?this.req?!1:!0:-1!=a.indexOf(c)};PFilterText.prototype.setup=function(){var a=this,c=this.insertPt(),d=document.getElementById("dltext-filter-text").innerHTML;c.append(d);c.find("input.filter-text").change(function(){a.isDirty(!0)})};PFilterText.prototype.getState=function(){return{t:this.insertPt().find("input.filter-text").val()}};PFilterText.prototype.setState=function(a){this.insertPt().find("input.filter-text").val(a.t)};
var PFilterVocab=function(a,c,d){PFilterModel.call(this,a,c,d)};PFilterVocab.prototype=Object.create(PFilterModel.prototype);PFilterVocab.prototype.constructor=PFilterVocab;PFilterVocab.prototype.evalPrep=function(){var a=this;this.sel=[];this.insertPt().find("div.filter-vocab-row input:checked").each(function(){var c=jQuery(this).parent().data("id");a.sel.push(c)});a.sel.sort()};
PFilterVocab.prototype.eval=function(a){if(0==this.sel.length)return!1;a=a.a[this.att.id];if("undefined"==typeof a)return this.req?!1:!0;for(var c,d,f=0;f<a.length;f++)if(d=a[f],c=_.sortedIndex(this.sel,d),this.sel[c]==d)return!0;return!1};
PFilterVocab.prototype.setup=function(){var a=this,c='<div class="filter-vocab-container">';this.att.l.forEach(function(a,d){c+='<div class="filter-vocab-entry" data-index="'+d+'"><div class="filter-vocab-row" data-id="'+a.l+'"><input type="checkbox" value="min-use" checked="checked">'+a.l+'</div><div class="filter-vocab-bar" style="background-color:'+a.v+'"></div>';a.z.forEach(function(d,l){c+='<div class="filter-vocab-row" data-id="'+d.l+'"><input type="checkbox" value="min-use" checked="checked">'+
d.l+"</div>";c=null==d.v||""==d.v?c+('<div class="filter-vocab-bar" style="background-color:'+a.v+'"></div>'):c+('<div class="filter-vocab-bar" style="background-color:'+d.v+'"></div>')});c+="</div>"});var d=this.insertPt();d.append(c+"</div>");d.click(function(c){"INPUT"==c.target.nodeName&&a.isDirty(!0)})};PFilterVocab.prototype.getState=function(){var a=[];this.insertPt().find("div.filter-vocab-row input:checked").each(function(){var c=jQuery(this).parent().data("id");a.push(c)});a.sort();return{s:a}};
PFilterVocab.prototype.setState=function(a){this.insertPt().find("div.filter-vocab-row").each(function(){var c=jQuery(this),d=c.data("id"),d=_.indexOf(a.s,d,!0);c.find("input").prop("checked",-1!=d)})};var PFilterNum=function(a,c,d){PFilterModel.call(this,a,c,d)};PFilterNum.prototype=Object.create(PFilterModel.prototype);PFilterNum.prototype.constructor=PFilterNum;
PFilterNum.prototype.evalPrep=function(){if(null==this.rCats){var a=this.insertPt();this.min=parseInt(a.find("input.filter-num-min-val").val());this.max=parseInt(a.find("input.filter-num-max-val").val());this.useMin=a.find("input.filter-num-min-use").is(":checked");this.useMax=a.find("input.filter-num-max-use").is(":checked")}};
PFilterNum.prototype.eval=function(a){a=a.a[this.att.id];if("undefined"==typeof a)return this.req?!1:!0;if(this.useMin&&a<this.min)return!1;if(null==this.rCats){if(this.useMax&&a>this.max)return!1}else if(a>=this.max)return!1;return!0};
PFilterNum.prototype.setup=function(){var a=this,c=this.insertPt();this.rCats=PData.getRCats(this.att,!1);if(null==this.rCats){var d=_.template(document.getElementById("dltext-filter-num-boxes").innerHTML),f="undefined"==typeof this.att.r.min?0:this.att.r.min;c.append(d({min:f,max:"undefined"==typeof this.att.r.max?f+100:this.att.r.max}));c.click(function(c){"INPUT"==c.target.nodeName&&a.isDirty(!0)});c.find("input.filter-num-min-val").change(function(){var d=jQuery(this).val(),f=c.find("input.filter-num-max-val").val();
d<=f?a.isDirty(!0):jQuery(this).val(f)});c.find("input.filter-num-max-val").change(function(){var d=jQuery(this).val(),f=c.find("input.filter-num-min-val").val();d>=f?a.isDirty(!0):jQuery(this).val(f)})}else{this.useMin=this.useMax=!0;this.min=this.rCats[0].min;this.max=this.rCats[this.rCats.length-1].max;var l=80-D3FG_MARGINS.top-D3FG_MARGINS.bottom,d=this.rCats.length*D3FG_BAR_WIDTH,m=d3.scale.linear().domain([0,this.rCats.length]).rangeRound([0,d]),p=d3.scale.linear().domain([0,100]).range([l,
0]),f=d3.scale.ordinal().rangeRoundBands([0,d]);f.domain(this.rCats.map(function(a){return a.l}));var f=d3.svg.axis().scale(f).orient("bottom"),q=d3.svg.axis().scale(p).orient("left").ticks(4),d=d3.select(c.get(0)).append("svg").attr("width",d+D3FG_MARGINS.left+D3FG_MARGINS.right).attr("height",l+D3FG_MARGINS.top+D3FG_MARGINS.bottom).append("g").attr("transform","translate("+D3FG_MARGINS.left+","+D3FG_MARGINS.top+")");d.append("g").attr("class","x axis").attr("transform","translate(0,"+l+")").call(f);
d.append("g").attr("class","y axis").call(q);d.selectAll(".bar").data(this.rCats).enter().append("rect").attr("class","bar").attr("x",function(a,c){return m(c)}).attr("y",function(a){return p(100)}).attr("fill",function(a){return a.c}).attr("height",function(a){return l-p(100)}).attr("width",D3FG_BAR_WIDTH-2);a.brush=d3.svg.brush().x(m).extent([0,this.rCats.length]).on("brushend",function(){if(d3.event.sourceEvent){var c=a.brush.extent(),d=[Math.floor(c[0]),Math.floor(c[1])];d[0]>=d[1]&&(d[0]=Math.floor(c[0]),
d[1]=Math.ceil(c[1]));d[1]=Math.max(d[1],d[0]+1);d3.select(this).transition().call(a.brush.extent(d));a.min=a.rCats[d[0]].min;a.max=a.rCats[d[1]-1].max;a.isDirty(!0)}});a.brushg=d.append("g");a.brushg.attr("class","brush").call(a.brush);a.brushg.selectAll("rect").attr("y",0).attr("height",l);a.brushg.selectAll(".resize").append("path").attr("d",function(a){var c=(a=+("e"==a))?1:-1,e=l/4;return"M"+.5*c+","+e+"A6,6 0 0 "+a+" "+6.5*c+","+(e+6)+"V"+(2*e-6)+"A6,6 0 0 "+a+" "+.5*c+","+2*e+"ZM"+2.5*c+","+
(e+8)+"V"+(2*e-8)+"M"+4.5*c+","+(e+8)+"V"+(2*e-8)})}};PFilterNum.prototype.getState=function(){if(null==this.rCats){var a=this.insertPt(),c=parseInt(a.find("input.filter-num-min-val").val()),d=parseInt(a.find("input.filter-num-max-val").val()),f=a.find("input.filter-num-min-use").is(":checked"),a=a.find("input.filter-num-max-use").is(":checked");return{rc:!1,min:c,max:d,useMin:f,useMax:a}}c=this.brush.extent();return{rc:!0,e0:c[0],e1:c[1]}};
PFilterNum.prototype.setState=function(a){if(a.rc)this.min=this.rCats[a.e0].min,this.max=this.rCats[a.e1-1].max,this.brush.extent([a.e0,a.e1]),this.brushg.call(this.brush);else{var c=this.insertPt();c.find("input.filter-num-min-val").val(a.min);c.find("input.filter-num-max-val").val(a.max);c.find("input.filter-num-min-use").prop("checked",a.useMin);c.find("input.filter-num-max-use").prop("checked",a.useMax)}};var PFilterDates=function(a,c,d){PFilterModel.call(this,a,c,d)};PFilterDates.prototype=Object.create(PFilterModel.prototype);
PFilterDates.prototype.constructor=PFilterDates;PFilterDates.prototype.evalPrep=function(){this.c=jQuery("input[name=dctrl-"+this.id+"]:checked").val()};
PFilterDates.prototype.eval=function(a){function c(a,c,d,p){"undefined"!=typeof p.m&&(c=p.m,"undefined"!=typeof p.d&&(d=p.d));return PData.date3Nums(a,c,d)}var d=a.a[this.att.id];if("undefined"==typeof d)return this.req?!1:!0;if("undefined"==typeof d.max)return a=c(d.min.y,1,1,d.min),this.min<=a&&a<this.max;a=c(d.min.y,1,1,d.min);d="open"==d.max?TODAY:c(d.max.y,12,31,d.max);return"o"==this.c?d<this.min||a>=this.max?!1:!0:this.min<=a&&d<=this.max};
PFilterDates.prototype.setup=function(){var a=this;this.rCats=PData.getRCats(this.att,!1);this.min=this.rCats[0].min;this.max=this.rCats[this.rCats.length-1].max;var c=80-D3FG_MARGINS.top-D3FG_MARGINS.bottom,d=this.rCats.length*D3FG_BAR_WIDTH,f=d3.scale.linear().domain([0,this.rCats.length]).rangeRound([0,d]),l=d3.scale.linear().domain([0,100]).range([c,0]),m=d3.scale.ordinal().rangeRoundBands([0,d]);m.domain(this.rCats.map(function(a){return a.l}));var m=d3.svg.axis().scale(m).orient("bottom"),p=
d3.svg.axis().scale(l).orient("left").ticks(4),q=this.insertPt(),v=_.template(document.getElementById("dltext-filter-date-ctrl").innerHTML);q.append(v({id:this.id}));q.find("input[name=dctrl-"+a.id+"]").change(function(){a.isDirty(!0)});d=d3.select(q.get(0)).append("svg").attr("width",d+D3FG_MARGINS.left+D3FG_MARGINS.right).attr("height",c+D3FG_MARGINS.top+D3FG_MARGINS.bottom).append("g").attr("transform","translate("+D3FG_MARGINS.left+","+D3FG_MARGINS.top+")");d.append("g").attr("class","x axis").attr("transform",
"translate(0,"+c+")").call(m);d.append("g").attr("class","y axis").call(p);d.selectAll(".bar").data(this.rCats).enter().append("rect").attr("class","bar").attr("x",function(a,e){return f(e)}).attr("y",function(a){return l(100)}).attr("fill",function(a){return a.c}).attr("height",function(a){return c-l(100)}).attr("width",D3FG_BAR_WIDTH-2);a.brush=d3.svg.brush().x(f).extent([0,this.rCats.length]).on("brushend",function(){if(d3.event.sourceEvent){var c=a.brush.extent(),e=[Math.floor(c[0]),Math.floor(c[1])];
e[0]>=e[1]&&(e[0]=Math.floor(c[0]),e[1]=Math.ceil(c[1]));e[1]=Math.max(e[1],e[0]+1);d3.select(this).transition().call(a.brush.extent(e));a.min=a.rCats[e[0]].min;a.max=a.rCats[e[1]-1].max;a.isDirty(!0)}});a.brushg=d.append("g");a.brushg.attr("class","brush").call(a.brush);a.brushg.selectAll("rect").attr("y",0).attr("height",c);a.brushg.selectAll(".resize").append("path").attr("d",function(a){var e=(a=+("e"==a))?1:-1,k=c/4;return"M"+.5*e+","+k+"A6,6 0 0 "+a+" "+6.5*e+","+(k+6)+"V"+(2*k-6)+"A6,6 0 0 "+
a+" "+.5*e+","+2*k+"ZM"+2.5*e+","+(k+8)+"V"+(2*k-8)+"M"+4.5*e+","+(k+8)+"V"+(2*k-8)})};PFilterDates.prototype.getState=function(){var a=this.brush.extent(),c=jQuery("input[name=dctrl-"+this.id+"]:checked").val();return{e0:a[0],e1:a[1],c:c}};PFilterDates.prototype.setState=function(a){jQuery('input[name="dctrl-'+this.id+'"]').val([a.c]);this.min=this.rCats[a.e0].min;this.max=this.rCats[a.e1-1].max;this.brush.extent([a.e0,a.e1]);this.brushg.call(this.brush)};
function PViewFrame(a){function c(){return"#view-frame-"+a}function d(a){a=jQuery(c()+" div.view-control-bar select.view-viz-select option:selected").val();PState.set(PSTATE_BUILD);t(a,!0);PState.set(PSTATE_READY)}function f(a){n.flags()&V_FLAG_LGND&&jQuery(c()+" div.lgnd-container").toggle("slide",{direction:"left"});a.preventDefault()}function l(a){function e(a){var c=new Number,k=parseTC.exec(a);if(null!==k)c=1E3*(3600*parseInt(k[1])+60*parseInt(k[2])+parseFloat(k[3])),c=1==k[4].length?c+100*parseInt(k[4]):
c+10*parseInt(k[4]);else throw reportError(!1,"Error in transcript file: Cannot parse "+a+" as timecode."),Error("Error in transcript file: Cannot parse "+a+" as timecode.");return c}function c(a,e){var k=new String(a);if(widgetData.extract){var d=k.indexOf(widgetData.extract[0]);if(-1==d)throw Error("Transcript2 excerpt error: Cannot find timestamp "+widgetData.extract[0]);var g=k.indexOf(widgetData.extract[1]);if(-1==g)throw Error("Transcript2 excerpt error: Cannot find timestamp "+widgetData.extract[1]);
k=k.substring(d-1,g-1)}var k=k.trim().split(/\r\n|\r|\n/g),t=[];if(k){var f,h=0;_.each(k,function(a){a=a.trim();0<a.length&&("["===a.charAt(0)?(0<h&&t.push(f),f=""):f+=a,h++)})}_.each(t,function(a,c){e.find('div.timecode[data-tcindex="'+c+'"]').next().after('<div class="xscript">'+a+"</div>")})}function k(a){widgetData.tcArray=[];widgetData.tcIndex=-1;var d=widgetData.tcArray;a=new String(a);if(widgetData.extract){var g=a.indexOf(widgetData.extract[0]);if(-1==g)throw Error("Transcript excerpt error: Cannot find timestamp "+
widgetData.extract[0]);var t=a.indexOf(widgetData.extract[1]);if(-1==t)throw Error("Transcript excerpt error: Cannot find timestamp "+widgetData.extract[1]);a=a.substring(g-1,t-1)}if(a=a.trim().split(/\r\n|\r|\n/g)){var f=0,h,n=0,r=0,B="",D=jQuery("#xscript-tbl");_.each(a,function(a){a=a.trim();1<a.length&&("["===a.charAt(0)&&"0"<=a.charAt(1)&&"9">=a.charAt(1)?(h=e(a),0<B.length&&(r&&d.push({s:n,e:h}),D.append('<div class="row"><div class="timecode" data-timecode="'+n+'" data-tcindex="'+f++ +'">'+
r+'</div><div class="xscript">'+B+"</div></div>"),B=""),r=a,n=h):B+=a)});0<B.length&&(d.push({s:n,e:324E5}),D.append('<div class="row"><div class="timecode" data-timecode="'+n+'" data-tcindex="'+f+'">'+r+'</div><div class="xscript">'+B+"</div></div>"));if("undefined"!=typeof p&&null!=p){var z=new XMLHttpRequest;z.onload=function(a){c(z.responseText,D)};z.open("GET",p,!0);z.send()}}}function d(a){var e,c=widgetData.tcIndex;_.find(widgetData.tcArray,function(k,d){if((e=k.s<=a&&a<k.e)&&d!=c){var g=jQuery("#xscript-tbl");
if(document.getElementById("sync-xscript").checked){var t=g.find('[data-tcindex="'+d+'"]').offset().top-g.offset().top,t=g.scrollTop()+t;g.animate({scrollTop:t},300)}-1!=c&&g.find('[data-tcindex="'+c+'"]').removeClass("current");g.find('[data-tcindex="'+d+'"]').addClass("current");widgetData.tcIndex=d}return e})}function g(){widgetData.widget=new YT.Player("yt-widget",{width:"426",height:"240",videoId:widgetData.ytCode,events:{onError:function(a){console.log("YouTube Error: "+a.data)},onStateChange:function(a){var e;
switch(a.data){case 1:widgetData.playing=!0;null==widgetData.timer&&(widgetData.timer=setInterval(function(){e=1E3*widgetData.widget.getCurrentTime();widgetData.playing&&d(e)},300));break;case 0:case 2:widgetData.playing=!1;window.clearInterval(widgetData.timer);widgetData.timer=null;break;case 3:case 5:widgetData.playing=!1}},onReady:function(){widgetData.extract&&widgetData.widget.cueVideoById({videoId:widgetData.ytCode,startSeconds:widgetData.sTime/1E3,endSeconds:widgetData.eTime/1E3})}}})}function t(){function a(){widgetData.sTime=
widgetData.eTime=null;var c;(c=prspdata.e.i.t.tcAtts[h])&&(c=v.a[c])&&""!=c&&(c=c.split("-"),widgetData.extract=c,widgetData.sTime=e(c[0]),widgetData.eTime=e(c[1]))}var c=x[A];v=PData.getRecByIndex(c);var f=" "+v.l+" ("+(A+1)+"/"+x.length+") ";jQuery("#inspect-name").text(f);var h=PData.aIndex2Tmplt(c);D.empty();prspdata.e.i.modal.atts[h].forEach(function(a){var e=PData.getRecAtt(c,a,!1);e&&(a='<div><span class="att-label">'+PData.getAttID(a).def.l+":</span> "+e+"</div>",D.append(a))});m=null;l=0;
widgetData.extract=null;widgetData.xscriptOn=!1;widgetData.playing=!1;if(prspdata.e.i.modal.scOn&&(m=prspdata.e.i.sc.atts[h])&&(f=v.a[m])){var n=!0;a();l=1;D.append('<iframe id="sc-widget" class="player" width="100%" height="150" src="http://w.soundcloud.com/player/?url='+f+'"></iframe></p>');var r=SC.Widget(document.getElementById("sc-widget"));widgetData.widget=r;r.bind(SC.Widget.Events.READY,function(){r.play();r.bind(SC.Widget.Events.PLAY,function(){widgetData.playing=!0});r.bind(SC.Widget.Events.PAUSE,
function(){widgetData.playing=!1});r.bind(SC.Widget.Events.PLAY_PROGRESS,function(a){n&&(r.pause(),n=!1,widgetData.playing=!1);widgetData.extract&&(a.currentPosition<widgetData.sTime?r.seekTo(widgetData.sTime):a.currentPosition>widgetData.eTime&&(r.pause(),widgetData.playing=!1));widgetData.playing&&widgetData.xscriptOn&&d(a.currentPosition)});r.bind(SC.Widget.Events.FINISH,function(){widgetData.playing=!1})})}if(0==l&&prspdata.e.i.modal.ytOn&&(m=prspdata.e.i.yt.atts[h])&&(f=v.a[m])){a();widgetData.ytCode=
f;D.append('<div id="yt-widget"></div>');widgetData.ytCall=g;if(widgetData.ytLoaded)g();else{widgetData.ytLoaded=!0;f=document.createElement("script");f.src="https://www.youtube.com/iframe_api";var B=document.getElementsByTagName("script")[0];B.parentNode.insertBefore(f,B)}l=2}if(prspdata.e.i.modal.tOn&&(f=prspdata.e.i.t.t1Atts[h])&&""!==f&&"disable"!=f&&(f=v.a[f])){0<l&&D.append("<div>"+document.getElementById("dltext-sync-xscript").innerHTML+"</div>");D.append('<div id="xscript-tbl"><div>');widgetData.xscriptOn=
!0;jQuery("#xscript-tbl").click(function(a){if(l&&jQuery(a.target).hasClass("timecode"))switch(a=jQuery(a.target).data("timecode"),l){case 1:widgetData.playing||(widgetData.playing=!0,widgetData.widget.play());widgetData.widget.seekTo(a);break;case 2:widgetData.playing||(widgetData.playing=!0,widgetData.widget.playVideo()),widgetData.widget.seekTo(a/1E3)}});p=null;(B=prspdata.e.i.t.t2Atts[h])&&""!==B&&"disable"!=B&&(p=v.a[B]);var y=new XMLHttpRequest;y.onload=function(a){k(y.responseText)};y.open("GET",
f,!0);y.send()}}function f(a){a=A+a;-1==a?a=x.length-1:a==x.length&&(a=0);a!=A&&(A=a,t())}function h(a){f(-1)}function r(a){f(1)}var D=jQuery("#inspect-content"),m=null,l=0,p,x=null;n&&(x=n.getSel());if(null!=x&&0!=x.length){var q,v,A=0;t();jQuery("#btn-inspect-left").click(h);jQuery("#btn-inspect-right").click(r);var J=450,K=400;prspdata.e.i.modal.scOn&&(J=550);prspdata.e.i.modal.ytOn&&(J=Math.max(J,460),K=500);prspdata.e.i.tOn&&(K+=100,J=prspdata.e.i.t2On?750:Math.max(J,500));q=jQuery("#dialog-inspector").dialog({width:J,
height:K,modal:!0,buttons:[{text:dlText.seerec,click:function(){window.open(prspdata.site_url+"?p="+v.wp,"_blank")}},{text:dlText.close,click:function(){switch(l){case 1:null!=widgetData.widget&&widgetData.playing&&widgetData.widget.pause();widgetData.playing=!1;widgetData.widget=null;break;case 2:widgetData.ytCall=null,null!=widgetData.widget&&widgetData.playing&&widgetData.widget.stopVideo(),widgetData.widget=null,widgetData.playing=!1,null!=widgetData.timer&&(window.clearInterval(widgetData.timer),
widgetData.timer=null)}jQuery("#btn-inspect-left").off("click");jQuery("#btn-inspect-right").off("click");q.dialog("close")}}]});a.preventDefault()}}function m(a){var e=jQuery(c()+" .view-control-bar");a?(e.find(".osel").button("enable"),e.find(".osel").addClass("pulse"),e.find(".xsel").button("enable")):(e.find(".osel").button("disable"),e.find(".osel").removeClass("pulse"),e.find(".xsel").button("disable"))}function p(a){n&&n.clearSel();m(!1);a.preventDefault()}function q(a){n&&n.optionsModal();
a.preventDefault()}function v(a,e){jQuery(c()+' div.lgnd-container div.lgnd-scroll div.lgnd-template[data-index="'+a+'"] div.lgnd-group input.lgnd-entry-check').prop("checked",e)}function A(a){var e=jQuery(a.target).closest("div.lgnd-template").data("index"),k=a.target.className;switch(k){case "lgnd-update":n&&x&&(PState.set(PSTATE_BUILD),m(!1),n.render(x),PState.set(PSTATE_READY));break;case "lgnd-entry-check":k=jQuery(a.target).closest("div.lgnd-entry");a=jQuery(a.target).is(":checked");k.hasClass("lgnd-sh")?
v(e,a):k.hasClass("lgnd-locate")?k.data("id"):k.hasClass("lgnd-value")&&k.data("index");break;case "lgnd-viz":case "lgnd-value-title":k=jQuery(a.target).closest("div.lgnd-entry");k.hasClass("lgnd-locate")?(a=k.data("id"),jQuery(c()+' div.lgnd-container div.lgnd-scroll div.lgnd-template[data-index="'+e+'"] div.lgnd-locate input.lgnd-entry-check').prop("checked",!1),jQuery(c()+' div.lgnd-container div.lgnd-scroll div.lgnd-template[data-index="'+e+'"] div.lgnd-locate[data-id="'+a+'"] input.lgnd-entry-check').prop("checked",
!0)):k.hasClass("lgnd-value")&&(a=k.data("index"),jQuery(c()+' div.lgnd-container div.lgnd-scroll div.lgnd-template[data-index="'+e+'"] div.lgnd-group input.lgnd-entry-check').prop("checked",!1),jQuery(c()+' div.lgnd-container div.lgnd-scroll div.lgnd-template[data-index="'+e+'"] div.lgnd-group div.lgnd-value[data-index="'+a+'"] input.lgnd-entry-check').prop("checked",!0));break;case "lgnd-template":case "lgnd-select":case "":break;default:k.match(/lgnd-sh/i)&&(k=jQuery(a.target).find("input.lgnd-entry-check"),
a=!k.is(":checked"),k.prop("checked",a),v(e,a))}}function e(a){var e=jQuery(a.target).closest("div.lgnd-template").data("index");a=jQuery(a.target).val();k(e,a)}function k(a,e){var k,d=jQuery(c()+' div.lgnd-container div.lgnd-scroll div.lgnd-template[data-index="'+a+'"] div.lgnd-group');d.empty();h[a]=e;PData.getAttID(e).l.forEach(function(a,e){k='<div class="lgnd-value lgnd-entry" data-index="'+e+'"><input type="checkbox" checked="checked" class="lgnd-entry-check"/><div class="lgnd-viz" style="background-color: '+
a.v+'"> </div> <span class="lgnd-value-title">'+a.l+"</span></div>";d.append(k);a.z&&0<a.z.length&&a.z.forEach(function(a,c){k='<div class="lgnd-value lgnd-entry" data-index="'+e+","+c+'"><input type="checkbox" checked="checked" class="lgnd-entry-check"/>';k=a.v&&""!=a.v?k+('<div class="lgnd-viz" style="background-color: '+a.v+'"></div>'):k+'<div class="lgnd-viz lgnd-viz-empty"></div>';k+=' <span class="lgnd-value-title"> > '+a.l+"</span></div>";d.append(k)})});jQuery(c()+' div.lgnd-container div.lgnd-scroll div.lgnd-template[data-index="'+
a+'"] div.lgnd-sh input').prop("checked",!0)}function t(d,t){var f=PData.getVizIndex(d);n&&(n.teardown(),n=null);var l=jQuery(c());l.find("div.viz-content div.viz-result").empty();var p;switch(f.vf){case "M":p=new VizMap(r,f.c);break;case "C":p=new VizCards(r,f.c);break;case "P":p=new VizPinboard(r,f.c);break;case "T":p=new VizTime(r,f.c);break;case "D":p=new VizDirectory(r,f.c);break;case "t":p=new VizTextStream(r,f.c);break;case "S":p=new VizStackChart(r,f.c);break;case "N":p=new VizNetWheel(r,
f.c)}g=d;var q=p.flags();q&V_FLAG_HSCRL?(l.find("div.viz-content").addClass("h-scroll"),l.find("div.viz-result").addClass("viz-fit-w"),l.find("div.viz-result").removeClass("viz-max-w")):(l.find("div.viz-content").removeClass("h-scroll"),l.find("div.viz-result").removeClass("viz-fit-w"),l.find("div.viz-result").addClass("viz-max-w"));q&V_FLAG_VSCRL?(l.find("div.viz-content").addClass("v-scroll"),l.find("div.viz-result").addClass("viz-fit-h"),l.find("div.viz-result").removeClass("viz-max-h")):(l.find("div.viz-content").removeClass("v-scroll"),
l.find("div.viz-result").removeClass("viz-fit-h"),l.find("div.viz-result").addClass("viz-max-h"));h=[];if(q&V_FLAG_LGND){l.find(".hslgnd").button("enable");var v=l.find("div.lgnd-container div.lgnd-scroll");v.empty();if(q&V_FLAG_SLGND){var f=p.getFeatureAtts(),B=PData.getAttID(f);v.append('<div class="lgnd-template" data-index="0"><div class="lgnd-title">'+B.def.l+'</div><div class="lgnd-entry lgnd-sh"><input type="checkbox" checked="checked" class="lgnd-entry-check"/>'+dlText.sha+'</div><div class="lgnd-group"></div></div>');
h.push(f);k(0,f)}else prspdata.e.g.ts.forEach(function(a,c){var d=PData.getTmpltID(a),f=p.getLocAtts(c);if(f&&0<f.length||!(q&V_FLAG_LOC)){var g=jQuery('<div class="lgnd-template" data-index="'+c+'"><div class="lgnd-title">'+d.l+"</div></div>");f&&f.forEach(function(a,e){var c=PData.getAttID(a);g.append('<div class="lgnd-entry lgnd-locate" data-id="'+a+'"><input type="checkbox" checked="checked" class="lgnd-entry-check"/><span class="lgnd-value-title">'+c.def.l+"</span></div>")});var d=p.getFeatureAtts(c),
t='<select class="lgnd-select">';d.forEach(function(a,e){var c=PData.getAttID(a);t+='<option value="'+a+'">'+c.def.l+"</option>"});t+="</select>";f=jQuery(t);f.change(e);jQuery(g).append(f);jQuery(g).append('<div class="lgnd-entry lgnd-sh"><input type="checkbox" checked="checked" class="lgnd-entry-check"/>'+dlText.sha+'</div><div class="lgnd-group"></div>');v.append(g);c!=prspdata.t.length-1&&v.append("<hr/>");d=0<d.length?d[0]:null;h.push(d);d&&k(c,d)}});l.find("div.lgnd-container").show()}else l.find(".hslgnd").button("disable"),
l.find("div.lgnd-container").hide();f=jQuery("#selector-v"+a);q&V_FLAG_SEL?(f.removeAttr("disabled"),f.prop("checked",!0)):(f.attr("disabled",!0),f.prop("checked",!1));q&V_FLAG_SET?l.find(".vopts").button("enable"):l.find(".vopts").button("disable");p.setup();m(!1);x&&t&&p.render(x);n=p}var r={},g=0,n=null,h=[],x=null;r.getFrameID=c;r.getIndex=function(){return a};r.setViz=function(a,e){a!=g&&(jQuery(c()+" div.view-control-bar select.view-viz-select").val(a),t(a,e))};r.initDOM=function(e){var k=document.getElementById("dltext-viewframe-dom").innerHTML;
jQuery("#viz-display-frame").append('<div id="view-frame-'+a+'">'+k+"</div>");var k=jQuery(c()),g=k.find("div.view-control-bar select.view-viz-select");prspdata.e.vf.forEach(function(a,e){g.append('<option value="'+e+'">'+a.l+"</option>")});g.val(e);g.change(d);k.find("div.view-control-bar button:first").button({icons:{primary:"ui-icon-bookmark"},text:!1}).click(f).next().button({icons:{primary:"ui-icon-info"},text:!1}).click(l).next().button({icons:{primary:"ui-icon-cancel"},text:!1}).click(p).next().button({icons:{primary:"ui-icon-gear"},
text:!1}).click(q).next();k.find("div.lgnd-container").click(A);t(e,!1)};r.getSelLocAtts=function(a){var e=[];jQuery(c()+' div.lgnd-container div.lgnd-scroll div.lgnd-template[data-index="'+a+'"] div.lgnd-locate input:checked').each(function(){var a=jQuery(this).parent().data("id");e.push(a)});return e};r.getSelFeatAtts=function(a){var e=[],k,d;jQuery(c()+' div.lgnd-container div.lgnd-scroll div.lgnd-template[data-index="'+a+'"] div.lgnd-group div.lgnd-value input:checked').each(function(){k=jQuery(this).parent().data("index");
"number"==typeof k?e.push(k):-1!=(d=k.indexOf(","))?e.push([parseInt(k.substring(0,d),10),parseInt(k.substring(d+1),10)]):e.push(parseInt(k,10))});return e};r.getSelLegend=function(a){return h[a]};r.getLgndSels=function(){return h.slice(0)};r.setLgndSels=function(a){a.forEach(function(a,e){jQuery(c()+' div.lgnd-container div.lgnd-scroll div.lgnd-template[data-index="'+e+'"] select.lgnd-select').val(a);k(e,a)})};r.getState=function(){return n?n.getState():null};r.setState=function(a){n&&n.setState(a)};
r.showStream=function(a){x=a;n&&n.render(a)};r.setStream=function(a){x=a};r.selBtns=function(a){m(a)};r.clearSel=function(){n&&n.clearSel();m(!1)};r.setSel=function(a){return n&&n.flags()&V_FLAG_SEL?(n.setSel(a),m(0<a.length),!0):!1};r.resize=function(){n&&n.resize()};r.title=function(){return PData.getVizIndex(g).l};return r}
var PData=function(){function a(a,k,d){jQuery.ajax({type:"POST",url:prspdata.ajax_url,data:{action:"prsp_get_records",tmplt_id:prspdata.t[a].id,from:k,count:d},success:function(k,f,n){f=q[a];k=JSON.parse(k);f.d=f.d?f.d.concat(k):k;f.n+=d;c()},error:function(a,e,c){alert(c)}})}function c(){for(var e=!0,c=0;c<prspdata.t.length;c++){var f=q[c].n,r=prspdata.t[c].n;if(f<r){e=!1;r-=f;a(c,f,r<d?r:d);break}}e&&(A=!0,setTimeout(function(){jQuery("body").trigger("prospect",{pstate:PSTATE_PROCESS,component:0})},
500))}var d=1E3,f,l,m,p,q=[],v=0,A=!1;return{init:function(){f=document.getElementById("dltext-from").innerHTML;l=document.getElementById("dltext-to").innerHTML;m=document.getElementById("dltext-approximately").innerHTML;p=document.getElementById("dltext-now").innerHTML;"number"==typeof prspdata.chunk&&0<prspdata.chunk&&(d=prspdata.chunk);prspdata.t.forEach(function(a){q.push({i:v,n:0,d:null});v+=a.n});c()},strcmp:function(a,c){for(var d=0,f=Math.max(a.length,c.length);d<f&&a.charAt(d)===c.charAt(d);++d);
return d===f?0:a.charAt(d)>c.charAt(d)?-1:1},newIndexStream:function(a){var c={};c.s=new Uint16Array(v);c.t=[];c.l=0;if(a){for(a=0;a<v;a++)c.s[a]=a;for(a=0;a<q.length;a++){var d=q[a];c.t.push({i:d.i,n:d.n})}c.l=v}return c},aIndex2Tmplt:function(a){for(var c=0;c<q.length;c++){var d=q[c];if(d.i<=a&&a<d.i+d.n)return c}},attInTmplt:function(a,c){var d=prspdata.t[c],f=a.split("."),f=f[0];return-1!=d.def.a.findIndex(function(a){return a==f})},stream1stTEntry:function(a,c){var d=a.t[c];return 0==d.n?-1:
d.i},getRecByIndex:function(a){for(var c=0;c<q.length;c++){var d=q[c];if(0<d.n&&d.i<=a&&a<d.i+d.n)return d.d[a-d.i]}return null},procAttTxt:function(a,c){var d=PData.getAttID(a);switch(d.def.t){case "V":return c.join(", ");case "T":return c;case "N":return c.toString();case "D":return c.max?(d=f,c.min.f&&(d+=m),d+=c.min.y.toString(),c.min.m&&(d+="-"+c.min.m.toString(),c.min.d&&(d+="-"+c.min.d.toString())),d+=l,"open"==c.max?d+=p:(c.max.f&&(d+=m+" "),d+=c.max.y.toString(),c.max.m&&(d+="-"+c.max.m.toString(),
c.max.d&&(d+="-"+c.max.d.toString())))):(d=c.min.f?m:"",d+=c.min.y.toString(),c.min.m&&(d+="-"+c.min.m.toString(),c.min.d&&(d+="-"+c.min.d.toString()))),d;case "L":case "X":return c.join(", ");case "I":return'<img src="'+c+'" alt="'+d.def.l+'"/>';case "l":return'<a href="'+c+'" target="_blank">(See Link)</a>';case "S":return'<a href="'+c+'" target="_blank">(SoundCloud)</a>';case "Y":return'<a href="https://www.youtube.com/watch?v='+c+'" target="_blank">(YouTube)</a>';case "x":return'<a href="'+c+
'" target="_blank">(See Transcript File)</a>';case "t":return c;case "P":if(0<c.length){var r="";c.forEach(function(a){(a=PData.getRecByID(a))&&(r+='<a href="'+prspdata.site_url+"?p="+a.wp+'" target="_blank">'+a.l+"</a> ")});return r}}return null},getRecAtt:function(a,c,d){for(var f=0;f<q.length;f++){var g=q[f];if(0<g.n&&g.i<=a&&a<g.i+g.n){a=g.d[a-g.i].a[c];if(null==a||"undefined"==typeof a)break;return d?a:PData.procAttTxt(c,a)}}return null},getAbsIByID:function(a){for(var c=0;c<q.length;c++){var d=
q[c];if(0<d.n)for(var f=0,g=d.n-1,n,h;f<=g;)if(n=f+g>>1,h=d.d[n],h=PData.strcmp(a,h.id),0>h)f=n+1;else if(0<h)g=n-1;else return d.i+n}return null},getRecByID:function(a){for(var c=0;c<q.length;c++){var d=q[c];if(0<d.n)for(var f=0,g=d.n-1,n,h,l;f<=g;)if(n=f+g>>1,l=d.d[n],h=PData.strcmp(a,l.id),0>h)f=n+1;else if(0<h)g=n-1;else return l}return null},getAttID:function(a){for(var c=0,d=prspdata.a.length-1,f,g;c<=d;)if(f=c+d>>1,g=PData.strcmp(a,prspdata.a[f].id),0>g)c=f+1;else if(0<g)d=f-1;else return prspdata.a[f];
return null},getAttIndex:function(a){return prspdata.a[a]},getNumETmplts:function(){return prspdata.e.g.ts.length},getETmpltIndex:function(a){return prspdata.e.g.ts[a]},getTmpltID:function(a){for(var c=0;c<prspdata.t.length;c++)if(a==prspdata.t[c].id)return prspdata.t[c].def},getAttLgndRecs:function(a,c,d,f){var g,n=d.length,h;switch(c.def.t){case "V":var l=function(a){for(var e=0;e<n;e++)if(g=d[e],"number"===typeof g){if(h=c.l[g],h.l==a)return h}else{h=c.l[g[0]];var f=h.z[g[1]];if(f.l==a)return f.v&&
""!=f.v?f:h}return null};if(f&&""!=c.def.d){var m=[],p;a.forEach(function(a){p=l(a);null!=p&&m.push(p)});return 0<m.length?m:null}if(""!=c.def.d){for(f=0;f<a.length;f++)if(p=l(a[f]),null!=p)return p;break}else return l(a[0]);case "T":for(p=0;p<n;p++)if(g=d[p],h=c.l[g],-1!=a.indexOf(h.d))return h;break;case "N":for(p=0;p<n;p++)if(g=d[p],h=c.l[g],"undefined"!=typeof h.d.min){if(h.d.min<=a)if("undefined"!=typeof h.d.max){if(a<=h.d.max)return h}else return h}else if(a<=h.d.max)return h;break;case "D":for(p=
0;p<n;p++)if(g=d[p],h=c.l[g],"undefined"!=typeof h.d.max.y){if("undefined"!=typeof a.max&&"open"!=a.max){if(a.max.y<h.d.min.y)continue;if(a.max.y==h.d.min.y&&a.max.m&&h.d.min.m){if(a.max.m<h.d.min.m)continue;if(a.max.m==h.d.min.m&&a.max.d&&h.d.min.d&&a.max.d<h.d.min.d)continue}}if(!(a.min.y>h.d.max.y)){if(a.min.y==h.d.max.y&&a.min.m&&h.d.max.m){if(a.min.m>h.d.max.m)continue;if(a.min.m==h.d.max.m&&a.min.d&&h.d.max.d&&a.min.d>h.d.max.d)continue}return h}}else if("undefined"!=typeof a.max){if("open"==
a.max)return h;if(!(a.max.y<h.d.min.y)){if(a.max.y==h.d.min.y&&a.max.m&&h.d.min.m){if(a.max.m<h.d.min.m)continue;if(a.max.m==h.d.min.m&&a.max.d&&h.d.min.d&&a.max.d<h.d.min.d)continue}return h}}else if(!(a.min.y<h.d.min.y)){if(a.min.y==h.d.min.y&&a.min.m&&h.d.min.m){if(a.min.m<h.d.min.m)continue;if(a.min.m==h.d.min.m&&a.min.d&&h.d.min.d&&a.min.d<h.d.min.d)continue}return h}}return null},getAttLgndVal:function(a,c,d){var f;return(f=PData.getAttLgndRecs(a,c,d,!1))?f.v:null},getVLgndVal:function(a,c){for(var d=
0,f=a.x.length-1,g,n;d<=f;)if(g=d+f>>1,n=PData.strcmp(c,a.x[g].l),0>n)d=g+1;else if(0<n)f=g-1;else return d=a.x[g].i,"number"==typeof d?a.l[d]:a.l[d[0]].z[d[1]];return null},date3Nums:function(a,c,d){0>a||99<a?c=new Date(a,c-1,d):0==a?c=new Date(-1,c-1,d):(c=new Date(a,c-1,d),c.setUTCFullYear(("0000"+a).slice(-4)));return c},objDate:function(a,c){var d;"undefined"!=typeof a.m&&null!=a.m?(c=a.m,d="undefined"!=typeof a.d&&null!=a.d?a.d:mnthDays[c-1]):d=mnthDays[c-1];return PData.date3Nums(a.y,c,d)},
parseDate:function(a,c,d){if("open"==a)return TODAY;var f=1;"-"==a.charAt(0)&&(f=-1,a=a.substring(1));a=a.split("-");f*=parseInt(a[0]);1<a.length&&(c=parseInt(a[1]),3==a.length&&(d=parseInt(a[2])));return PData.date3Nums(f,c,d)},makeDates:function(a){var c,d,f,g,n=!1;d=a.min.y;"undefined"==typeof a.min.m?g=f=1:(f=a.min.m,"undefined"==typeof a.min.d?g=1:(g=a.min.d,n=!0));c=PData.date3Nums(d,f,g);if("undefined"!=typeof a.max)"open"==a.max?a=TODAY:(d=a.max.y,"undefined"==typeof a.max.m?(f=12,g=31):(f=
a.max.m,g="undefined"==typeof a.max.d?mnthDays[f-1]:a.max.d),a=PData.date3Nums(d,f,g));else{if(n)return[c,null];"undefined"==typeof a.min.m?(f=12,g=31):g=mnthDays[f-1];a=PData.date3Nums(d,f,g)}return[c,a]},getLCats:function(a,c){var d=[];switch(a.def.t){case "T":return a.l.forEach(function(f){(null==c||PData.getAttLgndRecs(f.d,a,c,!1))&&d.push({l:f.l,x:f.d,c:f.v,i:[]})}),d;case "V":return a.l.forEach(function(f){(null==c||PData.getAttLgndRecs([f.l],a,c,!1))&&d.push({l:f.l,c:f.v,i:[]});f.z.forEach(function(f){(null==
c||PData.getAttLgndRecs([f.l],a,c,!1))&&d.push({l:f.l,c:f.v,i:[]})})}),d;case "N":return a.l.forEach(function(f){(null==c||PData.getAttLgndRecs(f.d.min,a,c,!1))&&d.push({l:f.l,c:f.v,min:f.d.min,max:f.d.max,i:[]})}),d;case "D":var f,g;a.l.forEach(function(n){f=PData.objDate(n.min,1);if(null==c||PData.getAttLgndRecs(f,a,c,!1))g=null==n.max.y?TODAY:PData.objDate(n.max,12),d.push({l:n.l,c:n.v,min:f,max:g})});return d}},getRCats:function(a,c){var d=[];switch(a.def.t){case "T":return a.l.forEach(function(a){c?
d.push({l:a.l,x:a.d,c:a.v,i:[]}):d.push({l:a.l,x:a.d,c:a.v})}),d;case "V":return a.l.forEach(function(a){c?d.push({l:a.l,c:a.v,i:[]}):d.push({l:a.l,c:a.v});a.z.forEach(function(a){c?d.push({l:a.l,c:a.v,i:[]}):d.push({l:a.l,c:a.v})})}),d;case "N":if("undefined"==typeof a.r.min||"undefined"==typeof a.r.max)return null;var f=Math.pow(10,a.r.g),g=a.r.min,n=0,h,l,p;for(0<a.l.length&&(h=a.l[0]);g<=a.r.max;){for(;n<a.l.length&&"undefined"!=typeof h.d.max&&g>h.d.max;)h=a.l[++n];p=0==a.l.length||g<h.d.min?
"#000000":n==a.l.length?"#000000":"undefined"==typeof h.d.max||g<=h.d.max?h.v:"#000000";l=g;max=g+=f;c?d.push({l:l.toString(),c:p,min:l,max:g,i:[]}):d.push({l:l.toString(),c:p,min:l,max:g})}return d;case "D":g=function(a){var c,e;if("undefined"==typeof a.y)return TODAY;c=a.y;"undefined"==typeof a.m?(e=12,a=31):(e=a.m,a="undefined"==typeof a.d?mnthDays[e-1]:a.d);return PData.date3Nums(c,e,a)};l=function(a,c,e,d){"undefined"!=typeof d.m&&(c=d.m,"undefined"!=typeof d.d&&(e=d.d));return PData.date3Nums(a,
c,e)};p=g(a.r.max);var f=a.r.g,m=a.r.min.y,q=1,w=1;"undefined"!=typeof a.r.min.m&&(q=a.r.min.m,"undefined"!=typeof a.r.min.d&&(w=a.r.min.d));var u=PData.date3Nums(m,q,w),n=0,v,A;0<a.l.length&&(h=a.l[0],v=l(h.d.min.y,1,1,h.d.min),A=g(h.d.max));for(;u<=p;){var B={};c&&(B.i=[]);switch(f){case "d":B.l=m.toString()+"-"+q.toString()+"-"+w.toString();break;case "m":B.l=m.toString()+"-"+q.toString();break;case "y":case "t":case "c":B.l=m.toString()}for(;n<a.l.length&&u>A;)h=a.l[++n],n<a.l.length&&(v=l(h.d.min.y,
1,1,h.d.min),A=g(h.d.max));B.c=0==a.l.length||u<v?"#000000":n==a.l.length?"#000000":u<=A?h.v:"#000000";B.min=u;switch(f){case "d":B.max=PData.date3Nums(m,q,w+1);w++;break;case "m":B.max=PData.date3Nums(m,q+1,w);q++;break;case "y":B.max=PData.date3Nums(m+1,q,w);m++;break;case "t":B.max=PData.date3Nums(m+10,q,w);m+=10;break;case "c":B.max=PData.date3Nums(m+100,q,w),m+=100}d.push(B);u=PData.date3Nums(m,q,w)}return d}},fillCats:function(a,c,d,f,g){var n=PData.getNumETmplts(),h=0,l,m=0,p,q,w,u,v=PData.getAttID(c);
for(l=f.t[0];m<f.l;){for(;0==l.n||l.i+l.n==m||!PData.attInTmplt(c,h)||d&&!PData.attInTmplt(d,h);){if(++h==n)return;l=f.t[h];m=l.i}p=f.s[m];q=PData.getRecByIndex(p);q=q.a[c];if("undefined"!=typeof q)switch(v.def.t){case "T":if(g){for(w=0;w<a.length;w++)if(u=a[w],q==u.l){u.i.push(p);break}w==a.length&&a.push({l:q,i:[p]})}else for(w=0;w<a.length;w++)if(u=a[w],-1!=q.indexOf(u.x)){u.i.push(p);break}break;case "V":q.forEach(function(c){for(w=0;w<a.length;w++)if(u=a[w],c==u.l){u.i.push(p);break}});break;
case "N":for(w=0;w<a.length;w++){u=a[w];if(q<u.min)break;if(u.min<=q&&q<=u.max){u.i.push(p);break}}break;case "D":for(q=PData.objDate(q.min,1),w=0;w<a.length;w++){u=a[w];if(q<u.min)break;if(u.min<=q&&q<=u.max){u.i.push(p);break}}}m++}g&&a.sort(function(a,c){return PData.strcmp(c.l,a.l)})},sortCats:function(a,c,d){var f=c.id,g,n,h;a.forEach(function(a){g=PData.getRecByIndex(a);datum=g.a[f];if("undefined"!=typeof datum)switch(c.def.t){case "T":for(n=0;n<d.length;n++)if(h=d[n],-1!=datum.indexOf(h.x)){h.i.push(a);
break}break;case "V":datum.forEach(function(c){for(n=0;n<d.length;n++)if(h=d[n],c==h.l){h.i.push(a);break}});break;case "N":for(n=0;n<d.length;n++){h=d[n];if(datum<h.min)break;if(h.min<=datum&&datum<=h.max){h.i.push(a);break}}break;case "D":var e=PData.objDate(datum.min,1);for(n=0;n<d.length;n++){h=d[n];if(e<h.min)break;if(h.min<=e&&e<=h.max){h.i.push(a);break}}}})},orderTBy:function(a,c,d){function f(a){return a}function g(a){return a[0]}function n(a){var c=1,d=1;"undefined"!=typeof a.min.m&&(c=
a.m,"undefined"!=typeof a.min.d&&(d=a.d));return PData.date3Nums(a.min.y,c,d)}var h,l;switch(a.def.t){case "T":h=f;l="~";break;case "V":h=g;l="~";break;case "N":h=f;l=a.r.max;break;case "D":h=n,l=TODAY}var m=[],p=c.t[d];d=q[d];for(var v=0,w,u;v<p.n;)w=c.s[p.i+v++],u=d.d[w-d.i],u=u.a[a.id],"undefined"==typeof u?m.push({i:w,v:l}):m.push({i:w,v:h(u)});switch(a.def.t){case "T":case "V":m.sort(function(a,c){return PData.strcmp(a.v,c.v)});break;case "D":case "N":m.sort(function(a,c){return a.v-c.v})}return m},
getVizIndex:function(a){return prspdata.e.vf[a]},ready:function(){return A}}}();
jQuery(document).ready(function(a){function c(){PState.set(PSTATE_PROCESS);g.clearSel();n&&n.clearSel();null==C&&(C=PData.newIndexStream(!0));y=C;var a=!1,c,d;for(c=0;c<h.length;c++)if(d=h[c],a||d.f.isDirty(null)){a=!0;d.f.evalPrep();for(var e=PData.newIndexStream(!1),f=0,k,l,m=0,p=y.t[0],q=0;f<y.l;){for(;0==p.n||p.i+p.n==f;)e.t.push({i:e.l-q,n:q}),q=0,p=y.t[++m];k=y.s[f++];l=PData.getRecByIndex(k);d.f.eval(l)&&(e.s[e.l++]=k,q++)}for(;m++<PData.getNumETmplts();)e.t.push({i:e.l-q,n:q}),q=0;d.f.isDirty(!1);
y=d.f.out=e}else y=d.f.out;PState.set(PSTATE_BUILD);g.showStream(y);n&&n.showStream(y);jQuery("#btn-recompute").removeClass("pulse")}function d(a){var c=jQuery("#annote");c.text(a);0<a.length?(jQuery("#btn-annote").button("enable"),c.show()):(jQuery("#btn-annote").button("disable"),c.hide())}function f(a){var c=_.find(prspdata.p,function(c){return a==c.id});return c?c:null==w||0==u.length?null:(c=_.find(u,function(c){return a==c.id}))?c:null}function l(a){var c=jQuery("input[name=save-prspctv-dest]:checked").val();
if(""==c)return null;var d=jQuery("#save-psrctv-note").val(),d=d.replace(/"/,""),e=jQuery("#save-psrctv-lbl").val().trim(),e=e.replace(/"/,""),f=!jQuery("#selector-v0").prop("disabled")&&jQuery("#selector-v0").is(":checked"),k=!jQuery("#selector-v1").prop("disabled")&&jQuery("#selector-v1").is(":checked"),l={f:[],s:null,a0:f,a1:k,v0:{l:g.title(),s:g.getState()},v1:null};h.forEach(function(a){l.f.push({id:a.attID,r:a.f.isReq(!1),s:a.f.getState()})});x&&(l.s={id:z,s:x.getState()});n&&(l.v1={l:n.title(),
s:n.getState()});var m={id:a,l:e,n:d,s:l};"local"==c?(u.push(m),w.setItem(prspdata.e.id,JSON.stringify(u))):"server"==c&&jQuery.ajax({type:"POST",url:prspdata.ajax_url,data:{action:"prsp_save_prspctv",id:a,l:e,x:prspdata.e.id,n:d,s:JSON.stringify(l)},success:function(a,c,d){"0"!=a&&prspdata.p.push(m)},error:function(a,c,d){alert(d)}});return c}function m(){var a,c=[],d=!1;(function(){var a=jQuery("#prspctv-mlist");a.empty();u.forEach(function(c){a.append('<li data-type="l" data-id="'+c.id+'"><span class="label">'+
c.l+'</span> <button class="del">'+dlText.del+'</button> <button class="edit">'+dlText.edit+"</button></li>")});for(var d=0;d<w.length;d++){var e=w.key(d);if(e!=prspdata.e.id){var f=w.getItem(e);c.push({id:e,ps:JSON.parse(f)})}}c.forEach(function(c,d){c.ps.forEach(function(e){a.append('<li data-type="x" data-xid="'+c.id+'" data-xindex="'+d+'" data-id="'+e.id+'"><i class="label">'+e.l+'</i> <button class="del">'+dlText.del+'</button> <button class="edit">'+dlText.edit+"</button></li>")})})})();jQuery("#prspctv-mlist").click(function(a){if("BUTTON"==
a.target.nodeName){var e=jQuery(a.target).hasClass("del"),f=jQuery(a.target).parent(),g=f.data("type"),h=f.data("id");if(e){switch(g){case "l":a=u.findIndex(function(a){return h==a.id});-1!=a&&(u.splice(a,1),0==u.length?w.removeItem(prspdata.e.id):w.setItem(prspdata.e.id,JSON.stringify(u)));break;case "x":a=f.data("xindex"),e=c[a],a=e.ps.findIndex(function(a){return h==a.id}),-1!=a&&(e.ps.splice(a,1),d=!0)}f.remove()}else{var k;switch(g){case "l":k=_.find(u,function(a){return h==a.id});break;case "x":a=
f.data("xindex"),e=c[a],k=_.find(e.ps,function(a){return h==a.id})}jQuery("#edit-psrctv-lbl").val(k.l);jQuery("#edit-psrctv-note").val(k.n);var l=jQuery("#dialog-edit-prsrctv").dialog({width:340,height:270,modal:!0,buttons:[{text:dlText.ok,click:function(){k.l=jQuery("#edit-psrctv-lbl").val();k.n=jQuery("#edit-psrctv-note").val();f.find(".label").text(k.l);"x"==g?d=!0:w.setItem(prspdata.e.id,JSON.stringify(u));l.dialog("close")}},{text:dlText.cancel,click:function(){l.dialog("close")}}]})}}});a=jQuery("#dialog-manage-prsrctv").dialog({width:450,
height:350,modal:!0,buttons:[{text:dlText.ok,click:function(){d&&c.forEach(function(a){0<a.ps.length?w.setItem(a.id,JSON.stringify(a.ps)):w.removeItem(a.id)});jQuery("#prspctv-mlist").off("click");a.dialog("close")}}]})}function p(a){window.location.href=prspdata.e.g.hurl;a.preventDefault()}function q(a){jQuery(this).parent().next().slideToggle(400);a.preventDefault()}function v(a){if(a=jQuery(this).closest("div.filter-instance")){var c=a.data("id");a=a.find("input.req-att").is(":checked");if(c&&
""!=c){var d;d=h.find(function(a){return a.id==c});null==d?alert("Bad Filter ID "+c):d.f.isReq(!0,a)}}}function A(a){var c=jQuery(this).closest("div.filter-instance"),d=c.data("id"),e,f;e=h.findIndex(function(a){return a.id==d});-1==e?alert("Bad Filter ID "+d):(f=h[e].f,f.teardown(),h.splice(e,1),e>=h.length?(e=0==h.length?C:h[e-1].out,g.setStream(e),n&&n.setStream(e),jQuery("#btn-recompute").addClass("pulse")):h[e].f.isDirty(!0),c.remove(),a.preventDefault())}function e(){null!=x&&(x.teardown(),
jQuery('div.filter-instance[data-id="0"]').empty(),x=null)}function k(a,c,d){var f;if(d)e(),f=0;else{do f=Math.floor(1E3*Math.random()+1),-1!=h.findIndex(function(a){return a.id==f})&&(f=-1);while(-1==f)}var g,k=PData.getAttID(a);switch(k.def.t){case "V":g=new PFilterVocab(f,k,c);break;case "T":g=new PFilterText(f,k,c);break;case "N":g=new PFilterNum(f,k,c);break;case "D":g=new PFilterDates(f,k,c)}d?(x=g,z=a,a=_.template(document.getElementById("dltext-selector-head").innerHTML),c=jQuery('div.filter-instance[data-id="0"]'),
c.append(a({title:g.title()})),c.find("button.btn-filter-del").button({text:!1,icons:{primary:"ui-icon-trash"}}).click(e)):(h.push({id:f,attID:a,f:g,out:null}),a=_.template(document.getElementById("dltext-filter-head").innerHTML),jQuery("#filter-instances").append(a({newID:f,title:g.title(),check:c?'checked="checked"':""})),c=jQuery('div.filter-instance[data-id="'+f+'"]'),c.find("button.btn-filter-toggle").button({text:!1,icons:{primary:"ui-icon-carat-2-n-s"}}).click(q),c.find("button.btn-filter-del").button({text:!1,
icons:{primary:"ui-icon-trash"}}).click(A),c.find("input.req-att").click(v),jQuery("#btn-recompute").addClass("pulse"));g.setup();return g}function t(){PState.set(PSTATE_PROCESS);var a=[],c=!1;if(null!=x&&null!=y){x.evalPrep();for(var d=0,e,f;d<y.l;)e=y.s[d++],f=PData.getRecByIndex(e),x.eval(f)&&a.push(e);x.isDirty(!1)}PState.set(PSTATE_BUILD);jQuery("#selector-v0").is(":checked")&&(c=g.setSel(a));jQuery("#selector-v1").is(":checked")&&n&&(c&&(a=a.slice(0)),n.setSel(a))}function r(a){function l(a){return prspdata.e.vf.findIndex(function(c){return a==
c.l})}a=f(a);if(null==a)return!1;PState.set(PSTATE_PROCESS);h.forEach(function(a){a.f.teardown()});h=[];jQuery("#filter-instances").empty();a.s.f.forEach(function(a){k(a.id,a.r,!1).setState(a.s)});jQuery("#filter-instances").hide();e();null!=a.s.s&&(k(a.s.s.id,!0,!0),x.setState(a.s.s.s));jQuery("#selector-instance").hide();var m;m=l(a.s.v0.l);g?g.setViz(m,!1):(g=PViewFrame(0),g.initDOM(m));g.setState(a.s.v0.s);null!=a.s.v1?(m=l(a.s.v1.l),n?(n.setViz(m,!1),n.setState(a.s.v1.s)):(n=PViewFrame(1),n.initDOM(m),
n.setState(a.s.v1.s),g.resize())):n&&(n=null,jQuery("#view-frame-1").remove(),jQuery("#selector-v1").prop("disabled",!0),g.resize());d(a.n);jQuery("#selector-v0").prop("checked",a.s.a0);jQuery("#selector-v1").prop("checked",a.s.a1);PData.ready()&&C&&(c(),x&&t());return!0}var g,n,h=[],x=null,z,C,y,w=null,u=[];jQuery("body").addClass("waiting");PState.init();PMapHub.init(prspdata.m);(function(){function a(d,e){c=document.getElementById(d).innerHTML;dlText[e]=c.trim()}var c;a("dltext-showhideall","sha");
a("dltext-ok","ok");a("dltext-cancel","cancel");a("dltext-seerec","seerec");a("dltext-close","close");a("dltext-add","add");a("dltext-manage","manage");a("dltext-delete","del");a("dltext-edit","edit");c=document.getElementById("dltext-month-names").innerHTML;months=c.trim().split("|");(c=document.getElementById("dltext-d3-local"))&&(c=c.innerHTML)&&1<c.length&&(localD3=d3.locale(JSON.parse(c)).timeFormat.multi([["%H:%M",function(a){return a.getMinutes()}],["%H:%M",function(a){return a.getHours()}],
["%a %d",function(a){return a.getDay()&&1!=a.getDate()}],["%b %d",function(a){return 1!=a.getDate()}],["%B",function(a){return a.getMonth()}],["%Y",function(){return!0}]]))})();xhbtURL=window.location.pathname;xhbtURL=xhbtURL.replace(/\&*prspctv=[\w\-]+/,"");xhbtURL=xhbtURL.replace(/\/$/,"");xhbtURL=xhbtURL.replace(/^\//,"");xhbtURL=window.location.protocol+"//"+window.location.host+"/"+xhbtURL;"/"!=prspdata.site_url.charAt(prspdata.site_url.length-1)&&(prspdata.site_url+="/");""!=prspdata.e.g.l&&
jQuery("#title").text(prspdata.e.g.l);try{var F=window.localStorage;F.setItem("__storage_test__","__storage_test__");F.removeItem("__storage_test__");var E=F.getItem(prspdata.e.id),w=F;0<E.length&&(u=JSON.parse(E))}catch(B){}jQuery("#btn-about").button({icons:{primary:"ui-icon-info"},text:!1}).click(function(a){var c;c=jQuery("#dialog-about").dialog({height:250,width:350,modal:!0,buttons:[{text:dlText.ok,click:function(){c.dialog("close")}}]});a.preventDefault()});jQuery("#btn-recompute").button({icons:{primary:"ui-icon-refresh"},
text:!1}).click(function(a){c();PState.set(PSTATE_READY);a.preventDefault()});jQuery("#btn-set-layout").button({icons:{primary:"ui-icon-newwin"},text:!1}).click(function(){PState.set(PSTATE_BUILD);null!=n?(n=null,jQuery("#view-frame-1").remove(),jQuery("#selector-v1").prop("disabled",!0)):(n=PViewFrame(1),n.initDOM(0),n.showStream(y),jQuery("#selector-v1").prop("disabled",!1));g.resize();PState.set(PSTATE_READY)});jQuery("#btn-show-prspctv").button({icons:{primary:"ui-icon-image"},text:!1}).click(function(a){var c=
jQuery("#prspctv-slist");c.empty();prspdata.p.forEach(function(a){c.append('<li data-src="server" data-id="'+a.id+'">'+a.l+"</li>")});u.forEach(function(a){c.append('<li data-src="local" data-id="'+a.id+'">'+a.l+"</li>")});var d=[{text:dlText.ok,click:function(){e.dialog("close");var a=c.find("li.selected");a.length&&(a=a.data("id"),r(a),PState.set(PSTATE_READY))}},{text:dlText.cancel,click:function(){e.dialog("close")}}];w&&d.push({text:dlText.manage,click:function(){e.dialog("close");m()}});var e=
jQuery("#dialog-show-prsrctv").dialog({width:350,height:350,modal:!0,buttons:d});a.preventDefault()});jQuery("#btn-save-prspctv").button({icons:{primary:"ui-icon-pencil"},text:!1}).click(function(a){var c,d=/[^\w\-]/;jQuery("#save-psrctv-id").val("");jQuery("#save-psrctv-lbl").val("");jQuery("#save-psrctv-note").val("");w||jQuery("#save-prspctv-d-1").attr("disabled","disabled");prspdata.add_prspctv||jQuery("#save-prspctv-d-2").attr("disabled","disabled");c=jQuery("#dialog-save-prsrctv").dialog({width:340,
height:350,modal:!0,buttons:[{text:dlText.ok,click:function(){var a=jQuery("#save-psrctv-id").val().trim(),e=a.match(d);0==a.length||20<a.length||e?e="#dialog-prspctv-id-badchars":f(a)&&(e="#dialog-prspctv-id-used");if(e)var g=jQuery(e).dialog({width:320,height:210,modal:!0,buttons:[{text:dlText.ok,click:function(){g.dialog("close")}}]});else if(e=l(a),c.dialog("close"),"server"==e){a=xhbtURL+"/?prspctv="+a;jQuery("#save-psrctv-embed").val(a);var h=jQuery("#dialog-prspctv-url").dialog({width:480,
height:230,modal:!0,buttons:[{text:dlText.ok,click:function(){h.dialog("close")}}]})}}},{text:dlText.cancel,click:function(){c.dialog("close")}}]});a.preventDefault()});jQuery("#btn-annote").button({icons:{primary:"ui-icon-comment"},text:!1}).click(function(a){jQuery("#annote").toggle("slide",{direction:"right"});a.preventDefault()});0<prspdata.e.g.hbtn.length&&0<prspdata.e.g.hurl.length?(jQuery("#home-title").text(prspdata.e.g.hbtn),jQuery("#btn-home").button({icons:{primary:"ui-icon-home"},text:!1}).click(p)):
jQuery("#btn-home").remove();jQuery("#filter-list").click(function(a){"LI"==a.target.nodeName&&(jQuery("#filter-list li").removeClass("selected"),jQuery(a.target).addClass("selected"))});jQuery("#prspctv-slist").click(function(a){"LI"==a.target.nodeName&&(jQuery("#prspctv-list li").removeClass("selected"),jQuery(a.target).addClass("selected"))});jQuery("#btn-new-filter").button({icons:{primary:"ui-icon-search"},text:!1}).click(function(a){jQuery("#filter-list li").removeClass("selected");var c;c=
jQuery("#dialog-new-filter").dialog({height:300,width:350,modal:!0,buttons:[{text:dlText.add,click:function(){var a=jQuery("#filter-list li.selected");a.length&&(jQuery("#filter-instances").show(400),k(a.data("id"),!0,!1));c.dialog("close")}},{text:dlText.cancel,click:function(){c.dialog("close")}}]});a.preventDefault()});jQuery("#btn-toggle-filters").button({icons:{primary:"ui-icon-arrow-2-n-s"},text:!1}).click(function(a){jQuery("#filter-instances").slideToggle(400);a.preventDefault()});jQuery("#btn-new-selector").button({icons:{primary:"ui-icon-search"},
text:!1}).click(function(a){jQuery("#filter-list li").removeClass("selected");var c;c=jQuery("#dialog-new-filter").dialog({height:300,width:350,modal:!0,buttons:[{text:dlText.add,click:function(){var a=jQuery("#filter-list li.selected");a.length&&(jQuery("#selector-instance").show(400),k(a.data("id"),!0,!0));c.dialog("close")}},{text:dlText.cancel,click:function(){c.dialog("close")}}]});a.preventDefault()});jQuery("#btn-toggle-selector").button({icons:{primary:"ui-icon-arrow-2-n-s"},text:!1}).click(function(a){jQuery("#selector-instance").slideToggle(400);
a.preventDefault()});jQuery("#btn-apply-selector").button({icons:{primary:"ui-icon-arrowreturn-1-e"},text:!1}).click(function(a){t();PState.set(PSTATE_READY);a.preventDefault()});jQuery("#btn-inspect-left").button({icons:{primary:"ui-icon-arrowthick-1-w"},text:!1});jQuery("#btn-inspect-right").button({icons:{primary:"ui-icon-arrowthick-1-e"},text:!1});(function(){prspdata.a.forEach(function(a){switch(a.def.t){case "V":case "T":case "N":case "D":jQuery("#filter-list").append('<li data-id="'+a.id+'">'+
a.def.l+"</li>")}})})();0!=prspdata.show_prspctv.length&&r(prspdata.show_prspctv)||(g=PViewFrame(0),g.initDOM(0),d(""));jQuery(window).resize(function(){g&&g.resize();n&&n.resize()});jQuery("body").on("prospect",function(a,d){d.pstate==PSTATE_PROCESS&&(PState.set(PSTATE_PROCESS),c(),x&&t(),PState.set(PSTATE_READY),jQuery("body").removeClass("waiting"))});PState.set(PSTATE_LOAD);PData.init()});function onYouTubeIframeAPIReady(){widgetData.ytCall&&widgetData.ytCall()};