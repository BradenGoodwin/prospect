Array.prototype.findIndex||(Array.prototype.findIndex=function(a,c){if(null==this)throw new TypeError("Array.prototype.find called on null or undefined");if("function"!==typeof a)throw new TypeError("predicate must be a function");for(var e=Object(this),f=e.length>>>0,l,m=0;m<f;m++)if(l=e[m],a.call(c,l,m,e))return m;return-1});
var EVENT_INSTANT=1,EVENT_F_START=2,EVENT_F_END=4,PSTATE_INIT=0,PSTATE_LOAD=1,PSTATE_PROCESS=2,PSTATE_BUILD=3,PSTATE_READY=4,D3FG_BAR_WIDTH=25,D3FG_MARGINS={top:4,right:7,bottom:22,left:30},V_FLAG_LGND=1,V_FLAG_SEL=2,V_FLAG_LOC=4,V_FLAG_SET=8,V_FLAG_VSCRL=16,V_FLAG_HSCRL=32,TODAY=new Date,localD3,months,dlText={},xhbtURL,parseTC=/(\d\d)\:(\d\d)\:(\d\d)\.(\d\d?)/,widgetData={ytLoaded:!1,ytCall:null,ytCode:null,timer:null,extract:null,sTime:null,eTime:null,playing:!1,widget:null,xscriptOn:!1,tcArray:null,
tcIndex:-1},PState=function(){var a=PSTATE_INIT,c;return{init:function(){c=document.getElementById("dltext-pstates").innerHTML.trim().split("|")},set:function(e){if(e!=a){var f=jQuery("#pstate");a==PSTATE_READY?f.addClass("attn"):e==PSTATE_READY&&f.removeClass("attn");f.text(c[e-1]);a=e}}}}();function PVizModel(a,c){this.vFrame=a;this.frameID=a.getFrameID()+" div.viz-content div.viz-result";this.settings=c;this.recSel=[]}PVizModel.prototype.flags=function(){return 0};
PVizModel.prototype.isSel=function(a){return-1!=_.indexOf(this.recSel,a,!0)};PVizModel.prototype.getSel=function(){return this.recSel};PVizModel.prototype.toggleSel=function(a){var c=this.recSel.length,e=_.sortedIndex(this.recSel,a);if(this.recSel[e]==a)return this.recSel.splice(e,1),0<c&&0==this.recSel.length&&this.vFrame.selBtns(!1),!1;this.recSel.splice(e,0,a);0==c&&0<this.recSel.length&&this.vFrame.selBtns(!0);return!0};PVizModel.prototype.clearSel=function(){this.recSel=[]};
PVizModel.prototype.getLocAtts=function(a){return[]};PVizModel.prototype.getFeatureAtts=function(a){return[]};PVizModel.prototype.teardown=function(){};PVizModel.prototype.resize=function(){};PVizModel.prototype.optionsModal=function(){};PVizModel.prototype.getState=function(){return{}};PVizModel.prototype.setState=function(a){};var VizMap=function(a,c){PVizModel.call(this,a,c)};VizMap.prototype=Object.create(PVizModel.prototype);VizMap.prototype.constructor=VizMap;
VizMap.prototype.flags=function(){return V_FLAG_LGND|V_FLAG_SEL|V_FLAG_LOC};VizMap.prototype.getLocAtts=function(a){return null!=a?this.settings.cAtts[a]:this.settings.cAtts};VizMap.prototype.getFeatureAtts=function(a){return null!=a?this.settings.lgnds[a]:this.settings.lgnds};
VizMap.prototype.setup=function(){var a=this,c=parseFloat(this.settings.clat),e=parseFloat(this.settings.clon),f;f="string"==typeof this.settings.zoom?parseInt(this.settings.zoom):this.settings.zoom;var l=this.vFrame.getIndex();jQuery(this.frameID).append('<div id="l-map-'+l+'" class="max-size"></div>');this.lMap=L.map("l-map-"+l,{zoomControl:!1}).setView([c,e],f);var m=L.control.layers();m.addTo(this.lMap);this.baseMap=PMapHub.createMapLayer(this.settings.base,1,this.lMap,m);var p;this.mapLayers=
[];_.each(this.settings.lyrs,function(c){p=c.o||1;c=PMapHub.createMapLayer(c.lid,p,a.lMap,m);a.mapLayers.push(c)});L.control.zoom({position:"topright"}).addTo(this.lMap);this.markerLayer=c=L.featureGroup();c.options=c.options||{};c.options.layerName="Markers";c.addTo(this.lMap);this.lineLayer=c=L.featureGroup();c.addTo(this.lMap);c=PData.getNumETmplts();this.tLCnt=new Uint16Array(c)};
VizMap.prototype.render=function(a){function c(d){if(d.target&&d.target.options){var a=d.target.options._aid,c=e.toggleSel(a);d=PData.aIndex2Tmplt(a);1<e.tLCnt[d]?f.eachLayer(function(d){d.options._aid==a&&(c?d.setStyle({color:"#ff0000"}):d.setStyle({color:"#000"}))}):c?this.setStyle({color:"#ff0000"}):this.setStyle({color:"#000"})}}var e=this,f=this.markerLayer;f.clearLayers();var l=this.lineLayer;l.clearLayers();var m=PData.getNumETmplts(),p=0,q,t=0,w,d,h,r,u,g,n,k,x,z,A,y,B,v,F,D,C,I;F=this.settings.min;
"string"==typeof F&&(F=parseInt(F));t=this.settings.max;"string"==typeof t&&(t=parseInt(t));D=t-F;for(p=0;p<m;p++)this.tLCnt[p]=0;for(var G,p=0;p<m;p++)if("disable"!=this.settings.pAtts[p]){G=[];break}p=0;t=-1;a:for(;p<a.l;){if(null==g){do{if(++t==m)break a;w=a.t[t]}while(0==w.n||w.i+w.n==p);g=this.vFrame.getSelLocAtts(t);if(0==g.length){g=null;continue}n=e.vFrame.getSelFeatAtts(t);if(0==n.length){g=null;continue}e.tLCnt[t]=g.length;r=e.vFrame.getSelLegend(t);u=PData.getAttID(r);k=e.settings.pAtts[t];
d=e.settings.lClrs[t];if(B=e.settings.sAtts[t])v=PData.getAttID(B),"number"==typeof v.r.min&&"number"==typeof v.r.max?(C=v.r.min,I=v.r.max-C):B=null}q=a.s[p];h=PData.getRecByIndex(q);var E;G&&(E={id:h.id,c:[],p:h.a[k],l:d});g.forEach(function(d){if(x=h.a[d])if(z=h.a[r],"undefined"!=typeof z&&(z=PData.getAttLgndVal(z,u,n)))y=e.isSel(q),"number"==typeof x[0]&&(B?(v=h.a[B],v="undefined"!=typeof v?Math.floor((v-C)*D/I)+F:F):v=F,A=L.circleMarker(x,{_aid:q,weight:1,radius:v,fillColor:z,color:y?"#ff0000":
"#000",opacity:1,fillOpacity:1}),E&&E.c.push(x)),A.on("click",c),f.addLayer(A)});E&&0<E.c.length&&G.push(E);++p==w.i+w.n&&(g=null)}if(G){G.sort(function(d,a){return d.id.localeCompare(a.id)});var H=[];G.forEach(function(d){d.p&&d.p.forEach(function(a){p=_.sortedIndex(G,{id:a},"id");var c=G[p];c.id==a&&d.c.forEach(function(a){c.c.forEach(function(c){a[0]==c[0]&&a[1]==c[1]||H.push({p:[a,c],c:d.l})})})})});H.forEach(function(d){l.addLayer(L.polyline(d.p,{color:d.c,weight:2}))})}};
VizMap.prototype.resize=function(){this.lMap.invalidateSize(!1)};VizMap.prototype.clearSel=function(){0<this.recSel.length&&(this.recSel=[],this.markerLayer&&this.markerLayer.eachLayer(function(a){a.setStyle({color:"#000"})}))};VizMap.prototype.setSel=function(a){var c=this;this.recSel=a;this.markerLayer&&this.markerLayer.eachLayer(function(a){c.isSel(a.options._aid)?a.setStyle({color:"#ff0000"}):a.setStyle({color:"#000"})})};
VizMap.prototype.getState=function(){return{c:this.lMap.getCenter(),z:this.lMap.getZoom(),l:this.vFrame.getLgndSels()}};VizMap.prototype.setState=function(a){this.lMap.setView(a.c,a.z);this.vFrame.setLgndSels(a.l)};var VizCards=function(a,c){PVizModel.call(this,a,c)};VizCards.prototype=Object.create(PVizModel.prototype);VizCards.prototype.constructor=VizCards;VizCards.prototype.flags=function(){return V_FLAG_LGND|V_FLAG_SEL|V_FLAG_VSCRL};
VizCards.prototype.getFeatureAtts=function(a){return null!=a?this.settings.lgnds[a]:this.settings.lgnds};VizCards.prototype.setup=function(){var a=this;jQuery(this.frameID).on("click.vf",function(c){if("DIV"==c.target.nodeName&&(c=jQuery(c.target).closest("div.card"),1==c.size())){var e=c.data("ai");null!=e&&(a.toggleSel(e)?c.addClass("obj-sel"):c.removeClass("obj-sel"))}})};
VizCards.prototype.render=function(a){var c=PData.getNumETmplts(),e=0,f,l=-1,m,p,q=!0,t,w,d,h,r,u,g,n,k,x,z,A,y=jQuery(this.frameID);y.empty();for(var B,v="w"+this.settings.w+" h"+this.settings.h;e<a.l;){if(q){do{if(++l==c)return;p=a.t[l]}while(0==p.n||p.i+p.n==e);m=PData.getETmpltIndex(l);f=PData.getTmpltID(m);m=this.vFrame.getSelFeatAtts(l);if(0==m.length){q=!0;continue}y.append('<div class="template-label">'+f.l+'</div><div class="cards" data-ti="'+l+'"></div>');B=jQuery('div.cards[data-ti="'+
l+'"]');t=this.vFrame.getSelLegend(l);w=PData.getAttID(t);d=this.settings.iAtts[l];n=this.settings.cnt[l];q=!1}f=a.s[e];h=PData.getRecByIndex(f);k=h.a[t];"undefined"!=typeof k&&(r=PData.getAttLgndRecs(k,w,m,!1))&&(u=this.isSel(f)?" obj-sel":"",z=this.settings.lOn?'<div class="card-title">'+h.l+"</div>":"",g=!1,x="",n&&0<n.length&&(A=r.b?' style="color:black"':"",n.forEach(function(d){if(k=h.a[d])if(k=PData.procAttTxt(d,k))g=!0,x+=k+"<br/>"})),x=(k=h.a[d])?g?'<div class="card-body"><img src="'+k+'"/><div class="card-cnt"'+
A+">"+x+"</div></div>":'<div class="card-body"><img class="full" src="'+k+'"/></div>':'<div class="card-body"><div class="card-cnt"'+A+">"+x+"</div>",B.append('<div class="card '+v+u+'" style="background-color:'+r.v+'" data-ai="'+f+'">'+z+x+"</div>"));++e==p.i+p.n&&(q=!0)}};VizCards.prototype.teardown=function(){jQuery(this.frameID).off("click.vf")};
VizCards.prototype.setSel=function(a){var c=this,e,f;this.recSel=a;jQuery(this.frameID).find("div.card").each(function(){f=jQuery(this);e=f.data("ai");null!=e&&(c.isSel(e)?f.addClass("obj-sel"):f.removeClass("obj-sel"))})};VizCards.prototype.clearSel=function(){0<this.recSel.length&&(this.recSel=[],jQuery(this.frameID).find("div.card").removeClass("obj-sel"))};VizCards.prototype.getState=function(){return{l:this.vFrame.getLgndSels()}};VizCards.prototype.setState=function(a){this.vFrame.setLgndSels(a.l)};
var VizPinboard=function(a,c){PVizModel.call(this,a,c)};VizPinboard.prototype=Object.create(PVizModel.prototype);VizPinboard.prototype.constructor=VizPinboard;VizPinboard.prototype.flags=function(){return V_FLAG_LGND|V_FLAG_SEL|V_FLAG_LOC};VizPinboard.prototype.getLocAtts=function(a){return null!=a?[this.settings.cAtts[a]]:[this.settings.cAtts]};VizPinboard.prototype.getFeatureAtts=function(a){return null!=a?this.settings.lgnds[a]:this.settings.lgnds};
VizPinboard.prototype.setup=function(){var a=this.settings;PData.getNumETmplts();this.xScale=d3.scale.linear().domain([0,a.iw-1]).rangeRound([0,a.dw-1]);this.yScale=d3.scale.linear().domain([0,a.ih-1]).range([0,a.dh-1]);this.xAxis=d3.svg.axis().scale(this.xScale).orient("top");this.yAxis=d3.svg.axis().scale(this.yScale).orient("left");var c=d3.select(this.frameID).append("svg").attr("width",a.dw+30+3).attr("height",a.dh+30+2),e=c.append("defs");e.append("marker").attr("id","arrowhead").attr("refX",
9).attr("refY",2).attr("markerWidth",6).attr("markerHeight",4).attr("orient","auto").append("path").attr("d","M 0,0 V 4 L6,2 Z");e=e.append("g").attr("id","pin");e.append("path").attr("d","M36.439,12.646c0-6.919-5.608-12.527-12.528-12.527S11.384,5.727,11.384,12.646c0,9.913,12.527,24.582,12.527,24.582 S36.439,22.508,36.439,12.646z M17.733,11.898c0-3.413,2.767-6.179,6.179-6.179s6.179,2.766,6.179,6.179 c0,3.413-2.767,6.179-6.179,6.179S17.733,15.311,17.733,11.898z");e.append("circle").attr("cx","23.911").attr("cy",
"11.898").attr("r","3.038");e.append("path").attr("d","M30.994,32.87c-1.021,1.476-1.979,2.761-2.777,3.793c7.916,0.476,13.104,2.185,15.034,3.456 c-2.261,1.491-8.979,3.587-19.338,3.587c-10.358,0-17.077-2.097-19.338-3.587c1.93-1.271,7.114-2.979,15.022-3.455 c-0.8-1.032-1.759-2.316-2.781-3.792C7.075,33.831,0,36.713,0,40.118c0,4.19,10.707,7.588,23.913,7.588 c13.207,0,23.912-3.396,23.912-7.588C47.827,36.711,40.744,33.828,30.994,32.87z");this.chart=c.append("g").attr("transform","translate(30,30)");this.chart.append("g").attr("class",
"x axis").call(this.xAxis);this.chart.append("g").attr("class","y axis").call(this.yAxis);this.chart.append("image").attr("xlink:href",a.img).attr("x",0).attr("y",0).attr("height",a.dh).attr("width",a.dw);this.chart.on("click",function(){});this.gRecs=this.chart.append("g").attr("id","recs")};
VizPinboard.prototype.render=function(a){var c=this;this.gRecs.selectAll("svg.recobj").remove();var e=PData.getNumETmplts(),f,l,m=0,p,q,t,w,d,h,r,u,g,n;for(f=0;f<e;f++)if("disable"!=this.settings.pAtts[f]){n=[];break}f=0;m=-1;a:for(;f<a.l;){if(null==d){do{if(++m==e)break a;p=a.t[m]}while(0==p.n||p.i+p.n==f);d=this.vFrame.getSelLocAtts(m);if(0==d.length){d=null;continue}d=d[0];h=c.vFrame.getSelFeatAtts(m);if(0==h.length){d=null;continue}t=c.vFrame.getSelLegend(m);w=PData.getAttID(t);r=c.settings.pAtts[m]}l=
a.s[f];q=PData.getRecByIndex(l);var k;n&&(k={id:q.id,c:null,p:q.a[r]});if(u=q.a[d])g=q.a[t],"undefined"!=typeof g&&(g=PData.getAttLgndVal(g,w,h))&&"number"==typeof u[0]&&(nodes.push({ai:l,id:q.id,v:g,x:u[0]+-12,y:u[1]+-20,w:24,h:24}),k&&(k.c=u));k&&0<k.c.length&&n.push(k);++f==p.i+p.n&&(d=null)}this.gRecs.selectAll("svg.recobj").data(nodes).enter().append("svg").attr("class",function(d){return c.isSel(d.ai)?"recobj obj-sel":"recobj"}).attr("x",function(d){return c.xScale(d.x)}).attr("y",function(d){return c.yScale(d.y)}).attr("width",
function(d){return c.xScale(d.w)}).attr("height",function(d){return c.yScale(d.h)}).attr("viewBox","0 0 48 48").attr("data-ai",function(d){return d.ai}).on("click",function(d,a){var h=c.toggleSel(d.ai);d3.select(this).classed("obj-sel",h)}).append("use").attr("xlink:href","#pin").attr("fill",function(d){return d.v})};VizPinboard.prototype.clearSel=function(){0<this.recSel.length&&(this.recSel=[],this.gRecs.selectAll("svg.recobj").classed("obj-sel",!1))};
VizPinboard.prototype.setSel=function(a){var c=this;this.recSel=a;this.gRecs.selectAll("svg.recobj").classed("obj-sel",function(a){return c.isSel(a.ai)})};
VizPinboard.prototype.optionsModal=function(){var a=jQuery("#dialog-opacities div.layer-list");a.empty();var c=jQuery('<div data-i="-1"><input type="checkbox" checked="checked"> Base Image <input type=range class="op-slider" min=0 max=100 value=90 step=5></div>');c.find(".op-slider").on("change",function(){jQuery(this).parent().data("i")});a.append(c);var e=jQuery("#dialog-map-opacities").dialog({height:300,width:320,modal:!0,buttons:[{text:dlText.ok,click:function(){e.dialog("close")}},{text:dlText.cancel,
click:function(){e.dialog("close")}}]})};VizPinboard.prototype.getState=function(){return{l:this.vFrame.getLgndSels()}};VizPinboard.prototype.setState=function(a){this.vFrame.setLgndSels(a.l)};var VizTime=function(a,c){PVizModel.call(this,a,c)};VizTime.prototype=Object.create(PVizModel.prototype);VizTime.prototype.constructor=VizTime;VizTime.prototype.flags=function(){return V_FLAG_LGND|V_FLAG_SEL|V_FLAG_LOC|V_FLAG_VSCRL};
VizTime.prototype.getFeatureAtts=function(a){return null!=a?this.settings.lgnds[a]:this.settings.lgnds};VizTime.prototype.getLocAtts=function(a){return null!=a?[this.settings.dAtts[a]]:[this.settings.dAtts]};VizTime.prototype.getWidths=function(){var a=[],c=jQuery(this.frameID).width();a.push(c);c-=4;a.push(c);this.threshold=c/(6.25*this.settings.xLbl);return a};
VizTime.prototype.setup=function(){function a(a){var c={id:a,l:0,t:0,h:0,w:m[1],svgID:"#tl-b-"+q+"-"+a,tHt:0,iHt:0,xScale:d3.time.scale(),yScale:function(d){return d*c.tHt},parts:[],g:null,labels:null,labelSVGs:null,redraw:function(){}};a?(c.tHt=f.settings.bHt,c.iHt=c.tHt-2):(c.tHt=3,c.iHt=2);if(1==a){var d=f.minDate,h=f.maxDate;0<f.settings.zFrom.length&&(d=PData.parseDate(f.settings.zFrom,1,1));0<f.settings.zTo.length&&(h=PData.parseDate(f.settings.zTo,12,31));c.xScale.domain([d,h]);f.zMinDate=
d;f.zMaxDate=h}else c.xScale.domain([f.minDate,f.maxDate]);c.xScale.range([0,c.w]);c.g=f.chart.append("g").attr("id",c.svgID.substring(1)).attr("class","tl-band").attr("width",c.w);f.bands[a]=c;f.cmpnts.push(c)}function c(a){var c=f.bands[a],d=d3.svg.axis().scale(c.xScale).orient("bottom").tickSize(6,0);localD3&&d.tickFormat(localD3);var h=c.g.append("g").attr("id","axis-"+q+"-"+a).attr("class","axis").style("font-size","10px");a={redraw:function(){h.call(d)}};c.parts.push(a);f.cmpnts.push(a)}function e(a){var c=
f.bands[a],d;d=1==a?32:16;c.labels=[{name:"s-"+q+"-"+a,x:function(){return 0},left:function(){return 0},anchor:"start",tDelta:2,whichDate:function(d,a){return d}},{name:"e-"+q+"-"+a,x:function(){return c.l+c.w},left:function(){return c.l+c.w-f.settings.xLbl},anchor:"end",tDelta:-3,whichDate:function(d,a){return a}}];var h=d3.select(c.svgID).selectAll(".bLblCntr").data(c.labels).enter().append("g").attr("class","bLblCntr");h.append("rect").attr("class","bLbl").attr("id",function(d){return"rect-"+d.name}).attr("x",
function(d){return d.left()}).attr("width",f.settings.xLbl).attr("height",d);var r=h.append("text").attr("class","bMinMaxLbl").attr("id",function(d){return"txt-"+d.name}).attr("x",function(d){return d.x()+d.tDelta}).attr("y",12).attr("text-anchor",function(d){return d.anchor}),e={redraw:function(){var d=c.xScale.domain(),a=d[0],h=d[1];r.text(function(d){return d.whichDate(a,h).getUTCFullYear()})}};c.parts.push(e);f.cmpnts.push(e);if(1==a){var g=h.append("text").attr("class","bMinMaxLbl").attr("id",
function(d){return"m-txt-"+d.name}).attr("x",function(d){return d.x()+d.tDelta}).attr("y",d-4).attr("text-anchor",function(d){return d.anchor});a={redraw:function(){var d=c.xScale.domain(),a=d[0],h=d[1];g.text(function(d){return h.getUTCFullYear()-a.getUTCFullYear()>f.threshold?"":months[d.whichDate(a,h).getMonth()]})}};c.parts.push(a);f.cmpnts.push(a)}c.labelSVGs=h}var f=this;"number"!=typeof this.settings.xLbl&&(this.settings.xLbl=parseInt(this.settings.xLbl));this.brushSVG=this.brush=null;var l=
this.settings;"string"===typeof l.bHt&&(l.bHt=parseInt(l.bHt,10));(function(){var a,c,d,h,r,e;l.dAtts.forEach(function(g){null!=g&&"disable"!=g&&(g=PData.getAttID(g))&&(null==a||g.r.min.y<a?(a=g.r.min.y,"undefined"!=typeof g.r.min.m?(c=g.r.min.m,d="undefined"!=typeof g.r.min.d?g.r.min.d:1):d=c=1):g.r.min.y==a&&"undefined"!=typeof g.r.min.m&&(g.r.min.m<c?(c=g.r.min.m,d="undefined"!=typeof g.r.min.d?g.r.min.d:1):g.r.min.m==c&&"undefined"!=typeof g.r.min.d&&g.r.min.d<d&&(d=g.r.min.d)),null==h?"undefined"==
typeof g.r.max.y?(h=TODAY.getUTCFullYear(),r=TODAY.getMonth()+1,e=TODAY.getDate()):(h=g.r.max.y,"undefined"!=typeof g.r.max.m?(r=g.r.max.m,e="undefined"!=typeof g.r.max.d?g.r.max.d:12):(r=12,e=31)):g.r.max.y>h?(h=g.r.max.y,"undefined"!=typeof g.r.max.m?(r=g.r.max.m,e="undefined"!=typeof g.r.max.d?g.r.max.d:12):(r=12,e=31)):g.r.max.y==h&&"undefined"!=typeof g.r.max.m&&(g.r.max.m>r?(r=g.r.max.m,e="undefined"!=typeof g.r.max.d?g.r.max.d:31):g.r.max.m==r&&"undefined"!=typeof g.r.max.d&&g.r.max.d>e&&(e=
g.r.max.d)))});f.minDate=0<l.from.length?PData.parseDate(l.from,1,1):PData.date3Nums(a,c,d);f.maxDate=0<l.to.length?PData.parseDate(l.to,12,31):PData.date3Nums(h,r,e);f.instGap=.015*(f.maxDate-f.minDate)})();var m=f.getWidths(),p=d3.select(this.frameID).append("svg").attr("class","tl-vf").attr("width",m[1]);(function(){var a=[];l.lgnds.forEach(function(d){d.forEach(function(d){a.push(d)})});var a=_.uniq(a),c=[];a.forEach(function(d){(d=PData.getAttID(d))&&d.l.forEach(function(d){c.push(d.v)})});c=
_.uniq(c);c.sort();var d=p.append("defs"),h,r;c.forEach(function(a){r=a.substr(1);h=d.append("linearGradient").attr("id",r+"-fs");h.append("stop").attr("offset","0%").attr("stop-color","white");h.append("stop").attr("offset","5%").attr("stop-color",a);h.append("stop").attr("offset","100%").attr("stop-color",a);h=d.append("linearGradient").attr("id",r+"-fe");h.append("stop").attr("offset","0%").attr("stop-color",a);h.append("stop").attr("offset","95%").attr("stop-color",a);h.append("stop").attr("offset",
"100%").attr("stop-color","white");h=d.append("linearGradient").attr("id",r+"-fb");h.append("stop").attr("offset","0%").attr("stop-color","white");h.append("stop").attr("offset","5%").attr("stop-color",a);h.append("stop").attr("offset","95%").attr("stop-color",a);h.append("stop").attr("offset","100%").attr("stop-color","white")});d.append("filter").attr("id","xortext").append("feComposite").attr("operator","xor")})();var q=this.vFrame.getIndex();p.append("clipPath").attr("id","tl-clip-"+q).append("rect").attr("width",
m[1]);f.chart=p.append("g").attr("class","chart").attr("clip-path","url(#tl-clip-"+q+")");f.instRad=l.bHt/2-1;f.bands=Array(2);f.cmpnts=[];a(0);a(1);c(0);c(1);e(0);e(1);(function(){var a=f.bands[0];f.brush=d3.svg.brush().x(a.xScale.range([0,a.w])).extent([f.zMinDate,f.zMaxDate]).on("brush",function(){var a=f.brush.extent(),d;"move"===d3.event.mode?(d=d3.time.day.round(a[0]),a=d3.time.day.offset(d,Math.round((a[1]-a[0])/864E5)),d=[d,a]):(d=a.map(d3.time.day.round),d[0]>=d[1]&&(d[0]=d3.time.day.floor(a[0]),
d[1]=d3.time.day.ceil(d3.time.day.offset(d[0],Math.round(f.instGap/864E5)))));f.brush.extent(d);f.brushHandler.redraw();zoom=f.bands[1];zoom.xScale.domain(d);zoom.redraw()})})()};
VizTime.prototype.render=function(a){function c(a,c){var d=a.s-c.s;if(0>d)return 1;if(0<d)return-1;d=c.e-a.e;return 0>d?1:0<d?-1:0}function e(a){function c(d,a){var h=m.toggleSel(d.ai);d3.select(this).classed("obj-sel",h)}var d,h,r,e,g=m.bands[a];a?(d=m.bands[0],g.t=d.t+d.h+37,d=h=r=m.instRad,e=2*m.instRad+3):(g.t=0,d=h=r=1);g.h=q*g.tHt+2;g.g.attr("transform","translate(0,"+g.t+")").attr("height",g.h);var f,k;a&&(f=.75*g.iHt+"px",k=.8*g.iHt);var l;l=d3.select(g.svgID).selectAll(".lgBd").remove();
l=d3.select(g.svgID).selectAll(".lgBd").data(m.lgBds).enter().append("svg").attr("class","lgBd").attr("y",function(d){return g.yScale(d.t)}).attr("height",function(d){return g.yScale(d.h)});l.append("rect").attr("width","100%").attr("height","100%").attr("fill",function(d){return d.d.v});1==a&&l.append("text").attr("class","lgBdLbl").attr("x",2).attr("y",k).attr("fill",function(d){return d.d.b?"#000000":"#FFFFFF"}).style("font-size",f).text(function(d){return d.d.l});var z;z=d3.select(g.svgID).selectAll(".event").remove();
z=d3.select(g.svgID).selectAll(".event").data(m.events).enter().append("svg").attr("class",function(d){return 1==a&&m.isSel(d.ai)?d.f&EVENT_INSTANT?"event instant obj-sel":"event range obj-sel":d.f&EVENT_INSTANT?"event instant":"event range"}).attr("y",function(d){return g.yScale(d.t)}).attr("height",g.iHt);if(1==a)z.on("click",c);var A=d3.select(g.svgID).selectAll(".range");A.append("rect").attr("width","100%").attr("height","100%").attr("fill",function(d){return 1==a&&d.f&(EVENT_F_START|EVENT_F_END)?
(d.f&(EVENT_F_START|EVENT_F_END))==(EVENT_F_START|EVENT_F_END)?"url("+d.c.v+"-fb)":(d.f&EVENT_F_START)===EVENT_F_START?"url("+d.c.v+"-fs)":"url("+d.c.v+"-fe)":d.c.v});1==a&&A.append("text").attr("class","rangeLbl").attr("x",4).attr("y",k).attr("fill",function(d){return d.c.b?"#000000":"#FFFFFF"}).style("font-size",f).text(function(d){return d.l});A=d3.select(g.svgID).selectAll(".instant");A.append("circle").attr("cx",d).attr("cy",h).attr("r",r).attr("fill",function(d){return d.c.v});1==a&&A.append("text").attr("class",
"instantLbl").attr("x",e).attr("y",k).style("font-size",f).style("filter","url(#xortext)").text(function(d){return d.l});g.redraw=function(){l.attr("x",function(d){return g.xScale(d.s)}).attr("width",function(d){return g.xScale(d.e)-g.xScale(d.s)});z.attr("x",function(d){return g.xScale(d.s)}).attr("width",function(d){return g.xScale(d.e)-g.xScale(d.s)});g.parts.forEach(function(d){d.redraw()})}}function f(a){a=m.bands[a];d3.select(a.svgID).selectAll(".axis").attr("transform","translate(0,"+a.h+")")}
function l(a){a=m.bands[a];d3.select(a.svgID).selectAll(".bLblCntr").attr("transform","translate(0,"+(a.h+1).toString()+")")}var m=this,p=m.vFrame.getIndex();m.events=[];m.lgBds=[];var q=0;(function(){for(var e=PData.getNumETmplts(),f=0,d,h,r,u,g,n,k,l;f<e;){for(d=a.t[f];0==d.n;){if(++f==e)return;d=a.t[f]}r=m.vFrame.getSelLocAtts(f);if(0!=r.length&&(r=m.vFrame.getSelFeatAtts(f),0!=r.length)){l=m.vFrame.getSelLegend(f);k=PData.getAttID(l);u=m.settings.dAtts[f];for(var z,A,y,B,v,p,D,C,I=[],G=d.i;G<
d.i+d.n;G++)h=a.s[G],C=PData.getRecByIndex(h),g=C.a[l],"undefined"!=typeof g&&(g=PData.getAttLgndRecs(g,k,r,!1))&&(n=C.a[u])&&(p=n.min.f?EVENT_F_START:0,z=n.min.y,"undefined"==typeof n.min.m?y=A=1:(A=n.min.m,y="undefined"==typeof n.min.d?1:n.min.d),B=PData.date3Nums(z,A,y),"undefined"==typeof n.max?(p|=EVENT_INSTANT,v=B.getTime()+m.instGap):"open"==n.max?v=TODAY:(n.max.f&&(p|=EVENT_F_END),z=n.max.y,"undefined"==typeof n.max.m?(A=12,y=31):(A=n.max.m,y="undefined"==typeof n.max.d?31:n.max.d),v=PData.date3Nums(z,
A,y)),I.push({s:B,e:v,ai:h,f:p,c:g,l:C.l,t:0}));I.sort(c);var E=[],H;I.forEach(function(d){for(H=0;H<E.length&&!(d.e<E[H]);H++);d.t=H+q+1;E[H]=d.s});d=PData.getAttID(u);d.l.forEach(function(d){D=d.d;z=D.min.y;"undefined"==typeof D.min.m?y=A=1:(A=D.min.m,y="undefined"==typeof D.min.d?1:D.min.d);B=PData.date3Nums(z,A,y);"undefined"==typeof D.max.y?v=TODAY:(z=D.max.y,"undefined"==typeof D.max.m?(A=12,y=31):(A=D.max.m,y="undefined"==typeof D.max.d?31:D.max.d),v=PData.date3Nums(z,A,y));m.lgBds.push({s:B,
e:v,t:q,h:E.length+1,d:d})});q+=E.length+1;m.events=m.events.concat(I)}f++}})();m.getWidths();e(0);e(1);(function(){var a=function(){function d(d,a){this._height=a;this.g=d;this.mask=this.g.attr("class","brush").call(m.brush);this.mask.selectAll("rect").attr("y",0).attr("height",a);this.left=this.mask.append("polygon").attr("class","dragger");this.right=this.mask.append("polygon").attr("class","dragger");this._bottom=this._top=this._x=null}d.prototype.style=function(d,a){this.left.style(d,a);this.right.style(d,
a);return this};d.prototype.x=function(d){if(null==d)return this._x;this._x=d;return this};d.prototype.height=function(d){if(null==d)return this._height;this._height=d;this.mask.selectAll("rect").attr("height",d);return this};d.prototype.redraw=function(){var d,a;a=m.brush.extent();this._x.range();d=a[0];a=a[1];d=this._x(d);a=this._x(a);this.left.attr("points",""+d+","+this._height+" "+(d+5)+","+(this._height+5)+" "+(d+5)+","+(this._height+9)+" "+(d-5)+","+(this._height+9)+" "+(d-5)+","+(this._height+
5)+" "+d+","+this._height);this.right.attr("points",""+a+","+this._height+" "+(a+5)+","+(this._height+5)+" "+(a+5)+","+(this._height+9)+" "+(a-5)+","+(this._height+9)+" "+(a-5)+","+(this._height+5)+" "+a+","+this._height);return this};return d}(),c=m.bands[0];null!=m.brushSVG&&m.brushSVG.remove();m.brushSVG=c.g.append("svg");m.brushHandler=(new a(m.brushSVG,c.h-1)).x(c.xScale).redraw()})();(function(){var a=m.bands[1],a=a.t+a.h+45;d3.select(m.frameID+" svg.tl-vf").attr("height",a);d3.select("#tl-clip-"+
p+" rect").attr("height",a)})();f(0);f(1);l(0);l(1);m.cmpnts.forEach(function(a){a.redraw()})};
VizTime.prototype.resize=function(){var a=this.getWidths(),c=d3.select(this.frameID+" svg.tl-vf");c.attr("width",a[1]);c.select("#tl-clip-"+this.vFrame.getIndex()+" rect").attr("width",a[1]);for(var e=0;2>e;e++){b=this.bands[e];b.w=a[1];c.select(b.svgID).attr("width",a[1]);b.xScale.range([0,a[1]]);var f=b.labels[1],l=f.x()+f.tDelta;b.labelSVGs.select("#rect-"+f.name).attr("x",f.left());b.labelSVGs.select("#txt-"+f.name).attr("x",l);if(0==e){if(this.brush){if(this.brushSVG){var m=this.brush.extent();
this.brushSVG.call(this.brush.extent(m))}this.brushHandler&&this.brushHandler.redraw()}b.labelSVGs.select("#m-txt-"+f.name).attr("x",l)}}this.cmpnts.forEach(function(a){a.redraw()})};VizTime.prototype.teardown=function(){};VizTime.prototype.setSel=function(a){var c=this;c.recSel=a;d3.select(this.bands[1].svgID).selectAll(".event").attr("class",function(a){return c.isSel(a.ai)?a.f&EVENT_INSTANT?"event instant obj-sel":"event range obj-sel":a.f&EVENT_INSTANT?"event instant":"event range"})};
VizTime.prototype.clearSel=function(){function a(a){return a.f&EVENT_INSTANT?"event instant":"event range"}0<this.recSel.length&&(this.recSel=[],d3.select(this.bands[1].svgID).selectAll(".event").attr("class",a))};
VizTime.prototype.getState=function(){var a=this.brush.extent(),c=a[0],a=a[1],e=c.getUTCMonth()+1,c=c.getUTCFullYear().toString()+"-"+e.toString()+"-"+c.getDate().toString(),e=a.getUTCMonth()+1,a=a.getUTCFullYear().toString()+"-"+e.toString()+"-"+a.getDate().toString();return{d0:c,d1:a,l:this.vFrame.getLgndSels()}};VizTime.prototype.setState=function(a){var c=PData.parseDate(a.d0,1,1),e=PData.parseDate(a.d1,12,31);this.bands[1].xScale.domain([c,e]);this.brush.extent([c,e]);this.vFrame.setLgndSels(a.l)};
var VizDirectory=function(a,c){PVizModel.call(this,a,c)};VizDirectory.prototype=Object.create(PVizModel.prototype);VizDirectory.prototype.constructor=VizDirectory;VizDirectory.prototype.flags=function(){return V_FLAG_SEL|V_FLAG_VSCRL};VizDirectory.prototype.setup=function(){var a=this;jQuery(this.frameID).on("click.vf",function(c){if("TD"==c.target.nodeName){c=jQuery(c.target).closest("tr");var e=c.data("ai");null!=e&&(a.toggleSel(e)?c.addClass("obj-sel"):c.removeClass("obj-sel"))}})};
VizDirectory.prototype.render=function(a){var c=PData.getNumETmplts(),e=0,f,l=0,m,p;p=null;var q,t,w,d,h=jQuery(this.frameID);h.empty();for(m=a.t[0];e<a.l;){for(;0==m.n||m.i+m.n==e;){if(++l==c)return;m=a.t[l];p=null}null==p&&(f=PData.getETmpltIndex(l),p=PData.getTmpltID(f),h.append('<div class="template-label">'+p.l+'</div><table cellspacing="0" class="viz-directory" data-id='+f+"></table>"),p=h.find('table[data-id="'+f+'"]'),q=this.settings.cnt[l],d="<thead><tr>",q.forEach(function(a){a=PData.getAttID(a);
d+="<th>"+a.def.l+"</th>"}),p.append(d+"<tr></thead><tbody></tbody>"),p=p.find("tbody"));f=a.s[e];w=PData.getRecByIndex(f);d='<tr data-id="'+w.id+'" data-ai='+f;this.isSel(f)&&(d+=' class="obj-sel" ');d+=">";q.forEach(function(a){t=w.a[a];"undefined"!=typeof t?d=(t=PData.procAttTxt(a,t))?d+("<td>"+t+"</td>"):d+"<td></td>":d+="<td></td>"});p.append(d+"</tr>");e++}};VizDirectory.prototype.teardown=function(){jQuery(this.frameID).off("click.vf")};
VizDirectory.prototype.setSel=function(a){var c=this,e,f;this.recSel=a;jQuery(this.frameID).find("tr").each(function(){f=jQuery(this);e=f.data("ai");null!=e&&(c.isSel(e)?f.addClass("obj-sel"):f.removeClass("obj-sel"))})};VizDirectory.prototype.clearSel=function(){0<this.recSel.length&&(this.recSel=[],jQuery(this.frameID).find("tr").removeClass("obj-sel"))};var VizTextStream=function(a,c){PVizModel.call(this,a,c)};VizTextStream.prototype=Object.create(PVizModel.prototype);
VizTextStream.prototype.constructor=VizTextStream;VizTextStream.prototype.flags=function(){return V_FLAG_LGND|V_FLAG_SEL|V_FLAG_LOC|V_FLAG_VSCRL};VizTextStream.prototype.getLocAtts=function(a){return null!=a?[this.settings.order[a]]:_.map(this.settings.order,function(a){return[a]})};VizTextStream.prototype.getFeatureAtts=function(a){return null!=a?this.settings.lgnds[a]:this.settings.lgnds};
VizTextStream.prototype.setup=function(){var a=this;jQuery(this.frameID).on("click.vf",function(c){if("DIV"==c.target.nodeName){c=jQuery(c.target);var e=c.data("ai");"undefined"!=typeof e&&0<=e&&(a.toggleSel(e)?c.addClass("obj-sel"):c.removeClass("obj-sel"))}})};
VizTextStream.prototype.render=function(a){var c=this,e=PData.getNumETmplts(),f=0,l,m,p,q,t,w,d,h,r,u,g,n,k,x,z,A,y,B,v=jQuery(this.frameID);v.empty();y=this.settings.max-this.settings.min;for(m=a.t[0];f<e;){for(;0==m.n;){if(++f==e)return;m=a.t[f]}u=c.vFrame.getSelLocAtts(f);if(0!=u.length&&(u=c.vFrame.getSelFeatAtts(f),0!=u.length)){g=c.vFrame.getSelLegend(f);n=PData.getAttID(g);v.append('<div class="viz-textstream" data-ti='+f+"></div>");p=v.find("div.viz-textstream[data-ti="+f+"]");l=PData.getETmpltIndex(f);
l=PData.getTmpltID(l);p.append('<div class="template-label">'+l.l+"</div>");r=c.settings.cnt[f];if(z=c.settings.sAtts[f])x=PData.getAttID(z),"number"==typeof x.r.min&&"number"==typeof x.r.max?A=x.r.max-x.r.min:z=null;r&&(l=PData.getAttID(c.settings.order[f]),l=PData.orderTBy(l,a,f),l.forEach(function(a){q=PData.getRecByIndex(a.i);t=q.a[g];"undefined"!=typeof t&&(k=PData.getAttLgndRecs(t,n,u,!1))&&((w=q.a[r])&&(w=PData.procAttTxt(r,w)),w&&(z?(d=q.a[z],d="undefined"!=typeof d?Math.floor((d-x.r.min)*
y/A)+c.settings.min:c.settings.min):d=c.settings.min,h=c.isSel(a.i)?" obj-sel":"",B=k.b?";background-color:black":"",p.append('<div class="recitem'+h+'" data-ai='+a.i+' style="color:'+k.v+B+";font-size:"+d+'px">'+w+"</div>")))}))}f++}};VizTextStream.prototype.teardown=function(){jQuery(this.frameID).off("click.vf")};
VizTextStream.prototype.setSel=function(a){var c=this;this.vFrame.getIndex();var e,f;this.recSel=a;jQuery(this.frameID).find("div.recitem").each(function(){f=jQuery(this);e=f.data("ai");null!=e&&(c.isSel(e)?f.addClass("obj-sel"):f.removeClass("obj-sel"))})};VizTextStream.prototype.clearSel=function(){0<this.recSel.length&&(this.recSel=[],jQuery(this.frameID).find("div.recitem").removeClass("obj-sel"))};VizTextStream.prototype.getState=function(){return{l:this.vFrame.getLgndSels()}};
VizTextStream.prototype.setState=function(a){this.vFrame.setLgndSels(a.l)};function PFilterModel(a,c,e){this.id=a;this.att=c;this.dirty=!0;this.req=e}PFilterModel.prototype.isDirty=function(a){null!=a&&(!this.dirty&&a&&0<this.id&&jQuery("#btn-recompute").addClass("pulse"),this.dirty=a);return this.dirty};PFilterModel.prototype.isReq=function(a,c){a&&(this.req!=c&&this.isDirty(!0),this.req=c);return this.dirty};PFilterModel.prototype.title=function(){return this.att.def.l};
PFilterModel.prototype.insertPt=function(){return jQuery('div.filter-instance[data-id="'+this.id+'"] div.filter-body')};PFilterModel.prototype.teardown=function(){};var PFilterText=function(a,c,e){PFilterModel.call(this,a,c,e)};PFilterText.prototype=Object.create(PFilterModel.prototype);PFilterText.prototype.constructor=PFilterText;PFilterText.prototype.evalPrep=function(){this.findStr=this.insertPt().find("input.filter-text").val()};
PFilterText.prototype.eval=function(a){var c=this.findStr;if(null==c||""==c)return!0;a=a.a[this.att.id];return"undefined"==typeof a?this.req?!1:!0:-1!=a.indexOf(c)};PFilterText.prototype.setup=function(){var a=this,c=this.insertPt(),e=document.getElementById("dltext-filter-text").innerHTML;c.append(e);c.find("input.filter-text").change(function(){a.isDirty(!0)})};PFilterText.prototype.getState=function(){return{t:this.insertPt().find("input.filter-text").val()}};PFilterText.prototype.setState=function(a){this.insertPt().find("input.filter-text").val(a.t)};
var PFilterVocab=function(a,c,e){PFilterModel.call(this,a,c,e)};PFilterVocab.prototype=Object.create(PFilterModel.prototype);PFilterVocab.prototype.constructor=PFilterVocab;PFilterVocab.prototype.evalPrep=function(){var a=this;this.sel=[];this.insertPt().find("div.filter-vocab-row input:checked").each(function(){var c=jQuery(this).parent().data("id");a.sel.push(c)});a.sel.sort()};
PFilterVocab.prototype.eval=function(a){if(0==this.sel.length)return!1;a=a.a[this.att.id];if("undefined"==typeof a)return this.req?!1:!0;for(var c,e,f=0;f<a.length;f++)if(e=a[f],c=_.sortedIndex(this.sel,e),this.sel[c]==e)return!0;return!1};
PFilterVocab.prototype.setup=function(){var a=this,c='<div class="filter-vocab-container">';this.att.l.forEach(function(a,e){c+='<div class="filter-vocab-entry" data-index="'+e+'"><div class="filter-vocab-row" data-id="'+a.l+'"><input type="checkbox" value="min-use" checked="checked">'+a.l+'</div><div class="filter-vocab-bar" style="background-color:'+a.v+'"></div>';a.z.forEach(function(e,l){c+='<div class="filter-vocab-row" data-id="'+e.l+'"><input type="checkbox" value="min-use" checked="checked">'+
e.l+"</div>";c=null==e.v||""==e.v?c+('<div class="filter-vocab-bar" style="background-color:'+a.v+'"></div>'):c+('<div class="filter-vocab-bar" style="background-color:'+e.v+'"></div>')});c+="</div>"});var e=this.insertPt();e.append(c+"</div>");e.click(function(c){"INPUT"==c.target.nodeName&&a.isDirty(!0)})};PFilterVocab.prototype.getState=function(){var a=[];this.insertPt().find("div.filter-vocab-row input:checked").each(function(){var c=jQuery(this).parent().data("id");a.push(c)});a.sort();return{s:a}};
PFilterVocab.prototype.setState=function(a){this.insertPt().find("div.filter-vocab-row").each(function(){var c=jQuery(this),e=c.data("id"),e=_.indexOf(a.s,e,!0);c.find("input").prop("checked",-1!=e)})};var PFilterNum=function(a,c,e){PFilterModel.call(this,a,c,e)};PFilterNum.prototype=Object.create(PFilterModel.prototype);PFilterNum.prototype.constructor=PFilterNum;
PFilterNum.prototype.evalPrep=function(){if(null==this.rCats){var a=this.insertPt();this.min=parseInt(a.find("input.filter-num-min-val").val());this.max=parseInt(a.find("input.filter-num-max-val").val());this.useMin=a.find("input.filter-num-min-use").is(":checked");this.useMax=a.find("input.filter-num-max-use").is(":checked")}};
PFilterNum.prototype.eval=function(a){a=a.a[this.att.id];if("undefined"==typeof a)return this.req?!1:!0;if(this.useMin&&a<this.min)return!1;if(null==this.rCats){if(this.useMax&&a>this.max)return!1}else if(a>=this.max)return!1;return!0};
PFilterNum.prototype.setup=function(){var a=this,c=this.insertPt();this.rCats=PData.getRCats(this.att);if(null==this.rCats){var e=_.template(document.getElementById("dltext-filter-num-boxes").innerHTML),f="undefined"==typeof this.att.r.min?0:this.att.r.min;c.append(e({min:f,max:"undefined"==typeof this.att.r.max?f+100:this.att.r.max}));c.click(function(c){"INPUT"==c.target.nodeName&&a.isDirty(!0)});c.find("input.filter-num-min-val").change(function(){var e=jQuery(this).val(),f=c.find("input.filter-num-max-val").val();
e<=f?a.isDirty(!0):jQuery(this).val(f)});c.find("input.filter-num-max-val").change(function(){var e=jQuery(this).val(),f=c.find("input.filter-num-min-val").val();e>=f?a.isDirty(!0):jQuery(this).val(f)})}else{this.useMin=this.useMax=!0;this.min=this.rCats[0].min;this.max=this.rCats[this.rCats.length-1].max;var l=80-D3FG_MARGINS.top-D3FG_MARGINS.bottom,e=this.rCats.length*D3FG_BAR_WIDTH,m=d3.scale.linear().domain([0,this.rCats.length]).rangeRound([0,e]),p=d3.scale.linear().domain([0,100]).range([l,
0]),f=d3.scale.ordinal().rangeRoundBands([0,e]);f.domain(this.rCats.map(function(a){return a.l}));var f=d3.svg.axis().scale(f).orient("bottom"),q=d3.svg.axis().scale(p).orient("left").ticks(4),e=d3.select(c.get(0)).append("svg").attr("width",e+D3FG_MARGINS.left+D3FG_MARGINS.right).attr("height",l+D3FG_MARGINS.top+D3FG_MARGINS.bottom).append("g").attr("transform","translate("+D3FG_MARGINS.left+","+D3FG_MARGINS.top+")");e.append("g").attr("class","x axis").attr("transform","translate(0,"+l+")").call(f);
e.append("g").attr("class","y axis").call(q);e.selectAll(".bar").data(this.rCats).enter().append("rect").attr("class","bar").attr("x",function(a,c){return m(c)}).attr("y",function(a){return p(100)}).attr("fill",function(a){return a.c}).attr("height",function(a){return l-p(100)}).attr("width",D3FG_BAR_WIDTH-2);a.brush=d3.svg.brush().x(m).extent([0,this.rCats.length]).on("brushend",function(){if(d3.event.sourceEvent){var c=a.brush.extent(),e=[Math.floor(c[0]),Math.floor(c[1])];e[0]>=e[1]&&(e[0]=Math.floor(c[0]),
e[1]=Math.ceil(c[1]));e[1]=Math.max(e[1],e[0]+1);d3.select(this).transition().call(a.brush.extent(e));a.min=a.rCats[e[0]].min;a.max=a.rCats[e[1]-1].max;a.isDirty(!0)}});a.brushg=e.append("g");a.brushg.attr("class","brush").call(a.brush);a.brushg.selectAll("rect").attr("y",0).attr("height",l);a.brushg.selectAll(".resize").append("path").attr("d",function(a){var c=(a=+("e"==a))?1:-1,d=l/4;return"M"+.5*c+","+d+"A6,6 0 0 "+a+" "+6.5*c+","+(d+6)+"V"+(2*d-6)+"A6,6 0 0 "+a+" "+.5*c+","+2*d+"ZM"+2.5*c+","+
(d+8)+"V"+(2*d-8)+"M"+4.5*c+","+(d+8)+"V"+(2*d-8)})}};PFilterNum.prototype.getState=function(){if(null==this.rCats){var a=this.insertPt(),c=parseInt(a.find("input.filter-num-min-val").val()),e=parseInt(a.find("input.filter-num-max-val").val()),f=a.find("input.filter-num-min-use").is(":checked"),a=a.find("input.filter-num-max-use").is(":checked");return{rc:!1,min:c,max:e,useMin:f,useMax:a}}c=this.brush.extent();return{rc:!0,e0:c[0],e1:c[1]}};
PFilterNum.prototype.setState=function(a){if(a.rc)this.min=this.rCats[a.e0].min,this.max=this.rCats[a.e1-1].max,this.brush.extent([a.e0,a.e1]),this.brushg.call(this.brush);else{var c=this.insertPt();c.find("input.filter-num-min-val").val(a.min);c.find("input.filter-num-max-val").val(a.max);c.find("input.filter-num-min-use").prop("checked",a.useMin);c.find("input.filter-num-max-use").prop("checked",a.useMax)}};var PFilterDates=function(a,c,e){PFilterModel.call(this,a,c,e)};PFilterDates.prototype=Object.create(PFilterModel.prototype);
PFilterDates.prototype.constructor=PFilterDates;PFilterDates.prototype.evalPrep=function(){this.c=jQuery("input[name=dctrl-"+this.id+"]:checked").val()};
PFilterDates.prototype.eval=function(a){function c(a,c,e,p){"undefined"!=typeof p.m&&(c=p.m,"undefined"!=typeof p.d&&(e=p.d));return PData.date3Nums(a,c,e)}var e=a.a[this.att.id];if("undefined"==typeof e)return this.req?!1:!0;if("undefined"==typeof e.max)return a=c(e.min.y,1,1,e.min),this.min<=a&&a<this.max;a=c(e.min.y,1,1,e.min);e="open"==e.max?TODAY:c(e.max.y,12,31,e.max);return"o"==this.c?e<this.min||a>=this.max?!1:!0:this.min<=a&&e<=this.max};
PFilterDates.prototype.setup=function(){var a=this;this.rCats=PData.getRCats(this.att);this.min=this.rCats[0].min;this.max=this.rCats[this.rCats.length-1].max;var c=80-D3FG_MARGINS.top-D3FG_MARGINS.bottom,e=this.rCats.length*D3FG_BAR_WIDTH,f=d3.scale.linear().domain([0,this.rCats.length]).rangeRound([0,e]),l=d3.scale.linear().domain([0,100]).range([c,0]),m=d3.scale.ordinal().rangeRoundBands([0,e]);m.domain(this.rCats.map(function(a){return a.l}));var m=d3.svg.axis().scale(m).orient("bottom"),p=d3.svg.axis().scale(l).orient("left").ticks(4),
q=this.insertPt(),t=_.template(document.getElementById("dltext-filter-date-ctrl").innerHTML);q.append(t({id:this.id}));q.find("input[name=dctrl-"+a.id+"]").change(function(){a.isDirty(!0)});e=d3.select(q.get(0)).append("svg").attr("width",e+D3FG_MARGINS.left+D3FG_MARGINS.right).attr("height",c+D3FG_MARGINS.top+D3FG_MARGINS.bottom).append("g").attr("transform","translate("+D3FG_MARGINS.left+","+D3FG_MARGINS.top+")");e.append("g").attr("class","x axis").attr("transform","translate(0,"+c+")").call(m);
e.append("g").attr("class","y axis").call(p);e.selectAll(".bar").data(this.rCats).enter().append("rect").attr("class","bar").attr("x",function(a,d){return f(d)}).attr("y",function(a){return l(100)}).attr("fill",function(a){return a.c}).attr("height",function(a){return c-l(100)}).attr("width",D3FG_BAR_WIDTH-2);a.brush=d3.svg.brush().x(f).extent([0,this.rCats.length]).on("brushend",function(){if(d3.event.sourceEvent){var c=a.brush.extent(),d=[Math.floor(c[0]),Math.floor(c[1])];d[0]>=d[1]&&(d[0]=Math.floor(c[0]),
d[1]=Math.ceil(c[1]));d[1]=Math.max(d[1],d[0]+1);d3.select(this).transition().call(a.brush.extent(d));a.min=a.rCats[d[0]].min;a.max=a.rCats[d[1]-1].max;a.isDirty(!0)}});a.brushg=e.append("g");a.brushg.attr("class","brush").call(a.brush);a.brushg.selectAll("rect").attr("y",0).attr("height",c);a.brushg.selectAll(".resize").append("path").attr("d",function(a){var d=(a=+("e"==a))?1:-1,h=c/4;return"M"+.5*d+","+h+"A6,6 0 0 "+a+" "+6.5*d+","+(h+6)+"V"+(2*h-6)+"A6,6 0 0 "+a+" "+.5*d+","+2*h+"ZM"+2.5*d+","+
(h+8)+"V"+(2*h-8)+"M"+4.5*d+","+(h+8)+"V"+(2*h-8)})};PFilterDates.prototype.getState=function(){var a=this.brush.extent(),c=jQuery("input[name=dctrl-"+this.id+"]:checked").val();return{e0:a[0],e1:a[1],c:c}};PFilterDates.prototype.setState=function(a){jQuery('input[name="dctrl-'+this.id+'"]').val([a.c]);this.min=this.rCats[a.e0].min;this.max=this.rCats[a.e1-1].max;this.brush.extent([a.e0,a.e1]);this.brushg.call(this.brush)};
function PViewFrame(a){function c(){return"#view-frame-"+a}function e(a){a=jQuery(c()+" div.view-control-bar select.view-viz-select option:selected").val();PState.set(PSTATE_BUILD);r(a,!0);PState.set(PSTATE_READY)}function f(a){n.flags()&V_FLAG_LGND&&jQuery(c()+" div.lgnd-container").toggle("slide",{direction:"left"});a.preventDefault()}function l(a){function d(a){var c=new Number,h=parseTC.exec(a);if(null!==h)c=1E3*(3600*parseInt(h[1])+60*parseInt(h[2])+parseFloat(h[3])),c=1==h[4].length?c+100*parseInt(h[4]):
c+10*parseInt(h[4]);else throw reportError(!1,"Error in transcript file: Cannot parse "+a+" as timecode."),Error("Error in transcript file: Cannot parse "+a+" as timecode.");return c}function c(a,d){var h=new String(a);if(widgetData.extract){var e=h.indexOf(widgetData.extract[0]);if(-1==e)throw Error("Transcript2 excerpt error: Cannot find timestamp "+widgetData.extract[0]);var g=h.indexOf(widgetData.extract[1]);if(-1==g)throw Error("Transcript2 excerpt error: Cannot find timestamp "+widgetData.extract[1]);
h=h.substring(e-1,g-1)}var h=h.trim().split(/\r\n|\r|\n/g),f=[];if(h){var r,k=0;_.each(h,function(a){a=a.trim();0<a.length&&("["===a.charAt(0)?(0<k&&f.push(r),r=""):r+=a,k++)})}_.each(f,function(a,c){d.find('div.timecode[data-tcindex="'+c+'"]').next().after('<div class="xscript">'+a+"</div>")})}function h(a){widgetData.tcArray=[];widgetData.tcIndex=-1;var e=widgetData.tcArray;a=new String(a);if(widgetData.extract){var g=a.indexOf(widgetData.extract[0]);if(-1==g)throw Error("Transcript excerpt error: Cannot find timestamp "+
widgetData.extract[0]);var f=a.indexOf(widgetData.extract[1]);if(-1==f)throw Error("Transcript excerpt error: Cannot find timestamp "+widgetData.extract[1]);a=a.substring(g-1,f-1)}if(a=a.trim().split(/\r\n|\r|\n/g)){var r=0,k,n=0,u=0,C="",E=jQuery("#xscript-tbl");_.each(a,function(a){a=a.trim();1<a.length&&("["===a.charAt(0)&&"0"<=a.charAt(1)&&"9">=a.charAt(1)?(k=d(a),0<C.length&&(u&&e.push({s:n,e:k}),E.append('<div class="row"><div class="timecode" data-timecode="'+n+'" data-tcindex="'+r++ +'">'+
u+'</div><div class="xscript">'+C+"</div></div>"),C=""),u=a,n=k):C+=a)});0<C.length&&(e.push({s:n,e:324E5}),E.append('<div class="row"><div class="timecode" data-timecode="'+n+'" data-tcindex="'+r+'">'+u+'</div><div class="xscript">'+C+"</div></div>"));if("undefined"!=typeof p&&null!=p){var z=new XMLHttpRequest;z.onload=function(a){c(z.responseText,E)};z.open("GET",p,!0);z.send()}}}function e(a){var d,c=widgetData.tcIndex;_.find(widgetData.tcArray,function(h,e){if((d=h.s<=a&&a<h.e)&&e!=c){var g=jQuery("#xscript-tbl");
if(document.getElementById("sync-xscript").checked){var f=g.find('[data-tcindex="'+e+'"]').offset().top-g.offset().top,f=g.scrollTop()+f;g.animate({scrollTop:f},300)}-1!=c&&g.find('[data-tcindex="'+c+'"]').removeClass("current");g.find('[data-tcindex="'+e+'"]').addClass("current");widgetData.tcIndex=e}return d})}function g(){widgetData.widget=new YT.Player("yt-widget",{width:"426",height:"240",videoId:widgetData.ytCode,events:{onError:function(a){console.log("YouTube Error: "+a.data)},onStateChange:function(a){var d;
switch(a.data){case 1:widgetData.playing=!0;null==widgetData.timer&&(widgetData.timer=setInterval(function(){d=1E3*widgetData.widget.getCurrentTime();widgetData.playing&&e(d)},300));break;case 0:case 2:widgetData.playing=!1;window.clearInterval(widgetData.timer);widgetData.timer=null;break;case 3:case 5:widgetData.playing=!1}},onReady:function(){widgetData.extract&&widgetData.widget.cueVideoById({videoId:widgetData.ytCode,startSeconds:widgetData.sTime/1E3,endSeconds:widgetData.eTime/1E3})}}})}function f(){function a(){widgetData.sTime=
widgetData.eTime=null;var c;(c=prspdata.e.i.t.tcAtts[k])&&(c=t.a[c])&&""!=c&&(c=c.split("-"),widgetData.extract=c,widgetData.sTime=d(c[0]),widgetData.eTime=d(c[1]))}var c=q[w];t=PData.getRecByIndex(c);var r=" "+t.l+" ("+(w+1)+"/"+q.length+") ";jQuery("#inspect-name").text(r);var k=PData.aIndex2Tmplt(c);E.empty();prspdata.e.i.modal.atts[k].forEach(function(a){var d=PData.getRecAtt(c,a,!1);d&&(a='<div><span class="att-label">'+PData.getAttID(a).def.l+":</span> "+d+"</div>",E.append(a))});m=null;l=0;
widgetData.extract=null;widgetData.xscriptOn=!1;widgetData.playing=!1;if(prspdata.e.i.modal.scOn&&(m=prspdata.e.i.sc.atts[k])&&(r=t.a[m])){var n=!0;a();l=1;E.append('<iframe id="sc-widget" class="player" width="100%" height="150" src="http://w.soundcloud.com/player/?url='+r+'"></iframe></p>');var C=SC.Widget(document.getElementById("sc-widget"));widgetData.widget=C;C.bind(SC.Widget.Events.READY,function(){C.play();C.bind(SC.Widget.Events.PLAY,function(){widgetData.playing=!0});C.bind(SC.Widget.Events.PAUSE,
function(){widgetData.playing=!1});C.bind(SC.Widget.Events.PLAY_PROGRESS,function(a){n&&(C.pause(),n=!1,widgetData.playing=!1);widgetData.extract&&(a.currentPosition<widgetData.sTime?C.seekTo(widgetData.sTime):a.currentPosition>widgetData.eTime&&(C.pause(),widgetData.playing=!1));widgetData.playing&&widgetData.xscriptOn&&e(a.currentPosition)});C.bind(SC.Widget.Events.FINISH,function(){widgetData.playing=!1})})}if(0==l&&prspdata.e.i.modal.ytOn&&(m=prspdata.e.i.yt.atts[k])&&(r=t.a[m])){a();widgetData.ytCode=
r;E.append('<div id="yt-widget"></div>');widgetData.ytCall=g;if(widgetData.ytLoaded)g();else{widgetData.ytLoaded=!0;r=document.createElement("script");r.src="https://www.youtube.com/iframe_api";var u=document.getElementsByTagName("script")[0];u.parentNode.insertBefore(r,u)}l=2}if(prspdata.e.i.modal.tOn&&(r=prspdata.e.i.t.t1Atts[k])&&""!==r&&"disable"!=r&&(r=t.a[r])){0<l&&E.append("<div>"+document.getElementById("dltext-sync-xscript").innerHTML+"</div>");E.append('<div id="xscript-tbl"><div>');widgetData.xscriptOn=
!0;jQuery("#xscript-tbl").click(function(a){if(l&&jQuery(a.target).hasClass("timecode"))switch(a=jQuery(a.target).data("timecode"),l){case 1:widgetData.playing||(widgetData.playing=!0,widgetData.widget.play());widgetData.widget.seekTo(a);break;case 2:widgetData.playing||(widgetData.playing=!0,widgetData.widget.playVideo()),widgetData.widget.seekTo(a/1E3)}});p=null;(u=prspdata.e.i.t.t2Atts[k])&&""!==u&&"disable"!=u&&(p=t.a[u]);var y=new XMLHttpRequest;y.onload=function(a){h(y.responseText)};y.open("GET",
r,!0);y.send()}}function r(a){a=w+a;-1==a?a=q.length-1:a==q.length&&(a=0);a!=w&&(w=a,f())}function k(a){r(-1)}function u(a){r(1)}var E=jQuery("#inspect-content"),m=null,l=0,p,q=null;n&&(q=n.getSel());if(null!=q&&0!=q.length){var x,t,w=0;f();jQuery("#btn-inspect-left").click(k);jQuery("#btn-inspect-right").click(u);var J=450,K=400;prspdata.e.i.modal.scOn&&(J=550);prspdata.e.i.modal.ytOn&&(J=Math.max(J,460),K=500);prspdata.e.i.tOn&&(K+=100,J=prspdata.e.i.t2On?750:Math.max(J,500));x=jQuery("#dialog-inspector").dialog({width:J,
height:K,modal:!0,buttons:[{text:dlText.seerec,click:function(){window.open(prspdata.site_url+"?p="+t.wp,"_blank")}},{text:dlText.close,click:function(){switch(l){case 1:null!=widgetData.widget&&widgetData.playing&&widgetData.widget.pause();widgetData.playing=!1;widgetData.widget=null;break;case 2:widgetData.ytCall=null,null!=widgetData.widget&&widgetData.playing&&widgetData.widget.stopVideo(),widgetData.widget=null,widgetData.playing=!1,null!=widgetData.timer&&(window.clearInterval(widgetData.timer),
widgetData.timer=null)}jQuery("#btn-inspect-left").off("click");jQuery("#btn-inspect-right").off("click");x.dialog("close")}}]});a.preventDefault()}}function m(a){var d=jQuery(c()+" .view-control-bar");a?(d.find(".osel").button("enable"),d.find(".osel").addClass("pulse"),d.find(".xsel").button("enable")):(d.find(".osel").button("disable"),d.find(".osel").removeClass("pulse"),d.find(".xsel").button("disable"))}function p(a){n&&n.clearSel();m(!1);a.preventDefault()}function q(a){n&&n.optionsModal();
a.preventDefault()}function t(a,d){jQuery(c()+' div.lgnd-container div.lgnd-template[data-index="'+a+'"] div.lgnd-group input.lgnd-entry-check').prop("checked",d)}function w(a){var d=jQuery(a.target).closest("div.lgnd-template").data("index"),h=a.target.className;switch(h){case "lgnd-update":n&&x&&(PState.set(PSTATE_BUILD),n.render(x),PState.set(PSTATE_READY));break;case "lgnd-entry-check":h=jQuery(a.target).closest("div.lgnd-entry");a=jQuery(a.target).is(":checked");h.hasClass("lgnd-sh")?t(d,a):
h.hasClass("lgnd-locate")?h.data("id"):h.hasClass("lgnd-value")&&h.data("index");break;case "lgnd-viz":case "lgnd-value-title":h=jQuery(a.target).closest("div.lgnd-entry");h.hasClass("lgnd-locate")?(a=h.data("id"),jQuery(c()+' div.lgnd-container div.lgnd-template[data-index="'+d+'"] div.lgnd-locate input.lgnd-entry-check').prop("checked",!1),jQuery(c()+' div.lgnd-container div.lgnd-template[data-index="'+d+'"] div.lgnd-locate[data-id="'+a+'"] input.lgnd-entry-check').prop("checked",!0)):h.hasClass("lgnd-value")&&
(a=h.data("index"),jQuery(c()+' div.lgnd-container div.lgnd-template[data-index="'+d+'"] div.lgnd-group input.lgnd-entry-check').prop("checked",!1),jQuery(c()+' div.lgnd-container div.lgnd-template[data-index="'+d+'"] div.lgnd-group div.lgnd-value[data-index="'+a+'"] input.lgnd-entry-check').prop("checked",!0));break;case "lgnd-template":case "lgnd-select":case "":break;default:h.match(/lgnd-sh/i)&&(h=jQuery(a.target).find("input.lgnd-entry-check"),a=!h.is(":checked"),h.prop("checked",a),t(d,a))}}
function d(a){var d=jQuery(a.target).closest("div.lgnd-template").data("index");a=jQuery(a.target).val();h(d,a)}function h(a,d){var h,e=jQuery(c()+' div.lgnd-container div.lgnd-template[data-index="'+a+'"] div.lgnd-group');e.empty();k[a]=d;PData.getAttID(d).l.forEach(function(a,d){h='<div class="lgnd-value lgnd-entry" data-index="'+d+'"><input type="checkbox" checked="checked" class="lgnd-entry-check"/><div class="lgnd-viz" style="background-color: '+a.v+'"> </div> <span class="lgnd-value-title">'+
a.l+"</span></div>";e.append(h);a.z&&0<a.z.length&&a.z.forEach(function(a,c){h='<div class="lgnd-value lgnd-entry" data-index="'+d+","+c+'"><input type="checkbox" checked="checked" class="lgnd-entry-check"/>';h=a.v&&""!=a.v?h+('<div class="lgnd-viz" style="background-color: '+a.v+'"></div>'):h+'<div class="lgnd-viz lgnd-viz-empty"></div>';h+=' <span class="lgnd-value-title"> > '+a.l+"</span></div>";e.append(h)})});jQuery(c()+' div.lgnd-container div.lgnd-template[data-index="'+a+'"] div.lgnd-sh input').prop("checked",
!0)}function r(e,r){var f=PData.getVizIndex(e);n&&(n.teardown(),n=null);var l=jQuery(c());l.find("div.viz-content div.viz-result").empty();var p;switch(f.vf){case "M":p=new VizMap(u,f.c);break;case "C":p=new VizCards(u,f.c);break;case "P":p=new VizPinboard(u,f.c);break;case "T":p=new VizTime(u,f.c);break;case "D":p=new VizDirectory(u,f.c);break;case "t":p=new VizTextStream(u,f.c)}g=e;var q=p.flags();q&V_FLAG_HSCRL?(l.find("div.viz-content").addClass("h-scroll"),l.find("div.viz-result").addClass("viz-fit-w"),
l.find("div.viz-result").removeClass("viz-max-w")):(l.find("div.viz-content").removeClass("h-scroll"),l.find("div.viz-result").removeClass("viz-fit-w"),l.find("div.viz-result").addClass("viz-max-w"));q&V_FLAG_VSCRL?(l.find("div.viz-content").addClass("v-scroll"),l.find("div.viz-result").addClass("viz-fit-h"),l.find("div.viz-result").removeClass("viz-max-h")):(l.find("div.viz-content").removeClass("v-scroll"),l.find("div.viz-result").removeClass("viz-fit-h"),l.find("div.viz-result").addClass("viz-max-h"));
k=[];if(q&V_FLAG_LGND){l.find(".hslgnd").button("enable");var t=l.find("div.lgnd-container div.lgnd-scroll");t.empty();prspdata.e.g.ts.forEach(function(a,c){var e=PData.getTmpltID(a),g=p.getLocAtts(c);if(g&&0<g.length||!(q&V_FLAG_LOC)){var f=jQuery('<div class="lgnd-template" data-index="'+c+'"><div class="lgnd-title">'+e.l+"</div></div>");g&&g.forEach(function(a,d){var c=PData.getAttID(a);f.append('<div class="lgnd-entry lgnd-locate" data-id="'+a+'"><input type="checkbox" checked="checked" class="lgnd-entry-check"/><span class="lgnd-value-title">'+
c.def.l+"</span></div>")});var e=p.getFeatureAtts(c),r='<select class="lgnd-select">';e.forEach(function(a,d){var c=PData.getAttID(a);r+='<option value="'+a+'">'+c.def.l+"</option>"});r+="</select>";g=jQuery(r);g.change(d);jQuery(f).append(g);jQuery(f).append('<div class="lgnd-entry lgnd-sh"><input type="checkbox" checked="checked" class="lgnd-entry-check"/>'+dlText.sha+'</div><div class="lgnd-group"></div>');t.append(f);c!=prspdata.t.length-1&&t.append("<hr/>");e=0<e.length?e[0]:null;k.push(e);e&&
h(c,e)}});l.find("div.lgnd-container").show()}else l.find(".hslgnd").button("disable"),l.find("div.lgnd-container").hide();f=jQuery("#selector-v"+a);q&V_FLAG_SEL?(f.removeAttr("disabled"),f.prop("checked",!0)):(f.attr("disabled",!0),f.prop("checked",!1));q&V_FLAG_SET?l.find(".vopts").button("enable"):l.find(".vopts").button("disable");p.setup();m(!1);x&&r&&p.render(x);n=p}var u={},g=0,n=null,k=[],x=null;u.getFrameID=c;u.getIndex=function(){return a};u.setViz=function(a,d){a!=g&&(jQuery(c()+" div.view-control-bar select.view-viz-select").val(a),
r(a,d))};u.initDOM=function(d){var h=document.getElementById("dltext-viewframe-dom").innerHTML;jQuery("#viz-display-frame").append('<div id="view-frame-'+a+'">'+h+"</div>");var h=jQuery(c()),g=h.find("div.view-control-bar select.view-viz-select");prspdata.e.vf.forEach(function(a,d){g.append('<option value="'+d+'">'+a.l+"</option>")});g.val(d);g.change(e);h.find("div.view-control-bar button:first").button({icons:{primary:"ui-icon-bookmark"},text:!1}).click(f).next().button({icons:{primary:"ui-icon-info"},
text:!1}).click(l).next().button({icons:{primary:"ui-icon-cancel"},text:!1}).click(p).next().button({icons:{primary:"ui-icon-gear"},text:!1}).click(q).next();h.find("div.lgnd-container").click(w);r(d,!1)};u.getSelLocAtts=function(a){var d=[];jQuery(c()+' div.lgnd-container div.lgnd-template[data-index="'+a+'"] div.lgnd-locate input:checked').each(function(){var a=jQuery(this).parent().data("id");d.push(a)});return d};u.getSelFeatAtts=function(a){var d=[],h,e;jQuery(c()+' div.lgnd-container div.lgnd-template[data-index="'+
a+'"] div.lgnd-group div.lgnd-value input:checked').each(function(){h=jQuery(this).parent().data("index");"number"==typeof h?d.push(h):-1!=(e=h.indexOf(","))?d.push([parseInt(h.substring(0,e),10),parseInt(h.substring(e+1),10)]):d.push(parseInt(h,10))});return d};u.getSelLegend=function(a){return k[a]};u.getLgndSels=function(){return k.slice(0)};u.setLgndSels=function(a){a.forEach(function(a,d){jQuery(c()+' div.lgnd-template[data-index="'+d+'"] select.lgnd-select').val(a);h(d,a)})};u.getState=function(){return n?
n.getState():null};u.setState=function(a){n&&n.setState(a)};u.showStream=function(a){x=a;n&&n.render(a)};u.setStream=function(a){x=a};u.selBtns=function(a){m(a)};u.clearSel=function(){n&&n.clearSel();m(!1)};u.setSel=function(a){return n&&n.flags()&V_FLAG_SEL?(n.setSel(a),m(0<a.length),!0):!1};u.resize=function(){n&&n.resize()};u.title=function(){return PData.getVizIndex(g).l};return u}
var PData=function(){function a(a,h,e){jQuery.ajax({type:"POST",url:prspdata.ajax_url,data:{action:"prsp_get_records",tmplt_id:prspdata.t[a].id,from:h,count:e},success:function(h,g,f){g=q[a];h=JSON.parse(h);g.d=g.d?g.d.concat(h):h;g.n+=e;c()},error:function(a,d,c){alert(c)}})}function c(){for(var d=!0,c=0;c<prspdata.t.length;c++){var f=q[c].n,u=prspdata.t[c].n;if(f<u){d=!1;u-=f;a(c,f,u<e?u:e);break}}d&&(w=!0,setTimeout(function(){jQuery("body").trigger("prospect",{pstate:PSTATE_PROCESS,component:0})},
500))}var e=1E3,f,l,m,p,q=[],t=0,w=!1;return{init:function(){f=document.getElementById("dltext-from").innerHTML;l=document.getElementById("dltext-to").innerHTML;m=document.getElementById("dltext-approximately").innerHTML;p=document.getElementById("dltext-now").innerHTML;"number"==typeof prspdata.chunk&&0<prspdata.chunk&&(e=prspdata.chunk);prspdata.t.forEach(function(a){q.push({i:t,n:0,d:null});t+=a.n});c()},newIndexStream:function(a){var c={};c.s=new Uint16Array(t);c.t=[];c.l=0;if(a){for(a=0;a<t;a++)c.s[a]=
a;for(a=0;a<q.length;a++){var e=q[a];c.t.push({i:e.i,n:e.n})}c.l=t}return c},aIndex2Tmplt:function(a){for(var c=0;c<q.length;c++){var e=q[c];if(e.i<=a&&a<e.i+e.n)return c}},stream1stTEntry:function(a,c){var e=a.t[c];return 0==e.n?-1:e.i},getRecByIndex:function(a){for(var c=0;c<q.length;c++){var e=q[c];if(0<e.n&&e.i<=a&&a<e.i+e.n)return e.d[a-e.i]}return null},procAttTxt:function(a,c){var e=PData.getAttID(a);switch(e.def.t){case "V":return c.join(", ");case "T":return c;case "N":return c.toString();
case "D":return c.max?(e=f,c.min.f&&(e+=m),e+=c.min.y.toString(),c.min.m&&(e+="-"+c.min.m.toString(),c.min.d&&(e+="-"+c.min.d.toString())),e+=l,"open"==c.max?e+=p:(c.max.f&&(e+=m+" "),e+=c.max.y.toString(),c.max.m&&(e+="-"+c.max.m.toString(),c.max.d&&(e+="-"+c.max.d.toString())))):(e=c.min.f?m:"",e+=c.min.y.toString(),c.min.m&&(e+="-"+c.min.m.toString(),c.min.d&&(e+="-"+c.min.d.toString()))),e;case "L":case "X":return c.join(", ");case "I":return'<img src="'+c+'" alt="'+e.def.l+'"/>';case "l":return'<a href="'+
c+'" target="_blank">(See Link)</a>';case "S":return'<a href="'+c+'" target="_blank">(SoundCloud)</a>';case "Y":return'<a href="https://www.youtube.com/watch?v='+c+'" target="_blank">(YouTube)</a>';case "x":return'<a href="'+c+'" target="_blank">(See Transcript File)</a>';case "t":return c;case "P":if(0<c.length){var u="";c.forEach(function(a){(a=PData.getRecByID(a))&&(u+='<a href="'+prspdata.site_url+"?p="+a.wp+'" target="_blank">'+a.l+"</a> ")});return u}}return null},getRecAtt:function(a,c,e){for(var f=
0;f<q.length;f++){var g=q[f];if(0<g.n&&g.i<=a&&a<g.i+g.n){a=g.d[a-g.i].a[c];if(null==a||"undefined"==typeof a)break;return e?a:PData.procAttTxt(c,a)}}return null},getAbsIByID:function(a){for(var c=0;c<q.length;c++){var e=q[c];if(0<e.n)for(var f=0,g=e.n-1,n,k;f<=g;)if(n=f+g>>1,k=e.d[n],k=k.id.localeCompare(a),0>k)f=n+1;else if(0<k)g=n-1;else return e.i+n}return null},getRecByID:function(a){for(var c=0;c<q.length;c++){var e=q[c];if(0<e.n)for(var f=0,g=e.n-1,n,k,l;f<=g;)if(n=f+g>>1,l=e.d[n],k=l.id.localeCompare(a),
0>k)f=n+1;else if(0<k)g=n-1;else return l}return null},getAttID:function(a){for(var c=0,e=prspdata.a.length-1,f,g;c<=e;)if(f=c+e>>1,g=prspdata.a[f].id.localeCompare(a),0>g)c=f+1;else if(0<g)e=f-1;else return prspdata.a[f];return null},getAttIndex:function(a){return prspdata.a[a]},getNumETmplts:function(){return prspdata.e.g.ts.length},getETmpltIndex:function(a){return prspdata.e.g.ts[a]},getTmpltID:function(a){for(var c=0;c<prspdata.t.length;c++)if(a==prspdata.t[c].id)return prspdata.t[c].def},getAttLgndRecs:function(a,
c,e,f){var g,n=e.length,k;switch(c.def.t){case "V":var l=function(a){for(var d=0;d<n;d++)if(g=e[d],"number"===typeof g){if(k=c.l[g],k.l==a)return k}else{k=c.l[g[0]];var f=k.z[g[1]];if(f.l==a)return f.v&&""!=f.v?f:k}return null};if(f&&""!=c.def.d){var m=[],p;a.forEach(function(a){p=l(a);null!=p&&m.push(p)});return 0<m.length?m:null}if(""!=c.def.d){for(f=0;f<a.length;f++)if(p=l(a[f]),null!=p)return p;break}else return l(a[0]);case "T":for(p=0;p<n;p++)if(g=e[p],k=c.l[g],-1!=a.indexOf(k.d))return k;break;
case "N":for(p=0;p<n;p++)if(g=e[p],k=c.l[g],"undefined"!=typeof k.d.min){if(k.d.min<=a)if("undefined"!=typeof k.d.max){if(a<=k.d.max)return k}else return k}else if(a<=k.d.max)return k;break;case "D":for(p=0;p<n;p++)if(g=e[p],k=c.l[g],"undefined"!=typeof k.d.max.y){if("undefined"!=typeof a.max&&"open"!=a.max){if(a.max.y<k.d.min.y)continue;if(a.max.y==k.d.min.y&&a.max.m&&k.d.min.m){if(a.max.m<k.d.min.m)continue;if(a.max.m==k.d.min.m&&a.max.d&&k.d.min.d&&a.max.d<k.d.min.d)continue}}if(!(a.min.y>k.d.max.y)){if(a.min.y==
k.d.max.y&&a.min.m&&k.d.max.m){if(a.min.m>k.d.max.m)continue;if(a.min.m==k.d.max.m&&a.min.d&&k.d.max.d&&a.min.d>k.d.max.d)continue}return k}}else if("undefined"!=typeof a.max){if("open"==a.max)return k;if(!(a.max.y<k.d.min.y)){if(a.max.y==k.d.min.y&&a.max.m&&k.d.min.m){if(a.max.m<k.d.min.m)continue;if(a.max.m==k.d.min.m&&a.max.d&&k.d.min.d&&a.max.d<k.d.min.d)continue}return k}}else if(!(a.min.y<k.d.min.y)){if(a.min.y==k.d.min.y&&a.min.m&&k.d.min.m){if(a.min.m<k.d.min.m)continue;if(a.min.m==k.d.min.m&&
a.min.d&&k.d.min.d&&a.min.d<k.d.min.d)continue}return k}}return null},getAttLgndVal:function(a,c,e){var f;return(f=PData.getAttLgndRecs(a,c,e,!1))?f.v:null},getVLgndVal:function(a,c){for(var e=0,f=a.x.length-1,g,n;e<=f;)if(g=e+f>>1,n=a.x[g].l.localeCompare(c),0>n)e=g+1;else if(0<n)f=g-1;else return e=a.x[g].i,"number"==typeof e?a.l[e]:a.l[e[0]].z[e[1]];return null},date3Nums:function(a,c,e){0>a||99<a?c=new Date(a,c-1,e):0==a?c=new Date(-1,c-1,e):(c=new Date(a,c-1,e),c.setUTCFullYear(("0000"+a).slice(-4)));
return c},objDate:function(a,c,e){"undefined"!=typeof a.m&&(c=a.m,"undefined"!=typeof a.d&&(e=a.d));return PData.date3Nums(a.y,c,e)},parseDate:function(a,c,e){if("open"==a)return TODAY;var f=1;"-"==a.charAt(0)&&(f=-1,a=a.substring(1));a=a.split("-");f*=parseInt(a[0]);1<a.length&&(c=parseInt(a[1]),3==a.length&&(e=parseInt(a[2])));return PData.date3Nums(f,c,e)},getRCats:function(a){var c=[];switch(a.def.t){case "N":if("undefined"==typeof a.r.min||"undefined"==typeof a.r.max)return null;var e=Math.pow(10,
a.r.g),f=a.r.min,g=0,n;for(0<a.l.length&&(n=a.l[0]);f<=a.r.max;){for(var k={l:f.toString()};g<a.l.length&&"undefined"!=typeof n.d.max&&f>n.d.max;)n=a.l[++g];k.c=0==a.l.length||f<n.d.min?"#000000":g==a.l.length?"#000000":"undefined"==typeof n.d.max||f<=n.d.max?n.v:"#000000";k.min=f;f+=e;k.max=f;c.push(k)}return c;case "D":var f=function(a){return"undefined"==typeof a.y?TODAY:l(a.y,12,31,a)},l=function(a,c,d,e){"undefined"!=typeof e.m&&(c=e.m,"undefined"!=typeof e.d&&(d=e.d));return PData.date3Nums(a,
c,d)},p=f(a.r.max),e=a.r.g,m=a.r.min.y,q=1,t=1;"undefined"!=typeof a.r.min.m&&(q=a.r.min.m,"undefined"!=typeof a.r.min.d&&(t=a.r.min.d));var v=PData.date3Nums(m,q,t),g=0,w,D;0<a.l.length&&(n=a.l[0],w=l(n.d.min.y,1,1,n.d.min),D=f(n.d.max));for(;v<=p;){k={};switch(e){case "d":k.l=m.toString()+"-"+q.toString()+"-"+t.toString();break;case "m":k.l=m.toString()+"-"+q.toString();break;case "y":case "t":case "c":k.l=m.toString()}for(;g<a.l.length&&v>D;)n=a.l[++g],g<a.l.length&&(w=l(n.d.min.y,1,1,n.d.min),
D=f(n.d.max));k.c=0==a.l.length||v<w?"#000000":g==a.l.length?"#000000":v<=D?n.v:"#000000";k.min=v;switch(e){case "d":k.max=PData.date3Nums(m,q,t+1);t++;break;case "m":k.max=PData.date3Nums(m,q+1,t);q++;break;case "y":k.max=PData.date3Nums(m+1,q,t);m++;break;case "t":k.max=PData.date3Nums(m+10,q,t);m+=10;break;case "c":k.max=PData.date3Nums(m+100,q,t),m+=100}c.push(k);v=PData.date3Nums(m,q,t)}return c}},getRCnts:function(a,c,e){},orderTBy:function(a,c,e){function f(a){return a}function g(a){return a[0]}
function n(a){var c=1,d=1;"undefined"!=typeof a.min.m&&(c=a.m,"undefined"!=typeof a.min.d&&(d=a.d));return PData.date3Nums(a.min.y,c,d)}var k,l;switch(a.def.t){case "T":k=f;l="~";break;case "V":k=g;l="~";break;case "N":k=f;l=a.r.max;break;case "D":k=n,l=TODAY}var m=[],p=c.t[e];e=q[e];for(var t=0,w,v;t<p.n;)w=c.s[p.i+t++],v=e.d[w-e.i],v=v.a[a.id],"undefined"==typeof v?m.push({i:w,v:l}):m.push({i:w,v:k(v)});switch(a.def.t){case "T":case "V":m.sort(function(a,c){return a.v.localeCompare(c.v)});break;
case "D":case "N":m.sort(function(a,c){return a.v-c.v})}return m},getVizIndex:function(a){return prspdata.e.vf[a]},ready:function(){return w}}}();
jQuery(document).ready(function(a){function c(){PState.set(PSTATE_PROCESS);g.clearSel();n&&n.clearSel();null==A&&(A=PData.newIndexStream(!0));y=A;var a=!1,c,d;for(c=0;c<k.length;c++)if(d=k[c],a||d.f.isDirty(null)){a=!0;d.f.evalPrep();for(var e=PData.newIndexStream(!1),f=0,h,l,m=0,p=y.t[0],q=0;f<y.l;){for(;0==p.n||p.i+p.n==f;)e.t.push({i:e.l-q,n:q}),q=0,p=y.t[++m];h=y.s[f++];l=PData.getRecByIndex(h);d.f.eval(l)&&(e.s[e.l++]=h,q++)}for(;m++<PData.getNumETmplts();)e.t.push({i:e.l-q,n:q}),q=0;d.f.isDirty(!1);
y=d.f.out=e}else y=d.f.out;PState.set(PSTATE_BUILD);g.showStream(y);n&&n.showStream(y);jQuery("#btn-recompute").removeClass("pulse")}function e(a){var c=jQuery("#annote");c.text(a);0<a.length?(jQuery("#btn-annote").button("enable"),c.show()):(jQuery("#btn-annote").button("disable"),c.hide())}function f(a){var c=_.find(prspdata.p,function(c){return a==c.id});return c?c:null==B||0==v.length?null:(c=_.find(v,function(c){return a==c.id}))?c:null}function l(a){var c=jQuery("input[name=save-prspctv-dest]:checked").val();
if(""==c)return null;var d=jQuery("#save-psrctv-note").val(),d=d.replace(/"/,""),e=jQuery("#save-psrctv-lbl").val().trim(),e=e.replace(/"/,""),f=!jQuery("#selector-v0").prop("disabled")&&jQuery("#selector-v0").is(":checked"),h=!jQuery("#selector-v1").prop("disabled")&&jQuery("#selector-v1").is(":checked"),l={f:[],s:null,a0:f,a1:h,v0:{l:g.title(),s:g.getState()},v1:null};k.forEach(function(a){l.f.push({id:a.attID,r:a.f.isReq(!1),s:a.f.getState()})});x&&(l.s={id:z,s:x.getState()});n&&(l.v1={l:n.title(),
s:n.getState()});var m={id:a,l:e,n:d,s:l};"local"==c?(v.push(m),B.setItem(prspdata.e.id,JSON.stringify(v))):"server"==c&&jQuery.ajax({type:"POST",url:prspdata.ajax_url,data:{action:"prsp_save_prspctv",id:a,l:e,x:prspdata.e.id,n:d,s:JSON.stringify(l)},success:function(a,c,d){prspdata.p.push(m)},error:function(a,c,d){alert(d)}});return c}function m(){var a,c=[],d=!1;(function(){var a=jQuery("#prspctv-mlist");a.empty();v.forEach(function(c){a.append('<li data-type="l" data-id="'+c.id+'"><span class="label">'+
c.l+'</span> <button class="del">'+dlText.del+'</button> <button class="edit">'+dlText.edit+"</button></li>")});for(var d=0;d<B.length;d++){var e=B.key(d);if(e!=prspdata.e.id){var f=B.getItem(e);c.push({id:e,ps:JSON.parse(f)})}}c.forEach(function(c,d){c.ps.forEach(function(e){a.append('<li data-type="x" data-xid="'+c.id+'" data-xindex="'+d+'" data-id="'+e.id+'"><i class="label">'+e.l+'</i> <button class="del">'+dlText.del+'</button> <button class="edit">'+dlText.edit+"</button></li>")})})})();jQuery("#prspctv-mlist").click(function(a){if("BUTTON"==
a.target.nodeName){var e=jQuery(a.target).hasClass("del"),f=jQuery(a.target).parent(),g=f.data("type"),h=f.data("id");if(e){switch(g){case "l":a=v.findIndex(function(a){return h==a.id});-1!=a&&(v.splice(a,1),0==v.length?B.removeItem(prspdata.e.id):B.setItem(prspdata.e.id,JSON.stringify(v)));break;case "x":a=f.data("xindex"),e=c[a],a=e.ps.findIndex(function(a){return h==a.id}),-1!=a&&(e.ps.splice(a,1),d=!0)}f.remove()}else{var k;switch(g){case "l":k=_.find(v,function(a){return h==a.id});break;case "x":a=
f.data("xindex"),e=c[a],k=_.find(e.ps,function(a){return h==a.id})}jQuery("#edit-psrctv-lbl").val(k.l);jQuery("#edit-psrctv-note").val(k.n);var l=jQuery("#dialog-edit-prsrctv").dialog({width:340,height:270,modal:!0,buttons:[{text:dlText.ok,click:function(){k.l=jQuery("#edit-psrctv-lbl").val();k.n=jQuery("#edit-psrctv-note").val();f.find(".label").text(k.l);"x"==g?d=!0:B.setItem(prspdata.e.id,JSON.stringify(v));l.dialog("close")}},{text:dlText.cancel,click:function(){l.dialog("close")}}]})}}});a=jQuery("#dialog-manage-prsrctv").dialog({width:450,
height:350,modal:!0,buttons:[{text:dlText.ok,click:function(){d&&c.forEach(function(a){0<a.ps.length?B.setItem(a.id,JSON.stringify(a.ps)):B.removeItem(a.id)});jQuery("#prspctv-mlist").off("click");a.dialog("close")}}]})}function p(a){window.location.href=prspdata.e.g.hurl;a.preventDefault()}function q(a){jQuery(this).parent().next().slideToggle(400);a.preventDefault()}function t(a){if(a=jQuery(this).closest("div.filter-instance")){var c=a.data("id");a=a.find("input.req-att").is(":checked");if(c&&
""!=c){var d;d=k.find(function(a){return a.id==c});null==d?alert("Bad Filter ID "+c):d.f.isReq(!0,a)}}}function w(a){var c=jQuery(this).closest("div.filter-instance"),d=c.data("id"),e,f;e=k.findIndex(function(a){return a.id==d});-1==e?alert("Bad Filter ID "+d):(f=k[e].f,f.teardown(),k.splice(e,1),e>=k.length?(e=0==k.length?A:k[e-1].out,g.setStream(e),n&&n.setStream(e),jQuery("#btn-recompute").addClass("pulse")):k[e].f.isDirty(!0),c.remove(),a.preventDefault())}function d(){null!=x&&(x.teardown(),
jQuery('div.filter-instance[data-id="0"]').empty(),x=null)}function h(a,c,e){var f;if(e)d(),f=0;else{do f=Math.floor(1E3*Math.random()+1),-1!=k.findIndex(function(a){return a.id==f})&&(f=-1);while(-1==f)}var g,h=PData.getAttID(a);switch(h.def.t){case "V":g=new PFilterVocab(f,h,c);break;case "T":g=new PFilterText(f,h,c);break;case "N":g=new PFilterNum(f,h,c);break;case "D":g=new PFilterDates(f,h,c)}e?(x=g,z=a,a=_.template(document.getElementById("dltext-selector-head").innerHTML),c=jQuery('div.filter-instance[data-id="0"]'),
c.append(a({title:g.title()})),c.find("button.btn-filter-del").button({text:!1,icons:{primary:"ui-icon-trash"}}).click(d)):(k.push({id:f,attID:a,f:g,out:null}),a=_.template(document.getElementById("dltext-filter-head").innerHTML),jQuery("#filter-instances").append(a({newID:f,title:g.title(),check:c?'checked="checked"':""})),c=jQuery('div.filter-instance[data-id="'+f+'"]'),c.find("button.btn-filter-toggle").button({text:!1,icons:{primary:"ui-icon-carat-2-n-s"}}).click(q),c.find("button.btn-filter-del").button({text:!1,
icons:{primary:"ui-icon-trash"}}).click(w),c.find("input.req-att").click(t),jQuery("#btn-recompute").addClass("pulse"));g.setup();return g}function r(){PState.set(PSTATE_PROCESS);var a=[],c=!1;if(null!=x&&null!=y){x.evalPrep();for(var d=0,e,f;d<y.l;)e=y.s[d++],f=PData.getRecByIndex(e),x.eval(f)&&a.push(e);x.isDirty(!1)}PState.set(PSTATE_BUILD);jQuery("#selector-v0").is(":checked")&&(c=g.setSel(a));jQuery("#selector-v1").is(":checked")&&n&&(c&&(a=a.slice(0)),n.setSel(a))}function u(a){function l(a){return prspdata.e.vf.findIndex(function(c){return a==
c.l})}a=f(a);if(null==a)return!1;PState.set(PSTATE_PROCESS);k.forEach(function(a){a.f.teardown()});k=[];jQuery("#filter-instances").empty();a.s.f.forEach(function(a){h(a.id,a.r,!1).setState(a.s)});jQuery("#filter-instances").hide();d();null!=a.s.s&&(h(a.s.s.id,!0,!0),x.setState(a.s.s.s));jQuery("#selector-instance").hide();var m;m=l(a.s.v0.l);g?g.setViz(m,!1):(g=PViewFrame(0),g.initDOM(m));g.setState(a.s.v0.s);null!=a.s.v1?(m=l(a.s.v1.l),n?(n.setViz(m,!1),n.setState(a.s.v1.s)):(n=PViewFrame(1),n.initDOM(m),
n.setState(a.s.v1.s),g.resize())):n&&(n=null,jQuery("#view-frame-1").remove(),jQuery("#selector-v1").prop("disabled",!0),g.resize());e(a.n);jQuery("#selector-v0").prop("checked",a.s.a0);jQuery("#selector-v1").prop("checked",a.s.a1);PData.ready()&&A&&(c(),x&&r());return!0}var g,n,k=[],x=null,z,A,y,B=null,v=[];jQuery("body").addClass("waiting");PState.init();PMapHub.init(prspdata.m);(function(){function a(d,e){c=document.getElementById(d).innerHTML;dlText[e]=c.trim()}var c;a("dltext-showhideall","sha");
a("dltext-ok","ok");a("dltext-cancel","cancel");a("dltext-seerec","seerec");a("dltext-close","close");a("dltext-add","add");a("dltext-manage","manage");a("dltext-delete","del");a("dltext-edit","edit");c=document.getElementById("dltext-month-names").innerHTML;months=c.trim().split("|");(c=document.getElementById("dltext-d3-local"))&&(c=c.innerHTML)&&1<c.length&&(localD3=d3.locale(JSON.parse(c)).timeFormat.multi([["%H:%M",function(a){return a.getMinutes()}],["%H:%M",function(a){return a.getHours()}],
["%a %d",function(a){return a.getDay()&&1!=a.getDate()}],["%b %d",function(a){return 1!=a.getDate()}],["%B",function(a){return a.getMonth()}],["%Y",function(){return!0}]]))})();"/"!=prspdata.site_url.charAt(prspdata.site_url.length-1)&&(prspdata.site_url+="/");xhbtURL=window.location.pathname;xhbtURL=xhbtURL.replace(/\&*prspctv=[\w\-]+/,"");xhbtURL=window.location.protocol+"//"+window.location.host+"/"+xhbtURL;""!=prspdata.e.g.l&&jQuery("#title").text(prspdata.e.g.l);try{var F=window.localStorage;
F.setItem("__storage_test__","__storage_test__");F.removeItem("__storage_test__");var D=F.getItem(prspdata.e.id),B=F;0<D.length&&(v=JSON.parse(D))}catch(C){}jQuery("#btn-about").button({icons:{primary:"ui-icon-info"},text:!1}).click(function(a){var c;c=jQuery("#dialog-about").dialog({height:250,width:350,modal:!0,buttons:[{text:dlText.ok,click:function(){c.dialog("close")}}]});a.preventDefault()});jQuery("#btn-recompute").button({icons:{primary:"ui-icon-refresh"},text:!1}).click(function(a){c();PState.set(PSTATE_READY);
a.preventDefault()});jQuery("#btn-set-layout").button({icons:{primary:"ui-icon-newwin"},text:!1}).click(function(){PState.set(PSTATE_BUILD);null!=n?(n=null,jQuery("#view-frame-1").remove(),jQuery("#selector-v1").prop("disabled",!0)):(n=PViewFrame(1),n.initDOM(0),n.showStream(y),jQuery("#selector-v1").prop("disabled",!1));g.resize();PState.set(PSTATE_READY)});jQuery("#btn-show-prspctv").button({icons:{primary:"ui-icon-image"},text:!1}).click(function(a){var c=jQuery("#prspctv-slist");c.empty();prspdata.p.forEach(function(a){c.append('<li data-src="server" data-id="'+
a.id+'">'+a.l+"</li>")});v.forEach(function(a){c.append('<li data-src="local" data-id="'+a.id+'">'+a.l+"</li>")});var d=[{text:dlText.ok,click:function(){var a=c.find("li.selected");a.length&&(a=a.data("id"),u(a),PState.set(PSTATE_READY));e.dialog("close")}},{text:dlText.cancel,click:function(){e.dialog("close")}}];B&&d.push({text:dlText.manage,click:function(){e.dialog("close");m()}});var e=jQuery("#dialog-show-prsrctv").dialog({width:350,height:350,modal:!0,buttons:d});a.preventDefault()});jQuery("#btn-save-prspctv").button({icons:{primary:"ui-icon-pencil"},
text:!1}).click(function(a){var c,d=/[^\w\-]/;jQuery("#save-psrctv-id").val("");jQuery("#save-psrctv-lbl").val("");jQuery("#save-psrctv-note").val("");B||jQuery("#save-prspctv-d-1").attr("disabled","disabled");prspdata.add_prspctv||jQuery("#save-prspctv-d-2").attr("disabled","disabled");c=jQuery("#dialog-save-prsrctv").dialog({width:340,height:350,modal:!0,buttons:[{text:dlText.ok,click:function(){var a=jQuery("#save-psrctv-id").val().trim(),e=a.match(d);0==a.length||20<a.length||e?e="#dialog-prspctv-id-badchars":
f(a)&&(e="#dialog-prspctv-id-used");if(e)var g=jQuery(e).dialog({width:320,height:210,modal:!0,buttons:[{text:dlText.ok,click:function(){g.dialog("close")}}]});else if(e=l(a),c.dialog("close"),"server"==e){a=xhbtURL+"/?prspctv="+a;jQuery("#save-psrctv-embed").val(a);var h=jQuery("#dialog-prspctv-url").dialog({width:480,height:200,modal:!0,buttons:[{text:dlText.ok,click:function(){h.dialog("close")}}]})}}},{text:dlText.cancel,click:function(){c.dialog("close")}}]});a.preventDefault()});jQuery("#btn-annote").button({icons:{primary:"ui-icon-comment"},
text:!1}).click(function(a){jQuery("#annote").toggle("slide",{direction:"right"});a.preventDefault()});0<prspdata.e.g.hbtn.length&&0<prspdata.e.g.hurl.length?(jQuery("#home-title").text(prspdata.e.g.hbtn),jQuery("#btn-home").button({icons:{primary:"ui-icon-home"},text:!1}).click(p)):jQuery("#btn-home").remove();jQuery("#filter-list").click(function(a){"LI"==a.target.nodeName&&(jQuery("#filter-list li").removeClass("selected"),jQuery(a.target).addClass("selected"))});jQuery("#prspctv-slist").click(function(a){"LI"==
a.target.nodeName&&(jQuery("#prspctv-list li").removeClass("selected"),jQuery(a.target).addClass("selected"))});jQuery("#btn-new-filter").button({icons:{primary:"ui-icon-search"},text:!1}).click(function(a){jQuery("#filter-list li").removeClass("selected");var c;c=jQuery("#dialog-new-filter").dialog({height:300,width:350,modal:!0,buttons:[{text:dlText.add,click:function(){var a=jQuery("#filter-list li.selected");a.length&&(jQuery("#filter-instances").show(400),h(a.data("id"),!0,!1));c.dialog("close")}},
{text:dlText.cancel,click:function(){c.dialog("close")}}]});a.preventDefault()});jQuery("#btn-toggle-filters").button({icons:{primary:"ui-icon-arrow-2-n-s"},text:!1}).click(function(a){jQuery("#filter-instances").slideToggle(400);a.preventDefault()});jQuery("#btn-new-selector").button({icons:{primary:"ui-icon-search"},text:!1}).click(function(a){jQuery("#filter-list li").removeClass("selected");var c;c=jQuery("#dialog-new-filter").dialog({height:300,width:350,modal:!0,buttons:[{text:dlText.add,click:function(){var a=
jQuery("#filter-list li.selected");a.length&&(jQuery("#selector-instance").show(400),h(a.data("id"),!0,!0));c.dialog("close")}},{text:dlText.cancel,click:function(){c.dialog("close")}}]});a.preventDefault()});jQuery("#btn-toggle-selector").button({icons:{primary:"ui-icon-arrow-2-n-s"},text:!1}).click(function(a){jQuery("#selector-instance").slideToggle(400);a.preventDefault()});jQuery("#btn-apply-selector").button({icons:{primary:"ui-icon-arrowreturn-1-e"},text:!1}).click(function(a){r();PState.set(PSTATE_READY);
a.preventDefault()});jQuery("#btn-inspect-left").button({icons:{primary:"ui-icon-arrowthick-1-w"},text:!1});jQuery("#btn-inspect-right").button({icons:{primary:"ui-icon-arrowthick-1-e"},text:!1});(function(){prspdata.a.forEach(function(a){switch(a.def.t){case "V":case "T":case "N":case "D":jQuery("#filter-list").append('<li data-id="'+a.id+'">'+a.def.l+"</li>")}})})();0!=prspdata.show_prspctv.length&&u(prspdata.show_prspctv)||(g=PViewFrame(0),g.initDOM(0),e(""));jQuery(window).resize(function(){g&&
g.resize();n&&n.resize()});jQuery("body").on("prospect",function(a,d){d.pstate==PSTATE_PROCESS&&(PState.set(PSTATE_PROCESS),c(),x&&r(),PState.set(PSTATE_READY),jQuery("body").removeClass("waiting"))});PState.set(PSTATE_LOAD);PData.init()});function onYouTubeIframeAPIReady(){widgetData.ytCall&&widgetData.ytCall()};