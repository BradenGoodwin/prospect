Array.prototype.findIndex||(Array.prototype.findIndex=function(a,c){if(null==this)throw new TypeError("Array.prototype.find called on null or undefined");if("function"!==typeof a)throw new TypeError("predicate must be a function");for(var d=Object(this),f=d.length>>>0,k,m=0;m<f;m++)if(k=d[m],a.call(c,k,m,d))return m;return-1});
var EVENT_INSTANT=1,EVENT_F_START=2,EVENT_F_END=4,PSTATE_INIT=0,PSTATE_LOAD=1,PSTATE_PROCESS=2,PSTATE_BUILD=3,PSTATE_UPDATE=4,PSTATE_READY=5,D3FG_BAR_WIDTH=25,D3FG_MARGINS={top:4,right:7,bottom:22,left:30},D3SC_MARGINS={top:30,right:5,bottom:5,left:40},V_FLAG_LGND=1,V_FLAG_SEL=2,V_FLAG_LOC=4,V_FLAG_SLGND=8,V_FLAG_SET=16,V_FLAG_VSCRL=32,V_FLAG_HSCRL=64,parseTC=/(\d\d)\:(\d\d)\:(\d\d)\.(\d\d?)/,mnthDays=[31,28,31,30,31,30,31,31,30,31,30,31],TODAY=new Date,localD3,months,dlText={},xhbtURL,widgetData=
{ytLoaded:!1,ytCall:null,ytCode:null,timer:null,extract:null,sTime:null,eTime:null,playing:!1,widget:null,xscriptOn:!1,tcArray:null,tcIndex:-1},PState=function(){var a=PSTATE_INIT,c;return{init:function(){c=document.getElementById("dltext-pstates").innerHTML.trim().split("|")},set:function(d){if(d!=a){var f=jQuery("#pstate");a==PSTATE_READY?f.addClass("attn"):d==PSTATE_READY&&f.removeClass("attn");f.text(c[d-1]);a=d}}}}();
function PVizModel(a,c){this.vFrame=a;this.frameID=a.getFrameID()+" div.viz-content div.viz-result";this.settings=c;this.recSel=[]}PVizModel.prototype.flags=function(){return 0};PVizModel.prototype.isSel=function(a){return-1!=_.indexOf(this.recSel,a,!0)};PVizModel.prototype.getSel=function(){return this.recSel};
PVizModel.prototype.toggleSel=function(a){var c=this.recSel.length,d=_.sortedIndex(this.recSel,a);if(this.recSel[d]==a)return this.recSel.splice(d,1),0<c&&0==this.recSel.length&&this.vFrame.selBtns(!1),!1;this.recSel.splice(d,0,a);0==c&&0<this.recSel.length&&this.vFrame.selBtns(!0);return!0};PVizModel.prototype.clearSel=function(){this.recSel=[]};PVizModel.prototype.getLocAtts=function(a){return[]};PVizModel.prototype.getFeatureAtts=function(a){return[]};PVizModel.prototype.teardown=function(){};
PVizModel.prototype.resize=function(){};PVizModel.prototype.optionsModal=function(){};PVizModel.prototype.getState=function(){return{}};PVizModel.prototype.setState=function(a){};var VizMap=function(a,c){PVizModel.call(this,a,c)};VizMap.prototype=Object.create(PVizModel.prototype);VizMap.prototype.constructor=VizMap;VizMap.prototype.flags=function(){return V_FLAG_LGND|V_FLAG_SEL|V_FLAG_LOC};VizMap.prototype.getLocAtts=function(a){return null!=a?this.settings.cAtts[a]:this.settings.cAtts};
VizMap.prototype.getFeatureAtts=function(a){return null!=a?this.settings.lgnds[a]:this.settings.lgnds};
VizMap.prototype.setup=function(){var a=this,c=parseFloat(this.settings.clat),d=parseFloat(this.settings.clon),f;f="string"==typeof this.settings.zoom?parseInt(this.settings.zoom):this.settings.zoom;var k=this.vFrame.getIndex();jQuery(this.frameID).append('<div id="l-map-'+k+'" class="max-size"></div>');this.lMap=L.map("l-map-"+k,{zoomControl:!1}).setView([c,d],f);var m=L.control.layers();m.addTo(this.lMap);this.baseMap=PMapHub.createMapLayer(this.settings.base,1,this.lMap,m);var n;this.mapLayers=
[];_.each(this.settings.lyrs,function(c){n=c.o||1;c=PMapHub.createMapLayer(c.lid,n,a.lMap,m);a.mapLayers.push(c)});var k=this.vFrame.getIndex(),q=_.template(document.getElementById("dltext-v-map").innerHTML);jQuery("#view-frame-"+k+" div.view-control-bar").append(q({vi:k}));jQuery("#map-zoom-"+k).button({text:!1,icons:{primary:"ui-icon-plus"}}).click(function(){a.lMap.zoomIn()});jQuery("#map-unzoom-"+k).button({text:!1,icons:{primary:"ui-icon-minus"}}).click(function(){a.lMap.zoomOut()});jQuery("#map-reset-"+
k).button({text:!1,icons:{primary:"ui-icon-arrowrefresh-1-w"}}).click(function(){a.lMap.setView([c,d],f)});this.markerLayer=k=L.featureGroup();k.options=k.options||{};k.options.layerName="Markers";k.addTo(this.lMap);this.lineLayer=k=L.featureGroup();k.addTo(this.lMap);k=PData.getNumETmplts();this.tLCnt=new Uint16Array(k)};
VizMap.prototype.render=function(a){function c(e){if(e.target&&e.target.options){var a=e.target.options._aid,l=d.toggleSel(a);e=PData.aIndex2Tmplt(a);1<d.tLCnt[e]?(PState.set(PSTATE_UPDATE),f.eachLayer(function(e){e.options._aid==a&&(l?e.setStyle({color:"#ff0000"}):e.setStyle({color:"#000"}))}),PState.set(PSTATE_READY)):l?this.setStyle({color:"#ff0000"}):this.setStyle({color:"#000"})}}var d=this,f=this.markerLayer;0<this.recSel.length&&(this.recSel=[]);f.clearLayers();var k=this.lineLayer;k.clearLayers();
var m=PData.getNumETmplts(),n=0,q,v=0,A,e,l,p,x,g,r,h,z,B,y,w,t,u,D,F,E;u=this.settings.min;"string"==typeof u&&(u=parseInt(u));v=this.settings.max;"string"==typeof v&&(v=parseInt(v));D=v-u;for(n=0;n<m;n++)this.tLCnt[n]=0;for(var C,n=0;n<m;n++)if("disable"!=this.settings.pAtts[n]){C=[];break}n=0;v=-1;a:for(;n<a.l;){if(null==g){do{if(++v==m)break a;A=a.t[v]}while(0==A.n||A.i+A.n==n);g=this.vFrame.getSelLocAtts(v);if(0==g.length){g=null;continue}r=d.vFrame.getSelFeatAtts(v);if(0==r.length){g=null;continue}d.tLCnt[v]=
g.length;p=d.vFrame.getSelLegend(v);x=PData.getAttID(p);h=d.settings.pAtts[v];e=d.settings.lClrs[v];if(w=d.settings.sAtts[v])t=PData.getAttID(w),"number"==typeof t.r.min&&"number"==typeof t.r.max?(F=t.r.min,E=t.r.max-F):w=null}q=a.s[n];l=PData.getRecByIndex(q);var G;C&&(G={id:l.id,c:[],p:l.a[h],l:e});g.forEach(function(e){if(z=l.a[e])if(B=l.a[p],"undefined"!=typeof B&&(B=PData.getAttLgndVal(B,x,r))){if("number"==typeof z[0])w?(t=l.a[w],t="undefined"!=typeof t?Math.floor((t-F)*D/E)+u:u):t=u,y=L.circleMarker(z,
{_aid:q,weight:1,radius:t,fillColor:B,color:"#000",opacity:1,fillOpacity:1}),G&&G.c.push(z);else if(y=2==z.length?L.polyline(z,{_aid:q,weight:1,fillColor:B,color:"#000",opacity:1,fillOpacity:1}):L.polygon(z,{_aid:q,weight:1,fillColor:B,color:"#000",opacity:1,fillOpacity:1}),G){var a=[0,0];z.forEach(function(e){a[0]+=e[0];a[1]+=e[1]});a[0]/=z.length;a[1]/=z.length;G.c.push(a)}y.on("click",c);f.addLayer(y)}});G&&0<G.c.length&&C.push(G);++n==A.i+A.n&&(g=null)}if(C){C.sort(function(e,a){return PData.strcmp(a.id,
e.id)});var H=[];C.forEach(function(e){e.p&&e.p.forEach(function(a){n=_.sortedIndex(C,{id:a},"id");if(n<C.length){var l=C[n];l.id==a&&e.c.forEach(function(a){l.c.forEach(function(l){a[0]==l[0]&&a[1]==l[1]||H.push({p:[a,l],c:e.l})})})}})});H.forEach(function(e){k.addLayer(L.polyline(e.p,{color:e.c,weight:2}))})}};VizMap.prototype.teardown=function(){var a=this.vFrame.getIndex();jQuery("#view-frame-"+a+" div.view-control-bar div.iconbar").remove()};VizMap.prototype.resize=function(){this.lMap.invalidateSize(!1)};
VizMap.prototype.clearSel=function(){0<this.recSel.length&&(this.recSel=[],this.markerLayer&&this.markerLayer.eachLayer(function(a){a.setStyle({color:"#000"})}))};VizMap.prototype.setSel=function(a){var c=this;this.recSel=a;this.markerLayer&&this.markerLayer.eachLayer(function(a){c.isSel(a.options._aid)?a.setStyle({color:"#ff0000"}):a.setStyle({color:"#000"})})};VizMap.prototype.getState=function(){return{c:this.lMap.getCenter(),z:this.lMap.getZoom(),l:this.vFrame.getLgndSels()}};
VizMap.prototype.setState=function(a){this.lMap.setView(a.c,a.z);this.vFrame.setLgndSels(a.l)};var VizCards=function(a,c){PVizModel.call(this,a,c)};VizCards.prototype=Object.create(PVizModel.prototype);VizCards.prototype.constructor=VizCards;VizCards.prototype.flags=function(){return V_FLAG_LGND|V_FLAG_SEL|V_FLAG_VSCRL};VizCards.prototype.getFeatureAtts=function(a){return null!=a?this.settings.lgnds[a]:this.settings.lgnds};
VizCards.prototype.setup=function(){var a=this;jQuery(this.frameID).on("click.vf",function(c){if("DIV"==c.target.nodeName&&(c=jQuery(c.target).closest("div.card"),1==c.size())){var d=c.data("ai");null!=d&&(a.toggleSel(d)?c.addClass("obj-sel"):c.removeClass("obj-sel"))}})};
VizCards.prototype.render=function(a){var c=PData.getNumETmplts(),d=0,f,k=-1,m,n,q=!0,v,A,e,l,p,x,g,r,h,z,B,y=jQuery(this.frameID);y.empty();0<this.recSel.length&&(this.recSel=[]);for(var w,t="w"+this.settings.w+" h"+this.settings.h;d<a.l;){if(q){do{if(++k==c)return;n=a.t[k]}while(0==n.n||n.i+n.n==d);m=PData.getETmpltIndex(k);f=PData.getTmpltID(m);m=this.vFrame.getSelFeatAtts(k);if(0==m.length){q=!0;continue}y.append('<div class="template-label">'+f.l+'</div><div class="cards" data-ti="'+k+'"></div>');
w=jQuery('div.cards[data-ti="'+k+'"]');v=this.vFrame.getSelLegend(k);A=PData.getAttID(v);e=this.settings.iAtts[k];g=this.settings.cnt[k];q=!1}f=a.s[d];l=PData.getRecByIndex(f);r=l.a[v];"undefined"!=typeof r&&(p=PData.getAttLgndRecs(r,A,m,!1))&&(z=this.settings.lOn?'<div class="card-title">'+l.l+"</div>":"",x=!1,h="",g&&0<g.length&&(B=p.b?' style="color:black"':"",g.forEach(function(e){if(r=l.a[e])if(r=PData.procAttTxt(e,r))x=!0,h+=r+"<br/>"})),h=(r=l.a[e])?x?'<div class="card-body"><img src="'+r+
'"/><div class="card-cnt"'+B+">"+h+"</div></div>":'<div class="card-body"><img class="full" src="'+r+'"/></div>':'<div class="card-body"><div class="card-cnt"'+B+">"+h+"</div>",w.append('<div class="card '+t+'" style="background-color:'+p.v+'" data-ai="'+f+'">'+z+h+"</div>"));++d==n.i+n.n&&(q=!0)}};VizCards.prototype.teardown=function(){jQuery(this.frameID).off("click.vf")};
VizCards.prototype.setSel=function(a){var c=this,d,f;this.recSel=a;jQuery(this.frameID).find("div.card").each(function(){f=jQuery(this);d=f.data("ai");null!=d&&(c.isSel(d)?f.addClass("obj-sel"):f.removeClass("obj-sel"))})};VizCards.prototype.clearSel=function(){0<this.recSel.length&&(this.recSel=[],jQuery(this.frameID).find("div.card").removeClass("obj-sel"))};VizCards.prototype.getState=function(){return{l:this.vFrame.getLgndSels()}};VizCards.prototype.setState=function(a){this.vFrame.setLgndSels(a.l)};
var VizPinboard=function(a,c){PVizModel.call(this,a,c)};VizPinboard.prototype=Object.create(PVizModel.prototype);VizPinboard.prototype.constructor=VizPinboard;VizPinboard.prototype.flags=function(){return V_FLAG_LGND|V_FLAG_SEL|V_FLAG_LOC};VizPinboard.prototype.getLocAtts=function(a){return null!=a?[this.settings.cAtts[a]]:[this.settings.cAtts]};VizPinboard.prototype.getFeatureAtts=function(a){return null!=a?this.settings.lgnds[a]:this.settings.lgnds};
VizPinboard.prototype.setup=function(){var a=this.settings;PData.getNumETmplts();this.xScale=d3.scale.linear().domain([0,a.iw-1]).rangeRound([0,a.dw-1]);this.yScale=d3.scale.linear().domain([0,a.ih-1]).range([0,a.dh-1]);this.xAxis=d3.svg.axis().scale(this.xScale).orient("top");this.yAxis=d3.svg.axis().scale(this.yScale).orient("left");var c=d3.select(this.frameID).append("svg").attr("width",a.dw+30+3).attr("height",a.dh+30+2),d=c.append("defs");d.append("marker").attr("id","arrowhead").attr("refX",
9).attr("refY",2).attr("markerWidth",6).attr("markerHeight",4).attr("orient","auto").append("path").attr("d","M 0,0 V 4 L6,2 Z");d=d.append("g").attr("id","pin");d.append("path").attr("d","M36.439,12.646c0-6.919-5.608-12.527-12.528-12.527S11.384,5.727,11.384,12.646c0,9.913,12.527,24.582,12.527,24.582 S36.439,22.508,36.439,12.646z M17.733,11.898c0-3.413,2.767-6.179,6.179-6.179s6.179,2.766,6.179,6.179 c0,3.413-2.767,6.179-6.179,6.179S17.733,15.311,17.733,11.898z");d.append("circle").attr("cx","23.911").attr("cy",
"11.898").attr("r","3.038");d.append("path").attr("d","M30.994,32.87c-1.021,1.476-1.979,2.761-2.777,3.793c7.916,0.476,13.104,2.185,15.034,3.456 c-2.261,1.491-8.979,3.587-19.338,3.587c-10.358,0-17.077-2.097-19.338-3.587c1.93-1.271,7.114-2.979,15.022-3.455 c-0.8-1.032-1.759-2.316-2.781-3.792C7.075,33.831,0,36.713,0,40.118c0,4.19,10.707,7.588,23.913,7.588 c13.207,0,23.912-3.396,23.912-7.588C47.827,36.711,40.744,33.828,30.994,32.87z");this.chart=c.append("g").attr("transform","translate(30,30)");this.chart.append("g").attr("class",
"x axis").call(this.xAxis);this.chart.append("g").attr("class","y axis").call(this.yAxis);this.chart.append("image").attr("xlink:href",a.img).attr("x",0).attr("y",0).attr("height",a.dh).attr("width",a.dw);this.chart.on("click",function(){});this.gRecs=this.chart.append("g").attr("id","recs")};
VizPinboard.prototype.render=function(a){var c=this;this.gRecs.selectAll("svg.recobj").remove();0<this.recSel.length&&(this.recSel=[]);var d=PData.getNumETmplts(),f,k,m=0,n,q,v,A,e,l,p,x,g,r;for(f=0;f<d;f++)if("disable"!=this.settings.pAtts[f]){r=[];break}f=0;m=-1;a:for(;f<a.l;){if(null==e){do{if(++m==d)break a;n=a.t[m]}while(0==n.n||n.i+n.n==f);e=this.vFrame.getSelLocAtts(m);if(0==e.length){e=null;continue}e=e[0];l=c.vFrame.getSelFeatAtts(m);if(0==l.length){e=null;continue}v=c.vFrame.getSelLegend(m);
A=PData.getAttID(v);p=c.settings.pAtts[m]}k=a.s[f];q=PData.getRecByIndex(k);var h;r&&(h={id:q.id,c:null,p:q.a[p]});if(x=q.a[e])g=q.a[v],"undefined"!=typeof g&&(g=PData.getAttLgndVal(g,A,l))&&"number"==typeof x[0]&&(nodes.push({ai:k,id:q.id,v:g,x:x[0]+-12,y:x[1]+-20,w:24,h:24}),h&&(h.c=x));h&&0<h.c.length&&r.push(h);++f==n.i+n.n&&(e=null)}this.gRecs.selectAll("svg.recobj").data(nodes).enter().append("svg").attr("class","recobj").attr("x",function(e){return c.xScale(e.x)}).attr("y",function(e){return c.yScale(e.y)}).attr("width",
function(e){return c.xScale(e.w)}).attr("height",function(e){return c.yScale(e.h)}).attr("viewBox","0 0 48 48").attr("data-ai",function(e){return e.ai}).on("click",function(e,a){var l=c.toggleSel(e.ai);d3.select(this).classed("obj-sel",l)}).append("use").attr("xlink:href","#pin").attr("fill",function(e){return e.v})};VizPinboard.prototype.clearSel=function(){0<this.recSel.length&&(this.recSel=[],this.gRecs.selectAll("svg.recobj").classed("obj-sel",!1))};
VizPinboard.prototype.setSel=function(a){var c=this;this.recSel=a;this.gRecs.selectAll("svg.recobj").classed("obj-sel",function(a){return c.isSel(a.ai)})};
VizPinboard.prototype.optionsModal=function(){var a=jQuery("#dialog-opacities div.layer-list");a.empty();var c=jQuery('<div data-i="-1"><input type="checkbox" checked="checked"> Base Image <input type=range class="op-slider" min=0 max=100 value=90 step=5></div>');c.find(".op-slider").on("change",function(){jQuery(this).parent().data("i")});a.append(c);var d=jQuery("#dialog-map-opacities").dialog({height:300,width:320,modal:!0,buttons:[{text:dlText.ok,click:function(){d.dialog("close")}},{text:dlText.cancel,
click:function(){d.dialog("close")}}]})};VizPinboard.prototype.getState=function(){return{l:this.vFrame.getLgndSels()}};VizPinboard.prototype.setState=function(a){this.vFrame.setLgndSels(a.l)};var VizTime=function(a,c){PVizModel.call(this,a,c)};VizTime.prototype=Object.create(PVizModel.prototype);VizTime.prototype.constructor=VizTime;VizTime.prototype.flags=function(){return V_FLAG_LGND|V_FLAG_SEL|V_FLAG_LOC|V_FLAG_VSCRL};
VizTime.prototype.getFeatureAtts=function(a){return null!=a?this.settings.lgnds[a]:this.settings.lgnds};VizTime.prototype.getLocAtts=function(a){return null!=a?[this.settings.dAtts[a]]:[this.settings.dAtts]};VizTime.prototype.getWidths=function(){var a=[],c=jQuery(this.frameID).width();a.push(c);c-=4;a.push(c);this.threshold=c/(6.25*this.settings.xLbl);return a};
VizTime.prototype.setup=function(){function a(a){var c={id:a,l:0,t:0,h:0,w:m[1],svgID:"#tl-b-"+q+"-"+a,tHt:0,iHt:0,xScale:d3.time.scale(),yScale:function(e){return e*c.tHt},parts:[],g:null,labels:null,labelSVGs:null,redraw:function(){}};a?(c.tHt=f.settings.bHt,c.iHt=c.tHt-2):(c.tHt=3,c.iHt=2);if(1==a){var e=f.minDate,l=f.maxDate;0<f.settings.zFrom.length&&(e=PData.parseDate(f.settings.zFrom,1,1));0<f.settings.zTo.length&&(l=PData.parseDate(f.settings.zTo,12,31));c.xScale.domain([e,l]);f.zMinDate=
e;f.zMaxDate=l}else c.xScale.domain([f.minDate,f.maxDate]);c.xScale.range([0,c.w]);c.g=f.chart.append("g").attr("id",c.svgID.substring(1)).attr("class","tl-band").attr("width",c.w);f.bands[a]=c;f.cmpnts.push(c)}function c(a){var c=f.bands[a],e=d3.svg.axis().scale(c.xScale).orient("bottom").tickSize(6,0);localD3&&e.tickFormat(localD3);var l=c.g.append("g").attr("id","axis-"+q+"-"+a).attr("class","axis").style("font-size","10px");a={redraw:function(){l.call(e)}};c.parts.push(a);f.cmpnts.push(a)}function d(a){var c=
f.bands[a],e;e=1==a?32:16;c.labels=[{name:"s-"+q+"-"+a,x:function(){return 0},left:function(){return 0},anchor:"start",tDelta:2,whichDate:function(e,a){return e}},{name:"e-"+q+"-"+a,x:function(){return c.l+c.w},left:function(){return c.l+c.w-f.settings.xLbl},anchor:"end",tDelta:-3,whichDate:function(e,a){return a}}];var l=d3.select(c.svgID).selectAll(".bLblCntr").data(c.labels).enter().append("g").attr("class","bLblCntr");l.append("rect").attr("class","bLbl").attr("id",function(e){return"rect-"+e.name}).attr("x",
function(e){return e.left()}).attr("width",f.settings.xLbl).attr("height",e);var p=l.append("text").attr("class","bMinMaxLbl").attr("id",function(e){return"txt-"+e.name}).attr("x",function(e){return e.x()+e.tDelta}).attr("y",12).attr("text-anchor",function(e){return e.anchor}),d={redraw:function(){var e=c.xScale.domain(),a=e[0],l=e[1];p.text(function(e){return e.whichDate(a,l).getUTCFullYear()})}};c.parts.push(d);f.cmpnts.push(d);if(1==a){var g=l.append("text").attr("class","bMinMaxLbl").attr("id",
function(e){return"m-txt-"+e.name}).attr("x",function(e){return e.x()+e.tDelta}).attr("y",e-4).attr("text-anchor",function(e){return e.anchor});a={redraw:function(){var e=c.xScale.domain(),a=e[0],l=e[1];g.text(function(e){return l.getUTCFullYear()-a.getUTCFullYear()>f.threshold?"":months[e.whichDate(a,l).getMonth()]})}};c.parts.push(a);f.cmpnts.push(a)}c.labelSVGs=l}var f=this;"number"!=typeof this.settings.xLbl&&(this.settings.xLbl=parseInt(this.settings.xLbl));this.brushSVG=this.brush=null;var k=
this.settings;"string"===typeof k.bHt&&(k.bHt=parseInt(k.bHt,10));(function(){var a,c,e,l,p,d;k.dAtts.forEach(function(g){null!=g&&"disable"!=g&&(g=PData.getAttID(g))&&(null==a||g.r.min.y<a?(a=g.r.min.y,"undefined"!=typeof g.r.min.m?(c=g.r.min.m,e="undefined"!=typeof g.r.min.d?g.r.min.d:1):e=c=1):g.r.min.y==a&&"undefined"!=typeof g.r.min.m&&(g.r.min.m<c?(c=g.r.min.m,e="undefined"!=typeof g.r.min.d?g.r.min.d:1):g.r.min.m==c&&"undefined"!=typeof g.r.min.d&&g.r.min.d<e&&(e=g.r.min.d)),null==l?"undefined"==
typeof g.r.max.y?(l=TODAY.getUTCFullYear(),p=TODAY.getMonth()+1,d=TODAY.getDate()):(l=g.r.max.y,"undefined"!=typeof g.r.max.m?(p=g.r.max.m,d="undefined"!=typeof g.r.max.d?g.r.max.d:mnthDays[p-1]):(p=12,d=31)):g.r.max.y>l?(l=g.r.max.y,"undefined"!=typeof g.r.max.m?(p=g.r.max.m,d="undefined"!=typeof g.r.max.d?g.r.max.d:mnthDays[p-1]):(p=12,d=31)):g.r.max.y==l&&"undefined"!=typeof g.r.max.m&&(g.r.max.m>p?(p=g.r.max.m,d="undefined"!=typeof g.r.max.d?g.r.max.d:mnthDays[p-1]):g.r.max.m==p&&"undefined"!=
typeof g.r.max.d&&g.r.max.d>d&&(d=g.r.max.d)))});f.minDate=0<k.from.length?PData.parseDate(k.from,1,1):PData.date3Nums(a,c,e);f.maxDate=0<k.to.length?PData.parseDate(k.to,12,31):PData.date3Nums(l,p,d);f.instGap=.015*(f.maxDate-f.minDate)})();var m=f.getWidths(),n=d3.select(this.frameID).append("svg").attr("class","tl-vf").attr("width",m[1]);(function(){var a=[];k.lgnds.forEach(function(e){e.forEach(function(e){a.push(e)})});var a=_.uniq(a),c=[];a.forEach(function(e){(e=PData.getAttID(e))&&e.l.forEach(function(e){c.push(e.v)})});
c=_.uniq(c);c.sort();var e=n.append("defs"),l,p;c.forEach(function(a){p=a.substr(1);l=e.append("linearGradient").attr("id",p+"-fs");l.append("stop").attr("offset","0%").attr("stop-color","#C0C0C0");l.append("stop").attr("offset","5%").attr("stop-color",a);l.append("stop").attr("offset","100%").attr("stop-color",a);l=e.append("linearGradient").attr("id",p+"-fe");l.append("stop").attr("offset","0%").attr("stop-color",a);l.append("stop").attr("offset","95%").attr("stop-color",a);l.append("stop").attr("offset",
"100%").attr("stop-color","#C0C0C0");l=e.append("linearGradient").attr("id",p+"-fb");l.append("stop").attr("offset","0%").attr("stop-color","#C0C0C0");l.append("stop").attr("offset","5%").attr("stop-color",a);l.append("stop").attr("offset","95%").attr("stop-color",a);l.append("stop").attr("offset","100%").attr("stop-color","#C0C0C0")});e.append("filter").attr("id","xortext").append("feComposite").attr("operator","xor")})();var q=this.vFrame.getIndex();n.append("clipPath").attr("id","tl-clip-"+q).append("rect").attr("width",
m[1]);f.chart=n.append("g").attr("class","chart").attr("clip-path","url(#tl-clip-"+q+")");f.instRad=k.bHt/2-1;f.bands=Array(2);f.cmpnts=[];a(0);a(1);c(0);c(1);d(0);d(1)};
VizTime.prototype.render=function(a){function c(a,c){var e=a.s-c.s;if(0>e)return 1;if(0<e)return-1;e=c.e-a.e;return 0>e?1:0<e?-1:0}function d(a){function c(e){e=m.toggleSel(e.ai);d3.select(this).classed("obj-sel",e)}var e,l,p,d,g=m.bands[a];a?(e=m.bands[0],g.t=e.t+e.h+37,e=l=p=m.instRad,d=2*m.instRad+3):(g.t=0,e=l=p=1);g.h=q*g.tHt+2;g.g.attr("transform","translate(0,"+g.t+")").attr("height",g.h);var f,h;a&&(f=.75*g.iHt+"px",h=.8*g.iHt);var k;k=d3.select(g.svgID).selectAll(".lgBd").remove();k=d3.select(g.svgID).selectAll(".lgBd").data(m.lgBds).enter().append("svg").attr("class",
"lgBd").attr("y",function(e){return g.yScale(e.t)}).attr("height",function(e){return g.yScale(e.h)});k.append("rect").attr("width","100%").attr("height","100%").attr("fill",function(e){return e.d.v});1==a&&k.append("text").attr("class","lgBdLbl").attr("x",2).attr("y",h).attr("fill",function(e){return e.d.b?"#000000":"#FFFFFF"}).style("font-size",f).text(function(e){return e.d.l});var n;d3.select(g.svgID).selectAll(".event").remove();n=d3.select(g.svgID).selectAll(".event").data(m.events).enter().append("svg").attr("class",
function(e){return e.f&EVENT_INSTANT?"event instant":"event range"}).attr("y",function(e){return g.yScale(e.t)}).attr("height",g.iHt);if(1==a)n.on("click",c);var y=d3.select(g.svgID).selectAll(".range");y.append("rect").attr("width","100%").attr("height","100%").attr("fill",function(e){return 1==a&&e.f&(EVENT_F_START|EVENT_F_END)?(e.f&(EVENT_F_START|EVENT_F_END))==(EVENT_F_START|EVENT_F_END)?"url("+e.c.v+"-fb)":(e.f&EVENT_F_START)===EVENT_F_START?"url("+e.c.v+"-fs)":"url("+e.c.v+"-fe)":e.c.v});1==
a&&y.append("text").attr("class","rangeLbl").attr("x",4).attr("y",h).attr("fill",function(e){return e.c.b?"#000000":"#FFFFFF"}).style("font-size",f).text(function(e){return e.l});y=d3.select(g.svgID).selectAll(".instant");y.append("circle").attr("cx",e).attr("cy",l).attr("r",p).attr("fill",function(e){return e.c.v});1==a&&y.append("text").attr("class","instantLbl").attr("x",d).attr("y",h).style("font-size",f).style("filter","url(#xortext)").text(function(e){return e.l});g.redraw=function(){k.attr("x",
function(e){return g.xScale(e.s)}).attr("width",function(e){return g.xScale(e.e)-g.xScale(e.s)});n.attr("x",function(e){return g.xScale(e.s)}).attr("width",function(e){return g.xScale(e.e)-g.xScale(e.s)});g.parts.forEach(function(e){e.redraw()})}}function f(a){a=m.bands[a];d3.select(a.svgID).selectAll(".axis").attr("transform","translate(0,"+a.h+")")}function k(a){a=m.bands[a];d3.select(a.svgID).selectAll(".bLblCntr").attr("transform","translate(0,"+(a.h+1).toString()+")")}var m=this,n=m.vFrame.getIndex();
0<this.recSel.length&&(this.recSel=[]);m.events=[];m.lgBds=[];var q=0;(function(){for(var d=PData.getNumETmplts(),f=0,e,l,p,x,g,r,h,k;f<d;){for(e=a.t[f];0==e.n;){if(++f==d)return;e=a.t[f]}p=m.vFrame.getSelLocAtts(f);if(0!=p.length&&(p=m.vFrame.getSelFeatAtts(f),0!=p.length)){k=m.vFrame.getSelLegend(f);h=PData.getAttID(k);x=m.settings.dAtts[f];for(var n,y,w,t,u,D,F,E,C=[],G=e.i;G<e.i+e.n;G++)l=a.s[G],E=PData.getRecByIndex(l),g=E.a[k],"undefined"!=typeof g&&(g=PData.getAttLgndRecs(g,h,p,!1))&&(r=E.a[x])&&
(D=r.min.f?EVENT_F_START:0,n=r.min.y,"undefined"==typeof r.min.m?w=y=1:(y=r.min.m,w="undefined"==typeof r.min.d?1:r.min.d),t=PData.date3Nums(n,y,w),"undefined"==typeof r.max?(D|=EVENT_INSTANT,u=t.getTime()+m.instGap):"open"==r.max?u=TODAY:(r.max.f&&(D|=EVENT_F_END),n=r.max.y,"undefined"==typeof r.max.m?(y=12,w=31):(y=r.max.m,w="undefined"==typeof r.max.d?mnthDays[y-1]:r.max.d),u=PData.date3Nums(n,y,w)),C.push({s:t,e:u,ai:l,f:D,c:g,l:E.l,t:0}));C.sort(c);var H=[],I;C.forEach(function(e){for(I=0;I<
H.length&&!(e.e<H[I]);I++);e.t=I+q+1;H[I]=e.s});e=PData.getAttID(x);e.l.forEach(function(e){F=e.d;n=F.min.y;"undefined"==typeof F.min.m?w=y=1:(y=F.min.m,w="undefined"==typeof F.min.d?1:F.min.d);t=PData.date3Nums(n,y,w);"undefined"==typeof F.max.y?u=TODAY:(n=F.max.y,"undefined"==typeof F.max.m?(y=12,w=31):(y=F.max.m,w="undefined"==typeof F.max.d?mnthDays[y-1]:F.max.d),u=PData.date3Nums(n,y,w));m.lgBds.push({s:t,e:u,t:q,h:H.length+1,d:e})});q+=H.length+1;m.events=m.events.concat(C)}f++}})();m.getWidths();
d(0);d(1);(function(){var a=function(){function e(e,a){this._height=a;this.g=e;this.mask=this.g.attr("class","brush").call(m.brush);this.mask.selectAll("rect").attr("y",0).attr("height",a);this.left=this.mask.append("polygon").attr("class","dragger");this.right=this.mask.append("polygon").attr("class","dragger");this._bottom=this._top=this._x=null}e.prototype.style=function(e,a){this.left.style(e,a);this.right.style(e,a);return this};e.prototype.x=function(e){if(null==e)return this._x;this._x=e;return this};
e.prototype.height=function(e){if(null==e)return this._height;this._height=e;this.mask.selectAll("rect").attr("height",e);return this};e.prototype.redraw=function(){var e,a;a=m.brush.extent();this._x.range();e=a[0];a=a[1];e=this._x(e);a=this._x(a);this.left.attr("points",""+e+","+this._height+" "+(e+5)+","+(this._height+5)+" "+(e+5)+","+(this._height+9)+" "+(e-5)+","+(this._height+9)+" "+(e-5)+","+(this._height+5)+" "+e+","+this._height);this.right.attr("points",""+a+","+this._height+" "+(a+5)+","+
(this._height+5)+" "+(a+5)+","+(this._height+9)+" "+(a-5)+","+(this._height+9)+" "+(a-5)+","+(this._height+5)+" "+a+","+this._height);return this};return e}(),c=m.bands[0];null!=m.brushSVG&&m.brushSVG.remove();m.brush=d3.svg.brush().x(c.xScale.range([0,c.w])).extent([m.zMinDate,m.zMaxDate]).on("brush",function(){var e=m.brush.extent(),a;"move"===d3.event.mode?(a=d3.time.day.round(e[0]),e=d3.time.day.offset(a,Math.round((e[1]-e[0])/864E5)),a=[a,e]):(a=e.map(d3.time.day.round),a[0]>=a[1]&&(a[0]=d3.time.day.floor(e[0]),
a[1]=d3.time.day.ceil(d3.time.day.offset(a[0],Math.round(m.instGap/864E5)))));m.zMinDate=a[0];m.zMaxDate=a[1];m.brush.extent(a);m.brushHandler.redraw();zoom=m.bands[1];zoom.xScale.domain(a);zoom.redraw()});m.brushSVG=c.g.append("svg");m.brushHandler=(new a(m.brushSVG,c.h-1)).x(c.xScale).redraw()})();(function(){var a=m.bands[1],a=a.t+a.h+45;d3.select(m.frameID+" svg.tl-vf").attr("height",a);d3.select("#tl-clip-"+n+" rect").attr("height",a)})();f(0);f(1);k(0);k(1);m.cmpnts.forEach(function(a){a.redraw()})};
VizTime.prototype.resize=function(){var a=this.getWidths(),c=d3.select(this.frameID+" svg.tl-vf");c.attr("width",a[1]);c.select("#tl-clip-"+this.vFrame.getIndex()+" rect").attr("width",a[1]);for(var d=0;2>d;d++){b=this.bands[d];b.w=a[1];c.select(b.svgID).attr("width",a[1]);b.xScale.range([0,a[1]]);var f=b.labels[1],k=f.x()+f.tDelta;b.labelSVGs.select("#rect-"+f.name).attr("x",f.left());b.labelSVGs.select("#txt-"+f.name).attr("x",k);if(0==d){if(this.brush){if(this.brushSVG){var m=this.brush.extent();
this.brushSVG.call(this.brush.extent(m))}this.brushHandler&&this.brushHandler.redraw()}b.labelSVGs.select("#m-txt-"+f.name).attr("x",k)}}this.cmpnts.forEach(function(a){a.redraw()})};VizTime.prototype.setSel=function(a){var c=this;c.recSel=a;d3.select(this.bands[1].svgID).selectAll(".event").attr("class",function(a){return c.isSel(a.ai)?a.f&EVENT_INSTANT?"event instant obj-sel":"event range obj-sel":a.f&EVENT_INSTANT?"event instant":"event range"})};
VizTime.prototype.clearSel=function(){function a(a){return a.f&EVENT_INSTANT?"event instant":"event range"}0<this.recSel.length&&(this.recSel=[],d3.select(this.bands[1].svgID).selectAll(".event").attr("class",a))};
VizTime.prototype.getState=function(){var a=this.brush.extent(),c=a[0],a=a[1],d=c.getUTCMonth()+1,c=c.getUTCFullYear().toString()+"-"+d.toString()+"-"+c.getDate().toString(),d=a.getUTCMonth()+1,a=a.getUTCFullYear().toString()+"-"+d.toString()+"-"+a.getDate().toString();return{d0:c,d1:a,l:this.vFrame.getLgndSels()}};VizTime.prototype.setState=function(a){var c=PData.parseDate(a.d0,1,1),d=PData.parseDate(a.d1,12,31);this.bands[1].xScale.domain([c,d]);this.zMinDate=c;this.zMaxDate=d;this.vFrame.setLgndSels(a.l)};
var VizDirectory=function(a,c){PVizModel.call(this,a,c)};VizDirectory.prototype=Object.create(PVizModel.prototype);VizDirectory.prototype.constructor=VizDirectory;VizDirectory.prototype.flags=function(){return V_FLAG_SEL|V_FLAG_VSCRL};VizDirectory.prototype.setup=function(){var a=this;jQuery(this.frameID).on("click.vf",function(c){if("TD"==c.target.nodeName){c=jQuery(c.target).closest("tr");var d=c.data("ai");null!=d&&(a.toggleSel(d)?c.addClass("obj-sel"):c.removeClass("obj-sel"))}})};
VizDirectory.prototype.render=function(a){var c=PData.getNumETmplts(),d=0,f,k=0,m,n;n=null;var q,v,A,e,l=jQuery(this.frameID);l.empty();0<this.recSel.length&&(this.recSel=[]);for(m=a.t[0];d<a.l;){for(;0==m.n||m.i+m.n==d;){if(++k==c)return;m=a.t[k];n=null}null==n&&(f=PData.getETmpltIndex(k),n=PData.getTmpltID(f),l.append('<div class="template-label">'+n.l+'</div><table cellspacing="0" class="viz-directory" data-id='+f+"></table>"),n=l.find('table[data-id="'+f+'"]'),q=this.settings.cnt[k],e="<thead><tr>",
q.forEach(function(a){a=PData.getAttID(a);e+="<th>"+a.def.l+"</th>"}),n.append(e+"<tr></thead><tbody></tbody>"),n=n.find("tbody"));f=a.s[d];A=PData.getRecByIndex(f);e='<tr data-id="'+A.id+'" data-ai='+f+">";q.forEach(function(a){v=A.a[a];"undefined"!=typeof v?e=(v=PData.procAttTxt(a,v))?e+("<td>"+v+"</td>"):e+"<td></td>":e+="<td></td>"});n.append(e+"</tr>");d++}};VizDirectory.prototype.teardown=function(){jQuery(this.frameID).off("click.vf")};
VizDirectory.prototype.setSel=function(a){var c=this,d,f;this.recSel=a;jQuery(this.frameID).find("tr").each(function(){f=jQuery(this);d=f.data("ai");null!=d&&(c.isSel(d)?f.addClass("obj-sel"):f.removeClass("obj-sel"))})};VizDirectory.prototype.clearSel=function(){0<this.recSel.length&&(this.recSel=[],jQuery(this.frameID).find("tr").removeClass("obj-sel"))};var VizTextStream=function(a,c){PVizModel.call(this,a,c)};VizTextStream.prototype=Object.create(PVizModel.prototype);
VizTextStream.prototype.constructor=VizTextStream;VizTextStream.prototype.flags=function(){return V_FLAG_LGND|V_FLAG_SEL|V_FLAG_LOC|V_FLAG_VSCRL};VizTextStream.prototype.getLocAtts=function(a){return null!=a?[this.settings.order[a]]:_.map(this.settings.order,function(a){return[a]})};VizTextStream.prototype.getFeatureAtts=function(a){return null!=a?this.settings.lgnds[a]:this.settings.lgnds};
VizTextStream.prototype.setup=function(){var a=this;jQuery(this.frameID).on("click.vf",function(c){if("DIV"==c.target.nodeName){c=jQuery(c.target);var d=c.data("ai");"undefined"!=typeof d&&0<=d&&(a.toggleSel(d)?c.addClass("obj-sel"):c.removeClass("obj-sel"))}})};
VizTextStream.prototype.render=function(a){var c=this,d=PData.getNumETmplts(),f=0,k,m,n,q,v,A,e,l,p,x,g,r,h,z,B,y,w,t=jQuery(this.frameID);t.empty();0<this.recSel.length&&(this.recSel=[]);y=this.settings.max-this.settings.min;for(m=a.t[0];f<d;){for(;0==m.n;){if(++f==d)return;m=a.t[f]}p=c.vFrame.getSelLocAtts(f);if(0!=p.length&&(p=c.vFrame.getSelFeatAtts(f),0!=p.length)){x=c.vFrame.getSelLegend(f);g=PData.getAttID(x);t.append('<div class="viz-textstream" data-ti='+f+"></div>");n=t.find("div.viz-textstream[data-ti="+
f+"]");k=PData.getETmpltIndex(f);k=PData.getTmpltID(k);n.append('<div class="template-label">'+k.l+"</div>");l=c.settings.cnt[f];if(z=c.settings.sAtts[f])h=PData.getAttID(z),"number"==typeof h.r.min&&"number"==typeof h.r.max?B=h.r.max-h.r.min:z=null;l&&(k=PData.getAttID(c.settings.order[f]),k=PData.orderTBy(k,a,f),k.forEach(function(a){q=PData.getRecByIndex(a.i);v=q.a[x];"undefined"!=typeof v&&(r=PData.getAttLgndRecs(v,g,p,!1))&&((A=q.a[l])&&(A=PData.procAttTxt(l,A)),A&&(z?(e=q.a[z],e="undefined"!=
typeof e?Math.floor((e-h.r.min)*y/B)+c.settings.min:c.settings.min):e=c.settings.min,w=r.b?";background-color:black":"",n.append('<div class="recitem" data-ai='+a.i+' style="color:'+r.v+w+";font-size:"+e+'px">'+A+"</div>")))}))}f++}};VizTextStream.prototype.teardown=function(){jQuery(this.frameID).off("click.vf")};
VizTextStream.prototype.setSel=function(a){var c=this;this.vFrame.getIndex();var d,f;this.recSel=a;jQuery(this.frameID).find("div.recitem").each(function(){f=jQuery(this);d=f.data("ai");null!=d&&(c.isSel(d)?f.addClass("obj-sel"):f.removeClass("obj-sel"))})};VizTextStream.prototype.clearSel=function(){0<this.recSel.length&&(this.recSel=[],jQuery(this.frameID).find("div.recitem").removeClass("obj-sel"))};VizTextStream.prototype.getState=function(){return{l:this.vFrame.getLgndSels()}};
VizTextStream.prototype.setState=function(a){this.vFrame.setLgndSels(a.l)};var VizStackChart=function(a,c){PVizModel.call(this,a,c);this.bSel=[]};VizStackChart.prototype=Object.create(PVizModel.prototype);VizStackChart.prototype.constructor=VizStackChart;VizStackChart.prototype.flags=function(){return V_FLAG_LGND|V_FLAG_SLGND|V_FLAG_VSCRL|V_FLAG_HSCRL};VizStackChart.prototype.getFeatureAtts=function(a){return this.settings.sAtt};
VizStackChart.prototype.setup2=function(){var a=0;this.cats.forEach(function(c){a=Math.max(a,c.l.length)});this.colW=a=Math.max(D3FG_BAR_WIDTH,8*a+4);var c=this.cats.length*a,d=this.settings.h;this.xScale=d3.scale.linear().domain([0,this.cats.length]).rangeRound([0,c]);this.yScale=d3.scale.linear().range([0,d-1]);this.rScale=d3.scale.ordinal().rangeRoundBands([0,c]);this.rScale.domain(this.cats.map(function(a){return a.l}));this.xAxis=d3.svg.axis().scale(this.rScale).orient("top");this.yAxis=d3.svg.axis().scale(this.yScale).orient("left").ticks(10);
this.svg=d3.select(this.frameID).append("svg").attr("width",c+D3SC_MARGINS.left+D3SC_MARGINS.right).attr("height",d+D3SC_MARGINS.top+D3SC_MARGINS.bottom);this.svg.append("g").attr("class","chart").attr("transform","translate("+D3SC_MARGINS.left+","+D3SC_MARGINS.top+")");this.svg.append("g").attr("class","x axis").attr("transform","translate("+D3SC_MARGINS.left+","+D3SC_MARGINS.top+")").call(this.xAxis);this.svg.append("g").attr("class","y axis").attr("transform","translate("+D3SC_MARGINS.left+","+
D3SC_MARGINS.top+")")};VizStackChart.prototype.setup=function(){var a=PData.getAttID(this.settings.oAtt);"T"==a.def.t&&this.settings.tlit?this.cats=null:(this.cats=this.settings.gr?PData.getRCats(a,!0):PData.getLCats(a,null),this.setup2())};
VizStackChart.prototype.render=function(a){var c=this;this.bSel=[];var d=this.settings.oAtt,f=this.settings.sAtt;this.svg.selectAll(".block").remove();null==this.cats?(this.cats=[],PData.fillCats(this.cats,d,f,a,!0),this.setup2()):PData.fillCats(this.cats,d,f,a,!1);this.blocks=[];a=PData.getAttID(f);for(var d=0,f=c.vFrame.getSelFeatAtts(0),f=PData.getLCats(a,f),k=0;k<this.cats.length;k++){if(0<k)for(var m=0;m<f.length;m++)f[m].i=[];PData.sortCats(c.cats[k].i,a,f);var n=0;f.forEach(function(a){0<a.i.length&&
(c.blocks.push({x:k,c:a.c,y:n,h:a.i.length,a:a.i}),n+=a.i.length)});d=Math.max(d,n)}c.yScale.domain([0,d]);c.svg.select(".y.axis").call(c.yAxis);a=c.colW-7;this.svg.selectAll(".block").data(c.blocks).enter().append("rect").attr("class","block").attr("x",function(a){return D3SC_MARGINS.left+5+c.xScale(a.x)}).attr("y",function(a){return c.yScale(a.y)+D3SC_MARGINS.top}).attr("fill",function(a){return a.c}).attr("height",function(a){return Math.max(1,c.yScale(a.h)-1)}).attr("width",a).on("click",function(a,
d){var f=c.bSel.length,e=_.sortedIndex(c.bSel,d);c.bSel[e]==d?(d3.select(this).classed("obj-sel",!1),c.bSel.splice(e,1),0<f&&0==c.bSel.length&&c.vFrame.selBtns(!1)):(d3.select(this).classed("obj-sel",!0),c.bSel.splice(e,0,d),0==f&&0<c.bSel.length&&c.vFrame.selBtns(!0))})};VizStackChart.prototype.setSel=function(a){};VizStackChart.prototype.clearSel=function(){0<this.bSel.length&&(this.bSel=[],this.svg.selectAll(".block").classed("obj-sel",!1))};
VizStackChart.prototype.getSel=function(){var a=this,c=[];this.bSel.forEach(function(d){c=_.union(c,a.blocks[d].a)});return c};VizStackChart.prototype.getState=function(){return{l:this.vFrame.getLgndSels()}};VizStackChart.prototype.setState=function(a){this.vFrame.setLgndSels(a.l)};var VizNetWheel=function(a,c){PVizModel.call(this,a,c);this.bSel=[]};VizNetWheel.prototype=Object.create(PVizModel.prototype);VizNetWheel.prototype.constructor=VizNetWheel;
VizNetWheel.prototype.flags=function(){return V_FLAG_LGND|V_FLAG_SEL|V_FLAG_VSCRL|V_FLAG_HSCRL};VizNetWheel.prototype.getFeatureAtts=function(a){return null!=a?this.settings.lgnds[a]:this.settings.lgnds};
VizNetWheel.prototype.setup=function(){function a(){360<c.spin?c.spin-=360:0>c.spin&&(c.spin+=360);c.center.attr("transform","translate("+c.cr+","+c.cr+")rotate("+c.spin+")")}var c=this;this.spin=0;var d=this.vFrame.getIndex(),f=_.template(document.getElementById("dltext-v-nwheel").innerHTML);jQuery("#view-frame-"+d+" div.view-control-bar").append(f({vi:d}));jQuery("#nw-prev-"+d).button({text:!1,icons:{primary:" ui-icon-arrowreturnthick-1-s"}}).click(function(){jQuery("#nw-size-"+d+" :radio:checked").attr("id")==
"nw-size-1-"+d?c.spin+=c.inc:c.spin+=90;a()});jQuery("#nw-for-"+d).button({text:!1,icons:{primary:" ui-icon-arrowreturnthick-1-n"}}).click(function(){jQuery("#nw-size-"+d+" :radio:checked").attr("id")=="nw-size-1-"+d?c.spin-=c.inc:c.spin-=90;a()});jQuery("#nw-size-"+d).buttonset();this.svg=d3.select(this.frameID).append("svg");this.center=this.svg.append("g")};
VizNetWheel.prototype.render=function(a){var c=this,d=[],f,k,m;this.svg.selectAll(".node").remove();this.svg.selectAll(".link").remove();this.inc=360/(a.l+a.t.length);k=Math.max((14*a.l+20)/(2*Math.PI),30);var n=this.settings.lw;"string"==typeof n&&(n=parseInt(n));this.cr=n+12+k;n=2*this.cr;this.svg.attr("width",n).attr("height",n);this.center.attr("transform","translate("+this.cr+","+this.cr+")");0<this.recSel.length&&(this.recSel=[]);var q={children:[]};(function(){var d,f=0,e=0,l,p,m,g=[],r=null,
h,k;d=a.t[0];k=c.vFrame.getSelLegend(0);h=PData.getAttID(k);r=c.vFrame.getSelFeatAtts(0);a:for(;e<a.l;){for(;0==d.n||d.i+d.n==e||0==r.length;){0<g.length&&(q.children.push({ti:f,children:g}),g=[]);if(++f==PData.getNumETmplts())break a;g=[];d=a.t[f];k=c.vFrame.getSelLegend(f);h=PData.getAttID(k);r=c.vFrame.getSelFeatAtts(f)}m=a.s[e];l=PData.getRecByIndex(m);p=l.a[k];"undefined"!=typeof p&&(fData=PData.getAttLgndRecs(p,h,r,!1))&&g.push({r:l,ai:m,c:fData.v,children:[]});e++}0<g.length&&q.children.push({ti:f,
children:g})})();k=d3.layout.cluster().size([360,k]).sort(null).nodes(q);m=this.center.append("g").selectAll(".node").data(k.filter(function(a){return!a.children})).enter().append("g").attr("class","node").attr("transform",function(a){return"rotate("+(a.x-90)+")translate("+(a.y+8)+",0)"});m.append("circle").attr("r","5").style("fill",function(a){return a.c}).on("click",function(a){a=c.toggleSel(a.ai);d3.select(this).classed("obj-sel",a)});m.append("text").attr("dy",".31em").attr("dx",function(a){return 180>
a.x?"10":"-10"}).attr("transform",function(a){return 180>a.x?"":"rotate(180)"}).style("text-anchor",function(a){return 180>a.x?"start":"end"}).attr("fill","white").text(function(a){return a.r.l}).on("click",function(a){PState.set(PSTATE_UPDATE);m.each(function(a){a.linked=!1});f.each(function(c){if(c.s===a){c.t.linked=!0;for(var e=0;e<d.length;e++){var l=d[e];if(l.source===a&&l.target===c.t){d3.select(this).attr("stroke",l.c).classed("thick",!0);break}}}else if(c.t===a)for(c.s.linked=!0,e=0;e<d.length;e++){if(l=
d[e],l.target===a&&l.source===c.s){d3.select(this).attr("stroke",l.c).classed("thick",!0);break}}else d3.select(this).attr("stroke","white").classed("thick",!1)});m.select("text").attr("fill",function(a){return a.linked?"black":"white"});d3.select(this).attr("fill","red");PState.set(PSTATE_READY)});k=d3.layout.bundle();n=d3.svg.line.radial().interpolate("bundle").tension(.85).radius(function(a){return a.y}).angle(function(a){return a.x/180*Math.PI});q.children.forEach(function(a){var f=c.settings.pAtts[a.ti],
e;a.children.forEach(function(a){f.forEach(function(c){e=a.r.a[c.pid];"undefined"!=typeof e&&e.forEach(function(e){var g=!1,f,h=0;a:for(;h<q.children.length;h++)for(var m=q.children[h],k=0;k<m.children.length;k++)if(f=m.children[k],f.r.id==e){g=!0;break a}g&&d.push({source:a,target:f,c:c.clr})})})})});f=this.center.append("g").selectAll(".link").data(k(d)).enter().append("path").each(function(a){a.s=a[0];a.t=a[a.length-1]}).attr("class","link").attr("d",n).attr("stroke","white")};
VizNetWheel.prototype.teardown=function(){var a=this.vFrame.getIndex();jQuery("#view-frame-"+a+" div.view-control-bar div.iconbar").remove()};VizNetWheel.prototype.setSel=function(a){var c=this;c.recSel=a;this.svg.selectAll(".node circle").attr("class",function(a){return c.isSel(a.ai)?"obj-sel":""})};VizNetWheel.prototype.clearSel=function(){0<this.recSel.length&&(this.recSel=[],this.svg.selectAll(".node circle").attr("class",""))};VizNetWheel.prototype.getState=function(){return{l:this.vFrame.getLgndSels()}};
VizNetWheel.prototype.setState=function(a){this.vFrame.setLgndSels(a.l)};function PFilterModel(a,c){this.id=a;this.att=c;this.dirty=!0}PFilterModel.prototype.isDirty=function(a){null!=a&&(!this.dirty&&a&&0<this.id&&jQuery("#btn-recompute").addClass("pulse"),this.dirty=a);return this.dirty};PFilterModel.prototype.title=function(){return this.att.def.l};PFilterModel.prototype.insertPt=function(){return jQuery('div.filter-instance[data-id="'+this.id+'"] div.filter-body')};
PFilterModel.prototype.teardown=function(){};var PFilterRemove=function(a){PFilterModel.call(this,a,null)};PFilterRemove.prototype=Object.create(PFilterModel.prototype);PFilterRemove.prototype.constructor=PFilterRemove;PFilterRemove.prototype.title=function(){return dlText.rha};PFilterRemove.prototype.evalPrep=function(){};PFilterRemove.prototype.eval=function(a){return!1};PFilterRemove.prototype.setup=function(){var a=this.insertPt(),c=document.getElementById("dltext-filter-remove").innerHTML;a.append(c)};
PFilterRemove.prototype.getState=function(){return{}};PFilterRemove.prototype.setState=function(a){};var PFilterText=function(a,c){PFilterModel.call(this,a,c)};PFilterText.prototype=Object.create(PFilterModel.prototype);PFilterText.prototype.constructor=PFilterText;PFilterText.prototype.evalPrep=function(){this.fStr=this.insertPt().find("input.filter-text").val()};
PFilterText.prototype.eval=function(a){var c=this.fStr;if(null==c||""==c)return!0;a=a.a[this.att.id];return"undefined"==typeof a?!1:-1!=a.indexOf(c)};PFilterText.prototype.setup=function(){var a=this,c=this.insertPt(),d=document.getElementById("dltext-filter-text").innerHTML;c.append(d);c.find("input.filter-text").change(function(){a.isDirty(!0)})};PFilterText.prototype.getState=function(){return{t:this.insertPt().find("input.filter-text").val()}};PFilterText.prototype.setState=function(a){this.insertPt().find("input.filter-text").val(a.t)};
var PFilterVocab=function(a,c){PFilterModel.call(this,a,c)};PFilterVocab.prototype=Object.create(PFilterModel.prototype);PFilterVocab.prototype.constructor=PFilterVocab;PFilterVocab.prototype.evalPrep=function(){var a=this;this.sel=[];this.insertPt().find("div.filter-vocab-row input:checked").each(function(){var c=jQuery(this).parent().data("id");a.sel.push(c)});a.sel.sort()};
PFilterVocab.prototype.eval=function(a){if(0==this.sel.length)return!1;a=a.a[this.att.id];if("undefined"==typeof a)return!1;for(var c,d,f=0;f<a.length;f++)if(d=a[f],c=_.sortedIndex(this.sel,d),this.sel[c]==d)return!0;return!1};
PFilterVocab.prototype.setup=function(){var a=this,c='<div class="filter-vocab-container">';this.att.l.forEach(function(a,d){c+='<div class="filter-vocab-entry" data-index="'+d+'"><div class="filter-vocab-row" data-id="'+a.l+'"><input type="checkbox" value="min-use" checked="checked">'+a.l+'</div><div class="filter-vocab-bar" style="background-color:'+a.v+'"></div>';a.z.forEach(function(d,k){c+='<div class="filter-vocab-row" data-id="'+d.l+'"><input type="checkbox" value="min-use" checked="checked">'+
d.l+"</div>";c=null==d.v||""==d.v?c+('<div class="filter-vocab-bar" style="background-color:'+a.v+'"></div>'):c+('<div class="filter-vocab-bar" style="background-color:'+d.v+'"></div>')});c+="</div>"});var d=this.insertPt();d.append(c+"</div>");d.click(function(c){"INPUT"==c.target.nodeName&&a.isDirty(!0)})};PFilterVocab.prototype.getState=function(){var a=[];this.insertPt().find("div.filter-vocab-row input:checked").each(function(){var c=jQuery(this).parent().data("id");a.push(c)});a.sort();return{s:a}};
PFilterVocab.prototype.setState=function(a){this.insertPt().find("div.filter-vocab-row").each(function(){var c=jQuery(this),d=c.data("id"),d=_.indexOf(a.s,d,!0);c.find("input").prop("checked",-1!=d)})};var PFilterNum=function(a,c){PFilterModel.call(this,a,c)};PFilterNum.prototype=Object.create(PFilterModel.prototype);PFilterNum.prototype.constructor=PFilterNum;
PFilterNum.prototype.evalPrep=function(){if(null==this.rCats){var a=this.insertPt();this.min=parseInt(a.find("input.filter-num-min-val").val());this.max=parseInt(a.find("input.filter-num-max-val").val());this.useMin=a.find("input.filter-num-min-use").is(":checked");this.useMax=a.find("input.filter-num-max-use").is(":checked")}};
PFilterNum.prototype.eval=function(a){a=a.a[this.att.id];if("undefined"==typeof a||this.useMin&&a<this.min)return!1;if(null==this.rCats){if(this.useMax&&a>this.max)return!1}else if(a>=this.max)return!1;return!0};
PFilterNum.prototype.setup=function(){var a=this,c=this.insertPt();this.rCats=PData.getRCats(this.att,!1);if(null==this.rCats){var d=_.template(document.getElementById("dltext-filter-num-boxes").innerHTML),f="undefined"==typeof this.att.r.min?0:this.att.r.min;c.append(d({min:f,max:"undefined"==typeof this.att.r.max?f+100:this.att.r.max}));c.click(function(c){"INPUT"==c.target.nodeName&&a.isDirty(!0)});c.find("input.filter-num-min-val").change(function(){var d=jQuery(this).val(),e=c.find("input.filter-num-max-val").val();
d<=e?a.isDirty(!0):jQuery(this).val(e)});c.find("input.filter-num-max-val").change(function(){var d=jQuery(this).val(),e=c.find("input.filter-num-min-val").val();d>=e?a.isDirty(!0):jQuery(this).val(e)})}else{this.useMin=this.useMax=!0;this.min=this.rCats[0].min;this.max=this.rCats[this.rCats.length-1].max;var k=80-D3FG_MARGINS.top-D3FG_MARGINS.bottom,m=0;this.rCats.forEach(function(a){m=Math.max(m,a.l.length)});var m=Math.max(D3FG_BAR_WIDTH,8*m),d=this.rCats.length*m,n=d3.scale.linear().domain([0,
this.rCats.length]).rangeRound([0,d]),q=d3.scale.linear().domain([0,100]).range([k,0]),f=d3.scale.ordinal().rangeRoundBands([0,d]);f.domain(this.rCats.map(function(a){return a.l}));var f=d3.svg.axis().scale(f).orient("bottom"),v=d3.svg.axis().scale(q).orient("left").ticks(4),d=d3.select(c.get(0)).append("svg").attr("width",d+D3FG_MARGINS.left+D3FG_MARGINS.right).attr("height",k+D3FG_MARGINS.top+D3FG_MARGINS.bottom).append("g").attr("transform","translate("+D3FG_MARGINS.left+","+D3FG_MARGINS.top+")");
d.append("g").attr("class","x axis").attr("transform","translate(0,"+k+")").call(f);d.append("g").attr("class","y axis").call(v);d.selectAll(".bar").data(this.rCats).enter().append("rect").attr("class","bar").attr("x",function(a,e){return n(e)+2}).attr("y",function(a){return q(100)}).attr("fill",function(a){return a.c}).attr("height",function(a){return k-q(100)}).attr("width",m-4);a.brush=d3.svg.brush().x(n).extent([0,this.rCats.length]).on("brushend",function(){if(d3.event.sourceEvent){var c=a.brush.extent(),
e=[Math.floor(c[0]),Math.floor(c[1])];e[0]>=e[1]&&(e[0]=Math.floor(c[0]),e[1]=Math.ceil(c[1]));e[1]=Math.max(e[1],e[0]+1);d3.select(this).transition().call(a.brush.extent(e));a.min=a.rCats[e[0]].min;a.max=a.rCats[e[1]-1].max;a.isDirty(!0)}});a.brushg=d.append("g");a.brushg.attr("class","brush").call(a.brush);a.brushg.selectAll("rect").attr("y",0).attr("height",k);a.brushg.selectAll(".resize").append("path").attr("d",function(a){var e=(a=+("e"==a))?1:-1,c=k/4;return"M"+.5*e+","+c+"A6,6 0 0 "+a+" "+
6.5*e+","+(c+6)+"V"+(2*c-6)+"A6,6 0 0 "+a+" "+.5*e+","+2*c+"ZM"+2.5*e+","+(c+8)+"V"+(2*c-8)+"M"+4.5*e+","+(c+8)+"V"+(2*c-8)})}};
PFilterNum.prototype.getState=function(){if(null==this.rCats){var a=this.insertPt(),c=parseInt(a.find("input.filter-num-min-val").val()),d=parseInt(a.find("input.filter-num-max-val").val()),f=a.find("input.filter-num-min-use").is(":checked"),a=a.find("input.filter-num-max-use").is(":checked");return{rc:!1,min:c,max:d,useMin:f,useMax:a}}c=this.brush.extent();return{rc:!0,e0:c[0],e1:c[1]}};
PFilterNum.prototype.setState=function(a){if(a.rc)this.min=this.rCats[a.e0].min,this.max=this.rCats[a.e1-1].max,this.brush.extent([a.e0,a.e1]),this.brushg.call(this.brush);else{var c=this.insertPt();c.find("input.filter-num-min-val").val(a.min);c.find("input.filter-num-max-val").val(a.max);c.find("input.filter-num-min-use").prop("checked",a.useMin);c.find("input.filter-num-max-use").prop("checked",a.useMax)}};var PFilterDates=function(a,c,d){PFilterModel.call(this,a,c,d)};PFilterDates.prototype=Object.create(PFilterModel.prototype);
PFilterDates.prototype.constructor=PFilterDates;PFilterDates.prototype.evalPrep=function(){this.c=jQuery("input[name=dctrl-"+this.id+"]:checked").val()};
PFilterDates.prototype.eval=function(a){function c(a,c,d,n){"undefined"!=typeof n.m&&(c=n.m,"undefined"!=typeof n.d&&(d=n.d));return PData.date3Nums(a,c,d)}var d=a.a[this.att.id];if("undefined"==typeof d)return!1;if("undefined"==typeof d.max)return a=c(d.min.y,1,1,d.min),this.min<=a&&a<this.max;a=c(d.min.y,1,1,d.min);d="open"==d.max?TODAY:c(d.max.y,12,31,d.max);return"o"==this.c?d<this.min||a>=this.max?!1:!0:this.min<=a&&d<=this.max};
PFilterDates.prototype.setup=function(){var a=this;this.rCats=PData.getRCats(this.att,!1);this.min=this.rCats[0].min;this.max=this.rCats[this.rCats.length-1].max;var c=80-D3FG_MARGINS.top-D3FG_MARGINS.bottom,d=0;this.rCats.forEach(function(a){d=Math.max(d,a.l.length)});var d=Math.max(D3FG_BAR_WIDTH,8*d),f=this.rCats.length*d,k=d3.scale.linear().domain([0,this.rCats.length]).rangeRound([0,f]),m=d3.scale.linear().domain([0,100]).range([c,0]),n=d3.scale.ordinal().rangeRoundBands([0,f]);n.domain(this.rCats.map(function(a){return a.l}));
var n=d3.svg.axis().scale(n).orient("bottom"),q=d3.svg.axis().scale(m).orient("left").ticks(4),v=this.insertPt(),A=_.template(document.getElementById("dltext-filter-date-ctrl").innerHTML);v.append(A({id:this.id}));v.find("input[name=dctrl-"+a.id+"]").change(function(){a.isDirty(!0)});f=d3.select(v.get(0)).append("svg").attr("width",f+D3FG_MARGINS.left+D3FG_MARGINS.right).attr("height",c+D3FG_MARGINS.top+D3FG_MARGINS.bottom).append("g").attr("transform","translate("+D3FG_MARGINS.left+","+D3FG_MARGINS.top+
")");f.append("g").attr("class","x axis").attr("transform","translate(0,"+c+")").call(n);f.append("g").attr("class","y axis").call(q);f.selectAll(".bar").data(this.rCats).enter().append("rect").attr("class","bar").attr("x",function(a,c){return k(c)+2}).attr("y",function(a){return m(100)}).attr("fill",function(a){return a.c}).attr("height",function(a){return c-m(100)}).attr("width",d-4);a.brush=d3.svg.brush().x(k).extent([0,this.rCats.length]).on("brushend",function(){if(d3.event.sourceEvent){var e=
a.brush.extent(),c=[Math.floor(e[0]),Math.floor(e[1])];c[0]>=c[1]&&(c[0]=Math.floor(e[0]),c[1]=Math.ceil(e[1]));c[1]=Math.max(c[1],c[0]+1);d3.select(this).transition().call(a.brush.extent(c));a.min=a.rCats[c[0]].min;a.max=a.rCats[c[1]-1].max;a.isDirty(!0)}});a.brushg=f.append("g");a.brushg.attr("class","brush").call(a.brush);a.brushg.selectAll("rect").attr("y",0).attr("height",c);a.brushg.selectAll(".resize").append("path").attr("d",function(a){var l=(a=+("e"==a))?1:-1,p=c/4;return"M"+.5*l+","+p+
"A6,6 0 0 "+a+" "+6.5*l+","+(p+6)+"V"+(2*p-6)+"A6,6 0 0 "+a+" "+.5*l+","+2*p+"ZM"+2.5*l+","+(p+8)+"V"+(2*p-8)+"M"+4.5*l+","+(p+8)+"V"+(2*p-8)})};PFilterDates.prototype.getState=function(){var a=this.brush.extent(),c=jQuery("input[name=dctrl-"+this.id+"]:checked").val();return{e0:a[0],e1:a[1],c:c}};PFilterDates.prototype.setState=function(a){jQuery('input[name="dctrl-'+this.id+'"]').val([a.c]);this.min=this.rCats[a.e0].min;this.max=this.rCats[a.e1-1].max;this.brush.extent([a.e0,a.e1]);this.brushg.call(this.brush)};
function PViewFrame(a){function c(){return"#view-frame-"+a}function d(a){a=jQuery(c()+" div.view-control-bar select.view-viz-select option:selected").val();PState.set(PSTATE_BUILD);x(a,!0);PState.set(PSTATE_READY)}function f(a){h.flags()&V_FLAG_LGND&&jQuery(c()+" div.lgnd-container").toggle("slide",{direction:"left"});a.preventDefault()}function k(a){function e(a){var c=new Number,l=parseTC.exec(a);if(null!==l)c=1E3*(3600*parseInt(l[1])+60*parseInt(l[2])+parseFloat(l[3])),c=1==l[4].length?c+100*parseInt(l[4]):
c+10*parseInt(l[4]);else throw reportError(!1,"Error in transcript file: Cannot parse "+a+" as timecode."),Error("Error in transcript file: Cannot parse "+a+" as timecode.");return c}function c(a,e){var l=new String(a);if(widgetData.extract){var g=l.indexOf(widgetData.extract[0]);if(-1==g)throw Error("Transcript2 excerpt error: Cannot find timestamp "+widgetData.extract[0]);var p=l.indexOf(widgetData.extract[1]);if(-1==p)throw Error("Transcript2 excerpt error: Cannot find timestamp "+widgetData.extract[1]);
l=l.substring(g-1,p-1)}var l=l.trim().split(/\r\n|\r|\n/g),d=[];if(l){var h,f=0;_.each(l,function(a){a=a.trim();0<a.length&&("["===a.charAt(0)?(0<f&&d.push(h),h=""):h+=a,f++)})}_.each(d,function(a,c){e.find('div.timecode[data-tcindex="'+c+'"]').next().after('<div class="xscript">'+a+"</div>")})}function l(a){widgetData.tcArray=[];widgetData.tcIndex=-1;var g=widgetData.tcArray;a=new String(a);if(widgetData.extract){var p=a.indexOf(widgetData.extract[0]);if(-1==p)throw Error("Transcript excerpt error: Cannot find timestamp "+
widgetData.extract[0]);var d=a.indexOf(widgetData.extract[1]);if(-1==d)throw Error("Transcript excerpt error: Cannot find timestamp "+widgetData.extract[1]);a=a.substring(p-1,d-1)}if(a=a.trim().split(/\r\n|\r|\n/g)){var h=0,f,C=0,r=0,y="",m=jQuery("#xscript-tbl");_.each(a,function(a){a=a.trim();1<a.length&&("["===a.charAt(0)&&"0"<=a.charAt(1)&&"9">=a.charAt(1)?(f=e(a),0<y.length&&(r&&g.push({s:C,e:f}),m.append('<div class="row"><div class="timecode" data-timecode="'+C+'" data-tcindex="'+h++ +'">'+
r+'</div><div class="xscript">'+y+"</div></div>"),y=""),r=a,C=f):y+=a)});0<y.length&&(g.push({s:C,e:324E5}),m.append('<div class="row"><div class="timecode" data-timecode="'+C+'" data-tcindex="'+h+'">'+r+'</div><div class="xscript">'+y+"</div></div>"));if("undefined"!=typeof z&&null!=z){var k=new XMLHttpRequest;k.onload=function(a){c(k.responseText,m)};k.open("GET",z,!0);k.send()}}}function g(a){var e,c=widgetData.tcIndex;_.find(widgetData.tcArray,function(l,g){if((e=l.s<=a&&a<l.e)&&g!=c){var p=jQuery("#xscript-tbl");
if(document.getElementById("sync-xscript").checked){var d=p.find('[data-tcindex="'+g+'"]').offset().top-p.offset().top,d=p.scrollTop()+d;p.animate({scrollTop:d},300)}-1!=c&&p.find('[data-tcindex="'+c+'"]').removeClass("current");p.find('[data-tcindex="'+g+'"]').addClass("current");widgetData.tcIndex=g}return e})}function p(){widgetData.widget=new YT.Player("yt-widget",{width:"426",height:"240",videoId:widgetData.ytCode,events:{onError:function(a){console.log("YouTube Error: "+a.data)},onStateChange:function(a){var e;
switch(a.data){case 1:widgetData.playing=!0;null==widgetData.timer&&(widgetData.timer=setInterval(function(){e=1E3*widgetData.widget.getCurrentTime();widgetData.playing&&g(e)},300));break;case 0:case 2:widgetData.playing=!1;window.clearInterval(widgetData.timer);widgetData.timer=null;break;case 3:case 5:widgetData.playing=!1}},onReady:function(){widgetData.extract&&widgetData.widget.cueVideoById({videoId:widgetData.ytCode,startSeconds:widgetData.sTime/1E3,endSeconds:widgetData.eTime/1E3})}}})}function d(){function a(){widgetData.sTime=
widgetData.eTime=null;var c;(c=prspdata.e.i.t.tcAtts[f])&&(c=B.a[c])&&""!=c&&(c=c.split("-"),widgetData.extract=c,widgetData.sTime=e(c[0]),widgetData.eTime=e(c[1]))}var c=q[A];B=PData.getRecByIndex(c);var h=" "+B.l+" ("+(A+1)+"/"+q.length+") ";jQuery("#inspect-name").text(h);var f=PData.aIndex2Tmplt(c);k.empty();prspdata.e.i.modal.atts[f].forEach(function(a){var e=PData.getRecAtt(c,a,!1);e&&(a=PData.getAttID(a),e="_"==a.def.l.charAt(0)?"<div>"+e+"</div>":'<div><span class="att-label">'+a.def.l+":</span> "+
e+"</div>",k.append(e))});x=null;n=0;widgetData.extract=null;widgetData.xscriptOn=!1;widgetData.playing=!1;if(prspdata.e.i.modal.scOn&&(x=prspdata.e.i.sc.atts[f])&&(h=B.a[x])){var C=!0;a();n=1;k.append('<iframe id="sc-widget" class="player" width="100%" height="150" src="http://w.soundcloud.com/player/?url='+h+'"></iframe></p>');var r=SC.Widget(document.getElementById("sc-widget"));widgetData.widget=r;r.bind(SC.Widget.Events.READY,function(){r.play();r.bind(SC.Widget.Events.PLAY,function(){widgetData.playing=
!0});r.bind(SC.Widget.Events.PAUSE,function(){widgetData.playing=!1});r.bind(SC.Widget.Events.PLAY_PROGRESS,function(a){C&&(r.pause(),C=!1,widgetData.playing=!1);widgetData.extract&&(a.currentPosition<widgetData.sTime?r.seekTo(widgetData.sTime):a.currentPosition>widgetData.eTime&&(r.pause(),widgetData.playing=!1));widgetData.playing&&widgetData.xscriptOn&&g(a.currentPosition)});r.bind(SC.Widget.Events.FINISH,function(){widgetData.playing=!1})})}if(0==n&&prspdata.e.i.modal.ytOn&&(x=prspdata.e.i.yt.atts[f])&&
(h=B.a[x])){a();widgetData.ytCode=h;k.append('<div id="yt-widget"></div>');widgetData.ytCall=p;if(widgetData.ytLoaded)p();else{widgetData.ytLoaded=!0;h=document.createElement("script");h.src="https://www.youtube.com/iframe_api";var y=document.getElementsByTagName("script")[0];y.parentNode.insertBefore(h,y)}n=2}if(prspdata.e.i.modal.tOn&&(h=prspdata.e.i.t.t1Atts[f])&&""!==h&&"disable"!=h&&(h=B.a[h])){0<n&&k.append("<div>"+document.getElementById("dltext-sync-xscript").innerHTML+"</div>");k.append('<div id="xscript-tbl"><div>');
widgetData.xscriptOn=!0;jQuery("#xscript-tbl").click(function(a){if(n&&jQuery(a.target).hasClass("timecode"))switch(a=jQuery(a.target).data("timecode"),n){case 1:widgetData.playing||(widgetData.playing=!0,widgetData.widget.play());widgetData.widget.seekTo(a);break;case 2:widgetData.playing||(widgetData.playing=!0,widgetData.widget.playVideo()),widgetData.widget.seekTo(a/1E3)}});z=null;(y=prspdata.e.i.t.t2Atts[f])&&""!==y&&"disable"!=y&&(z=B.a[y]);var t=new XMLHttpRequest;t.onload=function(a){l(t.responseText)};
t.open("GET",h,!0);t.send()}}function f(a){a=A+a;-1==a?a=q.length-1:a==q.length&&(a=0);a!=A&&(A=a,d())}function r(a){f(-1)}function m(a){f(1)}var k=jQuery("#inspect-content"),x=null,n=0,z,q=null;h&&(q=h.getSel());if(null!=q&&0!=q.length){var v,B,A=0;d();jQuery("#btn-inspect-left").click(r);jQuery("#btn-inspect-right").click(m);var J=450,K=400;prspdata.e.i.modal.scOn&&(J=550);prspdata.e.i.modal.ytOn&&(J=Math.max(J,460),K=500);prspdata.e.i.tOn&&(K+=100,J=prspdata.e.i.t2On?750:Math.max(J,500));v=jQuery("#dialog-inspector").dialog({width:J,
height:K,modal:!0,buttons:[{text:dlText.seerec,click:function(){window.open(prspdata.site_url+"?p="+B.wp,"_blank")}},{text:dlText.close,click:function(){switch(n){case 1:null!=widgetData.widget&&widgetData.playing&&widgetData.widget.pause();widgetData.playing=!1;widgetData.widget=null;break;case 2:widgetData.ytCall=null,null!=widgetData.widget&&widgetData.playing&&widgetData.widget.stopVideo(),widgetData.widget=null,widgetData.playing=!1,null!=widgetData.timer&&(window.clearInterval(widgetData.timer),
widgetData.timer=null)}jQuery("#btn-inspect-left").off("click");jQuery("#btn-inspect-right").off("click");v.dialog("close")}}]});a.preventDefault()}}function m(a){var e=jQuery(c()+" .view-control-bar");a?(e.find(".osel").button("enable"),e.find(".osel").addClass("pulse"),e.find(".xsel").button("enable")):(e.find(".osel").button("disable"),e.find(".osel").removeClass("pulse"),e.find(".xsel").button("disable"))}function n(a){PState.set(PSTATE_UPDATE);h&&h.clearSel();m(!1);PState.set(PSTATE_READY);a.preventDefault()}
function q(a){h&&h.optionsModal();a.preventDefault()}function v(a){var e=jQuery("#dialog-vnotes").dialog({width:300,height:300,modal:!0,buttons:[{text:dlText.ok,click:function(){e.dialog("close")}}]});a.preventDefault()}function A(a,e){jQuery(c()+' div.lgnd-container div.lgnd-scroll div.lgnd-template[data-index="'+a+'"] div.lgnd-group input.lgnd-entry-check').prop("checked",e)}function e(a){var e=jQuery(a.target).closest("div.lgnd-template").data("index"),l=a.target.className;switch(l){case "lgnd-update":h&&
B&&(PState.set(PSTATE_BUILD),m(!1),h.render(B),PState.set(PSTATE_READY));break;case "lgnd-entry-check":l=jQuery(a.target).closest("div.lgnd-entry");a=jQuery(a.target).is(":checked");l.hasClass("lgnd-sh")?A(e,a):l.hasClass("lgnd-locate")?l.data("id"):l.hasClass("lgnd-value")&&l.data("index");break;case "lgnd-viz":case "lgnd-value-title":l=jQuery(a.target).closest("div.lgnd-entry");l.hasClass("lgnd-locate")?(a=l.data("id"),jQuery(c()+' div.lgnd-container div.lgnd-scroll div.lgnd-template[data-index="'+
e+'"] div.lgnd-locate input.lgnd-entry-check').prop("checked",!1),jQuery(c()+' div.lgnd-container div.lgnd-scroll div.lgnd-template[data-index="'+e+'"] div.lgnd-locate[data-id="'+a+'"] input.lgnd-entry-check').prop("checked",!0)):l.hasClass("lgnd-value")&&(a=l.data("index"),jQuery(c()+' div.lgnd-container div.lgnd-scroll div.lgnd-template[data-index="'+e+'"] div.lgnd-group input.lgnd-entry-check').prop("checked",!1),jQuery(c()+' div.lgnd-container div.lgnd-scroll div.lgnd-template[data-index="'+e+
'"] div.lgnd-group div.lgnd-value[data-index="'+a+'"] input.lgnd-entry-check').prop("checked",!0));break;case "lgnd-template":case "lgnd-select":case "":break;default:l.match(/lgnd-sh/i)&&(l=jQuery(a.target).find("input.lgnd-entry-check"),a=!l.is(":checked"),l.prop("checked",a),A(e,a))}}function l(a){var e=jQuery(a.target).closest("div.lgnd-template").data("index");a=jQuery(a.target).val();p(e,a)}function p(a,e){var l,g=jQuery(c()+' div.lgnd-container div.lgnd-scroll div.lgnd-template[data-index="'+
a+'"] div.lgnd-group');g.empty();z[a]=e;PData.getAttID(e).l.forEach(function(a,e){l='<div class="lgnd-value lgnd-entry" data-index="'+e+'"><input type="checkbox" checked="checked" class="lgnd-entry-check"/><div class="lgnd-viz" style="background-color: '+a.v+'"> </div> <span class="lgnd-value-title">'+a.l+"</span></div>";g.append(l);a.z&&0<a.z.length&&a.z.forEach(function(a,c){l='<div class="lgnd-value lgnd-entry" data-index="'+e+","+c+'"><input type="checkbox" checked="checked" class="lgnd-entry-check"/>';
l=a.v&&""!=a.v?l+('<div class="lgnd-viz" style="background-color: '+a.v+'"></div>'):l+'<div class="lgnd-viz lgnd-viz-empty"></div>';l+=' <span class="lgnd-value-title">&raquo; '+a.l+"</span></div>";g.append(l)})});jQuery(c()+' div.lgnd-container div.lgnd-scroll div.lgnd-template[data-index="'+a+'"] div.lgnd-sh input').prop("checked",!0)}function x(e,d){var f=PData.getVizIndex(e);h&&(h.teardown(),h=null);var k=jQuery(c());k.find("div.viz-content div.viz-result").empty();var x;switch(f.vf){case "M":x=
new VizMap(g,f.c);break;case "C":x=new VizCards(g,f.c);break;case "P":x=new VizPinboard(g,f.c);break;case "T":x=new VizTime(g,f.c);break;case "D":x=new VizDirectory(g,f.c);break;case "t":x=new VizTextStream(g,f.c);break;case "S":x=new VizStackChart(g,f.c);break;case "N":x=new VizNetWheel(g,f.c)}r=e;var n=x.flags();n&V_FLAG_HSCRL?(k.find("div.viz-content").addClass("h-scroll"),k.find("div.viz-result").addClass("viz-fit-w"),k.find("div.viz-result").removeClass("viz-max-w")):(k.find("div.viz-content").removeClass("h-scroll"),
k.find("div.viz-result").removeClass("viz-fit-w"),k.find("div.viz-result").addClass("viz-max-w"));n&V_FLAG_VSCRL?(k.find("div.viz-content").addClass("v-scroll"),k.find("div.viz-result").addClass("viz-fit-h"),k.find("div.viz-result").removeClass("viz-max-h")):(k.find("div.viz-content").removeClass("v-scroll"),k.find("div.viz-result").removeClass("viz-fit-h"),k.find("div.viz-result").addClass("viz-max-h"));z=[];if(n&V_FLAG_LGND){k.find(".hslgnd").button("enable");var q=k.find("div.lgnd-container div.lgnd-scroll");
q.empty();if(n&V_FLAG_SLGND){var C=x.getFeatureAtts(),G=PData.getAttID(C);q.append('<div class="lgnd-template" data-index="0"><div class="lgnd-title">'+G.def.l+'</div><div class="lgnd-entry lgnd-sh"><input type="checkbox" checked="checked" class="lgnd-entry-check"/>'+dlText.sha+'</div><div class="lgnd-group"></div></div>');z.push(C);p(0,C)}else prspdata.e.g.ts.forEach(function(a,e){var c=PData.getTmpltID(a),g=x.getLocAtts(e);if(g&&0<g.length||!(n&V_FLAG_LOC)){var d=jQuery('<div class="lgnd-template" data-index="'+
e+'"><div class="lgnd-title">'+c.l+"</div></div>");g&&g.forEach(function(a,e){var c=PData.getAttID(a);d.append('<div class="lgnd-entry lgnd-locate" data-id="'+a+'"><input type="checkbox" checked="checked" class="lgnd-entry-check"/><span class="lgnd-value-title">'+c.def.l+"</span></div>")});var c=x.getFeatureAtts(e),h='<select class="lgnd-select">';c.forEach(function(a,e){var c=PData.getAttID(a);h+='<option value="'+a+'">'+c.def.l+"</option>"});h+="</select>";g=jQuery(h);g.change(l);jQuery(d).append(g);
jQuery(d).append('<div class="lgnd-entry lgnd-sh"><input type="checkbox" checked="checked" class="lgnd-entry-check"/>'+dlText.sha+'</div><div class="lgnd-group"></div>');q.append(d);e!=prspdata.t.length-1&&q.append("<hr/>");c=0<c.length?c[0]:null;z.push(c);c&&p(e,c)}});k.find("div.lgnd-container").show()}else k.find(".hslgnd").button("disable"),k.find("div.lgnd-container").hide();C=jQuery("#selector-v"+a);n&V_FLAG_SEL?(C.removeAttr("disabled"),C.prop("checked",!0)):(C.attr("disabled",!0),C.prop("checked",
!1));n&V_FLAG_SET?k.find(".vopts").button("enable"):k.find(".vopts").button("disable");"string"==typeof f.n&&""!=f.n?(k.find(".vnote").button("enable"),jQuery("#vnotes-txt").empty().append("<p>"+f.n+"</p>")):k.find(".vnote").button("disable");x.setup();m(!1);B&&d&&x.render(B);h=x}var g={},r=0,h=null,z=[],B=null;g.getFrameID=c;g.getIndex=function(){return a};g.setViz=function(a,e){a!=r&&(jQuery(c()+" div.view-control-bar select.view-viz-select").val(a),x(a,e))};g.initDOM=function(l){var g=document.getElementById("dltext-viewframe-dom").innerHTML;
jQuery("#viz-display-frame").append('<div id="view-frame-'+a+'">'+g+"</div>");g=jQuery(c());g.find("div.lgnd-container").draggable({handle:g.find("div.lgnd-handle"),containment:"parent"});var p=g.find("div.view-control-bar select.view-viz-select");prspdata.e.vf.forEach(function(a,e){p.append('<option value="'+e+'">'+a.l+"</option>")});p.val(l);p.change(d);g.find("div.view-control-bar button:first").button({icons:{primary:"ui-icon-bookmark"},text:!1}).click(f).next().button({icons:{primary:"ui-icon-search"},
text:!1}).click(k).next().button({icons:{primary:"ui-icon-cancel"},text:!1}).click(n).next().button({icons:{primary:"ui-icon-gear"},text:!1}).click(q).next().button({icons:{primary:"ui-icon-help"},text:!1}).click(v).next();g.find("div.lgnd-container").click(e);x(l,!1)};g.getSelLocAtts=function(a){var e=[];jQuery(c()+' div.lgnd-container div.lgnd-scroll div.lgnd-template[data-index="'+a+'"] div.lgnd-locate input:checked').each(function(){var a=jQuery(this).parent().data("id");e.push(a)});return e};
g.getSelFeatAtts=function(a){var e=[],l,g;jQuery(c()+' div.lgnd-container div.lgnd-scroll div.lgnd-template[data-index="'+a+'"] div.lgnd-group div.lgnd-value input:checked').each(function(){l=jQuery(this).parent().data("index");"number"==typeof l?e.push(l):-1!=(g=l.indexOf(","))?e.push([parseInt(l.substring(0,g),10),parseInt(l.substring(g+1),10)]):e.push(parseInt(l,10))});return e};g.getSelLegend=function(a){return z[a]};g.getLgndSels=function(){return z.slice(0)};g.setLgndSels=function(a){a.forEach(function(a,
e){jQuery(c()+' div.lgnd-container div.lgnd-scroll div.lgnd-template[data-index="'+e+'"] select.lgnd-select').val(a);p(e,a)})};g.getState=function(){return h?h.getState():null};g.setState=function(a){h&&h.setState(a)};g.showStream=function(a){B=a;h&&h.render(a)};g.setStream=function(a){B=a};g.selBtns=function(a){m(a)};g.clearSel=function(){h&&h.clearSel();m(!1)};g.setSel=function(a){return h&&h.flags()&V_FLAG_SEL?(h.setSel(a),m(0<a.length),!0):!1};g.resize=function(){h&&h.resize()};g.title=function(){return PData.getVizIndex(r).l};
g.flushLgnd=function(){jQuery(c()).find("div.lgnd-container").css("left","10px")};return g}
var PData=function(){function a(a,l,p){jQuery.ajax({type:"POST",url:prspdata.ajax_url,data:{action:"prsp_get_records",tmplt_id:prspdata.t[a].id,from:l,count:p},success:function(l,g,d){g=q[a];l=JSON.parse(l);g.d=g.d?g.d.concat(l):l;g.n+=p;c()},error:function(a,e,c){alert(c)}})}function c(){for(var e=!0,c=0;c<prspdata.t.length;c++){var p=q[c].n,f=prspdata.t[c].n;if(p<f){e=!1;f-=p;a(c,p,f<d?f:d);break}}e&&(A=!0,setTimeout(function(){jQuery("body").trigger("prospect",{pstate:PSTATE_PROCESS,component:0})},
500))}var d=1E3,f,k,m,n,q=[],v=0,A=!1;return{init:function(){f=document.getElementById("dltext-from").innerHTML;k=document.getElementById("dltext-to").innerHTML;m=document.getElementById("dltext-approximately").innerHTML;n=document.getElementById("dltext-now").innerHTML;"number"==typeof prspdata.chunk&&0<prspdata.chunk&&(d=prspdata.chunk);prspdata.t.forEach(function(a){q.push({i:v,n:0,d:null});v+=a.n});c()},strcmp:function(a,c){for(var p=0,d=Math.max(a.length,c.length);p<d&&a.charAt(p)===c.charAt(p);++p);
return p===d?0:a.charAt(p)>c.charAt(p)?-1:1},newIndexStream:function(a){var c={};c.s=new Uint16Array(v);c.t=[];c.l=0;if(a){for(a=0;a<v;a++)c.s[a]=a;for(a=0;a<q.length;a++){var p=q[a];c.t.push({i:p.i,n:p.n})}c.l=v}return c},aIndex2Tmplt:function(a){for(var c=0;c<q.length;c++){var p=q[c];if(p.i<=a&&a<p.i+p.n)return c}},attInTmplt:function(a,c){var p=prspdata.t[c],d=a.split("."),d=d[0];return-1!=p.def.a.findIndex(function(a){return a==d})},stream1stTEntry:function(a,c){var d=a.t[c];return 0==d.n?-1:
d.i},getRecByIndex:function(a){for(var c=0;c<q.length;c++){var d=q[c];if(0<d.n&&d.i<=a&&a<d.i+d.n)return d.d[a-d.i]}return null},procAttTxt:function(a,c){var d=PData.getAttID(a);switch(d.def.t){case "V":return c.join(", ");case "T":return c;case "N":return c.toString();case "D":return c.max?(d=f,c.min.f&&(d+=m),d+=c.min.y.toString(),c.min.m&&(d+="-"+c.min.m.toString(),c.min.d&&(d+="-"+c.min.d.toString())),d+=k,"open"==c.max?d+=n:(c.max.f&&(d+=m+" "),d+=c.max.y.toString(),c.max.m&&(d+="-"+c.max.m.toString(),
c.max.d&&(d+="-"+c.max.d.toString())))):(d=c.min.f?m:"",d+=c.min.y.toString(),c.min.m&&(d+="-"+c.min.m.toString(),c.min.d&&(d+="-"+c.min.d.toString()))),d;case "L":case "X":return c.join(", ");case "I":return'<img src="'+c+'" alt="'+d.def.l+'"/>';case "l":return'<a href="'+c+'" target="_blank">(See Link)</a>';case "S":return'<a href="'+c+'" target="_blank">(SoundCloud)</a>';case "Y":return'<a href="https://www.youtube.com/watch?v='+c+'" target="_blank">(YouTube)</a>';case "x":return'<a href="'+c+
'" target="_blank">(See Transcript File)</a>';case "t":return c;case "P":if(0<c.length){var x="";c.forEach(function(a){(a=PData.getRecByID(a))&&(x+='<a href="'+prspdata.site_url+"?p="+a.wp+'" target="_blank">'+a.l+"</a> ")});return x}}return null},getRecAtt:function(a,c,d){for(var f=0;f<q.length;f++){var g=q[f];if(0<g.n&&g.i<=a&&a<g.i+g.n){a=g.d[a-g.i].a[c];if(null==a||"undefined"==typeof a)break;return d?a:PData.procAttTxt(c,a)}}return null},getAbsIByID:function(a){for(var c=0;c<q.length;c++){var d=
q[c];if(0<d.n)for(var f=0,g=d.n-1,r,h;f<=g;)if(r=f+g>>1,h=d.d[r],h=PData.strcmp(a,h.id),0>h)f=r+1;else if(0<h)g=r-1;else return d.i+r}return null},getRecByID:function(a){for(var c=0;c<q.length;c++){var d=q[c];if(0<d.n)for(var f=0,g=d.n-1,r,h,k;f<=g;)if(r=f+g>>1,k=d.d[r],h=PData.strcmp(a,k.id),0>h)f=r+1;else if(0<h)g=r-1;else return k}return null},getAttID:function(a){for(var c=0,d=prspdata.a.length-1,f,g;c<=d;)if(f=c+d>>1,g=PData.strcmp(a,prspdata.a[f].id),0>g)c=f+1;else if(0<g)d=f-1;else return prspdata.a[f];
return null},getAttIndex:function(a){return prspdata.a[a]},getNumETmplts:function(){return prspdata.e.g.ts.length},getETmpltIndex:function(a){return prspdata.e.g.ts[a]},getTmpltID:function(a){for(var c=0;c<prspdata.t.length;c++)if(a==prspdata.t[c].id)return prspdata.t[c].def},getAttLgndRecs:function(a,c,d,f){var g,r=d.length,h;switch(c.def.t){case "V":var k=function(a){for(var e=0;e<r;e++)if(g=d[e],"number"===typeof g){if(h=c.l[g],h.l==a)return h}else{h=c.l[g[0]];var f=h.z[g[1]];if(f.l==a)return f.v&&
""!=f.v?f:h}return null};if(f&&""!=c.def.d){var m=[],n;a.forEach(function(a){n=k(a);null!=n&&m.push(n)});return 0<m.length?m:null}if(""!=c.def.d){for(f=0;f<a.length;f++)if(n=k(a[f]),null!=n)return n;break}else return k(a[0]);case "T":for(n=0;n<r;n++)if(g=d[n],h=c.l[g],-1!=a.indexOf(h.d))return h;break;case "N":for(n=0;n<r;n++)if(g=d[n],h=c.l[g],"undefined"!=typeof h.d.min){if(h.d.min<=a)if("undefined"!=typeof h.d.max){if(a<=h.d.max)return h}else return h}else if(a<=h.d.max)return h;break;case "D":for(n=
0;n<r;n++)if(g=d[n],h=c.l[g],"undefined"!=typeof h.d.max.y){if("undefined"!=typeof a.max&&"open"!=a.max){if(a.max.y<h.d.min.y)continue;if(a.max.y==h.d.min.y&&a.max.m&&h.d.min.m){if(a.max.m<h.d.min.m)continue;if(a.max.m==h.d.min.m&&a.max.d&&h.d.min.d&&a.max.d<h.d.min.d)continue}}if(!(a.min.y>h.d.max.y)){if(a.min.y==h.d.max.y&&a.min.m&&h.d.max.m){if(a.min.m>h.d.max.m)continue;if(a.min.m==h.d.max.m&&a.min.d&&h.d.max.d&&a.min.d>h.d.max.d)continue}return h}}else if("undefined"!=typeof a.max){if("open"==
a.max)return h;if(!(a.max.y<h.d.min.y)){if(a.max.y==h.d.min.y&&a.max.m&&h.d.min.m){if(a.max.m<h.d.min.m)continue;if(a.max.m==h.d.min.m&&a.max.d&&h.d.min.d&&a.max.d<h.d.min.d)continue}return h}}else if(!(a.min.y<h.d.min.y)){if(a.min.y==h.d.min.y&&a.min.m&&h.d.min.m){if(a.min.m<h.d.min.m)continue;if(a.min.m==h.d.min.m&&a.min.d&&h.d.min.d&&a.min.d<h.d.min.d)continue}return h}}return null},getAttLgndVal:function(a,c,d){var f;return(f=PData.getAttLgndRecs(a,c,d,!1))?f.v:null},getVLgndVal:function(a,c){for(var d=
0,f=a.x.length-1,g,r;d<=f;)if(g=d+f>>1,r=PData.strcmp(c,a.x[g].l),0>r)d=g+1;else if(0<r)f=g-1;else return d=a.x[g].i,"number"==typeof d?a.l[d]:a.l[d[0]].z[d[1]];return null},date3Nums:function(a,c,d){0>a||99<a?c=new Date(a,c-1,d):0==a?c=new Date(-1,c-1,d):(c=new Date(a,c-1,d),c.setUTCFullYear(("0000"+a).slice(-4)));return c},objDate:function(a,c){var d;"undefined"!=typeof a.m&&null!=a.m?(c=a.m,d="undefined"!=typeof a.d&&null!=a.d?a.d:mnthDays[c-1]):d=mnthDays[c-1];return PData.date3Nums(a.y,c,d)},
parseDate:function(a,c,d){if("open"==a)return TODAY;var f=1;"-"==a.charAt(0)&&(f=-1,a=a.substring(1));a=a.split("-");f*=parseInt(a[0]);1<a.length&&(c=parseInt(a[1]),3==a.length&&(d=parseInt(a[2])));return PData.date3Nums(f,c,d)},makeDates:function(a){var c,d,f,g,r=!1;d=a.min.y;"undefined"==typeof a.min.m?g=f=1:(f=a.min.m,"undefined"==typeof a.min.d?g=1:(g=a.min.d,r=!0));c=PData.date3Nums(d,f,g);if("undefined"!=typeof a.max)"open"==a.max?a=TODAY:(d=a.max.y,"undefined"==typeof a.max.m?(f=12,g=31):(f=
a.max.m,g="undefined"==typeof a.max.d?mnthDays[f-1]:a.max.d),a=PData.date3Nums(d,f,g));else{if(r)return[c,null];"undefined"==typeof a.min.m?(f=12,g=31):g=mnthDays[f-1];a=PData.date3Nums(d,f,g)}return[c,a]},getLCats:function(a,c){var d=[];switch(a.def.t){case "T":return a.l.forEach(function(f){(null==c||PData.getAttLgndRecs(f.d,a,c,!1))&&d.push({l:f.l,x:f.d,c:f.v,i:[]})}),d;case "V":return a.l.forEach(function(f){(null==c||PData.getAttLgndRecs([f.l],a,c,!1))&&d.push({l:f.l,c:f.v,i:[]});f.z.forEach(function(f){(null==
c||PData.getAttLgndRecs([f.l],a,c,!1))&&d.push({l:f.l,c:f.v,i:[]})})}),d;case "N":return a.l.forEach(function(f){(null==c||PData.getAttLgndRecs(f.d.min,a,c,!1))&&d.push({l:f.l,c:f.v,min:f.d.min,max:f.d.max,i:[]})}),d;case "D":var f,g;a.l.forEach(function(k){f=PData.objDate(k.min,1);if(null==c||PData.getAttLgndRecs(f,a,c,!1))g=null==k.max.y?TODAY:PData.objDate(k.max,12),d.push({l:k.l,c:k.v,min:f,max:g})});return d}},getRCats:function(a,c){var d=[];switch(a.def.t){case "T":return a.l.forEach(function(a){c?
d.push({l:a.l,x:a.d,c:a.v,i:[]}):d.push({l:a.l,x:a.d,c:a.v})}),d;case "V":return a.l.forEach(function(a){c?d.push({l:a.l,c:a.v,i:[]}):d.push({l:a.l,c:a.v});a.z.forEach(function(a){c?d.push({l:a.l,c:a.v,i:[]}):d.push({l:a.l,c:a.v})})}),d;case "N":if("undefined"==typeof a.r.min||"undefined"==typeof a.r.max)return null;var f=Math.pow(10,a.r.g),g=a.r.min,k=0,h,m,n;for(0<a.l.length&&(h=a.l[0]);g<=a.r.max;){for(;k<a.l.length&&"undefined"!=typeof h.d.max&&g>h.d.max;)h=a.l[++k];n=0==a.l.length||g<h.d.min?
"#000000":k==a.l.length?"#000000":"undefined"==typeof h.d.max||g<=h.d.max?h.v:"#000000";m=g;max=g+=f;c?d.push({l:m.toString(),c:n,min:m,max:g,i:[]}):d.push({l:m.toString(),c:n,min:m,max:g})}return d;case "D":g=function(a){var c,e;if("undefined"==typeof a.y)return TODAY;c=a.y;"undefined"==typeof a.m?(e=12,a=31):(e=a.m,a="undefined"==typeof a.d?mnthDays[e-1]:a.d);return PData.date3Nums(c,e,a)};m=function(a,c,e,d){"undefined"!=typeof d.m&&(c=d.m,"undefined"!=typeof d.d&&(e=d.d));return PData.date3Nums(a,
c,e)};n=g(a.r.max);var f=a.r.g,q=a.r.min.y,w=1,t=1;"undefined"!=typeof a.r.min.m&&(w=a.r.min.m,"undefined"!=typeof a.r.min.d&&(t=a.r.min.d));var u=PData.date3Nums(q,w,t),k=0,v,A;0<a.l.length&&(h=a.l[0],v=m(h.d.min.y,1,1,h.d.min),A=g(h.d.max));for(;u<=n;){var E={};c&&(E.i=[]);switch(f){case "d":E.l=q.toString()+"-"+w.toString()+"-"+t.toString();break;case "m":E.l=q.toString()+"-"+w.toString();break;case "y":case "t":case "c":E.l=q.toString()}for(;k<a.l.length&&u>A;)h=a.l[++k],k<a.l.length&&(v=m(h.d.min.y,
1,1,h.d.min),A=g(h.d.max));E.c=0==a.l.length||u<v?"#000000":k==a.l.length?"#000000":u<=A?h.v:"#000000";E.min=u;switch(f){case "d":E.max=PData.date3Nums(q,w,t+1);t++;break;case "m":E.max=PData.date3Nums(q,w+1,t);w++;break;case "y":E.max=PData.date3Nums(q+1,w,t);q++;break;case "t":E.max=PData.date3Nums(q+10,w,t);q+=10;break;case "c":E.max=PData.date3Nums(q+100,w,t),q+=100}d.push(E);u=PData.date3Nums(q,w,t)}return d}},fillCats:function(a,c,d,f,g){var k=PData.getNumETmplts(),h=0,m,n=0,q,w,t,u,v=PData.getAttID(c);
for(m=f.t[0];n<f.l;){for(;0==m.n||m.i+m.n==n||!PData.attInTmplt(c,h)||d&&!PData.attInTmplt(d,h);){if(++h==k)return;m=f.t[h];n=m.i}q=f.s[n];w=PData.getRecByIndex(q);w=w.a[c];if("undefined"!=typeof w)switch(v.def.t){case "T":if(g){for(t=0;t<a.length;t++)if(u=a[t],w==u.l){u.i.push(q);break}t==a.length&&a.push({l:w,i:[q]})}else for(t=0;t<a.length;t++)if(u=a[t],-1!=w.indexOf(u.x)){u.i.push(q);break}break;case "V":w.forEach(function(c){for(t=0;t<a.length;t++)if(u=a[t],c==u.l){u.i.push(q);break}});break;
case "N":for(t=0;t<a.length;t++){u=a[t];if(w<u.min)break;if(u.min<=w&&w<=u.max){u.i.push(q);break}}break;case "D":for(w=PData.objDate(w.min,1),t=0;t<a.length;t++){u=a[t];if(w<u.min)break;if(u.min<=w&&w<=u.max){u.i.push(q);break}}}n++}g&&a.sort(function(a,c){return PData.strcmp(c.l,a.l)})},sortCats:function(a,c,d){var f=c.id,g,k,h;a.forEach(function(a){g=PData.getRecByIndex(a);datum=g.a[f];if("undefined"!=typeof datum)switch(c.def.t){case "T":for(k=0;k<d.length;k++)if(h=d[k],-1!=datum.indexOf(h.x)){h.i.push(a);
break}break;case "V":datum.forEach(function(c){for(k=0;k<d.length;k++)if(h=d[k],c==h.l){h.i.push(a);break}});break;case "N":for(k=0;k<d.length;k++){h=d[k];if(datum<h.min)break;if(h.min<=datum&&datum<=h.max){h.i.push(a);break}}break;case "D":var e=PData.objDate(datum.min,1);for(k=0;k<d.length;k++){h=d[k];if(e<h.min)break;if(h.min<=e&&e<=h.max){h.i.push(a);break}}}})},orderTBy:function(a,c,d){function f(a){return a}function g(a){return a[0]}function k(a){var c=1,e=1;"undefined"!=typeof a.min.m&&(c=
a.m,"undefined"!=typeof a.min.d&&(e=a.d));return PData.date3Nums(a.min.y,c,e)}var h,m;switch(a.def.t){case "T":h=f;m="~";break;case "V":h=g;m="~";break;case "N":h=f;m=a.r.max;break;case "D":h=k,m=TODAY}var n=[],v=c.t[d];d=q[d];for(var w=0,t,u;w<v.n;)t=c.s[v.i+w++],u=d.d[t-d.i],u=u.a[a.id],"undefined"==typeof u?n.push({i:t,v:m}):n.push({i:t,v:h(u)});switch(a.def.t){case "T":case "V":n.sort(function(a,c){return PData.strcmp(a.v,c.v)});break;case "D":case "N":n.sort(function(a,c){return a.v-c.v})}return n},
getVizIndex:function(a){return prspdata.e.vf[a]},ready:function(){return A}}}();
jQuery(document).ready(function(a){function c(){var a;PState.set(PSTATE_PROCESS);null==w&&(w=PData.newIndexStream(!0));t=w;var c=!1,e,d;for(e=0;e<h.length;e++)if(d=h[e],a=jQuery('div.filter-instance[data-id="'+d.id+'"]'),c||d.f.isDirty(null)){c=!0;d.f.evalPrep();var f=PData.newIndexStream(!1),k=0,l,m,n=0,q=t.t[0],p=0,u;for(u=a.find(".apply-tmplt-0").is(":checked");k<t.l;){for(;0==q.n||q.i+q.n==k;)f.t.push({i:f.l-p,n:p}),p=0,q=t.t[++n],u=a.find(".apply-tmplt-"+n).is(":checked");l=t.s[k++];u?(m=PData.getRecByIndex(l),
d.f.eval(m)&&(f.s[f.l++]=l,p++)):(f.s[f.l++]=l,p++)}for(;n++<PData.getNumETmplts();)f.t.push({i:f.l-p,n:p}),p=0;d.f.isDirty(!1);t=d.f.out=f}else t=d.f.out;PState.set(PSTATE_BUILD);g.showStream(t);r&&r.showStream(t);jQuery("#btn-recompute").removeClass("pulse")}function d(a){var c=jQuery("#annote");c.text(a);0<a.length?(jQuery("#btn-annote").button("enable"),c.show()):(jQuery("#btn-annote").button("disable"),c.hide())}function f(a){var c=_.find(prspdata.p,function(c){return a==c.id});return c?c:null==
u||0==D.length?null:(c=_.find(D,function(c){return a==c.id}))?c:null}function k(a){var c=jQuery("input[name=save-prspctv-dest]:checked").val();if(""==c)return null;var e=jQuery("#save-psrctv-note").val(),e=e.replace(/"/,""),d=jQuery("#save-psrctv-lbl").val().trim(),d=d.replace(/"/,""),f=!jQuery("#selector-v0").prop("disabled")&&jQuery("#selector-v0").is(":checked"),k=!jQuery("#selector-v1").prop("disabled")&&jQuery("#selector-v1").is(":checked"),l={f:[],s:null,a0:f,a1:k,v0:{l:g.title(),s:g.getState()},
v1:null};h.forEach(function(a){for(var c=[],e=jQuery('div.filter-instance[data-id="'+a.id+'"]'),d=0;d<PData.getNumETmplts();d++)c.push(e.find(".apply-tmplt-"+d).is(":checked"));l.f.push({id:a.attID,a:c,s:a.f.getState()})});z&&(l.s={id:B,s:z.getState()});r&&(l.v1={l:r.title(),s:r.getState()});var m={id:a,l:d,n:e,s:l};"local"==c?(D.push(m),u.setItem(prspdata.e.id,JSON.stringify(D))):"server"==c&&jQuery.ajax({type:"POST",url:prspdata.ajax_url,data:{action:"prsp_save_prspctv",id:a,l:d,x:prspdata.e.id,
n:e,s:JSON.stringify(l)},success:function(a,c,e){"0"!=a&&prspdata.p.push(m)},error:function(a,c,e){alert(e)}});return c}function m(){var a,c=[],e=!1;(function(){var a=jQuery("#prspctv-mlist");a.empty();D.forEach(function(c){a.append('<li data-type="l" data-id="'+c.id+'"><span class="label">'+c.l+'</span> <button class="del">'+dlText.del+'</button> <button class="edit">'+dlText.edit+"</button></li>")});for(var e=0;e<u.length;e++){var d=u.key(e);if(d!=prspdata.e.id){var f=u.getItem(d);c.push({id:d,
ps:JSON.parse(f)})}}c.forEach(function(c,e){c.ps.forEach(function(d){a.append('<li data-type="x" data-xid="'+c.id+'" data-xindex="'+e+'" data-id="'+d.id+'"><i class="label">'+d.l+'</i> <button class="del">'+dlText.del+'</button> <button class="edit">'+dlText.edit+"</button></li>")})})})();jQuery("#prspctv-mlist").click(function(a){if("BUTTON"==a.target.nodeName){var d=jQuery(a.target).hasClass("del"),f=jQuery(a.target).parent(),g=f.data("type"),h=f.data("id");if(d){switch(g){case "l":a=D.findIndex(function(a){return h==
a.id});-1!=a&&(D.splice(a,1),0==D.length?u.removeItem(prspdata.e.id):u.setItem(prspdata.e.id,JSON.stringify(D)));break;case "x":a=f.data("xindex"),d=c[a],a=d.ps.findIndex(function(a){return h==a.id}),-1!=a&&(d.ps.splice(a,1),e=!0)}f.remove()}else{var k;switch(g){case "l":k=_.find(D,function(a){return h==a.id});break;case "x":a=f.data("xindex"),d=c[a],k=_.find(d.ps,function(a){return h==a.id})}jQuery("#edit-psrctv-lbl").val(k.l);jQuery("#edit-psrctv-note").val(k.n);var l=jQuery("#dialog-edit-prsrctv").dialog({width:340,
height:270,modal:!0,buttons:[{text:dlText.ok,click:function(){k.l=jQuery("#edit-psrctv-lbl").val();k.n=jQuery("#edit-psrctv-note").val();f.find(".label").text(k.l);"x"==g?e=!0:u.setItem(prspdata.e.id,JSON.stringify(D));l.dialog("close")}},{text:dlText.cancel,click:function(){l.dialog("close")}}]})}}});a=jQuery("#dialog-manage-prsrctv").dialog({width:450,height:350,modal:!0,buttons:[{text:dlText.ok,click:function(){e&&c.forEach(function(a){0<a.ps.length?u.setItem(a.id,JSON.stringify(a.ps)):u.removeItem(a.id)});
jQuery("#prspctv-mlist").off("click");a.dialog("close")}}]})}function n(a){window.location.href=prspdata.e.g.hurl;a.preventDefault()}function q(a){jQuery(this).parent().next().slideToggle(400);a.preventDefault()}function v(a){if(a=jQuery(this).closest("div.filter-instance")){var c=a.data("id");c&&""!=c&&(a=h.find(function(a){return a.id==c}),null==a?alert("Bad Filter ID "+c):a.f.isDirty(!0))}}function A(a){var c=jQuery(this).closest("div.filter-instance"),e=c.data("id"),d,f;d=h.findIndex(function(a){return a.id==
e});-1==d?alert("Bad Filter ID "+e):(f=h[d].f,f.teardown(),h.splice(d,1),d>=h.length?(d=0==h.length?w:h[d-1].out,g.setStream(d),r&&r.setStream(d),jQuery("#btn-recompute").addClass("pulse")):h[d].f.isDirty(!0),c.remove(),0==h.length&&jQuery("#btn-toggle-filters").button("disable"),a.preventDefault())}function e(){null!=z&&(z.teardown(),jQuery('div.filter-instance[data-id="0"]').empty(),z=null,jQuery("#btn-toggle-selector").button("disable"),jQuery("#btn-apply-selector").button("disable"))}function l(a,
c,d){var f;if(d)e(),f=0;else{do f=Math.floor(1E3*Math.random()+1),-1!=h.findIndex(function(a){return a.id==f})&&(f=-1);while(-1==f)}var g,k;if("_remove"==a)g=new PFilterRemove(f),k={t:[!0,!0,!0,!0]};else switch(k=PData.getAttID(a),k.def.t){case "V":g=new PFilterVocab(f,k);break;case "T":g=new PFilterText(f,k);break;case "N":g=new PFilterNum(f,k);break;case "D":g=new PFilterDates(f,k)}if(d)z=g,B=a,d=_.template(document.getElementById("dltext-selector-head").innerHTML),a=jQuery('div.filter-instance[data-id="0"]'),
a.append(d({title:g.title()})),a.find("button.btn-filter-del").button({text:!1,icons:{primary:"ui-icon-trash"}}).click(e);else{h.push({id:f,attID:a,f:g,out:null});d=_.template(document.getElementById("dltext-filter-head").innerHTML);jQuery("#filter-instances").append(d({newID:f,title:g.title(),apply:y}));a=jQuery('div.filter-instance[data-id="'+f+'"]');for(d=0;d<PData.getNumETmplts();d++){var l=a.find(".apply-tmplt-"+d);l.prop("disabled",!k.t[d]);l.prop("checked",c[d]);l.click(v)}a.find("button.btn-filter-toggle").button({text:!1,
icons:{primary:"ui-icon-carat-2-n-s"}}).click(q);a.find("button.btn-filter-del").button({text:!1,icons:{primary:"ui-icon-trash"}}).click(A);jQuery("#btn-recompute").addClass("pulse")}g.setup();return g}function p(){PState.set(PSTATE_PROCESS);var a=[],c=!1;if(null!=z&&null!=t){z.evalPrep();for(var d=0,e,f;d<t.l;)e=t.s[d++],f=PData.getRecByIndex(e),z.eval(f)&&a.push(e);z.isDirty(!1)}PState.set(PSTATE_UPDATE);jQuery("#selector-v0").is(":checked")&&(c=g.setSel(a));jQuery("#selector-v1").is(":checked")&&
r&&(c&&(a=a.slice(0)),r.setSel(a))}function x(a){function k(a){return prspdata.e.vf.findIndex(function(c){return a==c.l})}a=f(a);if(null==a)return!1;PState.set(PSTATE_PROCESS);h.forEach(function(a){a.f.teardown()});h=[];jQuery("#filter-instances").empty();a.s.f.forEach(function(a){l(a.id,a.a,!1).setState(a.s)});jQuery("#filter-instances").hide();jQuery("#btn-toggle-filters").button(0==a.s.f.length?"disable":"enable");e();null!=a.s.s&&(l(a.s.s.id,null,!0),z.setState(a.s.s.s),jQuery("#btn-toggle-selector").button("enable"),
jQuery("#btn-apply-selector").button("enable"));jQuery("#selector-instance").hide();var m;PState.set(PSTATE_BUILD);m=k(a.s.v0.l);g?(g.setViz(m,!1),g.selBtns(!1)):(g=PViewFrame(0),g.initDOM(m));g.setState(a.s.v0.s);null!=a.s.v1?(m=k(a.s.v1.l),r?(r.selBtns(!1),r.setViz(m,!1),r.setState(a.s.v1.s)):(g.flushLgnd(),r=PViewFrame(1),r.initDOM(m),r.setState(a.s.v1.s),g.resize())):r&&(r=null,jQuery("#view-frame-1").remove(),jQuery("#selector-v1").prop("disabled",!0),g.resize());d(a.n);jQuery("#selector-v0").prop("checked",
a.s.a0);jQuery("#selector-v1").prop("checked",a.s.a1);PData.ready()&&w&&(c(),z&&p());return!0}var g,r,h=[],z=null,B,y,w,t,u=null,D=[];jQuery("body").addClass("waiting");PState.init();PMapHub.init(prspdata.m);(function(){function a(d,e){c=document.getElementById(d).innerHTML;dlText[e]=c.trim()}var c;a("dltext-removehideall","rha");a("dltext-showhideall","sha");a("dltext-ok","ok");a("dltext-cancel","cancel");a("dltext-seerec","seerec");a("dltext-close","close");a("dltext-add","add");a("dltext-manage",
"manage");a("dltext-delete","del");a("dltext-edit","edit");c=document.getElementById("dltext-month-names").innerHTML;months=c.trim().split("|");(c=document.getElementById("dltext-d3-local"))&&(c=c.innerHTML)&&1<c.length&&(localD3=d3.locale(JSON.parse(c)).timeFormat.multi([["%H:%M",function(a){return a.getMinutes()}],["%H:%M",function(a){return a.getHours()}],["%a %d",function(a){return a.getDay()&&1!=a.getDate()}],["%b %d",function(a){return 1!=a.getDate()}],["%B",function(a){return a.getMonth()}],
["%Y",function(){return!0}]]))})();xhbtURL=window.location.pathname;xhbtURL=xhbtURL.replace(/\&*prspctv=[\w\-]+/,"");xhbtURL=xhbtURL.replace(/\/$/,"");xhbtURL=xhbtURL.replace(/^\//,"");xhbtURL=window.location.protocol+"//"+window.location.host+"/"+xhbtURL;(function(){var a=_.template(document.getElementById("dltext-filter-template").innerHTML),c=[];prspdata.t.forEach(function(d,e){c.push(a({ti:e,tl:d.def.l}))});y=c.join("&nbsp;")})();"/"!=prspdata.site_url.charAt(prspdata.site_url.length-1)&&(prspdata.site_url+=
"/");""!=prspdata.e.g.l&&jQuery("#title").text(prspdata.e.g.l);try{var F=window.localStorage;F.setItem("__storage_test__","__storage_test__");F.removeItem("__storage_test__");var E=F.getItem(prspdata.e.id),u=F;0<E.length&&(D=JSON.parse(E))}catch(C){}jQuery("#btn-about").button({icons:{primary:"ui-icon-info"},text:!1}).click(function(a){var c;jQuery("#dialog-about img").removeClass("zoomin");c=jQuery("#dialog-about").dialog({height:390,width:350,modal:!0,buttons:[{text:dlText.ok,click:function(){c.dialog("close")}}]});
jQuery("#dialog-about img").addClass("zoomin");a.preventDefault()});jQuery("#btn-recompute").button({icons:{primary:"ui-icon-refresh"},text:!1}).click(function(a){c();PState.set(PSTATE_READY);a.preventDefault()});jQuery("#btn-set-layout").button({icons:{primary:"ui-icon-newwin"},text:!1}).click(function(){null!=r?(r=null,jQuery("#view-frame-1").remove(),jQuery("#selector-v1").prop("checked",!1),jQuery("#selector-v1").prop("disabled",!0)):(g.flushLgnd(),PState.set(PSTATE_BUILD),r=PViewFrame(1),r.initDOM(0),
r.showStream(t),jQuery("#selector-v1").prop("disabled",!1),PState.set(PSTATE_READY));g.resize()});jQuery("#btn-show-prspctv").button({icons:{primary:"ui-icon-image"},text:!1}).click(function(a){var c=jQuery("#prspctv-slist");c.empty();prspdata.p.forEach(function(a){c.append('<li data-src="server" data-id="'+a.id+'">'+a.l+"</li>")});D.forEach(function(a){c.append('<li data-src="local" data-id="'+a.id+'">'+a.l+"</li>")});var d=[{text:dlText.ok,click:function(){e.dialog("close");var a=c.find("li.selected");
a.length&&(a=a.data("id"),x(a),PState.set(PSTATE_READY))}},{text:dlText.cancel,click:function(){e.dialog("close")}}];u&&d.push({text:dlText.manage,click:function(){e.dialog("close");m()}});var e=jQuery("#dialog-show-prsrctv").dialog({width:350,height:350,modal:!0,buttons:d});a.preventDefault()});jQuery("#btn-save-prspctv").button({icons:{primary:"ui-icon-pencil"},text:!1}).click(function(a){var c,d=/[^\w\-]/;jQuery("#save-psrctv-id").val("");jQuery("#save-psrctv-lbl").val("");jQuery("#save-psrctv-note").val("");
u||jQuery("#save-prspctv-d-1").attr("disabled","disabled");prspdata.add_prspctv||jQuery("#save-prspctv-d-2").attr("disabled","disabled");c=jQuery("#dialog-save-prsrctv").dialog({width:340,height:350,modal:!0,buttons:[{text:dlText.ok,click:function(){var a=jQuery("#save-psrctv-id").val().trim(),e=a.match(d);0==a.length||20<a.length||e?e="#dialog-prspctv-id-badchars":f(a)&&(e="#dialog-prspctv-id-used");if(e)var g=jQuery(e).dialog({width:320,height:210,modal:!0,buttons:[{text:dlText.ok,click:function(){g.dialog("close")}}]});
else if(e=k(a),c.dialog("close"),"server"==e){a=xhbtURL+"/?prspctv="+a;jQuery("#save-psrctv-embed").val(a);var h=jQuery("#dialog-prspctv-url").dialog({width:480,height:230,modal:!0,buttons:[{text:dlText.ok,click:function(){h.dialog("close")}}]})}}},{text:dlText.cancel,click:function(){c.dialog("close")}}]});a.preventDefault()});jQuery("#btn-annote").button({icons:{primary:"ui-icon-comment"},text:!1}).click(function(a){jQuery("#annote").toggle("slide",{direction:"right"});a.preventDefault()});0<prspdata.e.g.hbtn.length&&
0<prspdata.e.g.hurl.length?(jQuery("#home-title").text(prspdata.e.g.hbtn),jQuery("#btn-home").button({icons:{primary:"ui-icon-home"},text:!1}).click(n)):jQuery("#btn-home").remove();jQuery("#filter-list").click(function(a){"I"==a.target.nodeName?(jQuery("#filter-list li").removeClass("selected"),jQuery(a.target).parent().addClass("selected")):"LI"==a.target.nodeName&&(jQuery("#filter-list li").removeClass("selected"),jQuery(a.target).addClass("selected"))});jQuery("#prspctv-slist").click(function(a){"LI"==
a.target.nodeName&&(jQuery("#prspctv-list li").removeClass("selected"),jQuery(a.target).addClass("selected"))});jQuery("#btn-new-filter").button({icons:{primary:"ui-icon-plus"},text:!1}).click(function(a){var c=1==PData.getNumETmplts()?[!0]:[!1,!1,!1,!1];jQuery("#filter-list li").removeClass("selected");jQuery("#filter-list li.remove").show();var d;d=jQuery("#dialog-new-filter").dialog({height:300,width:350,modal:!0,buttons:[{text:dlText.add,click:function(){var a=jQuery("#filter-list li.selected");
a.length&&(jQuery("#filter-instances").show(400),l(a.data("id"),c,!1),jQuery("#btn-toggle-filters").button("enable"));d.dialog("close")}},{text:dlText.cancel,click:function(){d.dialog("close")}}]});a.preventDefault()});jQuery("#btn-toggle-filters").button({icons:{primary:"ui-icon-arrow-2-n-s"},text:!1}).click(function(a){jQuery("#filter-instances").slideToggle(400);a.preventDefault()});jQuery("#btn-new-selector").button({icons:{primary:"ui-icon-plus"},text:!1}).click(function(a){jQuery("#filter-list li").removeClass("selected");
jQuery("#filter-list li.remove").hide();var c;c=jQuery("#dialog-new-filter").dialog({height:300,width:350,modal:!0,buttons:[{text:dlText.add,click:function(){var a=jQuery("#filter-list li.selected");a.length&&(jQuery("#selector-instance").show(400),l(a.data("id"),null,!0),jQuery("#btn-toggle-selector").button("enable"),jQuery("#btn-apply-selector").button("enable"));c.dialog("close")}},{text:dlText.cancel,click:function(){c.dialog("close")}}]});a.preventDefault()});jQuery("#btn-toggle-selector").button({icons:{primary:"ui-icon-arrow-2-n-s"},
text:!1}).click(function(a){jQuery("#selector-instance").slideToggle(400);a.preventDefault()});jQuery("#btn-apply-selector").button({icons:{primary:"ui-icon-arrowreturn-1-e"},text:!1}).click(function(a){p();PState.set(PSTATE_READY);a.preventDefault()});jQuery("#dialog-about .logo").attr("src",prspdata.assets+"prospectlogo.jpg");jQuery("#btn-inspect-left").button({icons:{primary:"ui-icon-arrowthick-1-w"},text:!1});jQuery("#btn-inspect-right").button({icons:{primary:"ui-icon-arrowthick-1-e"},text:!1});
(function(){jQuery("#filter-list").append('<li class="remove" data-id="_remove"><i>'+dlText.rha+"</i></li>");prspdata.a.forEach(function(a){switch(a.def.t){case "V":case "T":case "N":case "D":jQuery("#filter-list").append('<li data-id="'+a.id+'">'+a.def.l+"</li>")}})})();0!=prspdata.show_prspctv.length&&x(prspdata.show_prspctv)||(g=PViewFrame(0),g.initDOM(0),d(""));jQuery(window).resize(function(){g&&g.resize();r&&r.resize()});jQuery("body").on("prospect",function(a,d){d.pstate==PSTATE_PROCESS&&(PState.set(PSTATE_PROCESS),
c(),z&&p(),PState.set(PSTATE_READY),jQuery("body").removeClass("waiting"))});PState.set(PSTATE_LOAD);PData.init()});function onYouTubeIframeAPIReady(){widgetData.ytCall&&widgetData.ytCall()};