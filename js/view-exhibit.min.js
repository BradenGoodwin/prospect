Array.prototype.findIndex||(Array.prototype.findIndex=function(a,d){if(null==this)throw new TypeError("Array.prototype.find called on null or undefined");if("function"!==typeof a)throw new TypeError("predicate must be a function");for(var e=Object(this),f=e.length>>>0,g,h=0;h<f;h++)if(g=e[h],a.call(d,g,h,e))return h;return-1});
var EVENT_INSTANT=1,EVENT_F_START=2,EVENT_F_END=4,PSTATE_INIT=0,PSTATE_LOAD=1,PSTATE_PROCESS=2,PSTATE_BUILD=3,PSTATE_UPDATE=4,PSTATE_READY=5,D3FG_BAR_WIDTH=25,D3FG_MARGINS={top:4,right:7,bottom:22,left:30},D3SC_MARGINS={top:30,right:5,bottom:5,left:40},V_FLAG_LGND=1,V_FLAG_SEL=2,V_FLAG_LOC=4,V_FLAG_SLGND=8,V_FLAG_OPT=16,V_FLAG_VSCRL=32,V_FLAG_HSCRL=64,parseTC=/(\d\d)\:(\d\d)\:(\d\d)\.(\d\d?)/,MS_IN_DAY=86399990,TODAY=new Date,localD3,months,dlText={},xhbtURL,widgetData={ytLoaded:!1,ytCall:null,ytCode:null,
timer:null,extract:null,sTime:null,eTime:null,playing:!1,widget:null,xscriptOn:!1,tcArray:null,tcIndex:-1},PState=function(){var a=PSTATE_INIT,d;return{init:function(){d=document.getElementById("dltext-pstates").innerHTML.trim().split("|")},set:function(e){if(e!=a){var f=jQuery("#pstate");a==PSTATE_READY?f.addClass("attn"):e==PSTATE_READY&&f.removeClass("attn");f.text(d[e-1]);a=e}}}}();
function PVizModel(a,d){this.vFrame=a;this.frameID=a.getFrameID()+" div.viz-content div.viz-result";this.settings=d;this.recSel=[]}PVizModel.prototype.flags=function(){return 0};PVizModel.prototype.isSel=function(a){return-1!=_.indexOf(this.recSel,a,!0)};PVizModel.prototype.getSel=function(){return this.recSel};
PVizModel.prototype.toggleSel=function(a){var d=this.recSel.length,e=_.sortedIndex(this.recSel,a);if(this.recSel[e]==a)return this.recSel.splice(e,1),0<d&&0==this.recSel.length&&this.vFrame.selBtns(!1),!1;this.recSel.splice(e,0,a);0==d&&0<this.recSel.length&&this.vFrame.selBtns(!0);return!0};PVizModel.prototype.clearSel=function(){this.recSel=[]};PVizModel.prototype.getLocAtts=function(a){return[]};PVizModel.prototype.getFeatureAtts=function(a){return[]};PVizModel.prototype.teardown=function(){};
PVizModel.prototype.resize=function(){};PVizModel.prototype.doOptions=function(){};PVizModel.prototype.getState=function(){return{}};PVizModel.prototype.setState=function(a){};PVizModel.prototype.hint=function(){return null};var VizMap=function(a,d){PVizModel.call(this,a,d)};VizMap.prototype=Object.create(PVizModel.prototype);VizMap.prototype.constructor=VizMap;VizMap.prototype.flags=function(){return V_FLAG_LGND|V_FLAG_SEL|V_FLAG_LOC|V_FLAG_OPT};
VizMap.prototype.getLocAtts=function(a){return null!=a?(a=this.settings.cAtts[a],null==a?null:a):this.settings.cAtts};VizMap.prototype.getFeatureAtts=function(a){return null!=a?this.settings.lgnds[a]:this.settings.lgnds};
VizMap.prototype.setup=function(){var a=this,d=parseFloat(this.settings.clat),e=parseFloat(this.settings.clon),f;f="string"==typeof this.settings.zoom?parseInt(this.settings.zoom):this.settings.zoom;var g=this.vFrame.getIndex();jQuery(this.frameID).append('<div id="l-map-'+g+'" class="max-size"></div>');this.lMap=L.map("l-map-"+g,{zoomControl:!1}).setView([d,e],f);this.baseMap=PMapHub.createMapLayer(this.settings.base,1,this.lMap,null);var h;this.mapLayers=[];var m=jQuery("#dialog-opacities div.layer-list");
m.empty();var n=jQuery('<div class="op-layer" data-i="-1">Base Map <input type=range class="op-slider" min=0 max=100 value=100 step=5></div>');m.append(n);_.each(this.settings.lyrs,function(d,k){h=d.o||1;var r;r=PMapHub.createMapLayer(d.lid,h,a.lMap,null);a.mapLayers.push(r);n=jQuery('<div class="op-layer" data-i="'+k+'">'+r.options.layerName+' <input type=range class="op-slider" min=0 max=100 value='+100*d.o+" step=5></div>");m.append(n)});var p=_.template(document.getElementById("dltext-v-map").innerHTML);
jQuery("#view-frame-"+g+" div.view-control-bar").append(p({vi:g}));jQuery("#map-zoom-"+g).button({text:!1,icons:{primary:"ui-icon-plus"}}).click(function(){a.lMap.zoomIn()});jQuery("#map-unzoom-"+g).button({text:!1,icons:{primary:"ui-icon-minus"}}).click(function(){a.lMap.zoomOut()});jQuery("#map-reset-"+g).button({text:!1,icons:{primary:"ui-icon-arrowrefresh-1-w"}}).click(function(){a.lMap.setView([d,e],f)});jQuery("#map-cloc-"+g).button({text:!1,icons:{primary:"ui-icon-pin-s"}}).click(function(){navigator.geolocation.getCurrentPosition(function(d){a.lMap.setView([d.coords.latitude,
d.coords.longitude])})});this.markerLayer=g=L.featureGroup();g.options=g.options||{};g.options.layerName=dlText.markers;g.addTo(this.lMap);this.lineLayer=g=L.featureGroup();g.addTo(this.lMap);g=PData.getNumETmplts();this.tLCnt=new Uint16Array(g)};
VizMap.prototype.render=function(a){function d(a){if(a.target&&a.target.options){var d=a.target.options._aid,k=e.toggleSel(d);a=PData.aIndex2Tmplt(d);1<e.tLCnt[a]?(PState.set(PSTATE_UPDATE),f.eachLayer(function(a){a.options._aid==d&&(k?a.setStyle({color:"#ff0000"}):a.setStyle({color:"#000"}))}),PState.set(PSTATE_READY)):k?this.setStyle({color:"#ff0000"}):this.setStyle({color:"#000"})}}var e=this,f=this.markerLayer;0<this.recSel.length&&(this.recSel=[]);f.clearLayers();var g=this.lineLayer;g.clearLayers();
var h=PData.getNumETmplts(),m=0,n,p=0,t,k,r,y,u,q,w,l,z,A,B,E,v,x,C,D,F;x=this.settings.min;"string"==typeof x&&(x=parseInt(x));p=this.settings.max;"string"==typeof p&&(p=parseInt(p));C=p-x;for(m=0;m<h;m++)this.tLCnt[m]=0;for(var H,m=0;m<h;m++)if("disable"!=this.settings.pAtts[m]){H=[];break}m=0;p=-1;a:for(;m<a.l;){if(null==q){do{if(++p==h)break a;t=a.t[p]}while(0==t.n||t.i+t.n==m);q=this.vFrame.getSelLocAtts(p);if(0==q.length){q=null;continue}w=e.vFrame.getSelFeatAtts(p);if(0==w.length){q=null;continue}e.tLCnt[p]=
q.length;y=e.vFrame.getSelLegend(p);u=PData.getAttID(y);l=e.settings.pAtts[p];k=e.settings.lClrs[p];if(E=e.settings.sAtts[p])v=PData.getAttID(E),"number"==typeof v.r.min&&"number"==typeof v.r.max?(D=v.r.min,F=v.r.max-D):E=null}n=a.s[m];r=PData.getRecByIndex(n);var G;H&&(G={id:r.id,c:[],p:r.a[l],l:k});q.forEach(function(a){if(z=r.a[a])if(A=r.a[y],"undefined"!=typeof A&&(A=PData.getAttLgndVal(A,u,w))){if("number"==typeof z[0])E?(v=r.a[E],v="undefined"!=typeof v?Math.floor((v-D)*C/F)+x:x):v=x,B=L.circleMarker(z,
{_aid:n,weight:1,radius:v,fillColor:A,color:"#000",opacity:1,fillOpacity:1}),G&&G.c.push(z);else if(B=2==z.length?L.polyline(z,{_aid:n,weight:1,fillColor:A,color:"#000",opacity:1,fillOpacity:1}):L.polygon(z,{_aid:n,weight:1,fillColor:A,color:"#000",opacity:1,fillOpacity:1}),G){var k=[0,0];z.forEach(function(a){k[0]+=a[0];k[1]+=a[1]});k[0]/=z.length;k[1]/=z.length;G.c.push(k)}B.on("click",d);f.addLayer(B)}});G&&0<G.c.length&&H.push(G);++m==t.i+t.n&&(q=null)}if(H){H.sort(function(a,d){return PData.strcmp(d.id,
a.id)});var I=[];H.forEach(function(a){a.p&&a.p.forEach(function(d){m=_.sortedIndex(H,{id:d},"id");if(m<H.length){var k=H[m];k.id==d&&a.c.forEach(function(d){k.c.forEach(function(k){d[0]==k[0]&&d[1]==k[1]||I.push({p:[d,k],c:a.l})})})}})});I.forEach(function(a){g.addLayer(L.polyline(a.p,{color:a.c,weight:2}))})}};VizMap.prototype.teardown=function(){var a=this.vFrame.getIndex();jQuery("#view-frame-"+a+" div.view-control-bar div.iconbar").remove()};VizMap.prototype.resize=function(){this.lMap.invalidateSize(!1)};
VizMap.prototype.clearSel=function(){0<this.recSel.length&&(this.recSel=[],this.markerLayer&&this.markerLayer.eachLayer(function(a){a.setStyle({color:"#000"})}))};VizMap.prototype.setSel=function(a){var d=this;this.recSel=a;this.markerLayer&&this.markerLayer.eachLayer(function(a){d.isSel(a.options._aid)?a.setStyle({color:"#ff0000"}):a.setStyle({color:"#000"})})};VizMap.prototype.getState=function(){return{c:this.lMap.getCenter(),z:this.lMap.getZoom(),l:this.vFrame.getLgndSels()}};
VizMap.prototype.setState=function(a){this.lMap.setView(a.c,a.z);this.vFrame.setLgndSels(a.l)};VizMap.prototype.hint=function(){for(var a="",d=PData.getNumETmplts(),e=0;e<d;e++){var f=this.settings.sAtts[e];if(f)var a=0==a.length?dlText.markersize:a+",",f=PData.getAttID(f),g=PData.getETmpltIndex(e),g=PData.getTmpltID(g),a=a+(" "+f.def.l+" ("+g.l+")")}return 0<a.length?a:null};
VizMap.prototype.doOptions=function(){var a=this;this.vFrame.getIndex();var d=jQuery("#dialog-opacities").dialog({height:300,width:500,modal:!0,buttons:[{text:dlText.ok,click:function(){d.dialog("close");var e,f;e=jQuery('.op-layer[data-i="-1"] .op-slider').val();a.baseMap.setOpacity(e/100);f=a.settings.lyrs.length;for(var g=0;g<f;g++)e=jQuery('.op-layer[data-i="'+g+'"] .op-slider').val(),a.mapLayers[g].setOpacity(e/100)}},{text:dlText.cancel,click:function(){d.dialog("close")}}]})};
var VizCards=function(a,d){PVizModel.call(this,a,d)};VizCards.prototype=Object.create(PVizModel.prototype);VizCards.prototype.constructor=VizCards;VizCards.prototype.flags=function(){return V_FLAG_LGND|V_FLAG_SEL|V_FLAG_VSCRL|V_FLAG_OPT};VizCards.prototype.getFeatureAtts=function(a){return null!=a?this.settings.lgnds[a]:this.settings.lgnds};
VizCards.prototype.setup=function(){var a=this;jQuery(this.frameID).on("click.vf",function(d){if("DIV"==d.target.nodeName||"IMG"==d.target.nodeName)if(d=jQuery(d.target).closest("div.card"),1==d.size()){var e=d.data("ai");null!=e&&(a.toggleSel(e)?d.addClass("obj-sel"):d.removeClass("obj-sel"))}});a.sAtts=[];for(var d=0;d<PData.getNumETmplts();d++){var e=jQuery('#dialog-sortby select[data-ti="'+d+'"] :first').val();a.sAtts.push(e)}for(d=0;d<PData.getNumETmplts();d++)jQuery('#dialog-sortby select[data-ti="'+
d+'"]').val(this.sAtts[d])};
VizCards.prototype.render=function(a){var d=this;this.stream=a;var e=PData.getNumETmplts(),f,g,h,m,n,p,t,k,r,y,u,q,w,l,z=jQuery(this.frameID);z.empty();0<this.recSel.length&&(this.recSel=[]);var A,B="w"+this.settings.w+" h"+this.settings.h;g=a.t[0];for(f=0;f<e;){for(;0==g.n;){if(++f==e)return;g=a.t[f]}g=PData.getETmpltIndex(f);g=PData.getTmpltID(g);p=d.vFrame.getSelFeatAtts(f);0!=p.length&&(z.append('<div class="template-label">'+g.l+'</div><div class="cards" data-ti="'+f+'"></div>'),A=jQuery('div.cards[data-ti="'+
f+'"]'),h=d.vFrame.getSelLegend(f),m=PData.getAttID(h),n=d.settings.iAtts[f],y=d.settings.cnt[f],g=d.sAtts[f],g=PData.getAttID(g),g=PData.orderTBy(g,a,f),g.forEach(function(a){t=PData.getRecByIndex(a.i);u=t.a[h];"undefined"!=typeof u&&(k=PData.getAttLgndRecs(u,m,p,!1))&&(w=d.settings.lOn?'<div class="card-title">'+t.l+"</div>":"",r=!1,q="",y&&0<y.length&&(l=k.b?' style="color:black"':"",y.forEach(function(a){if(u=t.a[a])if(u=PData.procAttTxt(a,u))r=!0,q+=u+"<br/>"})),q=n&&(u=t.a[n])?r?'<div class="card-body"><img src="'+
u+'"/><div class="card-cnt"'+l+">"+q+"</div></div>":'<div class="card-body"><img class="full" src="'+u+'"/></div>':'<div class="card-body"><div class="card-cnt"'+l+">"+q+"</div>",A.append('<div class="card '+B+'" style="background-color:'+k.v+'" data-ai="'+a.i+'">'+w+q+"</div>"))}));g=a.t[++f]}};VizCards.prototype.teardown=function(){jQuery(this.frameID).off("click.vf")};
VizCards.prototype.rerender=function(a){var d=this,e=jQuery(this.frameID+' div.cards[data-ti="'+a+'"]');e.empty();var f,g,h,m,n,p,t,k,r,y,u,q,w,l="w"+this.settings.w+" h"+this.settings.h;f=d.vFrame.getSelFeatAtts(a);0!=f.length&&(g=d.vFrame.getSelLegend(a),h=PData.getAttID(g),m=d.settings.iAtts[a],n=d.settings.cnt[a],p=d.sAtts[a],p=PData.getAttID(p),a=PData.orderTBy(p,d.stream,a),a.forEach(function(a){t=PData.getRecByIndex(a.i);k=t.a[g];"undefined"!=typeof k&&(r=PData.getAttLgndRecs(k,h,f,!1))&&(q=
d.settings.lOn?'<div class="card-title">'+t.l+"</div>":"",y=!1,u="",n&&0<n.length&&(w=r.b?' style="color:black"':"",n.forEach(function(a){if(k=t.a[a])if(k=PData.procAttTxt(a,k))y=!0,u+=k+"<br/>"})),u=m&&(k=t.a[m])?y?'<div class="card-body"><img src="'+k+'"/><div class="card-cnt"'+w+">"+u+"</div></div>":'<div class="card-body"><img class="full" src="'+k+'"/></div>':'<div class="card-body"><div class="card-cnt"'+w+">"+u+"</div>",e.append('<div class="card '+l+(d.isSel(a.i)?" obj-sel":"")+'" style="background-color:'+
r.v+'" data-ai="'+a.i+'">'+q+u+"</div>"))}))};VizCards.prototype.doOptions=function(){var a=this,d=jQuery("#dialog-sortby").dialog({height:220,width:400,modal:!0,buttons:[{text:dlText.ok,click:function(){d.dialog("close");PState.set(PSTATE_BUILD);for(var e=0;e<PData.getNumETmplts();e++){var f=jQuery('#dialog-sortby select[data-ti="'+e+'"]').val();f!=a.sAtts[e]&&(a.sAtts[e]=f,a.rerender(e))}PState.set(PSTATE_READY)}},{text:dlText.cancel,click:function(){d.dialog("close")}}]})};
VizCards.prototype.setSel=function(a){var d=this,e,f;this.recSel=a;jQuery(this.frameID).find("div.card").each(function(){f=jQuery(this);e=f.data("ai");null!=e&&(d.isSel(e)?f.addClass("obj-sel"):f.removeClass("obj-sel"))})};VizCards.prototype.clearSel=function(){0<this.recSel.length&&(this.recSel=[],jQuery(this.frameID).find("div.card").removeClass("obj-sel"))};VizCards.prototype.getState=function(){return{l:this.vFrame.getLgndSels(),s:this.sAtts}};
VizCards.prototype.setState=function(a){this.vFrame.setLgndSels(a.l);this.sAtts=a.s;this.sAtts.forEach(function(a,e){jQuery('#dialog-sortby select[data-ti="'+e+'"]').val(a)})};var VizPinboard=function(a,d){PVizModel.call(this,a,d)};VizPinboard.prototype=Object.create(PVizModel.prototype);VizPinboard.prototype.constructor=VizPinboard;VizPinboard.prototype.flags=function(){return V_FLAG_LGND|V_FLAG_SEL|V_FLAG_LOC|V_FLAG_HSCRL|V_FLAG_VSCRL|V_FLAG_OPT};
VizPinboard.prototype.getLocAtts=function(a){return null!=a?(a=this.settings.cAtts[a],null==a?null:[a]):[this.settings.cAtts]};VizPinboard.prototype.getFeatureAtts=function(a){return null!=a?this.settings.lgnds[a]:this.settings.lgnds};
VizPinboard.prototype.setup=function(){var a=this.settings,d=this,e=this.vFrame.getIndex(),f=jQuery("#dialog-opacities div.layer-list");f.empty();var g=jQuery('<div class="op-layer" data-i="-1">Base Image <input type=range class="op-slider" min=0 max=100 value=100 step=5></div>');f.append(g);this.settings.lyrs.forEach(function(a,d){g=jQuery('<div class="op-layer" data-i="'+d+'">Overlay '+(d+1)+' <input type=range class="op-slider" min=0 max=100 value='+100*a.o+" step=5></div>");f.append(g)});PData.getNumETmplts();
this.xScale=d3.scale.linear().domain([0,a.iw-1]).rangeRound([0,a.dw-1]);this.yScale=d3.scale.linear().domain([0,a.ih-1]).range([0,a.dh-1]);this.xAxis=d3.svg.axis().scale(this.xScale).orient("top");this.yAxis=d3.svg.axis().scale(this.yScale).orient("left");this.chart=d3.select(this.frameID).append("svg").attr("width",a.dw+30+3).attr("height",a.dh+30+2).append("g").attr("transform","translate(30,30)");this.chart.append("g").attr("class","x axis").call(this.xAxis);this.chart.append("g").attr("class",
"y axis").call(this.yAxis);this.chart.append("image").attr("id","base-"+e).attr("xlink:href",a.img).attr("x",0).attr("y",0).attr("height",a.dh).attr("width",a.dw);this.settings.lyrs.forEach(function(a,f){d.chart.append("svg").attr("id","ol-"+e+"-"+f).attr("opacity",a.o)});this.settings.lyrs.forEach(function(a,d){d3.xml(a.url,function(a,f){if(!a){var t=f.getElementsByTagName("svg")[0];d3.select("#ol-"+e+"-"+d).node().appendChild(t)}})});this.gRecs=this.chart.append("g").attr("id","recs")};
VizPinboard.prototype.render=function(a){var d=this;this.gRecs.selectAll(".recobj").remove();this.gRecs.selectAll(".recline").remove();0<this.recSel.length&&(this.recSel=[]);var e=PData.getNumETmplts(),f,g,h=0,m,n,p,t,k,r,y,u,q,w,l,z,A,B,E,v;for(f=0;f<e;f++)if("disable"!=this.settings.pAtts[f]){v=[];break}z=this.settings.min;"string"==typeof z&&(z=parseInt(z));g=this.settings.max;"string"==typeof g&&(g=parseInt(g));A=g-z;var x=[];f=0;h=-1;a:for(;f<a.l;){if(null==r){do{if(++h==e)break a;m=a.t[h]}while(0==
m.n||m.i+m.n==f);r=this.vFrame.getSelLocAtts(h);if(0==r.length){r=null;continue}r=r[0];y=d.vFrame.getSelFeatAtts(h);if(0==y.length){r=null;continue}t=d.vFrame.getSelLegend(h);k=PData.getAttID(t);u=d.settings.pAtts[h];n=d.settings.lClrs[h];if(l=d.settings.sAtts[h])p=PData.getAttID(l),"number"==typeof p.r.min&&"number"==typeof p.r.max?(B=p.r.min,E=p.r.max-B):l=null}g=a.s[f];p=PData.getRecByIndex(g);var C;v&&(C={id:p.id,c:null,p:p.a[u],l:n});q=p.a[r];"undefined"!=typeof q&&(w=p.a[t],"undefined"!=typeof w&&
(w=PData.getAttLgndVal(w,k,y)))&&(l?(p=p.a[l],p="undefined"!=typeof p?Math.floor((p-B)*A/E)+z:z):p=z,x.push({ai:g,v:w,x:q[0],y:q[1],r:p}),C&&(C.c=q));C&&C.c&&v.push(C);++f==m.i+m.n&&(r=null)}this.gRecs.selectAll(".recobj").data(x).enter().append("circle").attr("class","recobj").attr("cx",function(a){return d.xScale(a.x)}).attr("cy",function(a){return d.yScale(a.y)}).attr("r",function(a){return d.yScale(a.r)}).style("fill",function(a){return a.v}).on("click",function(a,k){var r=d.toggleSel(a.ai);d3.select(this).classed("obj-sel",
r)});if(v){v.sort(function(a,d){return PData.strcmp(d.id,a.id)});var D=[];v.forEach(function(a){a.p&&a.p.forEach(function(d){f=_.sortedIndex(v,{id:d},"id");if(f<v.length){var k=v[f];k.id==d&&D.push({f:a.c,t:k.c,c:a.l})}})});this.gRecs.selectAll(".recline").data(D).enter().append("line").attr("class","recline").attr("x1",function(a){return d.xScale(a.f[0])}).attr("y1",function(a){return d.yScale(a.f[1])}).attr("x2",function(a){return d.xScale(a.t[0])}).attr("y2",function(a){return d.yScale(a.t[1])}).attr("stroke",
function(a){return a.c})}};VizPinboard.prototype.clearSel=function(){0<this.recSel.length&&(this.recSel=[],this.gRecs.selectAll(".recobj").classed("obj-sel",!1))};VizPinboard.prototype.setSel=function(a){var d=this;this.recSel=a;this.gRecs.selectAll(".recobj").classed("obj-sel",function(a){return d.isSel(a.ai)})};
VizPinboard.prototype.doOptions=function(){var a=this,d=this.vFrame.getIndex(),e=jQuery("#dialog-opacities").dialog({height:300,width:320,modal:!0,buttons:[{text:dlText.ok,click:function(){e.dialog("close");var f,g;f=jQuery('.op-layer[data-i="-1"] .op-slider').val();d3.select("#base-"+d).attr("opacity",f/100);g=a.settings.lyrs.length;for(var h=0;h<g;h++)f=jQuery('.op-layer[data-i="'+h+'"] .op-slider').val(),d3.select("#ol-"+d+"-"+h).attr("opacity",f/100)}},{text:dlText.cancel,click:function(){e.dialog("close")}}]})};
VizPinboard.prototype.getState=function(){return{l:this.vFrame.getLgndSels()}};VizPinboard.prototype.setState=function(a){this.vFrame.setLgndSels(a.l)};VizPinboard.prototype.hint=function(){for(var a="",d=PData.getNumETmplts(),e=0;e<d;e++){var f=this.settings.sAtts[e];if(f)var a=0==a.length?dlText.markersize:a+",",f=PData.getAttID(f),g=PData.getETmpltIndex(e),g=PData.getTmpltID(g),a=a+(" "+f.def.l+" ("+g.l+")")}return 0<a.length?a:null};var VizTime=function(a,d){PVizModel.call(this,a,d)};
VizTime.prototype=Object.create(PVizModel.prototype);VizTime.prototype.constructor=VizTime;VizTime.prototype.flags=function(){return V_FLAG_LGND|V_FLAG_SEL|V_FLAG_LOC|V_FLAG_VSCRL};VizTime.prototype.getFeatureAtts=function(a){return null!=a?this.settings.lgnds[a]:this.settings.lgnds};VizTime.prototype.getLocAtts=function(a){return null!=a?(a=this.settings.dAtts[a],null==a?null:[a]):[this.settings.dAtts]};
VizTime.prototype.getWidths=function(){var a=[],d=jQuery(this.frameID).width();a.push(d);d-=4;a.push(d);this.threshold=d/(6.25*this.settings.xLbl);return a};
VizTime.prototype.setup=function(){function a(a){var d={id:a,l:0,t:0,h:0,w:h[1],svgID:"#tl-b-"+n+"-"+a,tHt:0,iHt:0,xScale:d3.time.scale(),yScale:function(a){return a*d.tHt},parts:[],g:null,labels:null,labelSVGs:null,redraw:function(){}};a?(d.tHt=f.settings.bHt,d.iHt=d.tHt-2):(d.tHt=3,d.iHt=2);if(1==a){var k=f.minDate,r=f.maxDate;0<f.settings.zFrom.length&&(k=PData.parseDate(f.settings.zFrom,!1));0<f.settings.zTo.length&&(r=PData.parseDate(f.settings.zTo,!0));d.xScale.domain([k,r]);f.zMinDate=k;f.zMaxDate=
r}else d.xScale.domain([f.minDate,f.maxDate]);d.xScale.range([0,d.w]);d.g=f.chart.append("g").attr("id",d.svgID.substring(1)).attr("class","tl-band").attr("width",d.w);f.bands[a]=d;f.cmpnts.push(d)}function d(a){var d=f.bands[a],k=d3.svg.axis().scale(d.xScale).orient("bottom").tickSize(6,0);localD3&&k.tickFormat(localD3);var r=d.g.append("g").attr("id","axis-"+n+"-"+a).attr("class","axis").style("font-size","10px");a={redraw:function(){r.call(k)}};d.parts.push(a);f.cmpnts.push(a)}function e(a){var d=
f.bands[a],k;k=1==a?32:16;d.labels=[{name:"s-"+n+"-"+a,x:function(){return 0},left:function(){return 0},anchor:"start",tDelta:2,whichDate:function(a,d){return a}},{name:"e-"+n+"-"+a,x:function(){return d.l+d.w},left:function(){return d.l+d.w-f.settings.xLbl},anchor:"end",tDelta:-3,whichDate:function(a,d){return d}}];var r=d3.select(d.svgID).selectAll(".bLblCntr").data(d.labels).enter().append("g").attr("class","bLblCntr");r.append("rect").attr("class","bLbl").attr("id",function(a){return"rect-"+a.name}).attr("x",
function(a){return a.left()}).attr("width",f.settings.xLbl).attr("height",k);var e=r.append("text").attr("class","bMinMaxLbl").attr("id",function(a){return"txt-"+a.name}).attr("x",function(a){return a.x()+a.tDelta}).attr("y",12).attr("text-anchor",function(a){return a.anchor}),u={redraw:function(){var a=d.xScale.domain(),k=a[0],r=a[1];e.text(function(a){return a.whichDate(k,r).getUTCFullYear()})}};d.parts.push(u);f.cmpnts.push(u);if(1==a){var q=r.append("text").attr("class","bMinMaxLbl").attr("id",
function(a){return"m-txt-"+a.name}).attr("x",function(a){return a.x()+a.tDelta}).attr("y",k-4).attr("text-anchor",function(a){return a.anchor});a={redraw:function(){var a=d.xScale.domain(),k=a[0],r=a[1];q.text(function(a){return r.getUTCFullYear()-k.getUTCFullYear()>f.threshold?"":months[a.whichDate(k,r).getMonth()]})}};d.parts.push(a);f.cmpnts.push(a)}d.labelSVGs=r}var f=this;"number"!=typeof this.settings.xLbl&&(this.settings.xLbl=parseInt(this.settings.xLbl));this.brushSVG=this.brush=null;var g=
this.settings;"string"===typeof g.bHt&&(g.bHt=parseInt(g.bHt,10));(function(){var a,d,k,r,e,u;g.dAtts.forEach(function(f){null!=f&&"disable"!=f&&(f=PData.getAttID(f))&&(null==a||f.r.min.y<a?(a=f.r.min.y,"undefined"!=typeof f.r.min.m?(d=f.r.min.m,k="undefined"!=typeof f.r.min.d?f.r.min.d:1):k=d=1):f.r.min.y==a&&"undefined"!=typeof f.r.min.m&&(f.r.min.m<d?(d=f.r.min.m,k="undefined"!=typeof f.r.min.d?f.r.min.d:1):f.r.min.m==d&&"undefined"!=typeof f.r.min.d&&f.r.min.d<k&&(k=f.r.min.d)),null==r?"undefined"==
typeof f.r.max.y?(r=TODAY.getUTCFullYear(),e=TODAY.getMonth()+1,u=TODAY.getDate()):(r=f.r.max.y,"undefined"!=typeof f.r.max.m?(e=f.r.max.m,u="undefined"!=typeof f.r.max.d?f.r.max.d:PData.lenMnth(r,e)):(e=12,u=31)):f.r.max.y>r?(r=f.r.max.y,"undefined"!=typeof f.r.max.m?(e=f.r.max.m,u="undefined"!=typeof f.r.max.d?f.r.max.d:PData.lenMnth(r,e)):(e=12,u=31)):f.r.max.y==r&&"undefined"!=typeof f.r.max.m&&(f.r.max.m>e?(e=f.r.max.m,u="undefined"!=typeof f.r.max.d?f.r.max.d:PData.lenMnth(r,e)):f.r.max.m==
e&&"undefined"!=typeof f.r.max.d&&f.r.max.d>u&&(u=f.r.max.d)))});f.minDate=0<g.from.length?PData.parseDate(g.from,!1):PData.date3Nums(a,d,k,!1);f.maxDate=0<g.to.length?PData.parseDate(g.to,!0):PData.date3Nums(r,e,u,!0);f.instGap=.015*(f.maxDate-f.minDate)})();var h=f.getWidths(),m=d3.select(this.frameID).append("svg").attr("class","tl-vf").attr("width",h[1]);(function(){var a=[];g.lgnds.forEach(function(d){d.forEach(function(d){a.push(d)})});var a=_.uniq(a),d=[];a.forEach(function(a){(a=PData.getAttID(a))&&
a.l.forEach(function(a){d.push(a.v)})});d=_.uniq(d);d.sort();var k=m.append("defs"),f,e;d.forEach(function(a){e=a.substr(1);f=k.append("linearGradient").attr("id",e+"-fs");f.append("stop").attr("offset","0%").attr("stop-color","#C0C0C0");f.append("stop").attr("offset","5%").attr("stop-color",a);f.append("stop").attr("offset","100%").attr("stop-color",a);f=k.append("linearGradient").attr("id",e+"-fe");f.append("stop").attr("offset","0%").attr("stop-color",a);f.append("stop").attr("offset","95%").attr("stop-color",
a);f.append("stop").attr("offset","100%").attr("stop-color","#C0C0C0");f=k.append("linearGradient").attr("id",e+"-fb");f.append("stop").attr("offset","0%").attr("stop-color","#C0C0C0");f.append("stop").attr("offset","5%").attr("stop-color",a);f.append("stop").attr("offset","95%").attr("stop-color",a);f.append("stop").attr("offset","100%").attr("stop-color","#C0C0C0")})})();var n=this.vFrame.getIndex();m.append("clipPath").attr("id","tl-clip-"+n).append("rect").attr("width",h[1]);f.chart=m.append("g").attr("class",
"chart").attr("clip-path","url(#tl-clip-"+n+")");f.instRad=g.bHt/2-1;f.bands=Array(2);f.cmpnts=[];a(0);a(1);d(0);d(1);e(0);e(1)};
VizTime.prototype.render=function(a){function d(a,d){var k=a.s-d.s;if(0>k)return 1;if(0<k)return-1;k=d.e-a.e;return 0>k?1:0<k?-1:0}function e(a){function d(a){a=h.toggleSel(a.ai);d3.select(this).classed("obj-sel",a)}var k,f,e,g,q=h.bands[a];a?(k=h.bands[0],q.t=k.t+k.h+37,k=f=e=h.instRad,g=2*h.instRad+3):(q.t=0,k=f=e=1);q.h=n*q.tHt+2;q.g.attr("transform","translate(0,"+q.t+")").attr("height",q.h);var w,l;a&&(w=.75*q.iHt+"px",l=.8*q.iHt);var m;m=d3.select(q.svgID).selectAll(".lgBd").remove();m=d3.select(q.svgID).selectAll(".lgBd").data(h.lgBds).enter().append("svg").attr("class",
"lgBd").attr("y",function(a){return q.yScale(a.t)}).attr("height",function(a){return q.yScale(a.h)});m.append("rect").attr("width","100%").attr("height","100%").attr("fill",function(a){return a.d.v});1==a&&m.append("text").attr("class","lgBdLbl").attr("x",2).attr("y",l).attr("fill",function(a){return a.d.b?"#000000":"#FFFFFF"}).style("font-size",w).text(function(a){return a.d.l});var A;d3.select(q.svgID).selectAll(".event").remove();A=d3.select(q.svgID).selectAll(".event").data(h.events).enter().append("svg").attr("class",
function(a){return a.f&EVENT_INSTANT?"event instant":"event range"}).attr("y",function(a){return q.yScale(a.t)}).attr("height",q.iHt);if(1==a)A.on("click",d);var B=d3.select(q.svgID).selectAll(".range");B.append("rect").attr("width","100%").attr("height","100%").attr("fill",function(d){return 1==a&&d.f&(EVENT_F_START|EVENT_F_END)?(d.f&(EVENT_F_START|EVENT_F_END))==(EVENT_F_START|EVENT_F_END)?"url("+d.c.v+"-fb)":(d.f&EVENT_F_START)===EVENT_F_START?"url("+d.c.v+"-fs)":"url("+d.c.v+"-fe)":d.c.v});1==
a&&B.append("text").attr("class","rangeLbl").attr("x",4).attr("y",l).attr("fill",function(a){return a.c.b?"#000000":"#FFFFFF"}).style("font-size",w).text(function(a){return a.l});B=d3.select(q.svgID).selectAll(".instant");B.append("circle").attr("cx",k).attr("cy",f).attr("r",e).attr("fill",function(a){return a.c.v});1==a&&B.append("text").attr("class","instantLbl").attr("x",g).attr("y",l).style("font-size",w).text(function(a){return a.l});q.redraw=function(){m.attr("x",function(a){return q.xScale(a.s)}).attr("width",
function(a){return q.xScale(a.e)-q.xScale(a.s)});A.attr("x",function(a){return q.xScale(a.s)}).attr("width",function(a){return q.xScale(a.e)-q.xScale(a.s)});q.parts.forEach(function(a){a.redraw()})}}function f(a){a=h.bands[a];d3.select(a.svgID).selectAll(".axis").attr("transform","translate(0,"+a.h+")")}function g(a){a=h.bands[a];d3.select(a.svgID).selectAll(".bLblCntr").attr("transform","translate(0,"+(a.h+1).toString()+")")}var h=this,m=h.vFrame.getIndex();0<this.recSel.length&&(this.recSel=[]);
h.events=[];h.lgBds=[];var n=0;(function(){for(var f=PData.getNumETmplts(),e=0,k,r,y,g,q,w,l,m;e<f;){for(k=a.t[e];0==k.n;){if(++e==f)return;k=a.t[e]}y=h.vFrame.getSelLocAtts(e);if(0!=y.length&&(y=h.vFrame.getSelFeatAtts(e),0!=y.length)){m=h.vFrame.getSelLegend(e);l=PData.getAttID(m);g=h.settings.dAtts[e];for(var A,B,E,v,x,C,D,F,H=[],G=k.i;G<k.i+k.n;G++)r=a.s[G],F=PData.getRecByIndex(r),q=F.a[m],"undefined"!=typeof q&&(q=PData.getAttLgndRecs(q,l,y,!1))&&(w=F.a[g])&&(C=w.min.f?EVENT_F_START:0,A=w.min.y,
"undefined"==typeof w.min.m?E=B=1:(B=w.min.m,E="undefined"==typeof w.min.d?1:w.min.d),v=PData.date3Nums(A,B,E,!1),"undefined"==typeof w.max?(C|=EVENT_INSTANT,x=v.getTime()+h.instGap):"open"==w.max?x=TODAY:(w.max.f&&(C|=EVENT_F_END),A=w.max.y,"undefined"==typeof w.max.m?(B=12,E=31):(B=w.max.m,E="undefined"==typeof w.max.d?PData.lenMnth(A,B):w.max.d),x=PData.date3Nums(A,B,E,!0)),H.push({s:v,e:x,ai:r,f:C,c:q,l:F.l,t:0}));H.sort(d);var I=[],M;H.forEach(function(a){for(M=0;M<I.length&&!(a.e<I[M]);M++);
a.t=M+n+1;I[M]=a.s});k=PData.getAttID(g);k.l.forEach(function(a){D=a.d;A=D.min.y;"undefined"==typeof D.min.m?E=B=1:(B=D.min.m,E="undefined"==typeof D.min.d?1:D.min.d);v=PData.date3Nums(A,B,E,!1);"undefined"==typeof D.max.y?x=TODAY:(A=D.max.y,"undefined"==typeof D.max.m?(B=12,E=31):(B=D.max.m,E="undefined"==typeof D.max.d?PData.lenMnth(A,B):D.max.d),x=PData.date3Nums(A,B,E,!0));h.lgBds.push({s:v,e:x,t:n,h:I.length+1,d:a})});n+=I.length+1;h.events=h.events.concat(H)}e++}})();h.getWidths();e(0);e(1);
(function(){var a=function(){function a(d,k){this._height=k;this.g=d;this.mask=this.g.attr("class","brush").call(h.brush);this.mask.selectAll("rect").attr("y",0).attr("height",k);this.left=this.mask.append("polygon").attr("class","dragger");this.right=this.mask.append("polygon").attr("class","dragger");this._bottom=this._top=this._x=null}a.prototype.style=function(a,d){this.left.style(a,d);this.right.style(a,d);return this};a.prototype.x=function(a){if(null==a)return this._x;this._x=a;return this};
a.prototype.height=function(a){if(null==a)return this._height;this._height=a;this.mask.selectAll("rect").attr("height",a);return this};a.prototype.redraw=function(){var a,d;d=h.brush.extent();this._x.range();a=d[0];d=d[1];a=this._x(a);d=this._x(d);this.left.attr("points",""+a+","+this._height+" "+(a+5)+","+(this._height+5)+" "+(a+5)+","+(this._height+9)+" "+(a-5)+","+(this._height+9)+" "+(a-5)+","+(this._height+5)+" "+a+","+this._height);this.right.attr("points",""+d+","+this._height+" "+(d+5)+","+
(this._height+5)+" "+(d+5)+","+(this._height+9)+" "+(d-5)+","+(this._height+9)+" "+(d-5)+","+(this._height+5)+" "+d+","+this._height);return this};return a}(),d=h.bands[0];null!=h.brushSVG&&h.brushSVG.remove();h.brush=d3.svg.brush().x(d.xScale.range([0,d.w])).extent([h.zMinDate,h.zMaxDate]).on("brush",function(){var a=h.brush.extent(),d;"move"===d3.event.mode?(d=d3.time.day.round(a[0]),a=d3.time.day.offset(d,Math.round((a[1]-a[0])/864E5)),d=[d,a]):(d=a.map(d3.time.day.round),d[0]>=d[1]&&(d[0]=d3.time.day.floor(a[0]),
d[1]=d3.time.day.ceil(d3.time.day.offset(d[0],Math.round(h.instGap/864E5)))));h.zMinDate=d[0];h.zMaxDate=d[1];h.brush.extent(d);h.brushHandler.redraw();zoom=h.bands[1];zoom.xScale.domain(d);zoom.redraw()});h.brushSVG=d.g.append("svg");h.brushHandler=(new a(h.brushSVG,d.h-1)).x(d.xScale).redraw()})();(function(){var a=h.bands[1],a=a.t+a.h+45;d3.select(h.frameID+" svg.tl-vf").attr("height",a);d3.select("#tl-clip-"+m+" rect").attr("height",a)})();f(0);f(1);g(0);g(1);h.cmpnts.forEach(function(a){a.redraw()})};
VizTime.prototype.resize=function(){var a=this.getWidths(),d=d3.select(this.frameID+" svg.tl-vf");d.attr("width",a[1]);d.select("#tl-clip-"+this.vFrame.getIndex()+" rect").attr("width",a[1]);for(var e=0;2>e;e++){b=this.bands[e];b.w=a[1];d.select(b.svgID).attr("width",a[1]);b.xScale.range([0,a[1]]);var f=b.labels[1],g=f.x()+f.tDelta;b.labelSVGs.select("#rect-"+f.name).attr("x",f.left());b.labelSVGs.select("#txt-"+f.name).attr("x",g);if(0==e){if(this.brush){if(this.brushSVG){var h=this.brush.extent();
this.brushSVG.call(this.brush.extent(h))}this.brushHandler&&this.brushHandler.redraw()}b.labelSVGs.select("#m-txt-"+f.name).attr("x",g)}}this.cmpnts.forEach(function(a){a.redraw()})};VizTime.prototype.setSel=function(a){var d=this;d.recSel=a;d3.select(this.bands[1].svgID).selectAll(".event").attr("class",function(a){return d.isSel(a.ai)?a.f&EVENT_INSTANT?"event instant obj-sel":"event range obj-sel":a.f&EVENT_INSTANT?"event instant":"event range"})};
VizTime.prototype.clearSel=function(){function a(a){return a.f&EVENT_INSTANT?"event instant":"event range"}0<this.recSel.length&&(this.recSel=[],d3.select(this.bands[1].svgID).selectAll(".event").attr("class",a))};
VizTime.prototype.getState=function(){var a=this.brush.extent(),d=a[0],a=a[1],e=d.getUTCMonth()+1,d=d.getUTCFullYear().toString()+"-"+e.toString()+"-"+d.getDate().toString(),e=a.getUTCMonth()+1,a=a.getUTCFullYear().toString()+"-"+e.toString()+"-"+a.getDate().toString();return{d0:d,d1:a,l:this.vFrame.getLgndSels()}};VizTime.prototype.setState=function(a){var d=PData.parseDate(a.d0,!1),e=PData.parseDate(a.d1,!0);this.bands[1].xScale.domain([d,e]);this.zMinDate=d;this.zMaxDate=e;this.vFrame.setLgndSels(a.l)};
var VizDirectory=function(a,d){PVizModel.call(this,a,d)};VizDirectory.prototype=Object.create(PVizModel.prototype);VizDirectory.prototype.constructor=VizDirectory;VizDirectory.prototype.flags=function(){return V_FLAG_SEL|V_FLAG_VSCRL|V_FLAG_OPT};
VizDirectory.prototype.setup=function(){var a=this;jQuery(this.frameID).on("click.vf",function(d){if("TD"==d.target.nodeName){d=jQuery(d.target).closest("tr");var e=d.data("ai");null!=e&&(a.toggleSel(e)?d.addClass("obj-sel"):d.removeClass("obj-sel"))}});a.sAtts=[];for(var d=0;d<PData.getNumETmplts();d++){var e=jQuery('#dialog-sortby select[data-ti="'+d+'"] :first').val();a.sAtts.push(e)}for(d=0;d<PData.getNumETmplts();d++)jQuery('#dialog-sortby select[data-ti="'+d+'"]').val(a.sAtts[d])};
VizDirectory.prototype.render=function(a){var d=PData.getNumETmplts(),e=0,f,g,h,m,n,p,t=jQuery(this.frameID);t.empty();0<this.recSel.length&&(this.recSel=[]);this.stream=a;for(f=a.t[0];e<d;){for(;0==f.n;){if(++e==d)return;f=a.t[e]}f=PData.getETmpltIndex(e);f=PData.getTmpltID(f);t.append('<div class="template-label">'+f.l+'</div><table cellspacing="0" class="viz-directory" data-ti='+e+"></table>");g=t.find('table[data-ti="'+e+'"]');h=this.settings.cnt[e];p="<thead><tr>";h.forEach(function(a){a=PData.getAttID(a);
p+="<th>"+a.def.l+"</th>"});g.append(p+"<tr></thead><tbody></tbody>");g=g.find("tbody");f=this.sAtts[e];f=PData.getAttID(f);f=PData.orderTBy(f,this.stream,e);f.forEach(function(a){n=PData.getRecByIndex(a.i);p='<tr data-id="'+n.id+'" data-ai='+a.i+">";h.forEach(function(a){m=n.a[a];"undefined"!=typeof m?p=(m=PData.procAttTxt(a,m))?p+("<td>"+m+"</td>"):p+"<td></td>":p+="<td></td>"});g.append(p+"</tr>")});f=a.t[++e]}};
VizDirectory.prototype.rerender=function(a){var d=this,e,f,g,h,m,n=jQuery(this.frameID+' table.viz-directory[data-ti="'+a+'"] tbody');n.empty();tRec=this.stream.t[a];e=d.settings.cnt[a];f=PData.getAttID(d.sAtts[a]);PData.orderTBy(f,d.stream,a).forEach(function(a){h=PData.getRecByIndex(a.i);m="<tr "+(d.isSel(a.i)?'class="obj-sel" ':"")+'data-id="'+h.id+'" data-ai='+a.i+">";e.forEach(function(a){g=h.a[a];"undefined"!=typeof g?m=(g=PData.procAttTxt(a,g))?m+("<td>"+g+"</td>"):m+"<td></td>":m+="<td></td>"});
n.append(m+"</tr>")})};VizDirectory.prototype.teardown=function(){jQuery(this.frameID).off("click.vf")};
VizDirectory.prototype.doOptions=function(){var a=this,d=jQuery("#dialog-sortby").dialog({height:220,width:400,modal:!0,buttons:[{text:dlText.ok,click:function(){d.dialog("close");PState.set(PSTATE_BUILD);for(var e=0;e<PData.getNumETmplts();e++){var f=jQuery('#dialog-sortby select[data-ti="'+e+'"]').val();f!=a.sAtts[e]&&(a.sAtts[e]=f,a.rerender(e))}PState.set(PSTATE_READY)}},{text:dlText.cancel,click:function(){d.dialog("close")}}]})};
VizDirectory.prototype.setSel=function(a){var d=this,e,f;this.recSel=a;jQuery(this.frameID).find("tr").each(function(){f=jQuery(this);e=f.data("ai");null!=e&&(d.isSel(e)?f.addClass("obj-sel"):f.removeClass("obj-sel"))})};VizDirectory.prototype.clearSel=function(){0<this.recSel.length&&(this.recSel=[],jQuery(this.frameID).find("tr").removeClass("obj-sel"))};VizDirectory.prototype.getState=function(){return{s:this.sAtts}};
VizDirectory.prototype.setState=function(a){this.sAtts=a.s;this.sAtts.forEach(function(a,e){jQuery('#dialog-sortby select[data-ti="'+e+'"]').val(a)})};var VizTextStream=function(a,d){PVizModel.call(this,a,d)};VizTextStream.prototype=Object.create(PVizModel.prototype);VizTextStream.prototype.constructor=VizTextStream;VizTextStream.prototype.flags=function(){return V_FLAG_LGND|V_FLAG_SEL|V_FLAG_LOC|V_FLAG_VSCRL};
VizTextStream.prototype.getLocAtts=function(a){return null!=a?(a=this.settings.order[a],null==a?null:[a]):_.map(this.settings.order,function(a){return[a]})};VizTextStream.prototype.getFeatureAtts=function(a){return null!=a?this.settings.lgnds[a]:this.settings.lgnds};VizTextStream.prototype.setup=function(){var a=this;jQuery(this.frameID).on("click.vf",function(d){if("DIV"==d.target.nodeName){d=jQuery(d.target);var e=d.data("ai");"undefined"!=typeof e&&0<=e&&(a.toggleSel(e)?d.addClass("obj-sel"):d.removeClass("obj-sel"))}})};
VizTextStream.prototype.render=function(a){var d=this,e=PData.getNumETmplts(),f=0,g,h,m,n,p,t,k,r,y,u,q,w,l,z,A,B,E,v=jQuery(this.frameID);v.empty();0<this.recSel.length&&(this.recSel=[]);B=this.settings.max-this.settings.min;for(h=a.t[0];f<e;){for(;0==h.n;){if(++f==e)return;h=a.t[f]}y=d.vFrame.getSelLocAtts(f);if(0!=y.length&&(y=d.vFrame.getSelFeatAtts(f),0!=y.length)){u=d.vFrame.getSelLegend(f);q=PData.getAttID(u);v.append('<div class="viz-textstream" data-ti='+f+"></div>");m=v.find("div.viz-textstream[data-ti="+
f+"]");g=PData.getETmpltIndex(f);g=PData.getTmpltID(g);m.append('<div class="template-label">'+g.l+"</div>");r=d.settings.cnt[f];if(z=d.settings.sAtts[f])l=PData.getAttID(z),"number"==typeof l.r.min&&"number"==typeof l.r.max?A=l.r.max-l.r.min:z=null;r&&(g=PData.getAttID(d.settings.order[f]),g=PData.orderTBy(g,a,f),g.forEach(function(a){n=PData.getRecByIndex(a.i);p=n.a[u];"undefined"!=typeof p&&(w=PData.getAttLgndRecs(p,q,y,!1))&&((t=n.a[r])&&(t=PData.procAttTxt(r,t)),t&&(z?(k=n.a[z],k="undefined"!=
typeof k?Math.floor((k-l.r.min)*B/A)+d.settings.min:d.settings.min):k=d.settings.min,E=w.b?";background-color:black":"",m.append('<div class="recitem" data-ai='+a.i+' style="color:'+w.v+E+";font-size:"+k+'px">'+t+"</div>")))}))}f++}};VizTextStream.prototype.teardown=function(){jQuery(this.frameID).off("click.vf")};
VizTextStream.prototype.setSel=function(a){var d=this;this.vFrame.getIndex();var e,f;this.recSel=a;jQuery(this.frameID).find("div.recitem").each(function(){f=jQuery(this);e=f.data("ai");null!=e&&(d.isSel(e)?f.addClass("obj-sel"):f.removeClass("obj-sel"))})};VizTextStream.prototype.clearSel=function(){0<this.recSel.length&&(this.recSel=[],jQuery(this.frameID).find("div.recitem").removeClass("obj-sel"))};VizTextStream.prototype.getState=function(){return{l:this.vFrame.getLgndSels()}};
VizTextStream.prototype.setState=function(a){this.vFrame.setLgndSels(a.l)};VizTextStream.prototype.hint=function(){for(var a="",d,e,f=PData.getNumETmplts(),g=0;g<f;g++)if(d=this.settings.order[g])if(d=PData.getAttID(d),e=PData.getETmpltIndex(g),e=PData.getTmpltID(e),0<a.length&&(a+="; "),a+=e.l+": "+dlText.orderedby+" "+d.def.l,d=this.settings.sAtts[g])d=PData.getAttID(d),a+=", "+dlText.textsize+" "+d.def.l;return a};var VizStackChart=function(a,d){PVizModel.call(this,a,d);this.bSel=[]};
VizStackChart.prototype=Object.create(PVizModel.prototype);VizStackChart.prototype.constructor=VizStackChart;VizStackChart.prototype.flags=function(){return V_FLAG_LGND|V_FLAG_SLGND|V_FLAG_VSCRL|V_FLAG_HSCRL};VizStackChart.prototype.getFeatureAtts=function(a){return this.settings.sAtt};
VizStackChart.prototype.setup2=function(){var a=0;this.cats.forEach(function(d){a=Math.max(a,d.l.length)});this.colW=a=Math.max(D3FG_BAR_WIDTH,8*a+4);var d=this.cats.length*a,e=this.settings.h;this.xScale=d3.scale.linear().domain([0,this.cats.length]).rangeRound([0,d]);this.yScale=d3.scale.linear().range([0,e-1]);this.rScale=d3.scale.ordinal().rangeRoundBands([0,d]);this.rScale.domain(this.cats.map(function(a){return a.l}));this.xAxis=d3.svg.axis().scale(this.rScale).orient("top");this.yAxis=d3.svg.axis().scale(this.yScale).orient("left").ticks(10);
this.svg=d3.select(this.frameID).append("svg").attr("width",d+D3SC_MARGINS.left+D3SC_MARGINS.right).attr("height",e+D3SC_MARGINS.top+D3SC_MARGINS.bottom);this.svg.append("g").attr("class","chart").attr("transform","translate("+D3SC_MARGINS.left+","+D3SC_MARGINS.top+")");this.svg.append("g").attr("class","x axis").attr("transform","translate("+D3SC_MARGINS.left+","+D3SC_MARGINS.top+")").call(this.xAxis);this.svg.append("g").attr("class","y axis").attr("transform","translate("+D3SC_MARGINS.left+","+
D3SC_MARGINS.top+")")};VizStackChart.prototype.setup=function(){var a=PData.getAttID(this.settings.oAtt);"T"==a.def.t&&this.settings.tlit?this.cats=null:(this.cats=this.settings.gr?PData.getRCats(a,!0):PData.getLCats(a,null),this.setup2())};
VizStackChart.prototype.render=function(a){var d=this;this.bSel=[];var e=this.settings.oAtt,f=this.settings.sAtt;this.svg.selectAll(".block").remove();null==this.cats?(this.cats=[],PData.fillCats(this.cats,e,f,a,!0),this.setup2()):PData.fillCats(this.cats,e,f,a,!1);this.blocks=[];a=PData.getAttID(f);for(var e=0,f=d.vFrame.getSelFeatAtts(0),f=PData.getLCats(a,f),g=0;g<this.cats.length;g++){if(0<g)for(var h=0;h<f.length;h++)f[h].i=[];PData.sortCats(d.cats[g].i,a,f);var m=0;f.forEach(function(a){0<a.i.length&&
(d.blocks.push({x:g,c:a.c,y:m,h:a.i.length,a:a.i}),m+=a.i.length)});e=Math.max(e,m)}d.yScale.domain([0,e]);d.svg.select(".y.axis").call(d.yAxis);a=d.colW-7;this.svg.selectAll(".block").data(d.blocks).enter().append("rect").attr("class","block").attr("x",function(a){return D3SC_MARGINS.left+5+d.xScale(a.x)}).attr("y",function(a){return d.yScale(a.y)+D3SC_MARGINS.top}).attr("fill",function(a){return a.c}).attr("height",function(a){return Math.max(1,d.yScale(a.h)-1)}).attr("width",a).on("click",function(a,
f){var e=d.bSel.length,k=_.sortedIndex(d.bSel,f);d.bSel[k]==f?(d3.select(this).classed("obj-sel",!1),d.bSel.splice(k,1),0<e&&0==d.bSel.length&&d.vFrame.selBtns(!1)):(d3.select(this).classed("obj-sel",!0),d.bSel.splice(k,0,f),0==e&&0<d.bSel.length&&d.vFrame.selBtns(!0))})};VizStackChart.prototype.setSel=function(a){};VizStackChart.prototype.clearSel=function(){0<this.bSel.length&&(this.bSel=[],this.svg.selectAll(".block").classed("obj-sel",!1))};
VizStackChart.prototype.getSel=function(){var a=this,d=[];this.bSel.forEach(function(e){d=PData.union(d,a.blocks[e].a)});return d};VizStackChart.prototype.getState=function(){return{l:this.vFrame.getLgndSels()}};VizStackChart.prototype.setState=function(a){this.vFrame.setLgndSels(a.l)};VizStackChart.prototype.hint=function(){var a=dlText.xaxis+": ",d=PData.getAttID(this.settings.oAtt),a=a+(d.def.l+", "+dlText.yaxis+": "),d=PData.getAttID(this.settings.sAtt);return a+=d.def.l};
var VizNetWheel=function(a,d){PVizModel.call(this,a,d);this.bSel=[]};VizNetWheel.prototype=Object.create(PVizModel.prototype);VizNetWheel.prototype.constructor=VizNetWheel;VizNetWheel.prototype.flags=function(){return V_FLAG_LGND|V_FLAG_SEL|V_FLAG_VSCRL|V_FLAG_HSCRL};VizNetWheel.prototype.getFeatureAtts=function(a){return null!=a?this.settings.lgnds[a]:this.settings.lgnds};
VizNetWheel.prototype.setup=function(){function a(){360<d.spin?d.spin-=360:0>d.spin&&(d.spin+=360);d.center.attr("transform","translate("+d.cr+","+d.cr+")rotate("+d.spin+")")}var d=this;this.spin=0;var e=this.vFrame.getIndex(),f=_.template(document.getElementById("dltext-v-nwheel").innerHTML);jQuery("#view-frame-"+e+" div.view-control-bar").append(f({vi:e}));jQuery("#nw-prev-"+e).button({text:!1,icons:{primary:" ui-icon-arrowreturnthick-1-s"}}).click(function(){jQuery("#nw-size-"+e+" :radio:checked").attr("id")==
"nw-size-1-"+e?d.spin+=d.inc:d.spin+=90;a()});jQuery("#nw-for-"+e).button({text:!1,icons:{primary:" ui-icon-arrowreturnthick-1-n"}}).click(function(){jQuery("#nw-size-"+e+" :radio:checked").attr("id")=="nw-size-1-"+e?d.spin-=d.inc:d.spin-=90;a()});jQuery("#nw-size-"+e).buttonset();this.svg=d3.select(this.frameID).append("svg");this.center=this.svg.append("g")};
VizNetWheel.prototype.render=function(a){var d=this,e=[],f,g,h;this.svg.selectAll(".node").remove();this.svg.selectAll(".link").remove();this.inc=360/(a.l+a.t.length);g=Math.max((14*a.l+20)/(2*Math.PI),30);var m=this.settings.lw;"string"==typeof m&&(m=parseInt(m));this.cr=m+12+g;m=2*this.cr;this.svg.attr("width",m).attr("height",m);this.center.attr("transform","translate("+this.cr+","+this.cr+")");0<this.recSel.length&&(this.recSel=[]);var n={children:[]};(function(){var f,e=0,k=0,r,y,g,q=[],h=null,
l,m;f=a.t[0];m=d.vFrame.getSelLegend(0);l=PData.getAttID(m);h=d.vFrame.getSelFeatAtts(0);a:for(;k<a.l;){for(;0==f.n||f.i+f.n==k||0==h.length;){0<q.length&&(n.children.push({ti:e,children:q}),q=[]);if(++e==PData.getNumETmplts())break a;q=[];f=a.t[e];m=d.vFrame.getSelLegend(e);l=PData.getAttID(m);h=d.vFrame.getSelFeatAtts(e)}g=a.s[k];r=PData.getRecByIndex(g);y=r.a[m];"undefined"!=typeof y&&(fData=PData.getAttLgndRecs(y,l,h,!1))&&q.push({r:r,ai:g,c:fData.v,children:[]});k++}0<q.length&&n.children.push({ti:e,
children:q})})();g=d3.layout.cluster().size([360,g]).sort(null).nodes(n);h=this.center.append("g").selectAll(".node").data(g.filter(function(a){return!a.children})).enter().append("g").attr("class","node").attr("transform",function(a){return"rotate("+(a.x-90)+")translate("+(a.y+8)+",0)"});h.append("circle").attr("r","5").style("fill",function(a){return a.c}).on("click",function(a){a=d.toggleSel(a.ai);d3.select(this).classed("obj-sel",a)});h.append("text").attr("dy",".31em").attr("dx",function(a){return 180>
a.x?"10":"-10"}).attr("transform",function(a){return 180>a.x?"":"rotate(180)"}).style("text-anchor",function(a){return 180>a.x?"start":"end"}).attr("fill","black").text(function(a){return a.r.l}).on("click",function(a){PState.set(PSTATE_UPDATE);h.each(function(a){a.linked=!1});f.each(function(d){if(d.s===a){d.t.linked=!0;for(var k=0;k<e.length;k++){var f=e[k];if(f.source===a&&f.target===d.t){d3.select(this).attr("stroke",f.c).classed("thick",!0);this.parentElement.appendChild(this);break}}}else if(d.t===
a)for(d.s.linked=!0,k=0;k<e.length;k++){if(f=e[k],f.target===a&&f.source===d.s){d3.select(this).attr("stroke",f.c).classed("thick",!0);this.parentElement.appendChild(this);break}}else d3.select(this).attr("stroke","black").classed("thick",!1)});h.select("text").attr("fill",function(a){return a.linked?"white":"black"});d3.select(this).attr("fill","red");PState.set(PSTATE_READY)});g=d3.layout.bundle();m=d3.svg.line.radial().interpolate("bundle").tension(.85).radius(function(a){return a.y}).angle(function(a){return a.x/
180*Math.PI});n.children.forEach(function(a){var f=d.settings.pAtts[a.ti],k;a.children.forEach(function(a){f.forEach(function(d){k=a.r.a[d.pid];"undefined"!=typeof k&&k.forEach(function(k){var f=!1,g,l=0;a:for(;l<n.children.length;l++)for(var h=n.children[l],m=0;m<h.children.length;m++)if(g=h.children[m],g.r.id==k){f=!0;break a}f&&e.push({source:a,target:g,c:d.clr})})})})});f=this.center.append("g").selectAll(".link").data(g(e)).enter().append("path").each(function(a){a.s=a[0];a.t=a[a.length-1]}).attr("class",
"link").attr("d",m).attr("stroke","black")};VizNetWheel.prototype.teardown=function(){var a=this.vFrame.getIndex();jQuery("#view-frame-"+a+" div.view-control-bar div.iconbar").remove()};VizNetWheel.prototype.setSel=function(a){var d=this;d.recSel=a;this.svg.selectAll(".node circle").attr("class",function(a){return d.isSel(a.ai)?"obj-sel":""})};VizNetWheel.prototype.clearSel=function(){0<this.recSel.length&&(this.recSel=[],this.svg.selectAll(".node circle").attr("class",""))};
VizNetWheel.prototype.getState=function(){return{l:this.vFrame.getLgndSels()}};VizNetWheel.prototype.setState=function(a){this.vFrame.setLgndSels(a.l)};var VizFlow=function(a,d){PVizModel.call(this,a,d);this.bSel=[];this.fSel=[]};VizFlow.prototype=Object.create(PVizModel.prototype);VizFlow.prototype.constructor=VizFlow;VizFlow.prototype.flags=function(){return V_FLAG_VSCRL|V_FLAG_HSCRL};
VizFlow.prototype.setup=function(){this.bH=Math.max(120,Math.ceil(this.settings.w/3));var a=40+(this.settings.fcts.length-1)*this.bH;this.svg=d3.select(this.frameID).append("svg").attr("width",this.settings.w+10).attr("height",a);this.barG=this.svg.append("g");this.flowG=this.svg.append("g");this.titleG=this.svg.append("g")};
VizFlow.prototype.render=function(a){var d=this;this.bSel=[];this.fSel=[];this.barG.selectAll(".bar").remove();this.flowG.selectAll(".flow").remove();this.titleG.selectAll(".att-title").remove();var e=this.settings.w;d.bars=[];d.atts=[];d.settings.fcts.forEach(function(f,g){var h,m=PData.getAttID(f);"T"==m.def.t&&d.settings.tlit?(h=[],PData.fillCats(h,f,null,a,!0)):(h=d.settings.gr?PData.getRCats(m,!0):PData.getLCats(m,null),PData.fillCats(h,f,null,a,!1));var n=[],p=0;h.forEach(function(a){0<a.i.length&&
(n.push(a),p+=a.i.length)});var t=0,k=31+g*d.bH;n.forEach(function(a){d.bars.push({x:5+t*e/p,w:a.i.length*e/p,y:k,c:a});t+=a.i.length});d.atts.push({l:m.def.l,c:n,t:p,y:k})});this.barG.selectAll(".bar").data(d.bars).enter().append("rect").attr("class","bar").attr("x",function(a){return a.x}).attr("y",function(a){return a.y}).attr("fill",function(a){return a.c.c}).attr("height","8").attr("width",function(a){return a.w}).on("click",function(a,e){var h=d.bSel.length,m=_.sortedIndex(d.bSel,e);d.bSel[m]==
e?(d3.select(this).classed("obj-sel",!1),d.bSel.splice(m,1),0<h&&0==d.bSel.length&&0==d.fSel.length&&d.vFrame.selBtns(!1)):(d3.select(this).classed("obj-sel",!0),d.bSel.splice(m,0,e),0==h&&0==d.fSel.length&&0<d.bSel.length&&d.vFrame.selBtns(!0))}).append("title").text(function(a){return a.c.l+" ("+a.c.i.length+")"});d.ints=[];d.atts.forEach(function(a,g){if(g!=d.atts.length-1){for(var h=d.atts[g+1],m=Array(a.c.length),n=0;n<a.c.length;n++)m[n]=Array(h.c.length);a.c.forEach(function(a,d){h.c.forEach(function(k,
f){m[d][f]=PData.intersect(a.i,k.i)})});for(var p=Array(h.c.length),t=0;t<h.c.length;t++){for(var k=0,n=0;n<a.c.length;n++)0<m[n][t].length&&k++;p[t]=k-1}for(var r=Array(h.c.length),t=0;t<h.c.length;t++)r[t]=0;var y=0;a.c.forEach(function(k,q){for(var g=0,l=0;l<h.c.length;l++)0<m[q][l].length&&g++;--g;var t=k.i.length*e/a.t,n=0,B=0;h.c.forEach(function(l,v){var x=m[q][v];if(0<x.length){var C=x.length*e,D=C/a.t,C=C/h.t,F=l.i.length*e/h.t;d.ints.push({i:x,c:k.c,l:k.l+" > "+l.l,x1:5+y*e/a.t+(g?(t-D)*
n/g:0),x2:5+B*e/h.t+(p[v]?(F-C)*r[v]/p[v]:0),w1:D,w2:C,y1:a.y+10,y2:h.y-1});n++;r[v]++}B+=l.i.length});y+=k.i.length})}});this.flowG.selectAll(".flow").data(d.ints).enter().append("path").attr("class","flow").attr("d",function(a){return"M "+a.x1+" "+a.y1+"  L "+(a.x1+a.w1)+" "+a.y1+" L "+(a.x2+a.w2)+" "+a.y2+" L "+a.x2+" "+a.y2+" L "+a.x1+" "+a.y1}).attr("fill",function(a){return a.c}).on("click",function(a,e){var h=d.fSel.length,m=_.sortedIndex(d.fSel,e);d.fSel[m]==e?(d3.select(this).classed("obj-sel",
!1),d.fSel.splice(m,1),0<h&&0==d.fSel.length&&0==d.bSel.length&&d.vFrame.selBtns(!1)):(d3.select(this).classed("obj-sel",!0),d.fSel.splice(m,0,e),0==h&&0==d.bSel.length&&0<d.fSel.length&&d.vFrame.selBtns(!0))}).on("mouseover",function(){d3.select(this).classed("active",!0);this.parentElement.appendChild(this)}).on("mouseout",function(){d3.select(this).classed("active",!1)}).append("title").text(function(a){return a.l+" ("+a.i.length+")"});this.titleG.selectAll(".att-title").data(d.atts).enter().append("text").attr("class",
"att-title").attr("x","5").attr("y",function(a){return a.y-8}).text(function(a){return a.l})};VizFlow.prototype.setSel=function(a){};VizFlow.prototype.clearSel=function(){0<this.bSel.length&&(this.bSel=[],this.svg.selectAll(".bar").classed("obj-sel",!1));0<this.fSel.length&&(this.fSel=[],this.svg.selectAll(".flow").classed("obj-sel",!1))};
VizFlow.prototype.getSel=function(){var a=this,d=[];this.bSel.forEach(function(e){d=PData.union(d,a.bars[e].c.i)});this.fSel.forEach(function(e){d=PData.union(d,a.ints[e].i)});return d};var VizMBMap=function(a,d){PVizModel.call(this,a,d)};VizMBMap.prototype=Object.create(PVizModel.prototype);VizMBMap.prototype.constructor=VizMBMap;VizMBMap.prototype.flags=function(){return V_FLAG_VSCRL|V_FLAG_HSCRL};
VizMBMap.prototype.setup=function(){function a(){d.bkSel&&(d.bkSel.s=!1);d.clearSel()}var d=this,e=this.settings.h+40+30*this.settings.fcts.length;this.svg=d3.select(this.frameID).append("svg").attr("width",this.settings.w+10).attr("height",e);this.infoG=this.svg.append("g");this.infoG.attr("transform","translate(5,"+(3+this.settings.h)+")");this.attsG=this.svg.append("g");this.attsG.attr("transform","translate(5,"+(40+this.settings.h)+")");this.infoG.append("rect").attr("class","mbm-reset").attr("x",
"0").attr("y","8").attr("width","60").attr("height","20").attr("rx","4").attr("ry","4").on("click",a);this.infoG.append("text").attr("class","mbm-reset-text").attr("x","30").attr("y","23").text(dlText.reset).on("click",a)};VizMBMap.prototype.resetAttBars=function(){this.attsG.selectAll(".bar").transition().attr("x",function(a){return a.x0}).attr("width",function(a){return a.w0})};
VizMBMap.prototype.refreshTitles=function(){this.svg.selectAll(".mbm-title").attr("class",function(a){return a.s?"mbm-title obj-sel":"mbm-title"})};
VizMBMap.prototype.renderTree=function(a){function d(){var a=0,d=e.settings.w,h=null!=e.sbkSel?e.sbkSel.i:e.bkSel.i;PState.set(PSTATE_UPDATE);e.facets.forEach(function(m,n){var p=[],t=0;m.c.forEach(function(a){a=PData.intersect(h,a.i);p.push(a);t+=a.length});var k=0,r;p.forEach(function(y){r=e.bars[a++];r.x=t?k*d/t:0;r.w=t?y.length*d/t:0;k+=y.length})});e.attsG.selectAll(".bar").transition().attr("x",function(a){return a.x}).attr("width",function(a){return a.w});PState.set(PSTATE_READY)}var e=this;
this.svg.selectAll(".mbm-g").remove();a=this.treemaps[a];a=this.svg.selectAll(".mbm-g").data(a,function(a){return a.id}).enter().append("g").attr("class","mbm-g").attr("transform",function(a){return"translate("+a.x+","+a.y+")"});a.append("rect").attr("class","mbm-cell").attr("width",function(a){return a.dx-1}).attr("height",function(a){return a.dy-1}).attr("rx","3").attr("ry","3").style("fill",function(a){return 2==a.depth?a.c:"#888888"}).on("click",function(a){2==a.depth&&(e.sbkSel===a?e.clearSel():
(e.svg.selectAll(".mbm-cell").classed("obj-sel",!1),e.bkSel&&(e.bkSel.s=!1),e.sbkSel=a,d3.select(this).classed("obj-sel",!0),e.infoG.select(".mbm-select").remove(),e.infoG.append("text").attr("class","mbm-select").attr("x","70").attr("y","23").text(a.l),a.p.s=!0,e.bkSel=a.p,e.refreshTitles(),d(),e.vFrame.selBtns(!0)))}).append("title").text(function(a){return a.l});a.filter(function(a){return 1==a.depth}).append("text").attr("class","mbm-title").attr("x","3").attr("y","11").text(function(a){return a.l}).on("click",
function(a){e.bkSel===a?e.clearSel():(e.svg.selectAll(".mbm-cell").classed("obj-sel",!1),e.bkSel&&(e.bkSel.s=!1),a.s=!0,e.bkSel=a,e.sbkSel=null,e.refreshTitles(),e.infoG.select(".mbm-select").remove(),e.infoG.append("text").attr("class","mbm-select").attr("x","70").attr("y","23").text(a.l+" ("+a.i.length+")"),d(),e.vFrame.selBtns(!0))})};
VizMBMap.prototype.render=function(a){var d=this;this.sbkSel=this.bkSel=null;this.attSel=0;var e=this.settings.w;this.attsG.selectAll(".bar").remove();this.attsG.selectAll(".mbm-att-title").remove();this.infoG.select(".mbm-select").remove();this.facets=[];this.bars=[];this.settings.fcts.forEach(function(f,g){var k,r=PData.getAttID(f),y=30*g;"T"==r.def.t&&d.settings.tlit?(k=[],PData.fillCats(k,f,null,a,!0)):(k=d.settings.gr?PData.getRCats(r,!0):PData.getLCats(r,null),PData.fillCats(k,f,null,a,!1));
var h=[],q=0;k.forEach(function(a){0<a.i.length&&(h.push(a),q+=a.i.length)});var w=0;h.forEach(function(a){d.bars.push({x0:w*e/q,w0:a.i.length*e/q,x:0,w:0,y:y+18,c:a});w+=a.i.length});d.facets.push({i:g,l:r.def.l,y:y+14,c:h})});this.attsG.selectAll(".mbm-att-title").data(d.facets).enter().append("text").attr("class",function(a,d){return 0==d?"mbm-att-title obj-sel":"mbm-att-title"}).attr("x","0").attr("y",function(a){return a.y}).text(function(a){return a.l}).on("click",function(a,e){d.attSel!=e&&
(PState.set(PSTATE_UPDATE),d.attsG.selectAll(".mbm-att-title").classed("obj-sel",!1),d.clearSel(),d.resetAttBars(),d.renderTree(e),d3.select(this).classed("obj-sel",!0),d.attSel=e,PState.set(PSTATE_READY))});this.attsG.selectAll(".bar").data(d.bars).enter().append("rect").attr("class","bar").attr("x",function(a){return a.x0}).attr("y",function(a){return a.y}).attr("fill",function(a){return a.c.c}).attr("height","8").attr("width",function(a){return a.w0}).append("title").text(function(a){return a.c.l});
var f=this.settings.p,g=PData.getAttID(f),h;"T"==g.def.t&&d.settings.tlit?(h=[],PData.fillCats(h,f,null,a,!0)):(h=d.settings.gr?PData.getRCats(g,!0):PData.getLCats(g,null),PData.fillCats(h,f,null,a,!1));var m=this.vFrame.getIndex();d.trees=[];d.facets.forEach(function(a,e){var k={z:[],id:m+"."+e};h.forEach(function(d,f){if(0<d.i.length){var g=[],q={i:d.i,l:d.l,s:!1,z:g,id:m+"."+e+"."+f};a.c.forEach(function(a,k){var h=[],h=PData.intersect(d.i,a.i);0<h.length&&g.push({i:h,p:q,c:a.c,l:d.l+" + "+a.l+
" ("+h.length+")",id:m+"."+e+"."+f+"."+k})});k.z.push(q)}});d.trees.push(k)});var n=d3.layout.treemap().padding([14,3,3,3]).size([e,this.settings.h]).round(!0).children(function(a,d){return 2==d?null:a.z}).value(function(a){return a.i.length});d.treemaps=[];d.trees.forEach(function(a){d.treemaps.push(n.nodes(a))});d.renderTree(0)};VizMBMap.prototype.setSel=function(a){};
VizMBMap.prototype.clearSel=function(){this.bkSel&&(this.bkSel.s=!1);this.infoG.select(".mbm-select").remove();this.sbkSel=this.bkSel=null;this.svg.selectAll(".mbm-cell").classed("obj-sel",!1);this.svg.selectAll(".mbm-title").classed("obj-sel",!1);this.resetAttBars();this.vFrame.selBtns(!1)};VizMBMap.prototype.getSel=function(){return null!=this.sbkSel?this.sbkSel.i:null!=this.bkSel?this.bkSel.i:[]};
VizMBMap.prototype.hint=function(){var a=PData.getAttID(this.settings.p);return dlText.grpblks+" "+a.def.l};function PFilterModel(a,d){this.id=a;this.att=d;this.dirty=!0}PFilterModel.prototype.isDirty=function(a){null!=a&&(!this.dirty&&a&&0<this.id&&jQuery("#btn-recompute").addClass("pulse"),this.dirty=a);return this.dirty};PFilterModel.prototype.title=function(){return this.att.def.l};PFilterModel.prototype.evalPrep=function(){};PFilterModel.prototype.evalDone=function(){};
PFilterModel.prototype.insertPt=function(){return jQuery('div.filter-instance[data-id="'+this.id+'"] div.filter-body')};PFilterModel.prototype.teardown=function(){};PFilterModel.prototype.getState=function(){return{}};PFilterModel.prototype.setState=function(a){};var PFilterRemove=function(a){PFilterModel.call(this,a,null)};PFilterRemove.prototype=Object.create(PFilterModel.prototype);PFilterRemove.prototype.constructor=PFilterRemove;PFilterRemove.prototype.title=function(){return dlText.rha};
PFilterRemove.prototype.eval=function(a){return!1};PFilterRemove.prototype.setup=function(){var a=this.insertPt(),d=document.getElementById("dltext-filter-remove").innerHTML;a.append(d)};var PFilterText=function(a,d){PFilterModel.call(this,a,d)};PFilterText.prototype=Object.create(PFilterModel.prototype);PFilterText.prototype.constructor=PFilterText;
PFilterText.prototype.evalPrep=function(){var a=this.insertPt();this.cs=a.find("input.filter-text-cs").prop("checked");this.s=a.find("input.filter-text").val();this.cs||(this.s=this.s.toLocaleLowerCase())};PFilterText.prototype.eval=function(a){var d=this.s;if(null==d||""==d)return!0;a=a.a[this.att.id];if("undefined"==typeof a)return!1;this.cs||(a=a.toLocaleLowerCase());return-1!=a.indexOf(d)};
PFilterText.prototype.setup=function(){var a=this,d=this.insertPt(),e=document.getElementById("dltext-filter-text").innerHTML;d.append(e);d.find("input.filter-text").change(function(){a.isDirty(!0)});d.find("input.filter-text-cs").click(function(d){a.isDirty(!0)})};PFilterText.prototype.getState=function(){var a=this.insertPt();return{cs:a.find("input.filter-text-cs").prop("checked"),t:a.find("input.filter-text").val()}};
PFilterText.prototype.setState=function(a){var d=this.insertPt();d.find("input.filter-text-cs").prop("checked",a.cs);d.find("input.filter-text").val(a.t)};var PFilterVocab=function(a,d){PFilterModel.call(this,a,d)};PFilterVocab.prototype=Object.create(PFilterModel.prototype);PFilterVocab.prototype.constructor=PFilterVocab;
PFilterVocab.prototype.evalPrep=function(){var a=this;this.sel=[];this.insertPt().find("div.filter-vocab-row input:checked").each(function(){var d=jQuery(this).parent().data("id");d&&a.sel.push(d)});this.sel.sort();this.ctrs=new Uint16Array(this.sel.length);for(var d=0;d<this.sel.length;d++)this.ctrs[d]=0};
PFilterVocab.prototype.eval=function(a){if(0==this.sel.length)return!1;a=a.a[this.att.id];if("undefined"==typeof a)return!1;for(var d,e,f=0;f<a.length;f++)if(e=a[f],d=_.sortedIndex(this.sel,e),this.sel[d]==e)return this.ctrs[d]++,!0;return!1};PFilterVocab.prototype.evalDone=function(a){var d=this,e,f,g,h;this.insertPt().find("div.filter-vocab-row").each(function(){h=jQuery(this);if(e=h.data("id"))f=_.sortedIndex(d.sel,e),g=d.sel[f]==e?0<a?Math.round(100*d.ctrs[f]/a):0:0,h.next().width(g+"%")})};
PFilterVocab.prototype.setup=function(){var a=this,d='<div class="filter-vocab-container"><div class="filter-vocab-hsa"><input type="checkbox" checked="checked" data-index=-1><i> '+dlText.sha+"</i></div>";this.att.l.forEach(function(a,e){d+='<div class="filter-vocab-entry" data-index="'+e+'"><div class="filter-vocab-row" data-id="'+a.l+'"><input type="checkbox" class="term-parent" checked="checked">'+a.l+'</div><div class="filter-vocab-bar" style="background-color:'+a.v+'"></div>';a.z.forEach(function(h,
m){d+='<div class="filter-vocab-row" data-id="'+h.l+'"><input type="checkbox" data-parent="'+e+'" checked="checked">'+h.l+"</div>";d=null==h.v||""==h.v?d+('<div class="filter-vocab-bar" style="background-color:'+a.v+'"></div>'):d+('<div class="filter-vocab-bar" style="background-color:'+h.v+'"></div>')});d+="</div>"});var e=this.insertPt();e.append(d+"</div>");e.click(function(d){var g=d.target;"INPUT"==g.nodeName&&("undefined"!=typeof g.dataset.index&&-1==g.dataset.index?(d=g.checked,e.find("div.filter-vocab-row input").prop("checked",
d)):"term-parent"==d.target.className&&g.checked&&e.find('input[data-parent="'+d.target.parentElement.parentElement.dataset.index+'"]').prop("checked",!0),a.isDirty(!0))})};PFilterVocab.prototype.getState=function(){var a=[];this.insertPt().find("div.filter-vocab-row input:checked").each(function(){var d=jQuery(this).parent().data("id");d&&a.push(d)});a.sort();return{s:a}};
PFilterVocab.prototype.setState=function(a){this.insertPt().find("div.filter-vocab-row").each(function(){var d=jQuery(this),e=d.data("id"),e=_.indexOf(a.s,e,!0);d.find("input").prop("checked",-1!=e)})};var PFilterNum=function(a,d){PFilterModel.call(this,a,d)};PFilterNum.prototype=Object.create(PFilterModel.prototype);PFilterNum.prototype.constructor=PFilterNum;
PFilterNum.prototype.evalPrep=function(){if(null==this.rCats){var a=this.insertPt();this.min=parseInt(a.find("input.filter-num-min-val").val());this.max=parseInt(a.find("input.filter-num-max-val").val());this.useMin=a.find("input.filter-num-min-use").is(":checked");this.useMax=a.find("input.filter-num-max-use").is(":checked")}else for(this.ctrs=new Uint16Array(this.rCats.length),a=0;a<this.rCats.length;a++)this.ctrs[a]=0};
PFilterNum.prototype.eval=function(a){a=a.a[this.att.id];if("undefined"==typeof a||this.useMin&&a<this.min)return!1;if(null==this.rCats){if(this.useMax&&a>this.max)return!1}else{if(a>=this.max)return!1;for(var d,e=this.b0;e<=this.b1;e++)if(d=this.rCats[e],d.min<=a&&a<=d.max){this.ctrs[e]++;break}}return!0};
PFilterNum.prototype.evalDone=function(a){if(this.rCats){for(var d=this,e=80-D3FG_MARGINS.top-D3FG_MARGINS.bottom,f=new Uint16Array(this.ctrs.length),g=0;g<this.ctrs.length;g++)f[g]=0<a?Math.round(100*this.ctrs[g]/a):0;this.chart.selectAll(".bar").transition().duration(500).attr("height",function(a,g){return e-d.yScale(f[g])}).attr("y",function(a,e){return d.yScale(f[e])})}};
PFilterNum.prototype.setup=function(){var a=this,d=this.insertPt();this.rCats=PData.getRCats(this.att,!1);if(null==this.rCats){var e=_.template(document.getElementById("dltext-filter-num-boxes").innerHTML),f="undefined"==typeof this.att.r.min?0:this.att.r.min;d.append(e({min:f,max:"undefined"==typeof this.att.r.max?f+100:this.att.r.max}));d.click(function(d){"INPUT"==d.target.nodeName&&a.isDirty(!0)});d.find("input.filter-num-min-val").change(function(){var e=jQuery(this).val(),k=d.find("input.filter-num-max-val").val();
e<=k?a.isDirty(!0):jQuery(this).val(k)});d.find("input.filter-num-max-val").change(function(){var e=jQuery(this).val(),k=d.find("input.filter-num-min-val").val();e>=k?a.isDirty(!0):jQuery(this).val(k)})}else{this.useMin=this.useMax=!0;this.b0=0;this.b1=this.rCats.length-1;this.min=this.rCats[0].min;this.max=this.rCats[this.b1].max;var g=80-D3FG_MARGINS.top-D3FG_MARGINS.bottom,h=0;this.rCats.forEach(function(a){h=Math.max(h,a.l.length)});var h=Math.max(D3FG_BAR_WIDTH,7*h),e=this.rCats.length*h,m=d3.scale.linear().domain([0,
this.rCats.length]).rangeRound([0,e]),n=d3.scale.linear().domain([0,100]).range([g,0]);this.yScale=n;f=d3.scale.ordinal().rangeRoundBands([0,e]);f.domain(this.rCats.map(function(a){return a.l}));var f=d3.svg.axis().scale(f).orient("bottom"),p=d3.svg.axis().scale(n).orient("left").ticks(4);this.chart=e=d3.select(d.get(0)).append("svg").attr("width",e+D3FG_MARGINS.left+D3FG_MARGINS.right).attr("height",g+D3FG_MARGINS.top+D3FG_MARGINS.bottom).append("g").attr("transform","translate("+D3FG_MARGINS.left+
","+D3FG_MARGINS.top+")");e.append("g").attr("class","x axis").attr("transform","translate(0,"+g+")").call(f);e.append("g").attr("class","y axis").call(p);e.selectAll(".bar").data(this.rCats).enter().append("rect").attr("class","bar").attr("x",function(a,d){return m(d)+2}).attr("y",function(a){return n(100)}).attr("fill",function(a){return a.c}).attr("height",function(a){return g-n(100)}).attr("width",h-4);a.brush=d3.svg.brush().x(m).extent([0,this.rCats.length]).on("brushend",function(){if(d3.event.sourceEvent){var d=
a.brush.extent(),k=[Math.floor(d[0]),Math.floor(d[1])];k[0]>=k[1]&&(k[0]=Math.floor(d[0]),k[1]=Math.ceil(d[1]));k[1]=Math.max(k[1],k[0]+1);d3.select(this).transition().call(a.brush.extent(k));a.b0=k[0];a.b1=k[1]-1;a.min=a.rCats[a.b0].min;a.max=a.rCats[a.b1].max;a.isDirty(!0)}});a.brushg=e.append("g");a.brushg.attr("class","brush").call(a.brush);a.brushg.selectAll("rect").attr("y",0).attr("height",g);a.brushg.selectAll(".resize").append("path").attr("d",function(a){var d=(a=+("e"==a))?1:-1,e=g/4;return"M"+
.5*d+","+e+"A6,6 0 0 "+a+" "+6.5*d+","+(e+6)+"V"+(2*e-6)+"A6,6 0 0 "+a+" "+.5*d+","+2*e+"ZM"+2.5*d+","+(e+8)+"V"+(2*e-8)+"M"+4.5*d+","+(e+8)+"V"+(2*e-8)})}};
PFilterNum.prototype.getState=function(){if(null==this.rCats){var a=this.insertPt(),d=parseInt(a.find("input.filter-num-min-val").val()),e=parseInt(a.find("input.filter-num-max-val").val()),f=a.find("input.filter-num-min-use").is(":checked"),a=a.find("input.filter-num-max-use").is(":checked");return{rc:!1,min:d,max:e,useMin:f,useMax:a}}return{rc:!0,e0:this.b0,e1:this.b1+1}};
PFilterNum.prototype.setState=function(a){if(a.rc)this.b0=a.e0,this.b1=a.e1-1,this.min=this.rCats[this.b0].min,this.max=this.rCats[this.b1].max,this.brush.extent([a.e0,a.e1]),this.brushg.call(this.brush);else{var d=this.insertPt();d.find("input.filter-num-min-val").val(a.min);d.find("input.filter-num-max-val").val(a.max);d.find("input.filter-num-min-use").prop("checked",a.useMin);d.find("input.filter-num-max-use").prop("checked",a.useMax)}};
var PFilterDates=function(a,d,e){PFilterModel.call(this,a,d,e)};PFilterDates.prototype=Object.create(PFilterModel.prototype);PFilterDates.prototype.constructor=PFilterDates;PFilterDates.prototype.evalPrep=function(){this.c=jQuery("input[name=dctrl-"+this.id+"]:checked").val();this.ctrs=new Uint16Array(this.rCats.length);for(var a=0;a<this.rCats.length;a++)this.ctrs[a]=0};
PFilterDates.prototype.eval=function(a){function d(a,d,e,m,n){"undefined"!=typeof m.m&&(d=m.m,"undefined"!=typeof m.d&&(e=m.d));return PData.date3Nums(a,d,e,n)}var e=a.a[this.att.id];if("undefined"==typeof e)return!1;if("undefined"==typeof e.max){if(a=d(e.min.y,1,1,e.min,!1),a<this.min||a>=this.max)return!1}else if(a=d(e.min.y,1,1,e.min,!1),e="open"==e.max?TODAY:d(e.max.y,12,31,e.max,!0),"o"==this.c){if(e<this.min||a>=this.max)return!1}else if(this.min>a||e>this.max)return!1;for(e=this.b0;e<=this.b1;e++)if(c=
this.rCats[e],c.min<=a&&a<=c.max){this.ctrs[e]++;break}return!0};PFilterDates.prototype.evalDone=function(a){for(var d=this,e=80-D3FG_MARGINS.top-D3FG_MARGINS.bottom,f=new Uint16Array(this.ctrs.length),g=0;g<this.ctrs.length;g++)f[g]=0<a?Math.round(100*this.ctrs[g]/a):0;this.chart.selectAll(".bar").transition().duration(500).attr("height",function(a,g){return e-d.yScale(f[g])}).attr("y",function(a,e){return d.yScale(f[e])})};
PFilterDates.prototype.setup=function(){var a=this;this.rCats=PData.getRCats(this.att,!1);this.b0=0;this.b1=this.rCats.length-1;this.min=this.rCats[0].min;this.max=this.rCats[this.b1].max;var d=80-D3FG_MARGINS.top-D3FG_MARGINS.bottom,e=0;this.rCats.forEach(function(a){e=Math.max(e,a.l.length)});var e=Math.max(D3FG_BAR_WIDTH,7*e),f=this.rCats.length*e,g=d3.scale.linear().domain([0,this.rCats.length]).rangeRound([0,f]),h=d3.scale.linear().domain([0,100]).range([d,0]);this.yScale=h;var m=d3.scale.ordinal().rangeRoundBands([0,
f]);m.domain(this.rCats.map(function(a){return a.l}));var m=d3.svg.axis().scale(m).orient("bottom"),n=d3.svg.axis().scale(h).orient("left").ticks(4),p=this.insertPt(),t=_.template(document.getElementById("dltext-filter-date-ctrl").innerHTML);p.append(t({id:this.id}));p.find("input[name=dctrl-"+a.id+"]").change(function(){a.isDirty(!0)});this.chart=f=d3.select(p.get(0)).append("svg").attr("width",f+D3FG_MARGINS.left+D3FG_MARGINS.right).attr("height",d+D3FG_MARGINS.top+D3FG_MARGINS.bottom).append("g").attr("transform",
"translate("+D3FG_MARGINS.left+","+D3FG_MARGINS.top+")");f.append("g").attr("class","x axis").attr("transform","translate(0,"+d+")").call(m);f.append("g").attr("class","y axis").call(n);f.selectAll(".bar").data(this.rCats).enter().append("rect").attr("class","bar").attr("x",function(a,d){return g(d)+2}).attr("y",function(a){return h(100)}).attr("fill",function(a){return a.c}).attr("height",function(a){return d-h(100)}).attr("width",e-4);a.brush=d3.svg.brush().x(g).extent([0,this.rCats.length]).on("brushend",
function(){if(d3.event.sourceEvent){var d=a.brush.extent(),e=[Math.floor(d[0]),Math.floor(d[1])];e[0]>=e[1]&&(e[0]=Math.floor(d[0]),e[1]=Math.ceil(d[1]));e[1]=Math.max(e[1],e[0]+1);d3.select(this).transition().call(a.brush.extent(e));a.b0=e[0];a.b1=e[1]-1;a.min=a.rCats[a.b0].min;a.max=a.rCats[a.b1].max;a.isDirty(!0)}});a.brushg=f.append("g");a.brushg.attr("class","brush").call(a.brush);a.brushg.selectAll("rect").attr("y",0).attr("height",d);a.brushg.selectAll(".resize").append("path").attr("d",function(a){var e=
(a=+("e"==a))?1:-1,f=d/4;return"M"+.5*e+","+f+"A6,6 0 0 "+a+" "+6.5*e+","+(f+6)+"V"+(2*f-6)+"A6,6 0 0 "+a+" "+.5*e+","+2*f+"ZM"+2.5*e+","+(f+8)+"V"+(2*f-8)+"M"+4.5*e+","+(f+8)+"V"+(2*f-8)})};PFilterDates.prototype.getState=function(){var a=jQuery("input[name=dctrl-"+this.id+"]:checked").val();return{e0:this.b0,e1:this.b1+1,c:a}};
PFilterDates.prototype.setState=function(a){jQuery('input[name="dctrl-'+this.id+'"]').val([a.c]);this.b0=a.e0;this.b1=a.e1-1;this.min=this.rCats[this.b0].min;this.max=this.rCats[this.b1].max;this.brush.extent([a.e0,a.e1]);this.brushg.call(this.brush)};
function PViewFrame(a){function d(){return"#view-frame-"+a}function e(a){a=jQuery(d()+" div.view-control-bar select.view-viz-select option:selected").val();PState.set(PSTATE_BUILD);u(a,!0);PState.set(PSTATE_READY)}function f(a){l.flags()&V_FLAG_LGND&&jQuery(d()+" div.lgnd-container").toggle("slide",{direction:"left"});a.preventDefault()}function g(a){function d(a){return a.replace(/^[ \f\t\v\u200b]+|[ \f\t\v\u200b]+$/g,"")}function k(a){var d=new Number,e=parseTC.exec(a);if(null!==e)d=1E3*(3600*parseInt(e[1])+
60*parseInt(e[2])+parseFloat(e[3])),d=1==e[4].length?d+100*parseInt(e[4]):d+10*parseInt(e[4]);else throw reportError(!1,"Error in transcript file: Cannot parse "+a+" as timecode."),Error("Error in transcript file: Cannot parse "+a+" as timecode.");return d}function e(a,k){var f=new String(a);if(widgetData.extract){var r=f.indexOf(widgetData.extract[0]);if(-1==r)throw Error("Transcript2 excerpt error: Cannot find timestamp "+widgetData.extract[0]);var y=f.indexOf(widgetData.extract[1]);if(-1==y)throw Error("Transcript2 excerpt error: Cannot find timestamp "+
widgetData.extract[1]);f=f.substring(r-1,y-1)}var f=d(f).split(/\r\n|\r|\n/g),l=[];if(f){var q,g=0;_.each(f,function(a){a=d(a);0<a.length&&("["===a.charAt(0)?(0<g&&l.push(q),q=""):(0<q.length&&(q+="<br/>"),q+=a),g++)})}_.each(l,function(a,d){k.find('div.timecode[data-tcindex="'+d+'"]').next().after('<div class="xscript">'+a+"</div>")})}function f(a){widgetData.tcArray=[];widgetData.tcIndex=-1;var r=widgetData.tcArray;a=new String(a);if(widgetData.extract){var y=a.indexOf(widgetData.extract[0]);if(-1==
y)throw Error("Transcript excerpt error: Cannot find timestamp "+widgetData.extract[0]);var q=a.indexOf(widgetData.extract[1]);if(-1==q)throw Error("Transcript excerpt error: Cannot find timestamp "+widgetData.extract[1]);a=a.substring(y-1,q-1)}if(a=d(a).split(/\r\n|\r|\n/g)){var l=jQuery("#xscript-tbl"),g=0,h,B=0,w=0,u="";_.each(a,function(a){a=d(a);1<a.length&&("["===a.charAt(0)&&"0"<=a.charAt(1)&&"9">=a.charAt(1)?(h=k(a),0<u.length&&(w&&r.push({s:B,e:h}),l.append('<div class="row"><div class="timecode" data-timecode="'+
B+'" data-tcindex="'+g++ +'">'+w+'</div><div class="xscript">'+u+"</div></div>"),u=""),w=a,B=h):(0<u.length&&(u+="<br/>"),u+=a))});0<u.length&&(r.push({s:B,e:324E5}),l.append('<div class="row"><div class="timecode" data-timecode="'+B+'" data-tcindex="'+g+'">'+w+'</div><div class="xscript">'+u+"</div></div>"));if("undefined"!=typeof p&&null!=p){var G=new XMLHttpRequest;G.onload=function(a){e(G.responseText,l)};G.open("GET",p,!0);G.send()}}}function r(a){var d,k=widgetData.tcIndex;_.find(widgetData.tcArray,
function(e,f){if((d=e.s<=a&&a<e.e)&&f!=k){var r=jQuery("#xscript-tbl");if(document.getElementById("sync-xscript").checked){var y=r.find('[data-tcindex="'+f+'"]').offset().top-r.offset().top,y=r.scrollTop()+y;r.animate({scrollTop:y},300)}-1!=k&&r.find('[data-tcindex="'+k+'"]').removeClass("current");r.find('[data-tcindex="'+f+'"]').addClass("current");widgetData.tcIndex=f}return d})}function y(){widgetData.widget=new YT.Player("yt-widget",{width:"426",height:"240",videoId:widgetData.ytCode,events:{onError:function(a){console.log("YouTube Error: "+
a.data)},onStateChange:function(a){var d;switch(a.data){case 1:widgetData.playing=!0;null==widgetData.timer&&(widgetData.timer=setInterval(function(){d=1E3*widgetData.widget.getCurrentTime();widgetData.playing&&r(d)},300));break;case 0:case 2:widgetData.playing=!1;window.clearInterval(widgetData.timer);widgetData.timer=null;break;case 3:case 5:widgetData.playing=!1}},onReady:function(){widgetData.extract&&widgetData.widget.cueVideoById({videoId:widgetData.ytCode,startSeconds:widgetData.sTime/1E3,
endSeconds:widgetData.eTime/1E3})}}})}function q(){function a(){widgetData.sTime=widgetData.eTime=null;var d;(d=prspdata.e.i.t.tcAtts[g])&&(d=J.a[d])&&""!=d&&(d=d.split("-"),widgetData.extract=d,widgetData.sTime=k(d[0]),widgetData.eTime=k(d[1]))}var d=A[N];J=PData.getRecByIndex(d);var e=" "+J.l+" ("+(N+1)+"/"+A.length+") ",l=jQuery("#inspect-name");l.text(e);l.prop("title",J.id);var g=PData.aIndex2Tmplt(d);m.empty();prspdata.e.i.modal.atts[g].forEach(function(a){var e=PData.getRecAtt(d,a,!1);if(e){a=
PData.getAttID(a);var k;"_"==a.def.l.charAt(0)?k="<div>"+e+"</div>":(k='<div><span class="att-label">'+a.def.l+":</span> ","I"==a.def.t&&(k+="<br/>"),k+=e+"</div>");m.append(k)}});n=null;z=0;widgetData.extract=null;widgetData.xscriptOn=!1;widgetData.playing=!1;if(prspdata.e.i.modal.scOn&&(n=prspdata.e.i.sc.atts[g])&&(e=J.a[n])){var h=!0;a();z=1;m.append('<iframe id="sc-widget" class="player" width="95%" height="150" src="http://w.soundcloud.com/player/?url='+e+'"></iframe></p>');var u=SC.Widget(document.getElementById("sc-widget"));
widgetData.widget=u;u.bind(SC.Widget.Events.READY,function(){u.play();u.bind(SC.Widget.Events.PLAY,function(){widgetData.playing=!0});u.bind(SC.Widget.Events.PAUSE,function(){widgetData.playing=!1});u.bind(SC.Widget.Events.PLAY_PROGRESS,function(a){h&&(u.pause(),h=!1,widgetData.playing=!1);widgetData.extract&&(a.currentPosition<widgetData.sTime?u.seekTo(widgetData.sTime):a.currentPosition>widgetData.eTime&&(u.pause(),widgetData.playing=!1));widgetData.playing&&widgetData.xscriptOn&&r(a.currentPosition)});
u.bind(SC.Widget.Events.FINISH,function(){widgetData.playing=!1})})}0==z&&prspdata.e.i.modal.ytOn&&(n=prspdata.e.i.yt.atts[g])&&(e=J.a[n])&&(a(),widgetData.ytCode=e,m.append('<div id="yt-widget"></div>'),widgetData.ytCall=y,widgetData.ytLoaded?y():(widgetData.ytLoaded=!0,e=document.createElement("script"),e.src="https://www.youtube.com/iframe_api",l=document.getElementsByTagName("script")[0],l.parentNode.insertBefore(e,l)),z=2);if(prspdata.e.i.modal.tOn&&(e=prspdata.e.i.t.t1Atts[g])&&""!==e&&"disable"!=
e&&(e=J.a[e])){0<z&&m.append("<div>"+document.getElementById("dltext-sync-xscript").innerHTML+"</div>");m.find("#xscript-tbl").remove();m.append('<div id="xscript-tbl"><div>');widgetData.xscriptOn=!0;jQuery("#xscript-tbl").click(function(a){if(z&&jQuery(a.target).hasClass("timecode"))switch(a=jQuery(a.target).data("timecode"),z){case 1:widgetData.playing||(widgetData.playing=!0,widgetData.widget.play());widgetData.widget.seekTo(a);break;case 2:widgetData.playing||(widgetData.playing=!0,widgetData.widget.playVideo()),
widgetData.widget.seekTo(a/1E3)}});p=null;(l=prspdata.e.i.t.t2Atts[g])&&""!==l&&"disable"!=l&&(p=J.a[l]);var B=new XMLHttpRequest;B.onload=function(a){f(B.responseText)};B.open("GET",e,!0);B.send()}}function g(a){a=N+a;-1==a?a=A.length-1:a==A.length&&(a=0);a!=N&&(N=a,q())}function w(a){g(-1)}function u(a){g(1)}var m=jQuery("#inspect-content"),n=null,z=0,p,A=null;l&&(A=l.getSel());if(null!=A&&0!=A.length){var t,J,N=0;q();jQuery("#btn-inspect-left").click(w);jQuery("#btn-inspect-right").click(u);var K=
450,O=400;prspdata.e.i.modal.scOn&&(K=550);prspdata.e.i.modal.ytOn&&(K=Math.max(K,475),O=500);prspdata.e.i.modal.tOn&&(O+=100,prspdata.e.i.modal.t2On?(K=Math.max(750,Math.floor(.8*jQuery(document).width())),K=Math.min(900,K)):K=Math.max(K,550));h(!1);t=jQuery("#dialog-inspector").dialog({width:K,height:O,modal:!0,buttons:[{text:dlText.seerec,click:function(){window.open(prspdata.site_url+"?p="+J.wp,"_blank")}},{text:dlText.close,click:function(){switch(z){case 1:null!=widgetData.widget&&widgetData.playing&&
widgetData.widget.pause();widgetData.playing=!1;widgetData.widget=null;break;case 2:widgetData.ytCall=null,null!=widgetData.widget&&widgetData.playing&&widgetData.widget.stopVideo(),widgetData.widget=null,widgetData.playing=!1,null!=widgetData.timer&&(window.clearInterval(widgetData.timer),widgetData.timer=null)}jQuery("#btn-inspect-left").off("click");jQuery("#btn-inspect-right").off("click");t.dialog("close");h(!0)}}]});a.preventDefault()}}function h(a){var e=jQuery(d()+" .view-control-bar");a?
(e.find(".osel").button("enable"),e.find(".osel").addClass("pulse"),e.find(".xsel").button("enable")):(e.find(".osel").button("disable"),e.find(".osel").removeClass("pulse"),e.find(".xsel").button("disable"))}function m(a){PState.set(PSTATE_UPDATE);l&&l.clearSel();h(!1);PState.set(PSTATE_READY);a.preventDefault()}function n(a){l&&l.doOptions();a.preventDefault()}function p(a){var d=jQuery("#dialog-vnotes").dialog({width:300,height:300,modal:!0,buttons:[{text:dlText.ok,click:function(){d.dialog("close")}}]});
a.preventDefault()}function t(a,e){jQuery(d()+' div.lgnd-container div.lgnd-scroll div.lgnd-template[data-index="'+a+'"] div.lgnd-group input.lgnd-entry-check').prop("checked",e)}function k(a){var e=jQuery(a.target).closest("div.lgnd-template").data("index"),k=a.target.className;switch(k){case "lgnd-update":l&&A&&(PState.set(PSTATE_BUILD),h(!1),l.render(A),PState.set(PSTATE_READY));break;case "lgnd-entry-check":k=jQuery(a.target).closest("div.lgnd-entry");a=jQuery(a.target).is(":checked");k.hasClass("lgnd-sh")?
t(e,a):k.hasClass("lgnd-locate")?k.data("id"):k.hasClass("lgnd-value")&&k.data("index");break;case "lgnd-viz":case "lgnd-value-title":k=jQuery(a.target).closest("div.lgnd-entry");k.hasClass("lgnd-locate")?(a=k.data("id"),jQuery(d()+' div.lgnd-container div.lgnd-scroll div.lgnd-template[data-index="'+e+'"] div.lgnd-locate input.lgnd-entry-check').prop("checked",!1),jQuery(d()+' div.lgnd-container div.lgnd-scroll div.lgnd-template[data-index="'+e+'"] div.lgnd-locate[data-id="'+a+'"] input.lgnd-entry-check').prop("checked",
!0)):k.hasClass("lgnd-value")&&(a=k.data("index"),jQuery(d()+' div.lgnd-container div.lgnd-scroll div.lgnd-template[data-index="'+e+'"] div.lgnd-group input.lgnd-entry-check').prop("checked",!1),jQuery(d()+' div.lgnd-container div.lgnd-scroll div.lgnd-template[data-index="'+e+'"] div.lgnd-group div.lgnd-value[data-index="'+a+'"] input.lgnd-entry-check').prop("checked",!0));break;case "lgnd-template":case "lgnd-select":case "":break;default:k.match(/lgnd-sh/i)&&(k=jQuery(a.target).find("input.lgnd-entry-check"),
a=!k.is(":checked"),k.prop("checked",a),t(e,a))}}function r(a){var d=jQuery(a.target).closest("div.lgnd-template").data("index");a=jQuery(a.target).val();y(d,a)}function y(a,e){var k,f=jQuery(d()+' div.lgnd-container div.lgnd-scroll div.lgnd-template[data-index="'+a+'"] div.lgnd-group');f.empty();z[a]=e;PData.getAttID(e).l.forEach(function(a,d){k='<div class="lgnd-value lgnd-entry" data-index="'+d+'"><input type="checkbox" checked="checked" class="lgnd-entry-check"/><div class="lgnd-viz" style="background-color: '+
a.v+'"> </div> <span class="lgnd-value-title">'+a.l+"</span></div>";f.append(k);a.z&&0<a.z.length&&a.z.forEach(function(a,e){k='<div class="lgnd-value lgnd-entry" data-index="'+d+","+e+'"><input type="checkbox" checked="checked" class="lgnd-entry-check"/>';k=a.v&&""!=a.v?k+('<div class="lgnd-viz" style="background-color: '+a.v+'"></div>'):k+'<div class="lgnd-viz lgnd-viz-empty"></div>';k+=' <span class="lgnd-value-title">&raquo; '+a.l+"</span></div>";f.append(k)})});jQuery(d()+' div.lgnd-container div.lgnd-scroll div.lgnd-template[data-index="'+
a+'"] div.lgnd-sh input').prop("checked",!0)}function u(k,e){var f=PData.getVizIndex(k);l&&(l.teardown(),l=null);var g=jQuery(d());g.find("div.viz-content div.viz-result").empty();var u;switch(f.vf){case "M":u=new VizMap(q,f.c);break;case "C":u=new VizCards(q,f.c);break;case "P":u=new VizPinboard(q,f.c);break;case "T":u=new VizTime(q,f.c);break;case "D":u=new VizDirectory(q,f.c);break;case "t":u=new VizTextStream(q,f.c);break;case "S":u=new VizStackChart(q,f.c);break;case "N":u=new VizNetWheel(q,
f.c);break;case "F":u=new VizFlow(q,f.c);break;case "m":u=new VizMBMap(q,f.c)}w=k;var m=u.flags();m&V_FLAG_HSCRL?(g.find("div.viz-content").addClass("h-scroll"),g.find("div.viz-result").addClass("viz-fit-w"),g.find("div.viz-result").removeClass("viz-max-w")):(g.find("div.viz-content").removeClass("h-scroll"),g.find("div.viz-result").removeClass("viz-fit-w"),g.find("div.viz-result").addClass("viz-max-w"));m&V_FLAG_VSCRL?(g.find("div.viz-content").addClass("v-scroll"),g.find("div.viz-result").addClass("viz-fit-h"),
g.find("div.viz-result").removeClass("viz-max-h")):(g.find("div.viz-content").removeClass("v-scroll"),g.find("div.viz-result").removeClass("viz-fit-h"),g.find("div.viz-result").addClass("viz-max-h"));z=[];if(m&V_FLAG_LGND){g.find(".hslgnd").button("enable");var n=g.find("div.lgnd-container div.lgnd-scroll");n.empty();if(m&V_FLAG_SLGND){var p=u.getFeatureAtts(),G=PData.getAttID(p);n.append('<div class="lgnd-template" data-index="0"><div class="lgnd-title">'+G.def.l+'</div><div class="lgnd-entry lgnd-sh"><input type="checkbox" checked="checked" class="lgnd-entry-check"/><i>'+
dlText.sha+'</i></div><div class="lgnd-group"></div></div>');z.push(p);y(0,p)}else{var I=!1;prspdata.e.g.ts.forEach(function(a,d){var k=PData.getTmpltID(a),e=u.getLocAtts(d);if(e&&0<e.length||!(m&V_FLAG_LOC)){var f=u.getFeatureAtts(d);if(0<f.length){I&&n.append("<hr/>");var g=jQuery('<div class="lgnd-template" data-index="'+d+'"><div class="lgnd-title">'+k.l+"</div></div>");e&&e.forEach(function(a,d){var k=PData.getAttID(a);g.append('<div class="lgnd-entry lgnd-locate" data-id="'+a+'"><input type="checkbox" checked="checked" class="lgnd-entry-check"/><span class="lgnd-value-title">'+
k.def.l+"</span></div>")});var l='<select class="lgnd-select">';f.forEach(function(a,d){var k=PData.getAttID(a);l+='<option value="'+a+'">'+k.def.l+"</option>"});l+="</select>";k=jQuery(l);k.change(r);jQuery(g).append(k);jQuery(g).append('<div class="lgnd-entry lgnd-sh"><input type="checkbox" checked="checked" class="lgnd-entry-check"/><i>'+dlText.sha+'</i></div><div class="lgnd-group"></div>');n.append(g);f=f[0];z.push(f);y(d,f);I=!0}}})}g.find("div.lgnd-container").show()}else g.find(".hslgnd").button("disable"),
g.find("div.lgnd-container").hide();p=jQuery("#selector-v"+a);m&V_FLAG_SEL?(p.removeAttr("disabled"),p.prop("checked",!0)):(p.attr("disabled",!0),p.prop("checked",!1));m&V_FLAG_OPT?g.find(".vopts").button("enable"):g.find(".vopts").button("disable");(p=u.hint())||"string"==typeof f.n&&""!=f.n?(g.find(".vnote").button("enable"),p=p?"string"==typeof f.n&&""!=f.n?p+(".<br/>"+f.n):p+".":f.n,jQuery("#vnotes-txt").empty().append(p)):g.find(".vnote").button("disable");u.setup();h(!1);A&&e&&u.render(A);l=
u}var q={},w=0,l=null,z=[],A=null;q.getFrameID=d;q.getIndex=function(){return a};q.setViz=function(a,k){a!=w&&(jQuery(d()+" div.view-control-bar select.view-viz-select").val(a),u(a,k))};q.initDOM=function(r){var l=document.getElementById("dltext-viewframe-dom").innerHTML;jQuery("#viz-display-frame").append('<div id="view-frame-'+a+'">'+l+"</div>");var l=jQuery(d()),y=prspdata.bClrs.vf;y&&0<y.length&&l.find("div.view-control-bar").css("background-color",y);l.find("div.lgnd-container").draggable({handle:l.find("div.lgnd-handle"),
containment:"parent"});var q=l.find("div.view-control-bar select.view-viz-select");prspdata.e.vf.forEach(function(a,d){q.append('<option value="'+d+'">'+a.l+"</option>")});q.val(r);q.change(e);l.find("div.view-control-bar button:first").button({icons:{primary:"ui-icon-bookmark"},text:!1}).click(f).next().button({icons:{primary:"ui-icon-search"},text:!1}).click(g).next().button({icons:{primary:"ui-icon-cancel"},text:!1}).click(m).next().button({icons:{primary:"ui-icon-gear"},text:!1}).click(n).next().button({icons:{primary:"ui-icon-help"},
text:!1}).click(p).next();l.find("div.lgnd-container").click(k);u(r,!1)};q.getSelLocAtts=function(a){var k=[];jQuery(d()+' div.lgnd-container div.lgnd-scroll div.lgnd-template[data-index="'+a+'"] div.lgnd-locate input:checked').each(function(){var a=jQuery(this).parent().data("id");k.push(a)});return k};q.getSelFeatAtts=function(a){var k=[],e,f;jQuery(d()+' div.lgnd-container div.lgnd-scroll div.lgnd-template[data-index="'+a+'"] div.lgnd-group div.lgnd-value input:checked').each(function(){e=jQuery(this).parent().data("index");
"number"==typeof e?k.push(e):-1!=(f=e.indexOf(","))?k.push([parseInt(e.substring(0,f),10),parseInt(e.substring(f+1),10)]):k.push(parseInt(e,10))});return k};q.getSelLegend=function(a){return z[a]};q.getLgndSels=function(){return z.slice(0)};q.setLgndSels=function(a){a.forEach(function(a,k){jQuery(d()+' div.lgnd-container div.lgnd-scroll div.lgnd-template[data-index="'+k+'"] select.lgnd-select').val(a);y(k,a)})};q.getState=function(){return l?l.getState():null};q.setState=function(a){l&&l.setState(a)};
q.showStream=function(a){A=a;l&&l.render(a)};q.setStream=function(a){A=a};q.selBtns=function(a){h(a)};q.clearSel=function(){l&&l.clearSel();h(!1)};q.setSel=function(a){return l&&l.flags()&V_FLAG_SEL?(l.setSel(a),h(0<a.length),!0):!1};q.resize=function(){l&&l.resize()};q.title=function(){return PData.getVizIndex(w).l};q.flushLgnd=function(){jQuery(d()).find("div.lgnd-container").css("left","10px")};return q}
var PData=function(){function a(a,e,f){jQuery.ajax({type:"POST",url:prspdata.ajax_url,data:{action:"prsp_get_records",tmplt_id:prspdata.t[a].id,from:e,count:f},success:function(e,r,g){r=n[a];e=JSON.parse(e);r.d=r.d?r.d.concat(e):e;r.n+=f;d()},error:function(a,d,k){alert(k)}})}function d(){for(var d=!0,f=0;f<prspdata.t.length;f++){var g=n[f].n,h=prspdata.t[f].n;if(g<h){d=!1;h-=g;a(f,g,h<e?h:e);break}}d&&(t=!0,setTimeout(function(){jQuery("body").trigger("prospect",{pstate:PSTATE_PROCESS,component:0})},
500))}var e=1E3,f,g,h,m=[31,28,31,30,31,30,31,31,30,31,30,31],n=[],p=0,t=!1;return{init:function(){document.getElementById("dltext-from");f=document.getElementById("dltext-to").innerHTML;g=document.getElementById("dltext-approximately").innerHTML;h=document.getElementById("dltext-now").innerHTML;"number"==typeof prspdata.chunk&&0<prspdata.chunk&&(e=prspdata.chunk);prspdata.t.forEach(function(a){n.push({i:p,n:0,d:null});p+=a.n});d()},intersect:function(a,d){for(var e=[],f=a.length,g=d.length,h,l,m=
0,n=0;m<f&&n<g;)h=a[m],l=d[n],h>l?n++:l>h?m++:(e.push(h),m++,n++);return e},union:function(a,d){for(var e=[],f=0,g=0,h,l;f<a.length&&g<d.length;)h=a[f],l=d[g],h<l?(e.push(h),f++):(h==l?(e.push(h),f++):e.push(l),g++);for(;f<a.length;f++)e.push(a[f]);for(;g<d.length;g++)e.push(d[g]);return e},strcmp:function(a,d){for(var e=0,f=Math.max(a.length,d.length);e<f&&a.charAt(e)===d.charAt(e);++e);return e===f?0:a.charAt(e)>d.charAt(e)?-1:1},newIndexStream:function(a){var d={};d.s=new Uint16Array(p);d.t=[];
d.l=0;if(a){for(a=0;a<p;a++)d.s[a]=a;for(a=0;a<n.length;a++){var e=n[a];d.t.push({i:e.i,n:e.n})}d.l=p}return d},aIndex2Tmplt:function(a){for(var d=0;d<n.length;d++){var e=n[d];if(e.i<=a&&a<e.i+e.n)return d}},attInTmplt:function(a,d){return-1!=prspdata.t[d].def.a.findIndex(function(d){return d==a})},stream1stTEntry:function(a,d){var e=a.t[d];return 0==e.n?-1:e.i},getRecByIndex:function(a){for(var d=0;d<n.length;d++){var e=n[d];if(0<e.n&&e.i<=a&&a<e.i+e.n)return e.d[a-e.i]}return null},procAttTxt:function(a,
d){var e=PData.getAttID(a);switch(e.def.t){case "V":return d.join(", ");case "T":return d;case "N":return d.toString();case "D":return e="",d.max?(d.min.f&&(e=g),e+=d.min.y.toString(),d.min.m&&(e+="-"+d.min.m.toString(),d.min.d&&(e+="-"+d.min.d.toString())),e+=f,"open"==d.max?e+=h:(d.max.f&&(e+=g+" "),e+=d.max.y.toString(),d.max.m&&(e+="-"+d.max.m.toString(),d.max.d&&(e+="-"+d.max.d.toString())))):(e=d.min.f?g:"",e+=d.min.y.toString(),d.min.m&&(e+="-"+d.min.m.toString(),d.min.d&&(e+="-"+d.min.d.toString()))),
e;case "L":case "X":return d.join(", ");case "I":return'<img src="'+d+'" alt="'+e.def.l+'"/>';case "l":return'<a href="'+d+'" target="_blank">(See Link)</a>';case "S":return'<a href="'+d+'" target="_blank">(SoundCloud)</a>';case "Y":return'<a href="https://www.youtube.com/watch?v='+d+'" target="_blank">(YouTube)</a>';case "x":return'<a href="'+d+'" target="_blank">(See Transcript File)</a>';case "t":return d;case "P":if(0<d.length){var u="";d.forEach(function(a){(a=PData.getRecByID(a))&&(u+='<a href="'+
prspdata.site_url+"?p="+a.wp+'" target="_blank">'+a.l+"</a> ")});return u}}return null},getRecAtt:function(a,d,e){for(var f=0;f<n.length;f++){var g=n[f];if(0<g.n&&g.i<=a&&a<g.i+g.n){a=g.d[a-g.i].a[d];if(null==a||"undefined"==typeof a)break;return e?a:PData.procAttTxt(d,a)}}return null},getAbsIByID:function(a){for(var d=0;d<n.length;d++){var e=n[d];if(0<e.n)for(var f=0,g=e.n-1,h,l;f<=g;)if(h=f+g>>1,l=e.d[h],l=PData.strcmp(a,l.id),0>l)f=h+1;else if(0<l)g=h-1;else return e.i+h}return null},getRecByID:function(a){for(var d=
0;d<n.length;d++){var e=n[d];if(0<e.n)for(var f=0,g=e.n-1,h,l,m;f<=g;)if(h=f+g>>1,m=e.d[h],l=PData.strcmp(a,m.id),0>l)f=h+1;else if(0<l)g=h-1;else return m}return null},getAttID:function(a){for(var d=0,e=prspdata.a.length-1,f,g;d<=e;)if(f=d+e>>1,g=PData.strcmp(a,prspdata.a[f].id),0>g)d=f+1;else if(0<g)e=f-1;else return prspdata.a[f];return null},getAttIndex:function(a){return prspdata.a[a]},getNumETmplts:function(){return prspdata.e.g.ts.length},getETmpltIndex:function(a){return prspdata.e.g.ts[a]},
getTmpltID:function(a){for(var d=0;d<prspdata.t.length;d++)if(a==prspdata.t[d].id)return prspdata.t[d].def},getAttLgndRecs:function(a,d,e,f){var g,h=e.length,l;switch(d.def.t){case "V":var m=function(a){for(var f=0;f<h;f++)if(g=e[f],"number"===typeof g){if(l=d.l[g],l.l==a)return l}else{l=d.l[g[0]];var k=l.z[g[1]];if(k.l==a)return k.v&&""!=k.v?k:l}return null};if(f&&""!=d.def.d){var n=[],p;a.forEach(function(a){p=m(a);null!=p&&n.push(p)});return 0<n.length?n:null}if(""!=d.def.d){for(f=0;f<a.length;f++)if(p=
m(a[f]),null!=p)return p;break}else return m(a[0]);case "T":for(p=0;p<h;p++)if(g=e[p],l=d.l[g],-1!=a.indexOf(l.d))return l;break;case "N":for(p=0;p<h;p++)if(g=e[p],l=d.l[g],"undefined"!=typeof l.d.min){if(l.d.min<=a)if("undefined"!=typeof l.d.max){if(a<=l.d.max)return l}else return l}else if(a<=l.d.max)return l;break;case "D":for(p=0;p<h;p++)if(g=e[p],l=d.l[g],"undefined"!=typeof l.d.max.y){if("undefined"!=typeof a.max&&"open"!=a.max){if(a.max.y<l.d.min.y)continue;if(a.max.y==l.d.min.y&&a.max.m&&
l.d.min.m){if(a.max.m<l.d.min.m)continue;if(a.max.m==l.d.min.m&&a.max.d&&l.d.min.d&&a.max.d<l.d.min.d)continue}}if(!(a.min.y>l.d.max.y)){if(a.min.y==l.d.max.y&&a.min.m&&l.d.max.m){if(a.min.m>l.d.max.m)continue;if(a.min.m==l.d.max.m&&a.min.d&&l.d.max.d&&a.min.d>l.d.max.d)continue}return l}}else if("undefined"!=typeof a.max){if("open"==a.max)return l;if(!(a.max.y<l.d.min.y)){if(a.max.y==l.d.min.y&&a.max.m&&l.d.min.m){if(a.max.m<l.d.min.m)continue;if(a.max.m==l.d.min.m&&a.max.d&&l.d.min.d&&a.max.d<l.d.min.d)continue}return l}}else if(!(a.min.y<
l.d.min.y)){if(a.min.y==l.d.min.y&&a.min.m&&l.d.min.m){if(a.min.m<l.d.min.m)continue;if(a.min.m==l.d.min.m&&a.min.d&&l.d.min.d&&a.min.d<l.d.min.d)continue}return l}}return null},getAttLgndVal:function(a,d,e){var f;return(f=PData.getAttLgndRecs(a,d,e,!1))?f.v:null},getVLgndVal:function(a,d){for(var e=0,f=a.x.length-1,g,h;e<=f;)if(g=e+f>>1,h=PData.strcmp(d,a.x[g].l),0>h)e=g+1;else if(0<h)f=g-1;else return e=a.x[g].i,"number"==typeof e?a.l[e]:a.l[e[0]].z[e[1]];return null},lenMnth:function(a,d){return 2==
d&&0==a%4&&0!=a%100||0==a%400?29:m[d-1]},date3Nums:function(a,d,e,f){0>a||99<a?d=new Date(a,d-1,e):0==a?d=new Date(-1,d-1,e):(d=new Date(a,d-1,e),d.setUTCFullYear(("0000"+a).slice(-4)));f&&d.setTime(d.getTime()+MS_IN_DAY);return d},objDate:function(a,d,e){var f;"undefined"!=typeof a.m&&null!=a.m?(d=a.m,f="undefined"!=typeof a.d&&null!=a.d?a.d:PData.lenMnth(a.y,d)):f=PData.lenMnth(a.y,d);return PData.date3Nums(a.y,d,f,e)},parseDate:function(a,d){var e,f;if("open"==a)return TODAY;e=1;"-"==a.charAt(0)&&
(e=-1,a=a.substring(1));f=a.split("-");var g=parseInt(f[0])*e;1<f.length?(e=parseInt(f[1]),f=3==f.length?parseInt(f[2]):d?PData.lenMnth(g,e):1):d?(e=12,f=31):f=e=1;return PData.date3Nums(g,e,f,d)},makeDates:function(a){var d,e,f,g,h=!1;e=a.min.y;"undefined"==typeof a.min.m?g=f=1:(f=a.min.m,"undefined"==typeof a.min.d?g=1:(g=a.min.d,h=!0));d=PData.date3Nums(e,f,g,!1);if("undefined"!=typeof a.max)"open"==a.max?a=TODAY:(e=a.max.y,"undefined"==typeof a.max.m?(f=12,g=31):(f=a.max.m,g="undefined"==typeof a.max.d?
PData.lenMnth(e,f):a.max.d),a=PData.date3Nums(e,f,g,!0));else{if(h)return[d,null];"undefined"==typeof a.min.m?(f=12,g=31):(f=a.min.m,g=PData.lenMnth(e,f));a=PData.date3Nums(e,f,g,!0)}return[d,a]},getLCats:function(a,d){var e=[];switch(a.def.t){case "T":return a.l.forEach(function(f){(null==d||PData.getAttLgndRecs(f.d,a,d,!1))&&e.push({l:f.l,x:f.d,c:f.v,i:[]})}),e;case "V":return a.l.forEach(function(f){(null==d||PData.getAttLgndRecs([f.l],a,d,!1))&&e.push({l:f.l,c:f.v,i:[]});f.z.forEach(function(f){(null==
d||PData.getAttLgndRecs([f.l],a,d,!1))&&e.push({l:f.l,c:f.v,i:[]})})}),e;case "N":return a.l.forEach(function(f){(null==d||PData.getAttLgndRecs(f.d.min,a,d,!1))&&e.push({l:f.l,c:f.v,min:f.d.min,max:f.d.max,i:[]})}),e;case "D":var f,g;a.l.forEach(function(h){f=PData.objDate(h.min,1,!1);if(null==d||PData.getAttLgndRecs(f,a,d,!1))g=null==h.max.y?TODAY:PData.objDate(h.max,12,!0),e.push({l:h.l,c:h.v,min:f,max:g,i:[]})});return e}},getRCats:function(a,d){var e=[];switch(a.def.t){case "T":return a.l.forEach(function(a){d?
e.push({l:a.l,x:a.d,c:a.v,i:[]}):e.push({l:a.l,x:a.d,c:a.v})}),e;case "V":return a.l.forEach(function(a){d?e.push({l:a.l,c:a.v,i:[]}):e.push({l:a.l,c:a.v});a.z.forEach(function(a){d?e.push({l:a.l,c:a.v,i:[]}):e.push({l:a.l,c:a.v})})}),e;case "N":if("undefined"==typeof a.r.min||"undefined"==typeof a.r.max)return null;var f=Math.pow(10,a.r.g),g=a.r.min,h=0,l,m,p;for(0<a.l.length&&(l=a.l[0]);g<=a.r.max;){for(;h<a.l.length&&"undefined"!=typeof l.d.max&&g>l.d.max;)l=a.l[++h];p=0==a.l.length||g<l.d.min?
"#777777":h==a.l.length?"#777777":"undefined"==typeof l.d.max||g<=l.d.max?l.v:"#777777";m=g;max=g+=f;var n=m.toString();1<f&&4>n.length&&(n+="-"+(max-1).toString());d?e.push({l:n,c:p,min:m,max:g,i:[]}):e.push({l:n,c:p,min:m,max:g})}return e;case "D":g=function(a){var d,e;if("undefined"==typeof a.y)return TODAY;d=a.y;"undefined"==typeof a.m?(e=12,a=31):(e=a.m,a="undefined"==typeof a.d?PData.lenMnth(d,e):a.d);return PData.date3Nums(d,e,a,!0)};m=function(a,d,e,f){"undefined"!=typeof f.m&&(d=f.m,"undefined"!=
typeof f.d&&(e=f.d));return PData.date3Nums(a,d,e,!1)};p=g(a.r.max);var f=a.r.g,n=a.r.min.y,t=1,v=1;"undefined"!=typeof a.r.min.m&&(t=a.r.min.m,"undefined"!=typeof a.r.min.d&&(v=a.r.min.d));var x=PData.date3Nums(n,t,v,!1),h=0,C,D;0<a.l.length&&(l=a.l[0],C=m(l.d.min.y,1,1,l.d.min),D=g(l.d.max));for(;x<=p;){var F={};d&&(F.i=[]);switch(f){case "d":F.l=n.toString()+"-"+t.toString()+"-"+v.toString();break;case "m":F.l=n.toString()+"-"+t.toString();break;case "y":case "t":case "c":F.l=n.toString()}for(;h<
a.l.length&&x>D;)l=a.l[++h],h<a.l.length&&(C=m(l.d.min.y,1,1,l.d.min),D=g(l.d.max));F.c=0==a.l.length||x<C?"#777777":h==a.l.length?"#777777":x<=D?l.v:"#777777";F.min=x;switch(f){case "d":F.max=PData.date3Nums(n,t,v+1,!0);++v>PData.lenMnth(n,t)&&(v=1,12<++t&&(t=1,n++));break;case "m":F.max=PData.date3Nums(n,t+1,v,!0);12<++t&&(t=1,n++);break;case "y":F.max=PData.date3Nums(n+1,t,v,!0);n++;break;case "t":F.max=PData.date3Nums(n+10,t,v,!0);n+=10;break;case "c":F.max=PData.date3Nums(n+100,t,v,!0),n+=100}e.push(F);
x=PData.date3Nums(n,t,v,!1)}return e}},fillCats:function(a,d,e,f,g){var h=PData.getNumETmplts(),l=0,m,n=0,p,t,v,x,C=PData.getAttID(d);for(m=f.t[0];n<f.l;){for(;0==m.n||m.i+m.n==n||!PData.attInTmplt(d,l)||e&&!PData.attInTmplt(e,l);){if(++l==h)return;m=f.t[l];n=m.i}p=f.s[n];t=PData.getRecByIndex(p);t=t.a[d];if("undefined"!=typeof t)switch(C.def.t){case "T":if(g){for(v=0;v<a.length;v++)if(x=a[v],t==x.l){x.i.push(p);break}v==a.length&&a.push({l:t,i:[p]})}else for(v=0;v<a.length;v++)if(x=a[v],-1!=t.indexOf(x.x)){x.i.push(p);
break}break;case "V":t.forEach(function(d){for(v=0;v<a.length;v++)if(x=a[v],d==x.l){x.i.push(p);break}});break;case "N":for(v=0;v<a.length;v++){x=a[v];if(t<x.min)break;if(x.min<=t&&t<=x.max){x.i.push(p);break}}break;case "D":for(t=PData.objDate(t.min,1,!1),v=0;v<a.length;v++){x=a[v];if(t<x.min)break;if(x.min<=t&&t<=x.max){x.i.push(p);break}}}n++}g&&a.sort(function(a,d){return PData.strcmp(d.l,a.l)})},sortCats:function(a,d,e){var f=d.id,g,h,l;a.forEach(function(a){g=PData.getRecByIndex(a);datum=g.a[f];
if("undefined"!=typeof datum)switch(d.def.t){case "T":for(h=0;h<e.length;h++)if(l=e[h],-1!=datum.indexOf(l.x)){l.i.push(a);break}break;case "V":datum.forEach(function(d){for(h=0;h<e.length;h++)if(l=e[h],d==l.l){l.i.push(a);break}});break;case "N":for(h=0;h<e.length;h++){l=e[h];if(datum<l.min)break;if(l.min<=datum&&datum<=l.max){l.i.push(a);break}}break;case "D":var k=PData.objDate(datum.min,1,!1);for(h=0;h<e.length;h++){l=e[h];if(k<l.min)break;if(l.min<=k&&k<=l.max){l.i.push(a);break}}}})},orderTBy:function(a,
d,e){function f(a){return a}function g(a){return a[0]}function h(a){var d=1,e=1;"undefined"!=typeof a.min.m&&(d=a.min.m,"undefined"!=typeof a.min.d&&(e=a.min.d));return PData.date3Nums(a.min.y,d,e,!1)}var l,m;switch(a.def.t){case "T":l=f;m="~";break;case "V":l=g;m="~";break;case "N":l=f;m=a.r.max;break;case "D":l=h,m=TODAY}var p=[],t=d.t[e];e=n[e];for(var E=0,v,x;E<t.n;)v=d.s[t.i+E++],x=e.d[v-e.i],x=x.a[a.id],"undefined"==typeof x?p.push({i:v,v:m}):p.push({i:v,v:l(x)});switch(a.def.t){case "T":case "V":p.sort(function(a,
d){return PData.strcmp(d.v,a.v)});break;case "D":case "N":p.sort(function(a,d){return a.v-d.v})}return p},getVizIndex:function(a){return prspdata.e.vf[a]},ready:function(){return t}}}();
jQuery(document).ready(function(a){function d(){var a;PState.set(PSTATE_PROCESS);null==v&&(v=PData.newIndexStream(!0));x=v;var d=!1,e,f;for(e=0;e<z.length;e++)if(f=z[e],a=jQuery('div.filter-instance[data-id="'+f.id+'"]'),d||f.f.isDirty(null)){d=!0;f=f.f;f.evalPrep();for(var g=PData.newIndexStream(!1),h=0,k,m,n=0,p=x.t[0],q=0,r=0,t=a.find(".apply-tmplt-0").is(":checked");h<x.l;){for(;0==p.n||p.i+p.n==h;)g.t.push({i:g.l-q,n:q}),q=0,p=x.t[++n],t=a.find(".apply-tmplt-"+n).is(":checked");k=x.s[h++];t?
(m=PData.getRecByIndex(k),f.eval(m)&&(g.s[g.l++]=k,q++),r++):(g.s[g.l++]=k,q++)}for(;n++<PData.getNumETmplts();)g.t.push({i:g.l-q,n:q}),q=0;f.isDirty(!1);f.out=g;f.evalDone(r);x=g}else x=f.f.out;PState.set(PSTATE_BUILD);w.showStream(x);l&&l.showStream(x);jQuery("#btn-recompute").removeClass("pulse")}function e(a){var d=jQuery("#annote");d.text(a);0<a.length?(jQuery("#btn-annote").button("enable"),d.show()):(jQuery("#btn-annote").button("disable"),d.hide())}function f(a){var d=_.find(prspdata.p,function(d){return a==
d.id});return d?d:null==C||0==D.length?null:(d=_.find(D,function(d){return a==d.id}))?d:null}function g(a){var d=jQuery("input[name=save-prspctv-dest]:checked").val();if(""==d)return null;var e=jQuery("#save-psrctv-note").val(),e=e.replace(/"/,""),f=jQuery("#save-psrctv-lbl").val().trim(),f=f.replace(/"/,""),g=!jQuery("#selector-v0").prop("disabled")&&jQuery("#selector-v0").is(":checked"),h=!jQuery("#selector-v1").prop("disabled")&&jQuery("#selector-v1").is(":checked"),k={f:[],s:null,a0:g,a1:h,v0:{l:w.title(),
s:w.getState()},v1:null};z.forEach(function(a){for(var d=[],e=jQuery('div.filter-instance[data-id="'+a.id+'"]'),f=0;f<PData.getNumETmplts();f++)d.push(e.find(".apply-tmplt-"+f).is(":checked"));k.f.push({id:a.attID,a:d,s:a.f.getState()})});A&&(k.s={id:B,s:A.getState()});l&&(k.v1={l:l.title(),s:l.getState()});var m={id:a,l:f,n:e,s:k};"local"==d?(D.push(m),C.setItem(prspdata.e.id,JSON.stringify(D))):"server"==d&&jQuery.ajax({type:"POST",url:prspdata.ajax_url,data:{action:"prsp_save_prspctv",id:a,l:f,
x:prspdata.e.id,n:e,s:JSON.stringify(k)},success:function(a,d,e){"0"!=a&&prspdata.p.push(m)},error:function(a,d,e){alert(e)}});return d}function h(){var a,d=[],e=!1;(function(){var a=jQuery("#prspctv-mlist");a.empty();D.forEach(function(d){a.append('<li data-type="l" data-id="'+d.id+'"><span class="label">'+d.l+'</span> <button class="del">'+dlText.del+'</button> <button class="edit">'+dlText.edit+"</button></li>")});for(var e=0;e<C.length;e++){var f=C.key(e);if(f!=prspdata.e.id){var g=C.getItem(f);
d.push({id:f,ps:JSON.parse(g)})}}d.forEach(function(d,e){d.ps.forEach(function(f){a.append('<li data-type="x" data-xid="'+d.id+'" data-xindex="'+e+'" data-id="'+f.id+'"><i class="label">'+f.l+'</i> <button class="del">'+dlText.del+'</button> <button class="edit">'+dlText.edit+"</button></li>")})})})();jQuery("#prspctv-mlist").click(function(a){if("BUTTON"==a.target.nodeName){var f=jQuery(a.target).hasClass("del"),g=jQuery(a.target).parent(),h=g.data("type"),k=g.data("id");if(f){switch(h){case "l":a=
D.findIndex(function(a){return k==a.id});-1!=a&&(D.splice(a,1),0==D.length?C.removeItem(prspdata.e.id):C.setItem(prspdata.e.id,JSON.stringify(D)));break;case "x":a=g.data("xindex"),f=d[a],a=f.ps.findIndex(function(a){return k==a.id}),-1!=a&&(f.ps.splice(a,1),e=!0)}g.remove()}else{var l;switch(h){case "l":l=_.find(D,function(a){return k==a.id});break;case "x":a=g.data("xindex"),f=d[a],l=_.find(f.ps,function(a){return k==a.id})}jQuery("#edit-psrctv-lbl").val(l.l);jQuery("#edit-psrctv-note").val(l.n);
var m=jQuery("#dialog-edit-prsrctv").dialog({width:340,height:270,modal:!0,buttons:[{text:dlText.ok,click:function(){l.l=jQuery("#edit-psrctv-lbl").val();l.n=jQuery("#edit-psrctv-note").val();g.find(".label").text(l.l);"x"==h?e=!0:C.setItem(prspdata.e.id,JSON.stringify(D));m.dialog("close")}},{text:dlText.cancel,click:function(){m.dialog("close")}}]})}}});a=jQuery("#dialog-manage-prsrctv").dialog({width:450,height:350,modal:!0,buttons:[{text:dlText.ok,click:function(){e&&d.forEach(function(a){0<a.ps.length?
C.setItem(a.id,JSON.stringify(a.ps)):C.removeItem(a.id)});jQuery("#prspctv-mlist").off("click");a.dialog("close")}}]})}function m(a){window.location.href=prspdata.e.g.hurl;a.preventDefault()}function n(a){jQuery(this).parent().next().slideToggle(400);a.preventDefault()}function p(a){if(a=jQuery(this).closest("div.filter-instance")){var d=a.data("id");d&&""!=d&&(a=z.find(function(a){return a.id==d}),null==a?alert("Bad Filter ID "+d):a.f.isDirty(!0))}}function t(a){var d=jQuery(this).closest("div.filter-instance"),
e=d.data("id"),f,g;f=z.findIndex(function(a){return a.id==e});-1==f?alert("Bad Filter ID "+e):(g=z[f].f,g.teardown(),z.splice(f,1),f>=z.length?(f=0==z.length?v:z[f-1].out,w.setStream(f),l&&l.setStream(f),jQuery("#btn-recompute").addClass("pulse")):z[f].f.isDirty(!0),d.remove(),0==z.length&&jQuery("#btn-toggle-filters").button("disable"),a.preventDefault())}function k(){null!=A&&(A.teardown(),jQuery('div.filter-instance[data-id="0"]').empty(),A=null,jQuery("#btn-toggle-selector").button("disable"),
jQuery("#btn-apply-selector").button("disable"))}function r(a,d,e){var f;if(e)k(),f=0;else{do f=Math.floor(1E3*Math.random()+1),-1!=z.findIndex(function(a){return a.id==f})&&(f=-1);while(-1==f)}var g,h;if("_remove"==a)g=new PFilterRemove(f),h={t:[!0,!0,!0,!0]};else switch(h=PData.getAttID(a),h.def.t){case "V":g=new PFilterVocab(f,h);break;case "T":g=new PFilterText(f,h);break;case "N":g=new PFilterNum(f,h);break;case "D":g=new PFilterDates(f,h)}if(e)A=g,B=a,e=_.template(document.getElementById("dltext-selector-head").innerHTML),
a=jQuery('div.filter-instance[data-id="0"]'),a.append(e({title:g.title()})),a.find("button.btn-filter-del").button({text:!1,icons:{primary:"ui-icon-trash"}}).click(k);else{z.push({id:f,attID:a,f:g,out:null});e=_.template(document.getElementById("dltext-filter-head").innerHTML);jQuery("#filter-instances").append(e({newID:f,title:g.title(),apply:E}));a=jQuery('div.filter-instance[data-id="'+f+'"]');for(e=0;e<PData.getNumETmplts();e++){var l=a.find(".apply-tmplt-"+e);l.prop("disabled",!h.t[e]);l.prop("checked",
d[e]);l.click(p)}a.find("button.btn-filter-toggle").button({text:!1,icons:{primary:"ui-icon-carat-2-n-s"}}).click(n);a.find("button.btn-filter-del").button({text:!1,icons:{primary:"ui-icon-trash"}}).click(t);jQuery("#btn-recompute").addClass("pulse")}g.setup();return g}function y(){PState.set(PSTATE_PROCESS);var a=[],d=!1;if(null!=A&&null!=x){A.evalPrep();for(var e=0,f,g;e<x.l;)f=x.s[e++],g=PData.getRecByIndex(f),A.eval(g)&&a.push(f);A.isDirty(!1);A.evalDone(x.l)}PState.set(PSTATE_UPDATE);jQuery("#selector-v0").is(":checked")&&
(d=w.setSel(a));jQuery("#selector-v1").is(":checked")&&l&&(d&&(a=a.slice(0)),l.setSel(a))}function u(a){function g(a){return prspdata.e.vf.findIndex(function(d){return a==d.l})}a=f(a);if(null==a)return!1;PState.set(PSTATE_PROCESS);jQuery("#filter-frame").hide();jQuery("#selector-frame").hide();z.forEach(function(a){a.f.teardown()});z=[];jQuery("#filter-instances").empty();a.s.f.forEach(function(a){r(a.id,a.a,!1).setState(a.s)});jQuery("#filter-instances").hide();jQuery("#btn-toggle-filters").button(0==
a.s.f.length?"disable":"enable");k();null!=a.s.s&&(r(a.s.s.id,null,!0),A.setState(a.s.s.s),jQuery("#btn-toggle-selector").button("enable"),jQuery("#btn-apply-selector").button("enable"));jQuery("#selector-instance").hide();var h,m=!1;PState.set(PSTATE_BUILD);h=g(a.s.v0.l);w?(w.setViz(h,!1),w.selBtns(!1)):(w=PViewFrame(0),w.initDOM(h));null!=a.s.v1?(h=g(a.s.v1.l),l?(l.selBtns(!1),l.setViz(h,!1),l.setState(a.s.v1.s)):(w.flushLgnd(),l=PViewFrame(1),l.initDOM(h),l.setState(a.s.v1.s),m=!0)):l&&(l=null,
jQuery("#view-frame-1").remove(),jQuery("#selector-v1").prop("disabled",!0),m=!0);m&&w.resize();w.setState(a.s.v0.s);e(a.n);jQuery("#selector-v0").prop("checked",a.s.a0);jQuery("#selector-v1").prop("checked",a.s.a1);PData.ready()&&v&&(d(),A&&y());return!0}function q(a,d){var e=prspdata.bClrs[a];e&&0<e.length&&jQuery(d).css("background-color",e)}var w,l,z=[],A=null,B,E,v,x,C=null,D=[];jQuery("body").addClass("waiting");q("cb","#command-bar");q("fs","#filter-frame");q("sf","#selector-frame");PState.init();
PMapHub.init(prspdata.m);(function(){function a(e,f){d=document.getElementById(e).innerHTML;dlText[f]=d.trim()}var d;a("dltext-removehideall","rha");a("dltext-showhideall","sha");a("dltext-ok","ok");a("dltext-cancel","cancel");a("dltext-seerec","seerec");a("dltext-close","close");a("dltext-add","add");a("dltext-manage","manage");a("dltext-delete","del");a("dltext-edit","edit");a("dltext-markers","markers");a("dltext-hint-marker","markersize");a("dltext-hint-text","textsize");a("dltext-xaxis","xaxis");
a("dltext-yaxis","yaxis");a("dltext-orderedby","orderedby");a("dltext-grpblks","grpblks");a("dltext-reset","reset");d=document.getElementById("dltext-month-names").innerHTML;months=d.trim().split("|");(d=document.getElementById("dltext-d3-local"))&&(d=d.innerHTML)&&1<d.length&&(localD3=d3.locale(JSON.parse(d)).timeFormat.multi([["%H:%M",function(a){return a.getMinutes()}],["%H:%M",function(a){return a.getHours()}],["%a %d",function(a){return a.getDay()&&1!=a.getDate()}],["%b %d",function(a){return 1!=
a.getDate()}],["%B",function(a){return a.getMonth()}],["%Y",function(){return!0}]]))})();xhbtURL=window.location.pathname;xhbtURL=xhbtURL.replace(/\&*prspctv=[\w\-]+/,"");xhbtURL=xhbtURL.replace(/\/$/,"");xhbtURL=xhbtURL.replace(/^\//,"");xhbtURL="http://"+window.location.host+"/"+xhbtURL;(function(){var a=_.template(document.getElementById("dltext-filter-template").innerHTML),d=[];prspdata.t.forEach(function(e,f){d.push(a({ti:f,tl:e.def.l}))});E=d.join("&nbsp;")})();(function(){var a;prspdata.t.forEach(function(d,
e){var f="";d.def.a.forEach(function(d){a=PData.getAttID(d);switch(a.def.t){case "T":case "V":case "N":case "D":f+='<option value="'+d+'">'+a.def.l+"</option>"}});jQuery("#dialog-sortby").append("<b>"+d.def.l+"</b>: <select data-ti="+e+">"+f+"</select><br/>")})})();"/"!=prspdata.site_url.charAt(prspdata.site_url.length-1)&&(prspdata.site_url+="/");""!=prspdata.e.g.l&&jQuery("#title").text(prspdata.e.g.l);try{var F=window.localStorage;F.setItem("__storage_test__","__storage_test__");F.removeItem("__storage_test__");
var H=F.getItem(prspdata.e.id),C=F;0<H.length&&(D=JSON.parse(H))}catch(G){}jQuery("#btn-about").button({icons:{primary:"ui-icon-info"},text:!1}).click(function(a){var d;jQuery("#dialog-about img").removeClass("zoomin");d=jQuery("#dialog-about").dialog({height:390,width:350,modal:!0,buttons:[{text:dlText.ok,click:function(){d.dialog("close")}}]});jQuery("#dialog-about img").addClass("zoomin");a.preventDefault()});jQuery("#btn-recompute").button({icons:{primary:"ui-icon-refresh"},text:!1}).click(function(a){w.clearSel();
l&&l.clearSel();d();PState.set(PSTATE_READY);a.preventDefault()});jQuery("#btn-set-layout").button({icons:{primary:"ui-icon-newwin"},text:!1}).click(function(){null!=l?(l=null,jQuery("#view-frame-1").remove(),jQuery("#selector-v1").prop("checked",!1),jQuery("#selector-v1").prop("disabled",!0)):(w.flushLgnd(),PState.set(PSTATE_BUILD),l=PViewFrame(1),l.initDOM(0),l.showStream(x),jQuery("#selector-v1").prop("disabled",!1),PState.set(PSTATE_READY));w.resize()});jQuery("#btn-hs-bars").button({icons:{primary:"ui-icon-carat-2-n-s"},
text:!1}).click(function(a){jQuery("#filter-frame").slideToggle(400);jQuery("#selector-frame").slideToggle(400);a.preventDefault()});jQuery("#btn-show-prspctv").button({icons:{primary:"ui-icon-image"},text:!1}).click(function(a){var d=jQuery("#prspctv-slist");d.empty();prspdata.p.forEach(function(a){d.append('<li data-src="server" data-id="'+a.id+'">'+a.l+"</li>")});D.forEach(function(a){d.append('<li data-src="local" data-id="'+a.id+'">'+a.l+"</li>")});var e=[{text:dlText.ok,click:function(){f.dialog("close");
var a=d.find("li.selected");a.length&&(a=a.data("id"),u(a),PState.set(PSTATE_READY))}},{text:dlText.cancel,click:function(){f.dialog("close")}}];C&&e.push({text:dlText.manage,click:function(){f.dialog("close");h()}});var f=jQuery("#dialog-show-prsrctv").dialog({width:350,height:350,modal:!0,buttons:e});a.preventDefault()});jQuery("#btn-save-prspctv").button({icons:{primary:"ui-icon-pencil"},text:!1}).click(function(a){var d,e=/[^\w\-]/;jQuery("#save-psrctv-id").val("");jQuery("#save-psrctv-lbl").val("");
jQuery("#save-psrctv-note").val("");C||jQuery("#save-prspctv-d-1").attr("disabled","disabled");prspdata.add_prspctv||jQuery("#save-prspctv-d-2").attr("disabled","disabled");d=jQuery("#dialog-save-prsrctv").dialog({width:340,height:350,modal:!0,buttons:[{text:dlText.ok,click:function(){var a=jQuery("#save-psrctv-id").val().trim(),h=a.match(e);0==a.length||20<a.length||h?h="#dialog-prspctv-id-badchars":f(a)&&(h="#dialog-prspctv-id-used");if(h)var k=jQuery(h).dialog({width:320,height:210,modal:!0,buttons:[{text:dlText.ok,
click:function(){k.dialog("close")}}]});else if(h=g(a),d.dialog("close"),"server"==h){a=xhbtURL+"/?prspctv="+a;jQuery("#save-psrctv-embed").val(a);var l=jQuery("#dialog-prspctv-url").dialog({width:480,height:230,modal:!0,buttons:[{text:dlText.ok,click:function(){l.dialog("close")}}]})}}},{text:dlText.cancel,click:function(){d.dialog("close")}}]});a.preventDefault()});jQuery("#btn-annote").button({icons:{primary:"ui-icon-comment"},text:!1}).click(function(a){jQuery("#annote").toggle("slide",{direction:"right"});
a.preventDefault()});0<prspdata.e.g.hbtn.length&&0<prspdata.e.g.hurl.length?(jQuery("#home-title").text(prspdata.e.g.hbtn),jQuery("#btn-home").button({icons:{primary:"ui-icon-home"},text:!1}).click(m)):jQuery("#btn-home").remove();jQuery("#filter-list").click(function(a){"I"==a.target.nodeName?(jQuery("#filter-list li").removeClass("selected"),jQuery(a.target).parent().addClass("selected")):"LI"==a.target.nodeName&&(jQuery("#filter-list li").removeClass("selected"),jQuery(a.target).addClass("selected"))});
jQuery("#prspctv-slist").click(function(a){"LI"==a.target.nodeName&&(jQuery("#prspctv-slist li").removeClass("selected"),jQuery(a.target).addClass("selected"))});jQuery("#btn-new-filter").button({icons:{primary:"ui-icon-plus"},text:!1}).click(function(a){var d=1==PData.getNumETmplts()?[!0]:[!1,!1,!1,!1];jQuery("#filter-list li").removeClass("selected");jQuery("#filter-list li.remove").show();var e;e=jQuery("#dialog-new-filter").dialog({height:300,width:350,modal:!0,buttons:[{text:dlText.add,click:function(){var a=
jQuery("#filter-list li.selected");a.length&&(jQuery("#filter-instances").show(400),r(a.data("id"),d,!1),jQuery("#btn-toggle-filters").button("enable"));e.dialog("close")}},{text:dlText.cancel,click:function(){e.dialog("close")}}]});a.preventDefault()});jQuery("#btn-toggle-filters").button({icons:{primary:"ui-icon-arrow-2-n-s"},text:!1}).click(function(a){jQuery("#filter-instances").slideToggle(400);a.preventDefault()});jQuery("#btn-new-selector").button({icons:{primary:"ui-icon-plus"},text:!1}).click(function(a){jQuery("#filter-list li").removeClass("selected");
jQuery("#filter-list li.remove").hide();var d;d=jQuery("#dialog-new-filter").dialog({height:300,width:350,modal:!0,buttons:[{text:dlText.add,click:function(){var a=jQuery("#filter-list li.selected");a.length&&(jQuery("#selector-instance").show(400),r(a.data("id"),null,!0),jQuery("#btn-toggle-selector").button("enable"),jQuery("#btn-apply-selector").button("enable"));d.dialog("close")}},{text:dlText.cancel,click:function(){d.dialog("close")}}]});a.preventDefault()});jQuery("#btn-toggle-selector").button({icons:{primary:"ui-icon-arrow-2-n-s"},
text:!1}).click(function(a){jQuery("#selector-instance").slideToggle(400);a.preventDefault()});jQuery("#btn-apply-selector").button({icons:{primary:"ui-icon-arrowreturn-1-e"},text:!1}).click(function(a){y();PState.set(PSTATE_READY);a.preventDefault()});jQuery("#dialog-about .logo").attr("src",prspdata.assets+"prospectlogo.jpg");jQuery("#btn-inspect-left").button({icons:{primary:"ui-icon-arrowthick-1-w"},text:!1});jQuery("#btn-inspect-right").button({icons:{primary:"ui-icon-arrowthick-1-e"},text:!1});
(function(){jQuery("#filter-list").append('<li class="remove" data-id="_remove"><i>'+dlText.rha+"</i></li>");prspdata.a.forEach(function(a){switch(a.def.t){case "V":case "T":case "N":case "D":jQuery("#filter-list").append('<li data-id="'+a.id+'">'+a.def.l+"</li>")}})})();0!=prspdata.show_prspctv.length&&u(prspdata.show_prspctv)||(w=PViewFrame(0),w.initDOM(0),e(""));jQuery(window).resize(function(){w&&w.resize();l&&l.resize()});jQuery("body").on("prospect",function(a,e){e.pstate==PSTATE_PROCESS&&(PState.set(PSTATE_PROCESS),
d(),A&&y(),PState.set(PSTATE_READY),jQuery("body").removeClass("waiting"))});PState.set(PSTATE_LOAD);PData.init()});function onYouTubeIframeAPIReady(){widgetData.ytCall&&widgetData.ytCall()};