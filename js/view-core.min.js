Array.prototype.findIndex||(Array.prototype.findIndex=function(a,c){if(null==this)throw new TypeError("Array.prototype.find called on null or undefined");if("function"!==typeof a)throw new TypeError("predicate must be a function");for(var d=Object(this),e=d.length>>>0,f,g=0;g<e;g++)if(f=d[g],a.call(c,f,g,d))return g;return-1});
var EVENT_INSTANT=1,EVENT_F_START=2,EVENT_F_END=4,PSTATE_INIT=0,PSTATE_LOAD=1,PSTATE_PROCESS=2,PSTATE_BUILD=3,PSTATE_UPDATE=4,PSTATE_READY=5,PSTATE_FDIRTY=6,PSTATE_HILITE=7,D3FG_BAR_WIDTH=25,D3FG_MARGINS={top:4,right:7,bottom:22,left:30},D3SC_MARGINS={top:30,right:5,bottom:5,left:40},V_FLAG_LGND=1,V_FLAG_SEL=2,V_FLAG_LOC=4,V_FLAG_SLGND=8,V_FLAG_OPT=16,V_FLAG_VSCRL=32,V_FLAG_HSCRL=64,parseTC=/(\d\d)\:(\d\d)\:(\d\d)\.(\d\d?)/,MS_IN_DAY=86399990,TODAY=new Date,localD3,months,dlText={},PState=function(){var a=
PSTATE_INIT,c,d;return{init:function(){c=document.getElementById("dltext-pstates").innerHTML.trim().split("|");d=document.getElementById("pstate")},set:function(e){e!=a&&(a===PSTATE_READY?d.classList.add("attn"):e===PSTATE_READY&&d.classList.remove("attn"),d.textContent=c[e-1],a=e)}}}();function PVizModel(a,c){this.vFrame=a;this.frameID=a.getFrameID()+" div.viz-content div.viz-result";this.settings=c;this.recSel=[];this.tUsed=[!1,!1,!1,!1];this.rMap=null}PVizModel.prototype.flags=function(){return 0};
PVizModel.prototype.preRender=function(){var a;a=PData.rSize();var c=Math.floor((a+15)/16);for(a=0;4>a;a++)this.tUsed[a]=!1;null==this.rMap&&(this.rMap=new Uint16Array(c));for(a=0;a<c;a++)this.rMap[a]=0};PVizModel.prototype.isSel=function(a){return-1!=_.indexOf(this.recSel,a,!0)};PVizModel.prototype.getSel=function(){return this.recSel};
PVizModel.prototype.toggleSel=function(a){var c=this.recSel.length,d=_.sortedIndex(this.recSel,a);if(this.recSel[d]===a)return this.recSel.splice(d,1),0<c&&0==this.recSel.length&&this.vFrame.selBtns(!1),this.vFrame.vizDelSel(a),!1;this.recSel.splice(d,0,a);0==c&&0<this.recSel.length&&this.vFrame.selBtns(!0);this.vFrame.vizAddSel(a);return!0};PVizModel.prototype.clearSel=function(){this.recSel=[]};PVizModel.prototype.getLocAtts=function(a){return[]};PVizModel.prototype.getFeatureAtts=function(a){return[]};
PVizModel.prototype.teardown=function(){};PVizModel.prototype.resize=function(){};PVizModel.prototype.doOptions=function(){};PVizModel.prototype.getState=function(){return{}};PVizModel.prototype.setState=function(a){};PVizModel.prototype.hint=function(){return null};var VizMap=function(a,c){PVizModel.call(this,a,c)};VizMap.prototype=Object.create(PVizModel.prototype);VizMap.prototype.constructor=VizMap;VizMap.prototype.flags=function(){return V_FLAG_LGND|V_FLAG_SEL|V_FLAG_LOC|V_FLAG_OPT};
VizMap.prototype.getLocAtts=function(a){return null!=a?(a=this.settings.cAtts[a],null==a?null:a):this.settings.cAtts};VizMap.prototype.getFeatureAtts=function(a){return null!=a?this.settings.lgnds[a]:this.settings.lgnds};
VizMap.prototype.setup=function(){var a=this,c=parseFloat(this.settings.clat),d=parseFloat(this.settings.clon),e;e="string"===typeof this.settings.zoom?parseInt(this.settings.zoom):this.settings.zoom;var f=this.vFrame.getIndex();jQuery(this.frameID).append('<div id="l-map-'+f+'" class="max-size"></div>');this.lMap=L.map("l-map-"+f,{zoomControl:!1}).setView([c,d],e);this.baseMap=PMapHub.createMapLayer(this.settings.base,1,this.lMap,null);this.bOp=100;this.lOps=[];this.mapLayers=[];var g;_.each(this.settings.lyrs,
function(c,d){g=c.o||1;a.lOps.push(100*g);var e;e=PMapHub.createMapLayer(c.lid,g,a.lMap,null);a.mapLayers.push(e)});var h=_.template(document.getElementById("dltext-v-map").innerHTML);jQuery("#view-frame-"+f+" div.view-controls").append(h({vi:f}));jQuery("#map-zoom-"+f).button({text:!1,icons:{primary:"ui-icon-plus"}}).click(function(){a.lMap.zoomIn()});jQuery("#map-unzoom-"+f).button({text:!1,icons:{primary:"ui-icon-minus"}}).click(function(){a.lMap.zoomOut()});jQuery("#map-reset-"+f).button({text:!1,
icons:{primary:"ui-icon-arrowrefresh-1-w"}}).click(function(){a.lMap.setView([c,d],e)});jQuery("#map-cloc-"+f).button({text:!1,icons:{primary:"ui-icon-pin-s"}}).click(function(){navigator.geolocation.getCurrentPosition(function(c){a.lMap.setView([c.coords.latitude,c.coords.longitude])})});this.markerLayer=f=L.featureGroup();f.options=f.options||{};f.options.layerName=dlText.markers;f.addTo(this.lMap);this.lineLayer=f=L.featureGroup();f.addTo(this.lMap);f=PData.eTNum();this.tLCnt=new Uint16Array(f)};
VizMap.prototype.render=function(a){function c(a){if(a.target&&a.target.options){var k=a.target.options._aid,c=d.toggleSel(k);a=PData.n2T(k);1<d.tLCnt[a]?(PState.set(PSTATE_UPDATE),e.eachLayer(function(a){a.options._aid===k&&(c?a.setStyle({color:"yellow",weight:2}):a.setStyle({color:"#000",weight:1}))}),PState.set(PSTATE_READY)):c?this.setStyle({color:"yellow",weight:2}):this.setStyle({color:"#000",weight:1})}}var d=this,e=this.markerLayer;0<this.recSel.length&&(this.recSel=[]);this.preRender();e.clearLayers();
var f=this.lineLayer;f.clearLayers();var g=PData.eTNum(),h=0,l,m=0,t,k,x,q,v,u,C,n,y,z,w,r,p,A,B,D,F;A=this.settings.min;"string"===typeof A&&(A=parseInt(A));m=this.settings.max;"string"===typeof m&&(m=parseInt(m));B=m-A;for(h=0;h<g;h++)this.tLCnt[h]=0;for(var E,h=0;h<g;h++)if("disable"!==this.settings.pAtts[h]){E=[];break}h=0;m=-1;a:for(;h<a.l;){if(null==u){do{if(++m==g)break a;t=a.t[m]}while(0===t.n||t.i+t.n===h);u=this.vFrame.getSelLocAtts(m);if(0===u.length){u=null;continue}C=d.vFrame.getSelFeatAtts(m);
if(0===C.length){u=null;continue}d.tLCnt[m]=u.length;d.tUsed[m]=!0;q=d.vFrame.getSelLegend(m);v=PData.aByID(q);n=d.settings.pAtts[m];k=d.settings.lClrs[m];if(r=d.settings.sAtts[m])p=PData.aByID(r),"number"===typeof p.r.min&&"number"===typeof p.r.max?(D=p.r.min,F=p.r.max-D):r=null}l=a.s[h];x=PData.rByN(l);var G;E&&(G={id:x.id,c:[],p:x.a[n],l:k});u.forEach(function(a){if(y=x.a[a])if(z=x.a[q],"undefined"!==typeof z&&(z=PData.lClr(z,v,C))){d.rMap[l>>4]|=1<<(l&15);if("number"===typeof y[0])r?(p=x.a[r],
p="number"===typeof p?Math.floor((p-D)*B/F)+A:A):p=A,w=L.circleMarker(y,{_aid:l,weight:1,radius:p,fillColor:z,color:"#000",opacity:1,fillOpacity:1}),G&&G.c.push(y);else if(w=2===y.length?L.polyline(y,{_aid:l,weight:1,fillColor:z,color:"#000",opacity:1,fillOpacity:1}):L.polygon(y,{_aid:l,weight:1,fillColor:z,color:"#000",opacity:1,fillOpacity:1}),G){var k=[0,0];y.forEach(function(a){k[0]+=a[0];k[1]+=a[1]});k[0]/=y.length;k[1]/=y.length;G.c.push(k)}w.on("click",c);e.addLayer(w)}});G&&0<G.c.length&&
E.push(G);++h==t.i+t.n&&(u=null)}if(E){E.sort(function(a,k){return PData.strcmp(k.id,a.id)});var H=[];E.forEach(function(a){a.p&&a.p.forEach(function(k){h=_.sortedIndex(E,{id:k},"id");if(h<E.length){var c=E[h];c.id===k&&a.c.forEach(function(k){c.c.forEach(function(c){k[0]===c[0]&&k[1]===c[1]||H.push({p:[k,c],c:a.l})})})}})});H.forEach(function(a){f.addLayer(L.polyline(a.p,{color:a.c,weight:2}))})}};VizMap.prototype.teardown=function(){var a=this.vFrame.getIndex();jQuery("#view-frame-"+a+" div.view-controls div.iconbar").remove()};
VizMap.prototype.resize=function(){this.lMap.invalidateSize(!1)};VizMap.prototype.clearSel=function(){0<this.recSel.length&&(this.recSel=[],this.markerLayer&&this.markerLayer.eachLayer(function(a){a.setStyle({color:"#000",weight:1})}))};VizMap.prototype.setSel=function(a){var c=this;this.recSel=a;this.markerLayer&&this.markerLayer.eachLayer(function(a){c.isSel(a.options._aid)?a.setStyle({color:"yellow",weight:2}):a.setStyle({color:"#000",weight:1})})};
VizMap.prototype.getState=function(){return{c:this.lMap.getCenter(),z:this.lMap.getZoom(),l:this.vFrame.getLgndSels()}};VizMap.prototype.setState=function(a){this.lMap.setView(a.c,a.z);this.vFrame.setLgndSels(a.l)};VizMap.prototype.hint=function(){for(var a="",c=PData.eTNum(),d=0;d<c;d++){var e=this.settings.sAtts[d];if(e)var a=0===a.length?dlText.markersize:a+",",e=PData.aByID(e),f=PData.eTByN(d),f=PData.tByID(f),a=a+(" "+e.def.l+" ("+f.l+")")}return 0<a.length?a:null};
VizMap.prototype.doOptions=function(){function a(){f&&(c.baseMap.setOpacity(c.bOp/100),c.lOps.forEach(function(a,d){c.mapLayers[d].setOpacity(a/100)}));g.empty()}var c=this,d=this.bOp,e=[],f=!0,g=jQuery("#dialog-opacities div.layer-list"),h=jQuery('<div class="op-layer" data-i="-1">Base Map <input type=range class="op-slider" min=0 max=100 value='+this.bOp+" step=5></div>");h.find(".op-slider").on("change",function(){d=jQuery(this).val();c.baseMap.setOpacity(d/100)});g.append(h);this.settings.lyrs.forEach(function(a,
d){h=jQuery('<div class="op-layer" data-i="'+d+'">'+c.mapLayers[d].options.layerName+' <input type=range class="op-slider" min=0 max=100 value='+c.lOps[d]+" step=5></div>");h.find(".op-slider").on("change",function(){e[d]=jQuery(this).val();c.mapLayers[d].setOpacity(e[d]/100)});e.push(c.lOps[d]);g.append(h)});var l=jQuery("#dialog-opacities").dialog({height:300,width:500,modal:!0,buttons:[{text:dlText.ok,click:function(){f=!1;l.dialog("close");c.bOp=d;e.forEach(function(a,d){c.lOps[d]=e[d]})}},{text:dlText.cancel,
click:function(){l.dialog("close")}}]});l.on("dialogclose",function(c,d){a();l.off("dialogclose")})};var VizMap2=function(a,c){PVizModel.call(this,a,c)};VizMap2.prototype=Object.create(PVizModel.prototype);VizMap2.prototype.constructor=VizMap2;VizMap2.prototype.flags=function(){return V_FLAG_LGND|V_FLAG_SEL|V_FLAG_LOC|V_FLAG_OPT};VizMap2.prototype.getLocAtts=function(a){return null!=a?(a=this.settings.cAtts[a],null==a?null:[a]):[this.settings.cAtts]};
VizMap2.prototype.getFeatureAtts=function(a){return null!=a?this.settings.lgnds[a]:this.settings.lgnds};
VizMap2.prototype.setup=function(){var a=this,c=parseFloat(this.settings.clat),d=parseFloat(this.settings.clon),e;e="string"===typeof this.settings.zoom?parseInt(this.settings.zoom):this.settings.zoom;var f=this.vFrame.getIndex();jQuery(this.frameID).append('<div id="l-map-'+f+'" class="max-size"></div>');this.lMap=L.map("l-map-"+f,{zoomControl:!1}).setView([c,d],e);this.baseMap=PMapHub.createMapLayer(this.settings.base,1,this.lMap,null);this.bOp=100;this.lOps=[];this.mapLayers=[];var g;_.each(this.settings.lyrs,
function(c,d){g=c.o||1;a.lOps.push(100*g);var e;e=PMapHub.createMapGroup(c.gid,g,a.lMap);a.mapLayers.push(e)});var h=_.template(document.getElementById("dltext-v-map").innerHTML);jQuery("#view-frame-"+f+" div.view-controls").append(h({vi:f}));jQuery("#map-zoom-"+f).button({text:!1,icons:{primary:"ui-icon-plus"}}).click(function(){a.lMap.zoomIn()});jQuery("#map-unzoom-"+f).button({text:!1,icons:{primary:"ui-icon-minus"}}).click(function(){a.lMap.zoomOut()});jQuery("#map-reset-"+f).button({text:!1,
icons:{primary:"ui-icon-arrowrefresh-1-w"}}).click(function(){a.lMap.setView([c,d],e)});jQuery("#map-cloc-"+f).button({text:!1,icons:{primary:"ui-icon-pin-s"}}).click(function(){navigator.geolocation.getCurrentPosition(function(c){a.lMap.setView([c.coords.latitude,c.coords.longitude])})});this.markerLayer=f=L.featureGroup();f.options=f.options||{};f.options.layerName=dlText.markers;f.addTo(this.lMap);this.lblLayer=f=L.featureGroup();f.addTo(this.lMap);this.lineLayer=f=L.featureGroup();f.addTo(this.lMap)};
VizMap2.prototype.render=function(a){function c(a){if(a.target&&a.target.options){var k=a.target.options._aid,c=d.toggleSel(k);a=PData.n2T(k);a=d.vFrame.getSelLocAtts(a);a=a[0];1<PData.rByN(k).a[a].length?(PState.set(PSTATE_UPDATE),e.eachLayer(function(a){a.options._aid===k&&(c?a.setStyle({color:"yellow",weight:2}):a.setStyle({color:"#000",weight:1}))}),PState.set(PSTATE_READY)):c?this.setStyle({color:"yellow",weight:2}):this.setStyle({color:"#000",weight:1})}}var d=this,e=this.markerLayer;0<this.recSel.length&&
(this.recSel=[]);this.preRender();e.clearLayers();this.lblLayer.clearLayers();var f=this.lineLayer;f.clearLayers();var g=PData.eTNum(),h=0,l,m=0,t,k,x,q,v,u,C,n,y,z,w,r,p,A,B,D,F,E;A=this.settings.min;"string"===typeof A&&(A=parseInt(A));h=this.settings.max;"string"===typeof h&&(h=parseInt(h));B=h-A;h=0;m=-1;a:for(;h<a.l;){var G=function(a,k){r?(p=x.a[r],p="number"===typeof p?Math.floor((p-D)*B/F)+A:A):p=A;w=L.circleMarker(a,{_aid:l,weight:1,radius:p,fillColor:z,color:"#000",opacity:1,fillOpacity:1});
w.on("click",c);e.addLayer(w);k&&"n"!=n&&d.lblLayer.addLayer(L.marker(a,{icon:L.divIcon({iconSize:null,className:"maplbl",html:"<div>"+x.l+"</div>"})}))};if(null==u){do{if(++m==g)break a;t=a.t[m]}while(0===t.n||t.i+t.n===h);u=this.vFrame.getSelLocAtts(m);if(0===u.length){u=null;continue}u=u[0];C=d.vFrame.getSelFeatAtts(m);if(0===C.length){u=null;continue}d.tUsed[m]=!0;q=d.vFrame.getSelLegend(m);v=PData.aByID(q);k=d.settings.lClrs[m];if(r=d.settings.sAtts[m])p=PData.aByID(r),"number"===typeof p.r.min&&
"number"===typeof p.r.max?(D=p.r.min,F=p.r.max-D):r=null;n=d.settings.lbls[m]}l=a.s[h];x=PData.rByN(l);if(y=x.a[u])if(z=x.a[q],"undefined"!==typeof z&&(z=PData.lClr(z,v,C)))d.rMap[l>>4]|=1<<(l&15),"number"===typeof y[0]?G(y,!0):y.forEach(function(a,c){G(a,0===c);0===c?E=a:f.addLayer(L.polyline([E,a],{color:k}))});++h==t.i+t.n&&(u=null)}};VizMap2.prototype.teardown=function(){var a=this.vFrame.getIndex();jQuery("#view-frame-"+a+" div.view-controls div.iconbar").remove()};VizMap2.prototype.resize=function(){this.lMap.invalidateSize(!1)};
VizMap2.prototype.clearSel=function(){0<this.recSel.length&&(this.recSel=[],this.markerLayer&&this.markerLayer.eachLayer(function(a){a.setStyle({color:"#000",weight:1})}))};VizMap2.prototype.setSel=function(a){var c=this;this.recSel=a;this.markerLayer&&this.markerLayer.eachLayer(function(a){c.isSel(a.options._aid)?a.setStyle({color:"yellow",weight:2}):a.setStyle({color:"#000",weight:1})})};VizMap2.prototype.getState=function(){return{c:this.lMap.getCenter(),z:this.lMap.getZoom(),l:this.vFrame.getLgndSels()}};
VizMap2.prototype.setState=function(a){this.lMap.setView(a.c,a.z);this.vFrame.setLgndSels(a.l)};VizMap2.prototype.hint=function(){for(var a="",c=PData.eTNum(),d=0;d<c;d++){var e=this.settings.sAtts[d];if(e)var a=0===a.length?dlText.markersize:a+",",e=PData.aByID(e),f=PData.eTByN(d),f=PData.tByID(f),a=a+(" "+e.def.l+" ("+f.l+")")}return 0<a.length?a:null};
VizMap2.prototype.doOptions=function(){function a(){f&&(c.baseMap.setOpacity(c.bOp/100),c.lOps.forEach(function(a,d){c.mapLayers[d].eachLayer(function(k){k.setOpacity(a/100)})}));g.empty()}var c=this,d=this.bOp,e=[],f=!0,g=jQuery("#dialog-opacities div.layer-list"),h=jQuery('<div class="op-layer" data-i="-1">Base Map <input type=range class="op-slider" min=0 max=100 value='+this.bOp+" step=5></div>");h.find(".op-slider").on("change",function(){d=jQuery(this).val();c.baseMap.setOpacity(d/100)});g.append(h);
this.settings.lyrs.forEach(function(a,d){h=jQuery('<div class="op-layer" data-i="'+d+'">'+c.mapLayers[d].options.layerName+' <input type=range class="op-slider" min=0 max=100 value='+c.lOps[d]+" step=5></div>");h.find(".op-slider").on("change",function(){var a=jQuery(this).val();e[d]=a;a/=100;c.mapLayers[d].eachLayer(function(c){c.setOpacity(a)})});e.push(c.lOps[d]);g.append(h)});var l=jQuery("#dialog-opacities").dialog({height:300,width:500,modal:!0,buttons:[{text:dlText.ok,click:function(){f=!1;
l.dialog("close");c.bOp=d;e.forEach(function(a,d){c.lOps[d]=e[d]})}},{text:dlText.cancel,click:function(){l.dialog("close")}}]});l.on("dialogclose",function(c,d){a();l.off("dialogclose")})};var VizCards=function(a,c){PVizModel.call(this,a,c)};VizCards.prototype=Object.create(PVizModel.prototype);VizCards.prototype.constructor=VizCards;VizCards.prototype.flags=function(){return V_FLAG_LGND|V_FLAG_SEL|V_FLAG_VSCRL|V_FLAG_OPT};
VizCards.prototype.getFeatureAtts=function(a){return null!=a?this.settings.lgnds[a]:this.settings.lgnds};
VizCards.prototype.setup=function(){var a=this;jQuery(this.frameID).on("click.vf",function(c){if("DIV"===c.target.nodeName||"IMG"===c.target.nodeName)if(c=jQuery(c.target).closest("div.card"),1==c.size()){var d=c.data("ai");null!=d&&(a.toggleSel(d)?c.addClass("obj-sel"):c.removeClass("obj-sel"))}});a.sAtts=[];for(var c=0;c<PData.eTNum();c++){var d=jQuery('#dialog-sortby select[data-ti="'+c+'"] :first').val();a.sAtts.push(d)}for(c=0;c<PData.eTNum();c++)jQuery('#dialog-sortby select[data-ti="'+c+'"]').val(this.sAtts[c])};
VizCards.prototype.render=function(a){var c=this;this.stream=a;var d=PData.eTNum(),e,f,g,h,l,m,t,k,x,q,v,u,C,n,y=jQuery(this.frameID);y.empty();0<this.recSel.length&&(this.recSel=[]);this.preRender();var z,w="w"+this.settings.w+" h"+this.settings.h;f=a.t[0];for(e=0;e<d;){for(;0===f.n;){if(++e===d)return;f=a.t[e]}f=PData.eTByN(e);f=PData.tByID(f);m=c.vFrame.getSelFeatAtts(e);0!==m.length&&(y.append('<div class="template-label">'+f.l+'</div><div class="cards" data-ti="'+e+'"></div>'),z=jQuery('div.cards[data-ti="'+
e+'"]'),this.tUsed[e]=!0,g=c.vFrame.getSelLegend(e),h=PData.aByID(g),l=c.settings.iAtts[e],q=c.settings.cnt[e],f=c.sAtts[e],f=PData.aByID(f),f=PData.rTOrder(f,a,e),f.forEach(function(a){t=PData.rByN(a.i);v=t.a[g];"undefined"!==typeof v&&(k=PData.lRecs(v,h,m,!1))&&(c.rMap[a.i>>4]|=1<<(a.i&15),C=c.settings.lOn?'<div class="card-title">'+t.l+"</div>":"",x=!1,u="",q&&0<q.length&&(n=k.b?' style="color:black"':"",q.forEach(function(a){if(v=t.a[a])if(v=PData.procAttTxt(a,v))x=!0,u+=v+"<br/>"})),u=l&&(v=
t.a[l])?x?'<div class="card-body"><img src="'+v+'"/><div class="card-cnt"'+n+">"+u+"</div></div>":'<div class="card-body"><img class="full" src="'+v+'"/></div>':'<div class="card-body"><div class="card-cnt"'+n+">"+u+"</div>",z.append('<div class="card '+w+'" style="background-color:'+k.v+'" data-ai="'+a.i+'">'+C+u+"</div>"))}));f=a.t[++e]}};VizCards.prototype.teardown=function(){jQuery(this.frameID).off("click.vf")};
VizCards.prototype.rerender=function(a){var c=this,d=jQuery(this.frameID+' div.cards[data-ti="'+a+'"]');d.empty();var e,f,g,h,l,m,t,k,x,q,v,u,C,n="w"+this.settings.w+" h"+this.settings.h;e=c.vFrame.getSelFeatAtts(a);0!=e.length&&(f=c.vFrame.getSelLegend(a),g=PData.aByID(f),h=c.settings.iAtts[a],l=c.settings.cnt[a],m=c.sAtts[a],m=PData.aByID(m),a=PData.rTOrder(m,c.stream,a),a.forEach(function(a){t=PData.rByN(a.i);k=t.a[f];"undefined"!==typeof k&&(x=PData.lRecs(k,g,e,!1))&&(u=c.settings.lOn?'<div class="card-title">'+
t.l+"</div>":"",q=!1,v="",l&&0<l.length&&(C=x.b?' style="color:black"':"",l.forEach(function(a){if(k=t.a[a])if(k=PData.procAttTxt(a,k))q=!0,v+=k+"<br/>"})),v=h&&(k=t.a[h])?q?'<div class="card-body"><img src="'+k+'"/><div class="card-cnt"'+C+">"+v+"</div></div>":'<div class="card-body"><img class="full" src="'+k+'"/></div>':'<div class="card-body"><div class="card-cnt"'+C+">"+v+"</div>",d.append('<div class="card '+n+(c.isSel(a.i)?" obj-sel":"")+'" style="background-color:'+x.v+'" data-ai="'+a.i+'">'+
u+v+"</div>"))}))};VizCards.prototype.doOptions=function(){var a=this;this.sAtts.forEach(function(a,c){jQuery('#dialog-sortby select[data-ti="'+c+'"]').val(a)});var c=jQuery("#dialog-sortby").dialog({height:220,width:400,modal:!0,buttons:[{text:dlText.ok,click:function(){c.dialog("close");PState.set(PSTATE_BUILD);for(var d=0;d<PData.eTNum();d++){var e=jQuery('#dialog-sortby select[data-ti="'+d+'"]').val();e!=a.sAtts[d]&&(a.sAtts[d]=e,a.rerender(d))}PState.set(PSTATE_READY)}},{text:dlText.cancel,click:function(){c.dialog("close")}}]})};
VizCards.prototype.setSel=function(a){var c=this,d,e;this.recSel=a;jQuery(this.frameID).find("div.card").each(function(){e=jQuery(this);d=e.data("ai");null!=d&&(c.isSel(d)?e.addClass("obj-sel"):e.removeClass("obj-sel"))})};VizCards.prototype.clearSel=function(){0<this.recSel.length&&(this.recSel=[],jQuery(this.frameID).find("div.card").removeClass("obj-sel"))};VizCards.prototype.getState=function(){return{l:this.vFrame.getLgndSels(),s:this.sAtts}};
VizCards.prototype.setState=function(a){this.vFrame.setLgndSels(a.l);this.sAtts=a.s};var VizPinboard=function(a,c){PVizModel.call(this,a,c)};VizPinboard.prototype=Object.create(PVizModel.prototype);VizPinboard.prototype.constructor=VizPinboard;VizPinboard.prototype.flags=function(){return V_FLAG_LGND|V_FLAG_SEL|V_FLAG_LOC|V_FLAG_HSCRL|V_FLAG_VSCRL|V_FLAG_OPT};VizPinboard.prototype.getLocAtts=function(a){return null!=a?(a=this.settings.cAtts[a],null==a?null:[a]):[this.settings.cAtts]};
VizPinboard.prototype.getFeatureAtts=function(a){return null!=a?this.settings.lgnds[a]:this.settings.lgnds};
VizPinboard.prototype.setup=function(){var a=this.settings,c=this,d=this.vFrame.getIndex();this.bOp=100;this.lOps=[];this.settings.lyrs.forEach(function(a,d){c.lOps.push(100*a.o)});PData.eTNum();this.xScale=d3.scale.linear().domain([0,a.iw-1]).rangeRound([0,a.dw-1]);this.yScale=d3.scale.linear().domain([0,a.ih-1]).range([0,a.dh-1]);this.xAxis=d3.svg.axis().scale(this.xScale).orient("top");this.yAxis=d3.svg.axis().scale(this.yScale).orient("left");this.chart=d3.select(this.frameID).append("svg").attr("width",
a.dw+30+3).attr("height",a.dh+30+2).append("g").attr("transform","translate(30,30)");this.chart.append("g").attr("class","x axis").call(this.xAxis);this.chart.append("g").attr("class","y axis").call(this.yAxis);this.chart.append("image").attr("id","base-"+d).attr("xlink:href",a.img).attr("x",0).attr("y",0).attr("height",a.dh).attr("width",a.dw);this.settings.lyrs.forEach(function(a,f){c.chart.append("svg").attr("id","ol-"+d+"-"+f).attr("opacity",a.o)});this.settings.lyrs.forEach(function(a,c){d3.xml(a.url,
function(a,e){if(!a){var l=e.getElementsByTagName("svg")[0];d3.select("#ol-"+d+"-"+c).node().appendChild(l)}})});this.gRecs=this.chart.append("g").attr("id","recs")};
VizPinboard.prototype.render=function(a){var c=this;this.gRecs.selectAll(".recobj").remove();this.gRecs.selectAll(".recline").remove();0<this.recSel.length&&(this.recSel=[]);this.preRender();var d=PData.eTNum(),e,f,g=0,h,l,m,t,k,x,q,v,u,C,n,y,z,w,r,p;for(e=0;e<d;e++)if("disable"!==this.settings.pAtts[e]){p=[];break}y=this.settings.min;"string"===typeof y&&(y=parseInt(y));f=this.settings.max;"string"===typeof f&&(f=parseInt(f));z=f-y;var A=[];e=0;g=-1;a:for(;e<a.l;){if(null==x){do{if(++g===d)break a;
h=a.t[g]}while(0===h.n||h.i+h.n===e);x=this.vFrame.getSelLocAtts(g);if(0===x.length){x=null;continue}x=x[0];q=c.vFrame.getSelFeatAtts(g);if(0===q.length){x=null;continue}c.tUsed[g]=!0;t=c.vFrame.getSelLegend(g);k=PData.aByID(t);v=c.settings.pAtts[g];l=c.settings.lClrs[g];if(n=c.settings.sAtts[g])m=PData.aByID(n),"number"===typeof m.r.min&&"number"===typeof m.r.max?(w=m.r.min,r=m.r.max-w):n=null}f=a.s[e];m=PData.rByN(f);var B;p&&(B={id:m.id,c:null,p:m.a[v],l:l});u=m.a[x];"undefined"!==typeof u&&(C=
m.a[t],"undefined"!==typeof C&&(C=PData.lClr(C,k,q)))&&(c.rMap[f>>4]|=1<<(f&15),n?(m=m.a[n],m="number"===typeof m?Math.floor((m-w)*z/r)+y:y):m=y,A.push({ai:f,v:C,x:u[0],y:u[1],r:m}),B&&(B.c=u));B&&B.c&&p.push(B);++e==h.i+h.n&&(x=null)}this.gRecs.selectAll(".recobj").data(A).enter().append("circle").attr("class","recobj").attr("cx",function(a){return c.xScale(a.x)}).attr("cy",function(a){return c.yScale(a.y)}).attr("r",function(a){return c.yScale(a.r)}).style("fill",function(a){return a.v}).on("click",
function(a,k){var d=c.toggleSel(a.ai);d3.select(this).classed("obj-sel",d)});if(p){p.sort(function(a,c){return PData.strcmp(c.id,a.id)});var D=[];p.forEach(function(a){a.p&&a.p.forEach(function(c){e=_.sortedIndex(p,{id:c},"id");if(e<p.length){var k=p[e];k.id===c&&D.push({f:a.c,t:k.c,c:a.l})}})});this.gRecs.selectAll(".recline").data(D).enter().append("line").attr("class","recline").attr("x1",function(a){return c.xScale(a.f[0])}).attr("y1",function(a){return c.yScale(a.f[1])}).attr("x2",function(a){return c.xScale(a.t[0])}).attr("y2",
function(a){return c.yScale(a.t[1])}).attr("stroke",function(a){return a.c})}};VizPinboard.prototype.clearSel=function(){0<this.recSel.length&&(this.recSel=[],this.gRecs.selectAll(".recobj").classed("obj-sel",!1))};VizPinboard.prototype.setSel=function(a){var c=this;this.recSel=a;this.gRecs.selectAll(".recobj").classed("obj-sel",function(a){return c.isSel(a.ai)})};
VizPinboard.prototype.doOptions=function(){function a(){g&&(d3.select("#base-"+d).attr("opacity",c.bOp/100),c.lOps.forEach(function(a,c){d3.select("#ol-"+d+"-"+c).attr("opacity",a/100)}));h.empty()}var c=this,d=this.vFrame.getIndex(),e=this.bOp,f=[],g=!0,h=jQuery("#dialog-opacities div.layer-list"),l=jQuery('<div class="op-layer" data-i="-1">Base Image <input type=range class="op-slider" min=0 max=100 value='+this.bOp+" step=5></div>");l.find(".op-slider").on("change",function(){e=jQuery(this).val();
d3.select("#base-"+d).attr("opacity",e/100)});h.append(l);this.lOps.forEach(function(a,c){l=jQuery('<div class="op-layer" data-i="'+c+'">Overlay '+(c+1)+' <input type=range class="op-slider" min=0 max=100 value='+a+" step=5></div>");l.find(".op-slider").on("change",function(){f[c]=jQuery(this).val();d3.select("#ol-"+d+"-"+c).attr("opacity",f[c]/100)});f.push(a);h.append(l)});var m=jQuery("#dialog-opacities").dialog({height:300,width:320,modal:!0,buttons:[{text:dlText.ok,click:function(){g=!1;m.dialog("close");
c.bOp=e;f.forEach(function(a,k){c.lOps[k]=a})}},{text:dlText.cancel,click:function(){m.dialog("close")}}]});m.on("dialogclose",function(c,k){a();m.off("dialogclose")})};VizPinboard.prototype.getState=function(){return{l:this.vFrame.getLgndSels()}};VizPinboard.prototype.setState=function(a){this.vFrame.setLgndSels(a.l)};
VizPinboard.prototype.hint=function(){for(var a="",c=PData.eTNum(),d=0;d<c;d++){var e=this.settings.sAtts[d];if(e)var a=0===a.length?dlText.markersize:a+",",e=PData.aByID(e),f=PData.eTByN(d),f=PData.tByID(f),a=a+(" "+e.def.l+" ("+f.l+")")}return 0<a.length?a:null};var VizTime=function(a,c){PVizModel.call(this,a,c)};VizTime.prototype=Object.create(PVizModel.prototype);VizTime.prototype.constructor=VizTime;VizTime.prototype.flags=function(){return V_FLAG_LGND|V_FLAG_SEL|V_FLAG_LOC|V_FLAG_VSCRL};
VizTime.prototype.getFeatureAtts=function(a){return null!=a?this.settings.lgnds[a]:this.settings.lgnds};VizTime.prototype.getLocAtts=function(a){return null!=a?(a=this.settings.dAtts[a],null==a?null:[a]):[this.settings.dAtts]};VizTime.prototype.getWidths=function(){var a=[],c=jQuery(this.frameID).width();a.push(c);c-=4;a.push(c);this.threshold=c/(6.25*this.settings.xLbl);return a};
VizTime.prototype.setup=function(){function a(a){var c={id:a,l:0,t:0,h:0,w:g[1],svgID:"#tl-b-"+l+"-"+a,tHt:0,iHt:0,xScale:d3.time.scale(),yScale:function(a){return a*c.tHt},parts:[],g:null,labels:null,labelSVGs:null,redraw:function(){}};a?(c.tHt=e.settings.bHt,c.iHt=c.tHt-2):(c.tHt=3,c.iHt=2);if(1==a){var k=e.minDate,d=e.maxDate;0<e.settings.zFrom.length&&(k=PData.dStr(e.settings.zFrom,!1));0<e.settings.zTo.length&&(d=PData.dStr(e.settings.zTo,!0));c.xScale.domain([k,d]);e.zMinDate=k;e.zMaxDate=d}else c.xScale.domain([e.minDate,
e.maxDate]);c.xScale.range([0,c.w]);c.g=e.chart.append("g").attr("id",c.svgID.substring(1)).attr("class","tl-band").attr("width",c.w);e.bands[a]=c;e.cmpnts.push(c)}function c(a){var c=e.bands[a],k=d3.svg.axis().scale(c.xScale).orient("bottom").tickSize(6,0);localD3&&k.tickFormat(localD3);var d=c.g.append("g").attr("id","axis-"+l+"-"+a).attr("class","axis").style("font-size","10px");a={redraw:function(){d.call(k)}};c.parts.push(a);e.cmpnts.push(a)}function d(a){var c=e.bands[a],k;k=1===a?32:16;c.labels=
[{name:"s-"+l+"-"+a,x:function(){return 0},left:function(){return 0},anchor:"start",tDelta:2,whichDate:function(a,c){return a}},{name:"e-"+l+"-"+a,x:function(){return c.l+c.w},left:function(){return c.l+c.w-e.settings.xLbl},anchor:"end",tDelta:-3,whichDate:function(a,c){return c}}];var d=d3.select(c.svgID).selectAll(".bLblCntr").data(c.labels).enter().append("g").attr("class","bLblCntr");d.append("rect").attr("class","bLbl").attr("id",function(a){return"rect-"+a.name}).attr("x",function(a){return a.left()}).attr("width",
e.settings.xLbl).attr("height",k);var q=d.append("text").attr("class","bMinMaxLbl").attr("id",function(a){return"txt-"+a.name}).attr("x",function(a){return a.x()+a.tDelta}).attr("y",12).attr("text-anchor",function(a){return a.anchor}),f={redraw:function(){var a=c.xScale.domain(),k=a[0],d=a[1];q.text(function(a){return a.whichDate(k,d).getUTCFullYear()})}};c.parts.push(f);e.cmpnts.push(f);if(1===a){var u=d.append("text").attr("class","bMinMaxLbl").attr("id",function(a){return"m-txt-"+a.name}).attr("x",
function(a){return a.x()+a.tDelta}).attr("y",k-4).attr("text-anchor",function(a){return a.anchor});a={redraw:function(){var a=c.xScale.domain(),k=a[0],d=a[1];u.text(function(a){return d.getUTCFullYear()-k.getUTCFullYear()>e.threshold?"":months[a.whichDate(k,d).getMonth()]})}};c.parts.push(a);e.cmpnts.push(a)}c.labelSVGs=d}var e=this;"number"!==typeof this.settings.xLbl&&(this.settings.xLbl=parseInt(this.settings.xLbl));this.brushSVG=this.brush=null;var f=this.settings;"string"===typeof f.bHt&&(f.bHt=
parseInt(f.bHt,10));(function(){var a,c,k,d,q,v;f.dAtts.forEach(function(e){null!=e&&"disable"!==e&&(e=PData.aByID(e))&&(null==a||e.r.min.y<a?(a=e.r.min.y,"undefined"!==typeof e.r.min.m?(c=e.r.min.m,k="undefined"!==typeof e.r.min.d?e.r.min.d:1):k=c=1):e.r.min.y===a&&"undefined"!==typeof e.r.min.m&&(e.r.min.m<c?(c=e.r.min.m,k="undefined"!==typeof e.r.min.d?e.r.min.d:1):e.r.min.m===c&&"undefined"!==typeof e.r.min.d&&e.r.min.d<k&&(k=e.r.min.d)),null==d?"undefined"===typeof e.r.max.y?(d=TODAY.getUTCFullYear(),
q=TODAY.getMonth()+1,v=TODAY.getDate()):(d=e.r.max.y,"undefined"!==typeof e.r.max.m?(q=e.r.max.m,v="undefined"!==typeof e.r.max.d?e.r.max.d:PData.lenMnth(d,q)):(q=12,v=31)):e.r.max.y>d?(d=e.r.max.y,"undefined"!==typeof e.r.max.m?(q=e.r.max.m,v="undefined"!==typeof e.r.max.d?e.r.max.d:PData.lenMnth(d,q)):(q=12,v=31)):e.r.max.y===d&&"undefined"!==typeof e.r.max.m&&(e.r.max.m>q?(q=e.r.max.m,v="undefined"!==typeof e.r.max.d?e.r.max.d:PData.lenMnth(d,q)):e.r.max.m===q&&"undefined"!==typeof e.r.max.d&&
e.r.max.d>v&&(v=e.r.max.d)))});e.minDate=0<f.from.length?PData.dStr(f.from,!1):PData.d3Nums(a,c,k,!1);e.maxDate=0<f.to.length?PData.dStr(f.to,!0):PData.d3Nums(d,q,v,!0);e.instGap=.015*(e.maxDate-e.minDate)})();var g=e.getWidths(),h=d3.select(this.frameID).append("svg").attr("class","tl-vf").attr("width",g[1]);(function(){var a=[];f.lgnds.forEach(function(c){c.forEach(function(c){a.push(c)})});var a=_.uniq(a),c=[];a.forEach(function(a){(a=PData.aByID(a))&&a.l.forEach(function(a){c.push(a.v)})});c=
_.uniq(c);c.sort();var k=h.append("defs"),d,e;c.forEach(function(a){e=a.substr(1);d=k.append("linearGradient").attr("id",e+"-fs");d.append("stop").attr("offset","0%").attr("stop-color","#C0C0C0");d.append("stop").attr("offset","5%").attr("stop-color",a);d.append("stop").attr("offset","100%").attr("stop-color",a);d=k.append("linearGradient").attr("id",e+"-fe");d.append("stop").attr("offset","0%").attr("stop-color",a);d.append("stop").attr("offset","95%").attr("stop-color",a);d.append("stop").attr("offset",
"100%").attr("stop-color","#C0C0C0");d=k.append("linearGradient").attr("id",e+"-fb");d.append("stop").attr("offset","0%").attr("stop-color","#C0C0C0");d.append("stop").attr("offset","5%").attr("stop-color",a);d.append("stop").attr("offset","95%").attr("stop-color",a);d.append("stop").attr("offset","100%").attr("stop-color","#C0C0C0")})})();var l=this.vFrame.getIndex();h.append("clipPath").attr("id","tl-clip-"+l).append("rect").attr("width",g[1]);e.chart=h.append("g").attr("class","chart").attr("clip-path",
"url(#tl-clip-"+l+")");e.instRad=f.bHt/2-1;e.bands=Array(2);e.cmpnts=[];a(0);a(1);c(0);c(1);d(0);d(1)};
VizTime.prototype.render=function(a){function c(a,c){var k=a.s-c.s;if(0>k)return 1;if(0<k)return-1;k=c.e-a.e;return 0>k?1:0<k?-1:0}function d(a){function c(a){a=g.toggleSel(a.ai);d3.select(this).classed("obj-sel",a)}var k,d,e,f,u=g.bands[a];a?(k=g.bands[0],u.t=k.t+k.h+37,k=d=e=g.instRad,f=2*g.instRad+3):(u.t=0,k=d=e=1);u.h=l*u.tHt+2;u.g.attr("transform","translate(0,"+u.t+")").attr("height",u.h);var C,n;a&&(C=.75*u.iHt+"px",n=.8*u.iHt);var h;h=d3.select(u.svgID).selectAll(".lgBd").remove();h=d3.select(u.svgID).selectAll(".lgBd").data(g.lgBds).enter().append("svg").attr("class",
"lgBd").attr("y",function(a){return u.yScale(a.t)}).attr("height",function(a){return u.yScale(a.h)});h.append("rect").attr("width","100%").attr("height","100%").attr("fill",function(a){return a.d.v});1===a&&h.append("text").attr("class","lgBdLbl").attr("x",2).attr("y",n).attr("fill",function(a){return a.d.b?"#000000":"#FFFFFF"}).style("font-size",C).text(function(a){return a.d.l});var z;d3.select(u.svgID).selectAll(".event").remove();z=d3.select(u.svgID).selectAll(".event").data(g.events).enter().append("svg").attr("class",
function(a){return a.f&EVENT_INSTANT?"event instant":"event range"}).attr("y",function(a){return u.yScale(a.t)}).attr("height",u.iHt);if(1===a)z.on("click",c);var w=d3.select(u.svgID).selectAll(".range");w.append("rect").attr("width","100%").attr("height","100%").attr("fill",function(c){return 1===a&&c.f&(EVENT_F_START|EVENT_F_END)?(c.f&(EVENT_F_START|EVENT_F_END))===(EVENT_F_START|EVENT_F_END)?"url("+c.c.v+"-fb)":(c.f&EVENT_F_START)===EVENT_F_START?"url("+c.c.v+"-fs)":"url("+c.c.v+"-fe)":c.c.v});
1===a&&w.append("text").attr("class","rangeLbl").attr("x",4).attr("y",n).attr("fill",function(a){return a.c.b?"#000000":"#FFFFFF"}).style("font-size",C).text(function(a){return a.l});w=d3.select(u.svgID).selectAll(".instant");w.append("circle").attr("cx",k).attr("cy",d).attr("r",e).attr("fill",function(a){return a.c.v});1===a&&w.append("text").attr("class","instantLbl").attr("x",f).attr("y",n).style("font-size",C).text(function(a){return a.l});u.redraw=function(){h.attr("x",function(a){return u.xScale(a.s)}).attr("width",
function(a){return u.xScale(a.e)-u.xScale(a.s)});z.attr("x",function(a){return u.xScale(a.s)}).attr("width",function(a){return u.xScale(a.e)-u.xScale(a.s)});u.parts.forEach(function(a){a.redraw()})}}function e(a){a=g.bands[a];d3.select(a.svgID).selectAll(".axis").attr("transform","translate(0,"+a.h+")")}function f(a){a=g.bands[a];d3.select(a.svgID).selectAll(".bLblCntr").attr("transform","translate(0,"+(a.h+1).toString()+")")}var g=this,h=this.vFrame.getIndex();0<this.recSel.length&&(this.recSel=
[]);this.preRender();this.events=[];this.lgBds=[];var l=0;(function(){for(var d=PData.eTNum(),e=0,k,x,q,f,u,h,n,y;e<d;){for(k=a.t[e];0===k.n;){if(++e==d)return;k=a.t[e]}q=g.vFrame.getSelLocAtts(e);if(0!==q.length&&(q=g.vFrame.getSelFeatAtts(e),0!==q.length)){g.tUsed[e]=!0;y=g.vFrame.getSelLegend(e);n=PData.aByID(y);f=g.settings.dAtts[e];for(var z,w,r,p,A,B,D,F,E=[],G=k.i;G<k.i+k.n;G++)x=a.s[G],F=PData.rByN(x),u=F.a[y],"undefined"!==typeof u&&(u=PData.lRecs(u,n,q,!1))&&(h=F.a[f])&&"?"!==h&&(g.rMap[x>>
4]|=1<<(x&15),B=h.min.f?EVENT_F_START:0,z=h.min.y,"undefined"===typeof h.min.m?r=w=1:(w=h.min.m,r="undefined"===typeof h.min.d?1:h.min.d),p=PData.d3Nums(z,w,r,!1),"undefined"===typeof h.max?(B|=EVENT_INSTANT,A=p.getTime()+g.instGap):"open"===h.max?A=TODAY:(h.max.f&&(B|=EVENT_F_END),z=h.max.y,"undefined"===typeof h.max.m?(w=12,r=31):(w=h.max.m,r="undefined"===typeof h.max.d?PData.lenMnth(z,w):h.max.d),A=PData.d3Nums(z,w,r,!0)),E.push({s:p,e:A,ai:x,f:B,c:u,l:F.l,t:0}));E.sort(c);var H=[],I;E.forEach(function(a){for(I=
0;I<H.length&&!(a.e<H[I]);I++);a.t=I+l+1;H[I]=a.s});k=PData.aByID(f);k.l.forEach(function(a){D=a.d;z=D.min.y;"undefined"===typeof D.min.m?r=w=1:(w=D.min.m,r="undefined"===typeof D.min.d?1:D.min.d);p=PData.d3Nums(z,w,r,!1);"undefined"===typeof D.max.y?A=TODAY:(z=D.max.y,"undefined"===typeof D.max.m?(w=12,r=31):(w=D.max.m,r="undefined"===typeof D.max.d?PData.lenMnth(z,w):D.max.d),A=PData.d3Nums(z,w,r,!0));g.lgBds.push({s:p,e:A,t:l,h:H.length+1,d:a})});l+=H.length+1;g.events=g.events.concat(E)}e++}})();
g.getWidths();d(0);d(1);(function(){var a=g.bands[0];null!=g.brushSVG&&g.brushSVG.remove();g.brush=d3.svg.brush().x(a.xScale.range([0,a.w])).extent([g.zMinDate,g.zMaxDate]).on("brush",function(){var a=g.brush.extent(),c;"move"===d3.event.mode?(c=d3.time.day.round(a[0]),a=d3.time.day.offset(c,Math.round((a[1]-a[0])/864E5)),c=[c,a]):(c=a.map(d3.time.day.round),c[0]>=c[1]&&(c[0]=d3.time.day.floor(a[0]),c[1]=d3.time.day.ceil(d3.time.day.offset(c[0],Math.round(g.instGap/864E5)))));g.zMinDate=c[0];g.zMaxDate=
c[1];d3.select(this).call(g.brush.extent(c));zoom=g.bands[1];zoom.xScale.domain(c);zoom.redraw()});g.brushSVG=a.g.append("g");g.brushSVG.attr("class","brush").call(g.brush);g.brushSVG.selectAll("rect").attr("y",-1).attr("height",a.h);g.brushSVG.selectAll(".resize").append("path").attr("d",function(c){var k=(c=+("e"==c))?1:-1,d=a.h/4;return"M"+.5*k+","+d+"A6,6 0 0 "+c+" "+6.5*k+","+(d+6)+"V"+(2*d-6)+"A6,6 0 0 "+c+" "+.5*k+","+2*d+"ZM"+2.5*k+","+(d+8)+"V"+(2*d-8)+"M"+4.5*k+","+(d+8)+"V"+(2*d-8)})})();
(function(){var a=g.bands[1],a=a.t+a.h+45;d3.select(g.frameID+" svg.tl-vf").attr("height",a);d3.select("#tl-clip-"+h+" rect").attr("height",a)})();e(0);e(1);f(0);f(1);g.cmpnts.forEach(function(a){a.redraw()})};
VizTime.prototype.resize=function(){var a=this.getWidths(),c=d3.select(this.frameID+" svg.tl-vf");c.attr("width",a[1]);c.select("#tl-clip-"+this.vFrame.getIndex()+" rect").attr("width",a[1]);for(var d=0;2>d;d++){b=this.bands[d];b.w=a[1];c.select(b.svgID).attr("width",a[1]);b.xScale.range([0,a[1]]);var e=b.labels[1],f=e.x()+e.tDelta;b.labelSVGs.select("#rect-"+e.name).attr("x",e.left());b.labelSVGs.select("#txt-"+e.name).attr("x",f);if(0===d){if(this.brush){if(this.brushSVG){var g=this.brush.extent();
this.brushSVG.call(this.brush.extent(g))}this.brushHandler&&this.brushHandler.redraw()}b.labelSVGs.select("#m-txt-"+e.name).attr("x",f)}}this.cmpnts.forEach(function(a){a.redraw()})};VizTime.prototype.setSel=function(a){var c=this;c.recSel=a;d3.select(this.bands[1].svgID).selectAll(".event").attr("class",function(a){return c.isSel(a.ai)?a.f&EVENT_INSTANT?"event instant obj-sel":"event range obj-sel":a.f&EVENT_INSTANT?"event instant":"event range"})};
VizTime.prototype.clearSel=function(){function a(a){return a.f&EVENT_INSTANT?"event instant":"event range"}0<this.recSel.length&&(this.recSel=[],d3.select(this.bands[1].svgID).selectAll(".event").attr("class",a))};
VizTime.prototype.getState=function(){var a=this.brush.extent(),c=a[0],a=a[1],d=c.getUTCMonth()+1,c=c.getUTCFullYear().toString()+"-"+d.toString()+"-"+c.getDate().toString(),d=a.getUTCMonth()+1,a=a.getUTCFullYear().toString()+"-"+d.toString()+"-"+a.getDate().toString();return{d0:c,d1:a,l:this.vFrame.getLgndSels()}};VizTime.prototype.setState=function(a){var c=PData.dStr(a.d0,!1),d=PData.dStr(a.d1,!0);this.bands[1].xScale.domain([c,d]);this.zMinDate=c;this.zMaxDate=d;this.vFrame.setLgndSels(a.l)};
var VizDirectory=function(a,c){PVizModel.call(this,a,c)};VizDirectory.prototype=Object.create(PVizModel.prototype);VizDirectory.prototype.constructor=VizDirectory;VizDirectory.prototype.flags=function(){return V_FLAG_SEL|V_FLAG_VSCRL|V_FLAG_OPT};
VizDirectory.prototype.setup=function(){var a=this;jQuery(this.frameID).on("click.vf",function(c){if("TD"===c.target.nodeName){c=jQuery(c.target).closest("tr");var d=c.data("ai");null!=d&&(a.toggleSel(d)?c.addClass("obj-sel"):c.removeClass("obj-sel"))}else if("TH"===c.target.nodeName){c=jQuery(c.target);var d=c.data("aid"),g=c.closest("table").data("ti");switch(PData.aByID(d).def.t){case "T":case "V":case "N":case "D":c.closest("tr").find("th").removeClass("sel"),c.addClass("sel"),a.sAtts[g]=d,a.rerender(g)}}});
a.sAtts=[];for(var c=0;c<PData.eTNum();c++){var d=jQuery('#dialog-sortby select[data-ti="'+c+'"] :first').val();a.sAtts.push(d)}};
VizDirectory.prototype.render=function(a){var c=this,d=PData.eTNum(),e=0,f,g,h,l,m,t,k,x=jQuery(this.frameID);x.empty();0<this.recSel.length&&(this.recSel=[]);this.preRender();this.stream=a;for(f=a.t[0];e<d;){for(;0===f.n;){if(++e===d)return;f=a.t[e]}c.tUsed[e]=!0;f=PData.eTByN(e);f=PData.tByID(f);x.append('<div class="template-label">'+f.l+'</div><table cellspacing="0" class="viz-directory" data-ti='+e+"></table>");g=x.find('table[data-ti="'+e+'"]');h=c.settings.cnt[e];k=c.sAtts[e];t="<thead><tr>";
h.forEach(function(a){var c=PData.aByID(a);t+='<th data-aid="'+a;a===k&&(t+='" class="sel');t+='">'+c.def.l+"</th>"});g.append(t+"</tr></thead><tbody></tbody>");g=g.find("tbody");f=PData.aByID(k);f=PData.rTOrder(f,c.stream,e);f.forEach(function(a){m=PData.rByN(a.i);c.rMap[a.i>>4]|=1<<(a.i&15);t='<tr data-id="'+m.id+'" data-ai='+a.i+">";h.forEach(function(a){l=m.a[a];"undefined"!==typeof l?t=(l=PData.procAttTxt(a,l))?t+("<td>"+l+"</td>"):t+"<td></td>":t+="<td></td>"});g.append(t+"</tr>")});f=a.t[++e]}};
VizDirectory.prototype.rerender=function(a){var c=this,d,e,f,g,h,l=jQuery(this.frameID+' table.viz-directory[data-ti="'+a+'"] tbody');l.empty();tRec=this.stream.t[a];d=c.settings.cnt[a];e=PData.aByID(c.sAtts[a]);PData.rTOrder(e,c.stream,a).forEach(function(a){g=PData.rByN(a.i);h="<tr "+(c.isSel(a.i)?'class="obj-sel" ':"")+'data-id="'+g.id+'" data-ai='+a.i+">";d.forEach(function(a){f=g.a[a];"undefined"!==typeof f?h=(f=PData.procAttTxt(a,f))?h+("<td>"+f+"</td>"):h+"<td></td>":h+="<td></td>"});l.append(h+
"</tr>")})};VizDirectory.prototype.teardown=function(){jQuery(this.frameID).off("click.vf")};
VizDirectory.prototype.doOptions=function(){for(var a=this,c=0;c<PData.eTNum();c++)jQuery('#dialog-sortby select[data-ti="'+c+'"]').val(a.sAtts[c]);var d=jQuery("#dialog-sortby").dialog({height:220,width:400,modal:!0,buttons:[{text:dlText.ok,click:function(){d.dialog("close");PState.set(PSTATE_BUILD);for(var c=0;c<PData.eTNum();c++){var f=jQuery('#dialog-sortby select[data-ti="'+c+'"]').val();if(f!==a.sAtts[c]){a.sAtts[c]=f;var g=jQuery(a.frameID+' table[data-ti="'+c+'"] thead tr');g.find("th").removeClass("sel");
g.find('th[data-aid="'+f+'"]').addClass("sel");a.rerender(c)}}PState.set(PSTATE_READY)}},{text:dlText.cancel,click:function(){d.dialog("close")}}]})};VizDirectory.prototype.setSel=function(a){var c=this,d,e;this.recSel=a;jQuery(this.frameID).find("tr").each(function(){e=jQuery(this);d=e.data("ai");null!=d&&(c.isSel(d)?e.addClass("obj-sel"):e.removeClass("obj-sel"))})};VizDirectory.prototype.clearSel=function(){0<this.recSel.length&&(this.recSel=[],jQuery(this.frameID).find("tr").removeClass("obj-sel"))};
VizDirectory.prototype.getState=function(){return{s:this.sAtts}};VizDirectory.prototype.setState=function(a){this.sAtts=a.s};var VizTextStream=function(a,c){PVizModel.call(this,a,c)};VizTextStream.prototype=Object.create(PVizModel.prototype);VizTextStream.prototype.constructor=VizTextStream;VizTextStream.prototype.flags=function(){return V_FLAG_LGND|V_FLAG_SEL|V_FLAG_LOC|V_FLAG_VSCRL};
VizTextStream.prototype.getLocAtts=function(a){return null!=a?(a=this.settings.order[a],null==a?null:[a]):_.map(this.settings.order,function(a){return[a]})};VizTextStream.prototype.getFeatureAtts=function(a){return null!=a?this.settings.lgnds[a]:this.settings.lgnds};
VizTextStream.prototype.setup=function(){var a=this;jQuery(this.frameID).on("click.vf",function(c){if("DIV"===c.target.nodeName){c=jQuery(c.target);var d=c.data("ai");"undefined"!==typeof d&&0<=d&&(a.toggleSel(d)?c.addClass("obj-sel"):c.removeClass("obj-sel"))}})};
VizTextStream.prototype.render=function(a){var c=this,d=PData.eTNum(),e=0,f,g,h,l,m,t,k,x,q,v,u,C,n,y,z,w,r,p=jQuery(this.frameID);p.empty();0<this.recSel.length&&(this.recSel=[]);this.preRender();w=this.settings.max-this.settings.min;for(g=a.t[0];e<d;){for(;0===g.n;){if(++e===d)return;g=a.t[e]}q=c.vFrame.getSelLocAtts(e);if(0!==q.length&&(q=c.vFrame.getSelFeatAtts(e),0!==q.length)){c.tUsed[e]=!0;v=c.vFrame.getSelLegend(e);u=PData.aByID(v);p.append('<div class="viz-textstream" data-ti='+e+"></div>");
h=p.find("div.viz-textstream[data-ti="+e+"]");f=PData.eTByN(e);f=PData.tByID(f);h.append('<div class="template-label">'+f.l+"</div>");x=c.settings.cnt[e];if(y=c.settings.sAtts[e])n=PData.aByID(y),"number"===typeof n.r.min&&"number"===typeof n.r.max?z=n.r.max-n.r.min:y=null;x&&(f=PData.aByID(c.settings.order[e]),f=PData.rTOrder(f,a,e),f.forEach(function(a){l=PData.rByN(a.i);m=l.a[v];"undefined"!==typeof m&&(C=PData.lRecs(m,u,q,!1))&&((t=l.a[x])&&(t=PData.procAttTxt(x,t)),t&&(c.rMap[a.i>>4]|=1<<(a.i&
15),y?(k=l.a[y],k="number"===typeof k?Math.floor((k-n.r.min)*w/z)+c.settings.min:c.settings.min):k=c.settings.min,r=C.b?";background-color:black":"",h.append('<div class="recitem" data-ai='+a.i+' style="color:'+C.v+r+";font-size:"+k+'px">'+t+"</div>")))}))}e++}};VizTextStream.prototype.teardown=function(){jQuery(this.frameID).off("click.vf")};
VizTextStream.prototype.setSel=function(a){var c=this;this.vFrame.getIndex();var d,e;this.recSel=a;jQuery(this.frameID).find("div.recitem").each(function(){e=jQuery(this);d=e.data("ai");null!=d&&(c.isSel(d)?e.addClass("obj-sel"):e.removeClass("obj-sel"))})};VizTextStream.prototype.clearSel=function(){0<this.recSel.length&&(this.recSel=[],jQuery(this.frameID).find("div.recitem").removeClass("obj-sel"))};VizTextStream.prototype.getState=function(){return{l:this.vFrame.getLgndSels()}};
VizTextStream.prototype.setState=function(a){this.vFrame.setLgndSels(a.l)};VizTextStream.prototype.hint=function(){for(var a="",c,d,e=PData.eTNum(),f=0;f<e;f++)if(c=this.settings.order[f])if(c=PData.aByID(c),d=PData.eTByN(f),d=PData.tByID(d),0<a.length&&(a+="; "),a+=d.l+": "+dlText.orderedby+" "+c.def.l,c=this.settings.sAtts[f])c=PData.aByID(c),a+=", "+dlText.textsize+" "+c.def.l;return a};var VizNetWheel=function(a,c){PVizModel.call(this,a,c);this.bSel=[]};VizNetWheel.prototype=Object.create(PVizModel.prototype);
VizNetWheel.prototype.constructor=VizNetWheel;VizNetWheel.prototype.flags=function(){return V_FLAG_OPT|V_FLAG_LGND|V_FLAG_SEL|V_FLAG_VSCRL|V_FLAG_HSCRL};VizNetWheel.prototype.getFeatureAtts=function(a){return null!=a?this.settings.lgnds[a]:this.settings.lgnds};
VizNetWheel.prototype.setup=function(){function a(){360<c.spin?c.spin-=360:0>c.spin&&(c.spin+=360);c.center.attr("transform","translate("+c.cr+","+c.cr+")rotate("+c.spin+")")}var c=this;this.spin=0;this.prune=!0;var d=this.vFrame.getIndex(),e=_.template(document.getElementById("dltext-v-nwheel").innerHTML);jQuery("#view-frame-"+d+" div.view-controls").append(e({vi:d}));jQuery("#nw-prev-"+d).button({text:!1,icons:{primary:" ui-icon-arrowreturnthick-1-s"}}).click(function(){jQuery("#nw-size-"+d+" :radio:checked").attr("id")==
"nw-size-1-"+d?c.spin+=c.inc:c.spin+=90;a()});jQuery("#nw-for-"+d).button({text:!1,icons:{primary:" ui-icon-arrowreturnthick-1-n"}}).click(function(){jQuery("#nw-size-"+d+" :radio:checked").attr("id")=="nw-size-1-"+d?c.spin-=c.inc:c.spin-=90;a()});jQuery("#nw-size-"+d).buttonset();this.svg=d3.select(this.frameID).append("svg");this.center=this.svg.append("g")};
VizNetWheel.prototype.render=function(a){var c=this,d=[],e,f,g;a?this.stream=a:a=this.stream;this.svg.selectAll(".node").remove();this.svg.selectAll(".link").remove();0<this.recSel.length&&(this.recSel=[]);this.preRender();var h={children:[]};(function(){var d,k=0,e=0,q,f,g,l=[],n=null,y,m;d=a.t[0];m=c.vFrame.getSelLegend(0);y=PData.aByID(m);n=c.vFrame.getSelFeatAtts(0);0<n.length&&0<d.n&&(c.tUsed[0]=!0);a:for(;e<a.l;){for(;0===d.n||d.i+d.n===e||0===n.length;){0<l.length&&(h.children.push({ti:k,children:l}),
l=[]);if(++k===PData.eTNum())break a;l=[];d=a.t[k];m=c.vFrame.getSelLegend(k);y=PData.aByID(m);n=c.vFrame.getSelFeatAtts(k);0<n.length&&0<d.n&&(c.tUsed[k]=!0)}g=a.s[e];q=PData.rByN(g);f=q.a[m];"undefined"!==typeof f&&(fData=PData.lRecs(f,y,n,!1))&&(c.rMap[g>>4]|=1<<(g&15),l.push({r:q,ai:g,c:fData.v,l:!1,children:[]}));e++}0<l.length&&h.children.push({ti:k,children:l})})();h.children.forEach(function(a){var k=c.settings.pAtts[a.ti],e;a.children.forEach(function(a){k.forEach(function(c){e=a.r.a[c.pid];
"undefined"!==typeof e&&e.forEach(function(k){var e=!1,x,f=0;a:for(;f<h.children.length;f++)for(var g=h.children[f],t=0;t<g.children.length;t++)if(x=g.children[t],x.r.id==k){e=!0;break a}e&&(a.l=!0,x.l=!0,d.push({source:a,target:x,c:c.clr}))})})})});this.prune&&h.children.forEach(function(a){for(var c=a.children.length-1;0<=c;c--)a.children[c].l||a.children.splice(c,1)});var l=0;h.children.forEach(function(a){l+=a.children.length});this.inc=360/(l+h.children.length);f=Math.max((14*l+20)/(2*Math.PI),
30);var m=this.settings.lw;"string"===typeof m&&(m=parseInt(m));this.cr=m+12+f;m=2*this.cr;this.svg.attr("width",m).attr("height",m);this.center.attr("transform","translate("+this.cr+","+this.cr+")");f=d3.layout.cluster().size([360,f]).sort(null).nodes(h);g=this.center.append("g").selectAll(".node").data(f.filter(function(a){return!a.children})).enter().append("g").attr("class","node").attr("transform",function(a){return"rotate("+(a.x-90)+")translate("+(a.y+8)+",0)"});g.append("circle").attr("r",
"5").style("fill",function(a){return a.c}).on("click",function(a){a=c.toggleSel(a.ai);d3.select(this).classed("obj-sel",a)});g.append("text").attr("dy",".31em").attr("dx",function(a){return 180>a.x?"10":"-10"}).attr("transform",function(a){return 180>a.x?"":"rotate(180)"}).style("text-anchor",function(a){return 180>a.x?"start":"end"}).attr("fill","black").text(function(a){return a.r.l}).on("click",function(a){PState.set(PSTATE_UPDATE);g.each(function(a){a.linked=!1});e.each(function(c){if(c.s===a){c.t.linked=
!0;for(var e=0;e<d.length;e++){var q=d[e];if(q.source===a&&q.target===c.t){d3.select(this).attr("stroke",q.c).classed("thick",!0);this.parentElement.appendChild(this);break}}}else if(c.t===a)for(c.s.linked=!0,e=0;e<d.length;e++){if(q=d[e],q.target===a&&q.source===c.s){d3.select(this).attr("stroke",q.c).classed("thick",!0);this.parentElement.appendChild(this);break}}else d3.select(this).attr("stroke","black").classed("thick",!1)});g.select("text").attr("fill",function(a){return a.linked?"white":"black"});
d3.select(this).attr("fill","yellow");PState.set(PSTATE_READY)});f=d3.layout.bundle();m=d3.svg.line.radial().interpolate("bundle").tension(.85).radius(function(a){return a.y}).angle(function(a){return a.x/180*Math.PI});e=this.center.append("g").selectAll(".link").data(f(d)).enter().append("path").each(function(a){a.s=a[0];a.t=a[a.length-1]}).attr("class","link").attr("d",m).attr("stroke","black")};VizNetWheel.prototype.teardown=function(){var a=this.vFrame.getIndex();jQuery("#view-frame-"+a+" div.view-controls div.iconbar").remove()};
VizNetWheel.prototype.setSel=function(a){var c=this;c.recSel=a;this.svg.selectAll(".node circle").attr("class",function(a){return c.isSel(a.ai)?"obj-sel":""})};VizNetWheel.prototype.clearSel=function(){0<this.recSel.length&&(this.recSel=[],this.svg.selectAll(".node circle").attr("class",""))};
VizNetWheel.prototype.doOptions=function(){var a=this;jQuery("#prune-nodes").prop("checked",this.prune);var c=jQuery("#dialog-prune").dialog({height:150,width:400,modal:!0,buttons:[{text:dlText.ok,click:function(){c.dialog("close");PState.set(PSTATE_BUILD);var d=jQuery("#prune-nodes").prop("checked");a.prune!==d&&(a.prune=d,a.render(null));PState.set(PSTATE_READY)}},{text:dlText.cancel,click:function(){c.dialog("close")}}]})};VizNetWheel.prototype.getState=function(){return{l:this.vFrame.getLgndSels()}};
VizNetWheel.prototype.setState=function(a){this.vFrame.setLgndSels(a.l)};function PFilterModel(a,c){this.id=a;this.att=c;this.dirty=!0}PFilterModel.prototype.isDirty=function(a){null!=a&&(!this.dirty&&a&&0<this.id&&jQuery("body").trigger("prospect",{s:PSTATE_FDIRTY}),this.dirty=a);return this.dirty};PFilterModel.prototype.title=function(){return this.att.def.l};PFilterModel.prototype.evalPrep=function(){};PFilterModel.prototype.evalDone=function(){};
PFilterModel.prototype.insertPt=function(){return jQuery('div.filter-instance[data-id="'+this.id+'"] div.filter-body')};PFilterModel.prototype.teardown=function(){};PFilterModel.prototype.getState=function(){return{}};PFilterModel.prototype.setState=function(a){};var PFilterRemove=function(a){PFilterModel.call(this,a,null)};PFilterRemove.prototype=Object.create(PFilterModel.prototype);PFilterRemove.prototype.constructor=PFilterRemove;PFilterRemove.prototype.title=function(){return dlText.rha};
PFilterRemove.prototype.eval=function(a){return!1};PFilterRemove.prototype.setup=function(){var a=this.insertPt(),c=document.getElementById("dltext-filter-remove").innerHTML;a.append(c)};var PFilterText=function(a,c){PFilterModel.call(this,a,c)};PFilterText.prototype=Object.create(PFilterModel.prototype);PFilterText.prototype.constructor=PFilterText;
PFilterText.prototype.evalPrep=function(){var a=this.insertPt();this.cs=a.find("input.filter-text-cs").prop("checked");this.s=a.find("input.filter-text").val();this.cs||(this.s=this.s.toLocaleLowerCase())};PFilterText.prototype.eval=function(a){var c=this.s;if(null==c||""===c)return!0;a=a.a[this.att.id];if("undefined"===typeof a)return!1;this.cs||(a=a.toLocaleLowerCase());return-1!==a.indexOf(c)};
PFilterText.prototype.setup=function(){var a=this,c=this.insertPt(),d=document.getElementById("dltext-filter-text").innerHTML;c.append(d);c.find("input.filter-text").change(function(){a.isDirty(!0)});c.find("input.filter-text-cs").click(function(c){a.isDirty(!0)})};PFilterText.prototype.getState=function(){var a=this.insertPt();return{cs:a.find("input.filter-text-cs").prop("checked"),t:a.find("input.filter-text").val()}};
PFilterText.prototype.setState=function(a){var c=this.insertPt();c.find("input.filter-text-cs").prop("checked",a.cs);c.find("input.filter-text").val(a.t)};var PFilterTags=function(a,c){PFilterModel.call(this,a,c)};PFilterTags.prototype=Object.create(PFilterModel.prototype);PFilterTags.prototype.constructor=PFilterTags;
PFilterTags.prototype.evalPrep=function(){var a=this.insertPt();this.cs=a.find("input.filter-text-cs").prop("checked");this.p=a.find("input.filter-text-p").prop("checked");this.s=a.find("input.filter-text").val();this.cs||(this.s=this.s.toLocaleLowerCase())};PFilterTags.prototype.eval=function(a){var c=this.s;if(null==c||""===c)return!0;a=a.a[this.att.id];if("undefined"===typeof a)return!1;for(;0<a.length;)return a=a[0],this.cs||(a=a.toLocaleLowerCase()),this.p?-1!==a.indexOf(c):a===c;return!1};
PFilterTags.prototype.setup=function(){var a=this,c=this.insertPt(),d=document.getElementById("dltext-filter-tags").innerHTML;c.append(d);c.find("input.filter-text").change(function(){a.isDirty(!0)});c.find("input.filter-text-cs").click(function(c){a.isDirty(!0)});c.find("input.filter-text-p").click(function(c){a.isDirty(!0)})};PFilterTags.prototype.getState=function(){var a=this.insertPt();return{cs:a.find("input.filter-text-cs").prop("checked"),p:a.find("input.filter-text-p").prop("checked"),t:a.find("input.filter-text").val()}};
PFilterTags.prototype.setState=function(a){var c=this.insertPt();c.find("input.filter-text-cs").prop("checked",a.cs);c.find("input.filter-text-p").prop("checked",a.p);c.find("input.filter-text").val(a.t)};var PFilterVocab=function(a,c){PFilterModel.call(this,a,c)};PFilterVocab.prototype=Object.create(PFilterModel.prototype);PFilterVocab.prototype.constructor=PFilterVocab;
PFilterVocab.prototype.evalPrep=function(){var a=this;this.sel=[];this.insertPt().find("div.filter-vocab-row input:checked").each(function(){var c=jQuery(this).parent().data("id");c&&a.sel.push(c)});this.sel.sort();this.ctrs=new Uint16Array(this.sel.length);for(var c=0;c<this.sel.length;c++)this.ctrs[c]=0};
PFilterVocab.prototype.eval=function(a){if(0===this.sel.length)return!1;a=a.a[this.att.id];if("undefined"===typeof a)return!1;for(var c,d,e=0;e<a.length;e++)if(d=a[e],c=_.sortedIndex(this.sel,d),this.sel[c]===d)return this.ctrs[c]++,!0;return!1};PFilterVocab.prototype.evalDone=function(a){var c=this,d,e,f,g;this.insertPt().find("div.filter-vocab-row").each(function(){g=jQuery(this);if(d=g.data("id"))e=_.sortedIndex(c.sel,d),f=c.sel[e]===d?0<a?Math.round(100*c.ctrs[e]/a):0:0,g.next().width(f+"%")})};
PFilterVocab.prototype.setup=function(){var a=this,c='<div class="filter-vocab-container"><div class="filter-vocab-hsa"><input type="checkbox" checked="checked" data-index=-1><i> '+dlText.sha+"</i></div>";this.att.l.forEach(function(a,d){c+='<div class="filter-vocab-entry" data-index="'+d+'"><div class="filter-vocab-row" data-id="'+a.l+'"><input type="checkbox" class="term-parent" checked="checked">'+a.l+'</div><div class="filter-vocab-bar" style="background-color:'+a.v+'"></div>';a.z.forEach(function(g,
h){c+='<div class="filter-vocab-row" data-id="'+g.l+'"><input type="checkbox" data-parent="'+d+'" checked="checked">'+g.l+"</div>";c=null==g.v||""===g.v?c+('<div class="filter-vocab-bar" style="background-color:'+a.v+'"></div>'):c+('<div class="filter-vocab-bar" style="background-color:'+g.v+'"></div>')});c+="</div>"});var d=this.insertPt();d.append(c+"</div>");d.click(function(c){var f=c.target;"INPUT"===f.nodeName&&("undefined"!==typeof f.dataset.index&&-1==f.dataset.index?(c=f.checked,d.find("div.filter-vocab-row input").prop("checked",
c)):"term-parent"===c.target.className&&f.checked&&d.find('input[data-parent="'+c.target.parentElement.parentElement.dataset.index+'"]').prop("checked",!0),a.isDirty(!0))})};PFilterVocab.prototype.getState=function(){var a=[];this.insertPt().find("div.filter-vocab-row input:checked").each(function(){var c=jQuery(this).parent().data("id");c&&a.push(c)});a.sort();return{s:a}};
PFilterVocab.prototype.setState=function(a){this.insertPt().find("div.filter-vocab-row").each(function(){var c=jQuery(this),d=c.data("id"),d=_.indexOf(a.s,d,!0);c.find("input").prop("checked",-1!==d)})};var PFilterNum=function(a,c){PFilterModel.call(this,a,c)};PFilterNum.prototype=Object.create(PFilterModel.prototype);PFilterNum.prototype.constructor=PFilterNum;
PFilterNum.prototype.refreshBoxes=function(){var a=this.insertPt();a.find(".from").removeClass("error").val(this.min);a.find(".to").removeClass("error").val(this.max);a.find(".filter-update").prop("disabled",!0)};
PFilterNum.prototype.evalBoxes=function(a){function c(c,h){function k(){x=!0;a.find(c).addClass("error")}var x=!1,q,v=a.find(c).val();(v=e.exec(v))?(a.find(c).removeClass("error"),q=parseInt(v[1],10)):k();x||(0==h?null!==f&&q<f&&k():null!==g&&q>g&&k());d.uNums[h]=q;return x}var d=this,e=/^(\d+)$/,f="undefined"===typeof this.att.r.min?null:this.att.r.min,g="undefined"===typeof this.att.r.max?null:this.att.r.max,h,l;h=c(".from",0);l=c(".to",1);this.uNums[0]>this.uNums[1]&&(l=!0);a.find(".filter-update").prop("disabled",
h||l);return!(h||l)};PFilterNum.prototype.useBoxes=function(a){if(this.evalBoxes(a)){this.isDirty(!0);this.min=this.uNums[0];this.max=this.uNums[1];if(null!==this.rCats){var c,d;for(c=0;c<this.rCats.length&&!(this.min<=this.rCats[c].max);c++);for(d=c;d<this.rCats.length&&!(this.max<=this.rCats[d].max);d++);d=d===this.rCats.length?this.rCats.length-1:d;this.b0=c;this.b1=d;this.brushg.call(this.brush.extent([c,d+1]))}a.find(".filter-update").prop("disabled",!0)}};
PFilterNum.prototype.evalPrep=function(){if(null!==this.rCats)for(var a=0;a<this.rCats.length;a++)this.ctrs[a]=0};PFilterNum.prototype.eval=function(a){a=a.a[this.att.id];if("undefined"===typeof a)return!1;if("?"===a)return this.u;if(a<this.min||a>this.max)return!1;if(null===this.rCats)return!0;for(var c,d=this.b0;d<=this.b1;d++)if(c=this.rCats[d],c.min<=a&&a<=c.max){this.ctrs[d]++;break}return!0};
PFilterNum.prototype.evalDone=function(a){if(null!==this.rCats){for(var c=this,d=80-D3FG_MARGINS.top-D3FG_MARGINS.bottom,e=new Uint16Array(this.ctrs.length),f=0;f<this.ctrs.length;f++)e[f]=0<a?Math.round(100*this.ctrs[f]/a):0;this.chart.selectAll(".bar").transition().duration(500).attr("height",function(a,f){return d-c.yScale(e[f])}).attr("y",function(a,d){return c.yScale(e[d])})}};
PFilterNum.prototype.setup=function(){var a=this;this.u=!1;this.uNums=Array(2);var c=this.insertPt();c.append(document.getElementById("dltext-filter-nums").innerHTML);"undefined"===typeof this.att.r.u?c.find(".allow-undef").prop("disabled",!0):c.find(".allow-undef").click(function(){a.u=c.find("input.allow-undef").prop("checked");a.isDirty(!0)});this.rCats=PData.cRNew(this.att,!1,!1);if(null!==this.rCats){this.ctrs=new Uint16Array(this.rCats.length);this.b0=0;this.b1=this.rCats.length-1;this.min=
this.rCats[0].min;this.max=this.rCats[this.b1].max;var d=80-D3FG_MARGINS.top-D3FG_MARGINS.bottom,e=0;this.rCats.forEach(function(a){e=Math.max(e,a.l.length)});var e=Math.max(D3FG_BAR_WIDTH,7*e),f=this.rCats.length*e,g=d3.scale.linear().domain([0,this.rCats.length]).rangeRound([0,f]),h=d3.scale.linear().domain([0,100]).range([d,0]);this.yScale=h;var l=d3.scale.ordinal().rangeRoundBands([0,f]);l.domain(this.rCats.map(function(a){return a.l}));var l=d3.svg.axis().scale(l).orient("bottom"),m=d3.svg.axis().scale(h).orient("left").ticks(4);
this.chart=f=d3.select(c.get(0)).append("svg").attr("width",f+D3FG_MARGINS.left+D3FG_MARGINS.right).attr("height",d+D3FG_MARGINS.top+D3FG_MARGINS.bottom).append("g").attr("transform","translate("+D3FG_MARGINS.left+","+D3FG_MARGINS.top+")");f.append("g").attr("class","x axis").attr("transform","translate(0,"+d+")").call(l);f.append("g").attr("class","y axis").call(m);f.selectAll(".bar").data(this.rCats).enter().append("rect").attr("class","bar").attr("x",function(a,c){return g(c)+2}).attr("y",function(a){return h(100)}).attr("fill",
function(a){return a.c}).attr("height",function(a){return d-h(100)}).attr("width",e-4);a.brush=d3.svg.brush().x(g).extent([0,this.rCats.length]).on("brushend",function(){if(d3.event.sourceEvent){var c=a.brush.extent(),k=[Math.floor(c[0]),Math.floor(c[1])];k[0]>=k[1]&&(k[0]=Math.floor(c[0]),k[1]=Math.ceil(c[1]));k[1]=Math.max(k[1],k[0]+1);d3.select(this).transition().call(a.brush.extent(k));a.b0=k[0];a.b1=k[1]-1;a.min=a.rCats[a.b0].min;a.max=a.rCats[a.b1].max;a.refreshBoxes();a.isDirty(!0)}});a.brushg=
f.append("g");a.brushg.attr("class","brush").call(a.brush);a.brushg.selectAll("rect").attr("y",-1).attr("height",d+4);a.brushg.selectAll(".resize").append("path").attr("d",function(a){var c=(a=+("e"==a))?1:-1,e=d/4;return"M"+.5*c+","+e+"A6,6 0 0 "+a+" "+6.5*c+","+(e+6)+"V"+(2*e-6)+"A6,6 0 0 "+a+" "+.5*c+","+2*e+"ZM"+2.5*c+","+(e+8)+"V"+(2*e-8)+"M"+4.5*c+","+(e+8)+"V"+(2*e-8)})}else this.min="undefined"===typeof att.r.min?0:att.r.min,this.max="undefined"===typeof att.r.max?100:att.r.max;this.refreshBoxes();
c.find("input[type=text]").change(function(){a.evalBoxes(c)});c.find(".filter-update").click(function(){a.useBoxes(c)})};PFilterNum.prototype.getState=function(){return{min:this.min,max:this.max,u:this.u}};PFilterNum.prototype.setState=function(a){var c=this.insertPt();c.find("input.allow-undef").prop("checked",a.u);this.u=a.u;c.find(".from").removeClass("error").val(a.min);c.find(".to").removeClass("error").val(a.max);this.useBoxes(c)};
var PFilterDates=function(a,c,d){PFilterModel.call(this,a,c,d)};PFilterDates.prototype=Object.create(PFilterModel.prototype);PFilterDates.prototype.constructor=PFilterDates;
PFilterDates.prototype.refreshBoxes=function(){function a(a,e){var f=a.getUTCFullYear(),g=a.getUTCMonth()+1,h=a.getUTCDate();c.find(e+"-y").removeClass("error").val(f);c.find(e+"-m").removeClass("error").val(g);c.find(e+"-d").removeClass("error").val(h)}var c=this.insertPt();a(this.min,".from");a(this.max,".to");c.find(".filter-update").prop("disabled",!0)};
PFilterDates.prototype.evalBoxes=function(a){function c(c,g){function h(k){x=!0;a.find(c+k).addClass("error")}function k(k){a.find(c+k).removeClass("error")}var x=!1,q={y:0,m:0,d:0,ms:null},v=a.find(c+"-y"),v=v.val();(v=e.exec(v))?(k("-y"),q.y=parseInt(v[1],10)):h("-y");v=a.find(c+"-m");v=v.val();(v=f.exec(v))?(q.m=parseInt(v[1],10),1>q.m||12<q.m?h("-m"):k("-m")):h("-m");v=a.find(c+"-d");v=v.val();(v=f.exec(v))?(q.d=parseInt(v[1],10),1>q.d||31<q.d?h("-d"):k("-d")):h("-d");x||(q.ms=PData.d3Nums(q.y,
q.m,q.d,!1),0==g?q.ms<d.rCats[0].min&&(h("-y"),h("-m"),h("-d")):q.ms>d.rCats[d.rCats.length-1].max&&(h("-y"),h("-m"),h("-d")));d.uDates[g]=q;return x}var d=this,e=/^(-?\d+)$/,f=/^(\d{1,2})$/,g,h;g=c(".from",0);h=c(".to",1);this.uDates[0].ms>this.uDates[1].ms&&(h=!0);a.find(".filter-update").prop("disabled",g||h);return!(g||h)};
PFilterDates.prototype.useBoxes=function(a){if(this.evalBoxes(a)){this.isDirty(!0);this.min=this.uDates[0].ms;var c=this.uDates[1].ms;c.setTime(c.getTime()+10);this.max=c;for(var d,c=0;c<this.rCats.length&&!(this.min<this.rCats[c].max);c++);for(d=c;d<this.rCats.length&&!(this.max<=this.rCats[d].max);d++);d=d===this.rCats.length?this.rCats.length-1:d;this.b0=c;this.b1=d;this.brushg.call(this.brush.extent([c,d+1]));a.find(".filter-update").prop("disabled",!0)}};
PFilterDates.prototype.evalPrep=function(){this.c=jQuery("input[name=dctrl-"+this.id+"]:checked").val();for(var a=0;a<this.rCats.length;a++)this.ctrs[a]=0};
PFilterDates.prototype.eval=function(a){function c(a,c,d,e,m){"undefined"!=typeof e.m&&(c=e.m,"undefined"!=typeof e.d&&(d=e.d));return PData.d3Nums(a,c,d,m)}var d=a.a[this.att.id];if("undefined"===typeof d)return!1;if("?"===d)return this.u;if("undefined"===typeof d.max){if(a=c(d.min.y,1,1,d.min,!1),a<this.min||a>=this.max)return!1}else if(a=c(d.min.y,1,1,d.min,!1),d="open"===d.max?TODAY:c(d.max.y,12,31,d.max,!0),"o"===this.c){if(d<this.min||a>=this.max)return!1}else if(this.min>a||d>this.max)return!1;
for(var e=this.b0;e<=this.b1;e++)if(d=this.rCats[e],d.min<=a&&a<d.max){this.ctrs[e]++;break}return!0};PFilterDates.prototype.evalDone=function(a){for(var c=this,d=80-D3FG_MARGINS.top-D3FG_MARGINS.bottom,e=new Uint16Array(this.ctrs.length),f=0;f<this.ctrs.length;f++)e[f]=0<a?Math.round(100*this.ctrs[f]/a):0;this.chart.selectAll(".bar").transition().duration(500).attr("height",function(a,f){return d-c.yScale(e[f])}).attr("y",function(a,d){return c.yScale(e[d])})};
PFilterDates.prototype.setup=function(){var a=this;this.rCats=PData.cRNew(this.att,!1,!1);this.ctrs=new Uint16Array(this.rCats.length);this.b0=0;this.b1=this.rCats.length-1;this.u=!1;this.min=this.rCats[0].min;this.max=this.rCats[this.b1].max;this.uDates=Array(2);var c=80-D3FG_MARGINS.top-D3FG_MARGINS.bottom,d=this.insertPt(),e=0;this.rCats.forEach(function(a){e=Math.max(e,a.l.length)});var e=Math.max(D3FG_BAR_WIDTH,7*e),f=this.rCats.length*e,g=d3.scale.linear().domain([0,this.rCats.length]).rangeRound([0,
f]),h=d3.scale.linear().domain([0,100]).range([c,0]);this.yScale=h;var l=d3.scale.ordinal().rangeRoundBands([0,f]);l.domain(this.rCats.map(function(a){return a.l}));var l=d3.svg.axis().scale(l).orient("bottom"),m=d3.svg.axis().scale(h).orient("left").ticks(4),t=_.template(document.getElementById("dltext-filter-dates").innerHTML);d.append(t({id:this.id}));d.find("input[name=dctrl-"+a.id+"]").change(function(){a.isDirty(!0)});"undefined"===typeof this.att.r.u?d.find(".allow-undef").prop("disabled",
!0):d.find(".allow-undef").click(function(){a.u=d.find("input.allow-undef").prop("checked");a.isDirty(!0)});this.refreshBoxes();d.find("input[type=text]").change(function(){a.evalBoxes(d)});d.find(".filter-update").click(function(){a.useBoxes(d)});this.chart=f=d3.select(d.get(0)).append("svg").attr("width",f+D3FG_MARGINS.left+D3FG_MARGINS.right).attr("height",c+D3FG_MARGINS.top+D3FG_MARGINS.bottom).append("g").attr("transform","translate("+D3FG_MARGINS.left+","+D3FG_MARGINS.top+")");f.append("g").attr("class",
"x axis").attr("transform","translate(0,"+c+")").call(l);f.append("g").attr("class","y axis").call(m);f.selectAll(".bar").data(this.rCats).enter().append("rect").attr("class","bar").attr("x",function(a,c){return g(c)+2}).attr("y",function(a){return h(100)}).attr("fill",function(a){return a.c}).attr("height",function(a){return c-h(100)}).attr("width",e-4);a.brush=d3.svg.brush().x(g).extent([0,this.rCats.length]).on("brushend",function(){if(d3.event.sourceEvent){var c=a.brush.extent(),d=[Math.floor(c[0]),
Math.floor(c[1])];d[0]>=d[1]&&(d[0]=Math.floor(c[0]),d[1]=Math.ceil(c[1]));d[1]=Math.max(d[1],d[0]+1);d3.select(this).transition().call(a.brush.extent(d));a.b0=d[0];a.b1=d[1]-1;a.min=a.rCats[a.b0].min;a.max=a.rCats[a.b1].max;a.refreshBoxes();a.isDirty(!0)}});a.brushg=f.append("g");a.brushg.attr("class","brush").call(a.brush);a.brushg.selectAll("rect").attr("y",-1).attr("height",c+4);a.brushg.selectAll(".resize").append("path").attr("d",function(a){var d=(a=+("e"==a))?1:-1,e=c/4;return"M"+.5*d+","+
e+"A6,6 0 0 "+a+" "+6.5*d+","+(e+6)+"V"+(2*e-6)+"A6,6 0 0 "+a+" "+.5*d+","+2*e+"ZM"+2.5*d+","+(e+8)+"V"+(2*e-8)+"M"+4.5*d+","+(e+8)+"V"+(2*e-8)})};PFilterDates.prototype.getState=function(){function a(a){return a.getUTCFullYear()+"-"+(a.getUTCMonth()+1)+"-"+a.getUTCDate()}var c=jQuery("input[name=dctrl-"+this.id+"]:checked").val();return{min:a(this.min),max:a(this.max),c:c,u:this.u}};
PFilterDates.prototype.setState=function(a){function c(a,c){var g=c.split("-"),h=0;4===g.length?(d.find(a+"-y").removeClass("error").val("-"+g[1]),h=1):d.find(a+"-y").removeClass("error").val(g[0]);d.find(a+"-m").removeClass("error").val(g[++h]);d.find(a+"-d").removeClass("error").val(g[++h])}var d=this.insertPt();jQuery('input[name="dctrl-'+this.id+'"]').val([a.c]);d.find("input.allow-undef").prop("checked",a.u);this.u=a.u;c(".from",a.min);c(".to",a.max);this.useBoxes(d)};
var PData=function(){function a(a,d,e){jQuery.ajax({type:"POST",url:prspdata.ajax_url,data:{action:"prsp_get_records",tmplt_id:prspdata.t[a].id,from:d,count:e},success:function(d,f,x){f=l[a];d=JSON.parse(d);f.d=f.d?f.d.concat(d):d;f.n+=e;c()},error:function(a,c,d){alert(d)}})}function c(){for(var c=!0,e=0;e<prspdata.t.length;e++){var f=l[e].n,v=prspdata.t[e].n;if(f<v){c=!1;v-=f;a(e,f,v<d?v:d);break}}c&&(t=!0,setTimeout(function(){jQuery("body").trigger("prospect",{s:PSTATE_PROCESS})},500))}var d=
1E3,e,f,g,h=[31,28,31,30,31,30,31,31,30,31,30,31],l=[],m=0,t=!1;return{init:function(){e=document.getElementById("dltext-to").innerHTML;f=document.getElementById("dltext-approximately").innerHTML;g=document.getElementById("dltext-now").innerHTML;"number"==typeof prspdata.x.chunk&&0<prspdata.x.chunk&&(d=prspdata.x.chunk);prspdata.t.forEach(function(a){l.push({i:m,n:0,d:null});m+=a.n});c()},rSize:function(){return m},intersect:function(a,c){for(var d=[],e=a.length,f=c.length,g,n,h=0,l=0;h<e&&l<f;)g=
a[h],n=c[l],g>n?l++:n>g?h++:(d.push(g),h++,l++);return d},union:function(a,c){for(var d=[],e=0,f=0,g,n;e<a.length&&f<c.length;)g=a[e],n=c[f],g<n?(d.push(g),e++):(g==n?(d.push(g),e++):d.push(n),f++);for(;e<a.length;e++)d.push(a[e]);for(;f<c.length;f++)d.push(c[f]);return d},strcmp:function(a,c){for(var d=0,e=Math.max(a.length,c.length);d<e&&a.charAt(d)===c.charAt(d);++d);return d===e?0:a.charAt(d)>c.charAt(d)?-1:1},sNew:function(a){var c={};c.s=new Uint16Array(m);c.t=[];c.l=0;if(a){for(a=0;a<m;a++)c.s[a]=
a;for(a=0;a<l.length;a++){var d=l[a];c.t.push({i:d.i,n:d.n})}c.l=m}return c},s1stT:function(a,c){var d=a.t[c];return 0==d.n?-1:d.i},n2T:function(a){for(var c=0;c<l.length;c++){var d=l[c];if(d.i<=a&&a<d.i+d.n)return c}},aInT:function(a,c){return-1!=prspdata.t[c].def.a.findIndex(function(c){return c==a})},rByN:function(a){for(var c=0;c<l.length;c++){var d=l[c];if(0<d.n&&d.i<=a&&a<d.i+d.n)return d.d[a-d.i]}return null},procAttTxt:function(a,c){var d=PData.aByID(a);switch(d.def.t){case "V":case "g":return c.join(", ");
case "T":return c;case "N":return"?"===c?dlText.undef:c.toString();case "D":if("?"===c)return dlText.undef;d="";c.max?(c.min.f&&(d=f+" "),d+=c.min.y.toString(),c.min.m&&(d+="-"+c.min.m.toString(),c.min.d&&(d+="-"+c.min.d.toString())),d+=e+" ","open"==c.max?d+=g:(c.max.f&&(d+=f+" "),d+=c.max.y.toString(),c.max.m&&(d+="-"+c.max.m.toString(),c.max.d&&(d+="-"+c.max.d.toString())))):(d=c.min.f?f+" ":"",d+=c.min.y.toString(),c.min.m&&(d+="-"+c.min.m.toString(),c.min.d&&(d+="-"+c.min.d.toString())));return d;
case "L":case "X":return null!=d.def.d&""!==d.def.d?"number"===typeof c[0]?c.join(", "):c.map(function(a){return a.join(", ")}).join(d.def.d+" "):c.join(", ");case "I":return'<img src="'+c+'" alt="'+d.def.l+'"/>';case "l":return'<a href="'+c+'" target="_blank">(See Link)</a>';case "S":return'<a href="'+c+'" target="_blank">(SoundCloud)</a>';case "Y":return'<a href="https://www.youtube.com/watch?v='+c+'" target="_blank">(YouTube)</a>';case "x":return'<a href="'+c+'" target="_blank">(See Transcript File)</a>';
case "t":return c;case "P":if(0<c.length){var h="";c.forEach(function(a){if(a=PData.rByID(a))0<h.length&&(h+=", "),h+='<a href="'+prspdata.site_url+"?p="+a.wp+'" target="_blank">'+a.l+"</a>"});return h}}return null},rAV:function(a,c,d){for(var e=0;e<l.length;e++){var f=l[e];if(0<f.n&&f.i<=a&&a<f.i+f.n){a=f.d[a-f.i].a[c];if(null==a||"undefined"===typeof a)break;return d?a:PData.procAttTxt(c,a)}}return null},nByID:function(a){for(var c=0;c<l.length;c++){var d=l[c];if(0<d.n)for(var e=0,f=d.n-1,g,n;e<=
f;)if(g=e+f>>1,n=d.d[g],n=PData.strcmp(a,n.id),0>n)e=g+1;else if(0<n)f=g-1;else return d.i+g}return null},rByID:function(a){for(var c=0;c<l.length;c++){var d=l[c];if(0<d.n)for(var e=0,f=d.n-1,g,n,h;e<=f;)if(g=e+f>>1,h=d.d[g],n=PData.strcmp(a,h.id),0>n)e=g+1;else if(0<n)f=g-1;else return h}return null},aByID:function(a){for(var c=0,d=prspdata.a.length-1,e,f;c<=d;)if(e=c+d>>1,f=PData.strcmp(a,prspdata.a[e].id),0>f)c=e+1;else if(0<f)d=e-1;else return prspdata.a[e];return null},aByN:function(a){return prspdata.a[a]},
eTNum:function(){return prspdata.e.g.ts.length},eTByN:function(a){return prspdata.e.g.ts[a]},tByID:function(a){for(var c=0;c<prspdata.t.length;c++)if(a==prspdata.t[c].id)return prspdata.t[c].def},lRecs:function(a,c,d,e){var f,g=d.length,n;switch(c.def.t){case "V":var h=function(a){for(var e=0;e<g;e++)if(f=d[e],"number"===typeof f){if(n=c.l[f],n.l===a)return n}else{n=c.l[f[0]];var k=n.z[f[1]];if(k.l===a)return k.v&&""!==k.v?k:n}return null};if(e&&""!==c.def.d){var l=[],m;a.forEach(function(a){m=h(a);
null!=m&&l.push(m)});return 0<l.length?l:null}if(""!=c.def.d){for(e=0;e<a.length;e++)if(m=h(a[e]),null!=m)return m;break}else return h(a[0]);case "T":for(m=0;m<g;m++)if(f=d[m],n=c.l[f],-1!=a.indexOf(n.d))return n;break;case "N":m=0;if(-1===d[0]){if("?"===a){if("undefined"===typeof c.r.u)break;return c.r.u}m=1}if("?"===a)break;for(;m<g;m++)if(f=d[m],n=c.l[f],"undefined"!==typeof n.d.min){if(n.d.min<=a)if("undefined"!==typeof n.d.max){if(a<=n.d.max)return n}else return n}else if(a<=n.d.max)return n;
break;case "D":m=0;if(-1===d[0]){if("?"===a){if("undefined"===typeof c.r.u)break;return c.r.u}m=1}if("?"!==a)for(;m<g;m++)if(f=d[m],n=c.l[f],"undefined"!==typeof n.d.max.y){if("undefined"!==typeof a.max&&"open"!==a.max){if(a.max.y<n.d.min.y)continue;if(a.max.y===n.d.min.y&&a.max.m&&n.d.min.m){if(a.max.m<n.d.min.m)continue;if(a.max.m==n.d.min.m&&a.max.d&&n.d.min.d&&a.max.d<n.d.min.d)continue}}if(!(a.min.y>n.d.max.y)){if(a.min.y===n.d.max.y&&a.min.m&&n.d.max.m){if(a.min.m>n.d.max.m)continue;if(a.min.m===
n.d.max.m&&a.min.d&&n.d.max.d&&a.min.d>n.d.max.d)continue}return n}}else if("undefined"!==typeof a.max){if("open"===a.max)return n;if(!(a.max.y<n.d.min.y)){if(a.max.y===n.d.min.y&&a.max.m&&n.d.min.m){if(a.max.m<n.d.min.m)continue;if(a.max.m===n.d.min.m&&a.max.d&&n.d.min.d&&a.max.d<n.d.min.d)continue}return n}}else if(!(a.min.y<n.d.min.y)){if(a.min.y===n.d.min.y&&a.min.m&&n.d.min.m){if(a.min.m<n.d.min.m)continue;if(a.min.m===n.d.min.m&&a.min.d&&n.d.min.d&&a.min.d<n.d.min.d)continue}return n}}return null},
lClr:function(a,c,d){var e;return(e=PData.lRecs(a,c,d,!1))?e.v:null},lenMnth:function(a,c){return 2===c&&0===a%4&&0!==a%100||0===a%400?29:h[c-1]},d3Nums:function(a,c,d,e){0>a||99<a?c=new Date(a,c-1,d):0==a?c=new Date(-1,c-1,d):(c=new Date(a,c-1,d),c.setUTCFullYear(("0000"+a).slice(-4)));e&&c.setTime(c.getTime()+MS_IN_DAY);return c},dObj:function(a,c,d){var e;"undefined"!==typeof a.m&&null!==a.m?(c=a.m,e="undefined"!==typeof a.d&&null!==a.d?a.d:PData.lenMnth(a.y,c)):e=PData.lenMnth(a.y,c);return PData.d3Nums(a.y,
c,e,d)},dStr:function(a,c){var d,e;if("open"==a)return TODAY;d=1;"-"===a.charAt(0)&&(d=-1,a=a.substring(1));e=a.split("-");var f=parseInt(e[0])*d;1<e.length?(d=parseInt(e[1]),e=3==e.length?parseInt(e[2]):c?PData.lenMnth(f,d):1):c?(d=12,e=31):e=d=1;return PData.d3Nums(f,d,e,c)},cLNew:function(a,c,d){var e=[];switch(a.def.t){case "T":return a.l.forEach(function(d){(null==c||PData.lRecs(d.d,a,c,!1))&&e.push({l:d.l,x:d.d,c:d.v,i:[]})}),e;case "g":return e;case "V":return a.l.forEach(function(d){(null==
c||PData.lRecs([d.l],a,c,!1))&&e.push({l:d.l,c:d.v,i:[]});d.z.forEach(function(f){if(null==c||PData.lRecs([f.l],a,c,!1))""===f.v?e.push({l:f.l,c:d.v,i:[]}):e.push({l:f.l,c:f.v,i:[]})})}),e;case "N":return d&&"undefined"!==typeof a.r.u&&(null==c||PData.lRecs("?",a,c,!1))&&e.push({l:"?",c:a.r.u.v,min:"?",max:"?",i:[]}),a.l.forEach(function(d){(null==c||PData.lRecs(d.d.min,a,c,!1))&&e.push({l:d.l,c:d.v,min:d.d.min,max:d.d.max,i:[]})}),e;case "D":d&&"undefined"!==typeof a.r.u&&(null==c||PData.lRecs("?",
a,c,!1))&&e.push({l:"?",c:a.r.u.v,min:"?",max:"?",i:[]});var f,g;a.l.forEach(function(d){f=PData.dObj(d.d.min,1,!1);if(null===c||PData.lRecs(f,a,c,!1))g=null==d.d.max.y?TODAY:PData.dObj(d.d.max,12,!1),g.setTime(g.getTime()+10),e.push({l:d.l,c:d.v,min:f,max:g,i:[]})});return e}},cRNew:function(a,c,d){var e=[];switch(a.def.t){case "T":return a.l.forEach(function(a){c?e.push({l:a.l,x:a.d,c:a.v,i:[]}):e.push({l:a.l,x:a.d,c:a.v})}),e;case "g":return e;case "V":return a.l.forEach(function(a){c?e.push({l:a.l,
c:a.v,i:[]}):e.push({l:a.l,c:a.v});a.z.forEach(function(d){var f=""===d?a.v:d.v;c?e.push({l:d.l,c:f,i:[]}):e.push({l:d.l,c:f})})}),e;case "N":if("undefined"===typeof a.r.min||"undefined"===typeof a.r.max)return null;d&&"undefined"!==typeof a.r.u&&(c?e.push({l:"?",c:a.r.u.v,min:"?",max:"?",i:[]}):e.push({l:"?",c:a.r.u.v,min:"?",max:"?"}));var f=Math.pow(10,a.r.g),g=a.r.min,h=0,l,m,w;for(0<a.l.length&&(l=a.l[0]);g<=a.r.max;){for(;h<a.l.length&&"undefined"!==typeof l.d.max&&g>l.d.max;)l=a.l[++h];w=0==
a.l.length||g<l.d.min?"#777777":h===a.l.length?"#777777":"undefined"===typeof l.d.max||g<=l.d.max?l.v:"#777777";m=g;g+=f;max=g-1;max>a.r.max&&(max=a.r.max);var r=m.toString();1<f&&4>r.length&&m!==max&&(r+="-"+max.toString());c?e.push({l:r,c:w,min:m,max:max,i:[]}):e.push({l:r,c:w,min:m,max:max})}return e;case "D":g=function(a){var c,d;if("undefined"===typeof a.y)return TODAY;c=a.y;"undefined"===typeof a.m?(d=12,a=31):(d=a.m,a="undefined"===typeof a.d?PData.lenMnth(c,d):a.d);return PData.d3Nums(c,d,
a,!1)};m=function(a,c,d,e){"undefined"!==typeof e.m&&(c=e.m,"undefined"!==typeof e.d&&(d=e.d));return PData.d3Nums(a,c,d,!1)};w=g(a.r.max);var f=a.r.g,r=a.r.min.y,p=1,t=1;"undefined"!==typeof a.r.min.m&&(p=a.r.min.m,"undefined"!==typeof a.r.min.d&&(t=a.r.min.d));var B=PData.d3Nums(r,p,t,!1),h=0,D,F;0<a.l.length&&(l=a.l[0],D=m(l.d.min.y,1,1,l.d.min),F=g(l.d.max));for(d&&"undefined"!==typeof a.r.u&&(c?e.push({l:"?",c:a.r.u.v,min:"?",max:"?",i:[]}):e.push({l:"?",c:a.r.u.v,min:"?",max:"?"}));B<=w;){d=
{};c&&(d.i=[]);switch(f){case "d":d.l=r.toString()+"-"+p.toString()+"-"+t.toString();break;case "m":d.l=r.toString()+"-"+p.toString();break;case "y":case "t":case "c":d.l=r.toString()}for(;h<a.l.length&&B>F;)l=a.l[++h],h<a.l.length&&(D=m(l.d.min.y,1,1,l.d.min),F=g(l.d.max));d.c=0==a.l.length||B<D?"#777777":h==a.l.length?"#777777":B<=F?l.v:"#777777";d.min=B;switch(f){case "d":++t>PData.lenMnth(r,p)&&(t=1,12<++p&&(p=1,r++));break;case "m":12<++p&&(p=1,r++);break;case "y":r++;break;case "t":r+=10;break;
case "c":r+=100}B=PData.d3Nums(r,p,t,!1);B>TODAY&&(B=TODAY);B.setTime(B.getTime()+10);d.max=B;e.push(d);B=PData.d3Nums(r,p,t,!1)}return e}},cFill:function(a,c,d,e){var f=PData.eTNum(),g=0,h,l=0,m,w,r,p,t=PData.aByID(c);for(h=e.t[0];l<e.l;){for(;0===h.n||h.i+h.n===l||!PData.aInT(c,g)||d&&!PData.aInT(d,g);){if(++g===f)return;h=e.t[g];l=h.i}m=e.s[l];w=PData.rByN(m);w=w.a[c];if("undefined"!==typeof w)switch(t.def.t){case "T":for(r=0;r<a.length;r++)if(p=a[r],-1!==w.indexOf(p.x)){p.i.push(m);break}break;
case "g":w.forEach(function(c){for(r=0;r<a.length;r++)if(p=a[r],c===p.l){p.i.push(m);break}r===a.length&&a.push({l:c,i:[m],c:"#"+Math.floor(16777215*Math.random()).toString(16)})});break;case "V":w.forEach(function(c){for(r=0;r<a.length;r++)if(p=a[r],c==p.l){p.i.push(m);break}});break;case "N":r=0;p=a[0];if("?"===p.min){if("?"===w){p.i.push(m);break}r=1}if("?"===w)break;for(;r<a.length;r++){p=a[r];if(w<p.min)break;if(p.min<=w&&w<=p.max){p.i.push(m);break}}break;case "D":r=0;p=a[0];if("?"===p.min){if("?"===
w){p.i.push(m);break}r=1}if("?"!==w)for(w=PData.dObj(w.min,1,!1);r<a.length;r++){p=a[r];if(w<p.min)break;if(p.min<=w&&w<p.max){p.i.push(m);break}}}l++}"g"==t.def.t&&a.sort(function(a,c){return PData.strcmp(c.l,a.l)})},cSort:function(a,c,d){var e=c.id,f,g,h;a.forEach(function(a){f=PData.rByN(a);datum=f.a[e];if("undefined"!==typeof datum)switch(c.def.t){case "T":for(g=0;g<d.length;g++)if(h=d[g],-1!==datum.indexOf(h.x)){h.i.push(a);break}break;case "g":datum.forEach(function(c){for(g=0;g<d.length;g++)if(h=
d[g],c===h.l){h.i.push(a);break}g===d.length&&d.push({l:c,i:[a],c:"#777777"})});break;case "V":datum.forEach(function(c){for(g=0;g<d.length;g++)if(h=d[g],c===h.l){h.i.push(a);break}});break;case "N":g=0;h=d[0];if("?"===h.min){if("?"===datum){h.i.push(a);break}g=1}if("?"===datum)break;for(;g<d.length;g++){h=d[g];if(datum<h.min)break;if(h.min<=datum&&datum<=h.max){h.i.push(a);break}}break;case "D":g=0;h=d[0];if("?"===h.min){if("?"===datum){h.i.push(a);break}g=1}if("?"!==datum){var k=PData.dObj(datum.min,
1,!1);for(g=0;g<d.length;g++){h=d[g];if(k<h.min)break;if(h.min<=k&&k<h.max){h.i.push(a);break}}}}});"g"==c.def.t&&d.sort(function(a,c){return PData.strcmp(c.l,a.l)})},rTOrder:function(a,c,d){function e(a){return a}function f(a){return a[0]}function g(a){if("?"===a)return"?";var c=1,d=1;"undefined"!==typeof a.min.m&&(c=a.min.m,"undefined"!==typeof a.min.d&&(d=a.min.d));return PData.d3Nums(a.min.y,c,d,!1)}var h,m;switch(a.def.t){case "T":h=e;m="~";break;case "V":h=f;m="~";break;case "g":h=f;m="~";break;
case "N":h=e;m=a.r.max;break;case "D":h=g,m=TODAY}var t=[],w=c.t[d];d=l[d];for(var r=0,p,A;r<w.n;)p=c.s[w.i+r++],A=d.d[p-d.i],A=A.a[a.id],"undefined"===typeof A?t.push({i:p,v:m}):t.push({i:p,v:h(A)});switch(a.def.t){case "T":case "g":case "V":t.sort(function(a,c){return PData.strcmp(c.v,a.v)});break;case "D":case "N":t.sort(function(a,c){return"?"===a.v?-1:"?"===c.v?1:a.v-c.v})}return t},vByN:function(a){return prspdata.e.vf[a]},ready:function(){return t}}}();